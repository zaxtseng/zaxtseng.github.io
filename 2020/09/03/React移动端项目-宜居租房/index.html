<!DOCTYPE html>





<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="/lib/fancybox/source/jquery.fancybox.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"always","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="React移动端项目-宜居租房简介本项目采用React脚手架create-react-app搭建,使用less预处理配合rem,使用redux保存调用相关数据.后端mock数据采用node.js的express框架进行创建.前后端分离,跨域使用http-proxy-middleware中间件.使用模块化的方式处理各个页面.公共组件抽离到统一目录下方便调用.">
<meta name="keywords" content="javascript, Vue, React, Node, HTML5">
<meta property="og:type" content="article">
<meta property="og:title" content="React移动端项目-宜居租房">
<meta property="og:url" content="http://yoursite.com/2020/09/03/React移动端项目-宜居租房/index.html">
<meta property="og:site_name" content="Zax&#39;s BLOG">
<meta property="og:description" content="React移动端项目-宜居租房简介本项目采用React脚手架create-react-app搭建,使用less预处理配合rem,使用redux保存调用相关数据.后端mock数据采用node.js的express框架进行创建.前后端分离,跨域使用http-proxy-middleware中间件.使用模块化的方式处理各个页面.公共组件抽离到统一目录下方便调用.">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-09-03T01:42:17.634Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React移动端项目-宜居租房">
<meta name="twitter:description" content="React移动端项目-宜居租房简介本项目采用React脚手架create-react-app搭建,使用less预处理配合rem,使用redux保存调用相关数据.后端mock数据采用node.js的express框架进行创建.前后端分离,跨域使用http-proxy-middleware中间件.使用模块化的方式处理各个页面.公共组件抽离到统一目录下方便调用.">
  <link rel="canonical" href="http://yoursite.com/2020/09/03/React移动端项目-宜居租房/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>React移动端项目-宜居租房 | Zax's BLOG</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zax's BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

</nav>
  <div class="site-search">
    
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>


  </div>
</div>
    </header>

    

  <a href="https://github.com/zaxtseng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/03/React移动端项目-宜居租房/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">React移动端项目-宜居租房

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-09-03 09:41:26 / 修改时间：09:42:17" itemprop="dateCreated datePublished" datetime="2020-09-03T09:41:26+08:00">2020-09-03</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="React移动端项目-宜居租房"><a href="#React移动端项目-宜居租房" class="headerlink" title="React移动端项目-宜居租房"></a>React移动端项目-宜居租房</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本项目采用React脚手架create-react-app搭建,使用less预处理配合rem,使用redux保存调用相关数据.<br><br>后端mock数据采用node.js的express框架进行创建.前后端分离,跨域使用http-proxy-middleware中间件.<br><br>使用模块化的方式处理各个页面.公共组件抽离到统一目录下方便调用.</p><a id="more"></a>
<h2 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h2><p>React+React-Router(v4)+React-Redux+Less+Express+Fetch</p>
<h2 id="项目启动"><a href="#项目启动" class="headerlink" title="项目启动"></a>项目启动</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安装依赖</span></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>再另开一个终端</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node ./mock/index.js</span><br></pre></td></tr></table></figure>

<p>回到第一个终端</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ol>
<li>less配置</li>
</ol>
<p>通过<code>npm install less less-loader -S</code>安装less.<br><br><code>npm eject</code>加载webpack配置,打开<code>config/webpack.config.js</code>文件,<br><br>找到<code>sass</code>配置,复制一份.改为less配置.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> lessRegex = <span class="regexp">/\.less$/</span>;</span><br><span class="line"><span class="keyword">const</span> lessModuleRegex = <span class="regexp">/\.module\.less$/</span>;</span><br></pre></td></tr></table></figure>

<p>搜索<code>sassRegex</code>和<code>sassModuleRegex</code>将相应的文件配置复制一份进行修改.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: lessRegex,</span><br><span class="line">    exclude: lessModuleRegex,</span><br><span class="line">    use: getStyleLoaders(</span><br><span class="line">    &#123;</span><br><span class="line">        importLoaders: <span class="number">2</span>,</span><br><span class="line">        sourceMap: isEnvProduction &amp;&amp; shouldUseSourceMap,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'less-loader'</span></span><br><span class="line">    ),</span><br><span class="line"></span><br><span class="line">    sideEffects: <span class="literal">true</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">    test: lessModuleRegex,</span><br><span class="line">    use: getStyleLoaders(</span><br><span class="line">    &#123;</span><br><span class="line">        importLoaders: <span class="number">2</span>,</span><br><span class="line">        sourceMap: isEnvProduction &amp;&amp; shouldUseSourceMap,</span><br><span class="line">        modules: &#123;</span><br><span class="line">        getLocalIdent: getCSSModuleLocalIdent,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">'less-loader'</span></span><br><span class="line">    ),</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="经验之谈"><a href="#经验之谈" class="headerlink" title="经验之谈"></a>经验之谈</h2><blockquote>
<p>如果出现<code>Cannot find module &#39;resolve&#39;</code>报错,说明依赖没有安装好,大部分是网络原因,运行<code>npm install</code>重新安装一次就好了.</p>
<ol start="2">
<li>rem配置</li>
</ol>
</blockquote>
<p>在index.html中的<code>&lt;header&gt;</code>最后位置放入下列代码.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">doc, win</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> docEl = doc.documentElement,</span><br><span class="line">            resizeEvt = <span class="string">'orientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">'orientationchange'</span> : <span class="string">'resize'</span>,</span><br><span class="line">            recalc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">var</span> clientWidth = docEl.clientWidth;</span><br><span class="line">                <span class="keyword">if</span> (!clientWidth) <span class="keyword">return</span>;</span><br><span class="line">                <span class="keyword">if</span>(clientWidth&gt;=<span class="number">750</span>)&#123;</span><br><span class="line">                    docEl.style.fontSize = <span class="string">'100px'</span>;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    docEl.style.fontSize = <span class="number">100</span> * (clientWidth / <span class="number">750</span>) + <span class="string">'px'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!doc.addEventListener) <span class="keyword">return</span>;</span><br><span class="line">    win.addEventListener(resizeEvt, recalc, <span class="literal">false</span>);</span><br><span class="line">    doc.addEventListener(<span class="string">'DOMContentLoaded'</span>, recalc, <span class="literal">false</span>);</span><br><span class="line">&#125;)(<span class="built_in">document</span>, <span class="built_in">window</span>);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建文件夹</li>
</ol>
<p>在<code>src</code>下创建以下文件夹.</p>
<ul>
<li>路由文件夹<code>router</code></li>
<li>公共组件文件夹<code>components</code></li>
<li>工具类文件夹<code>utils</code></li>
<li>页面文件夹<code>pages</code></li>
<li>静态文件夹<code>static</code></li>
</ul>
<p>在<code>pages</code>下创建各个文件夹<br><br><code>Home, Shop, Life, Mine, NotFound</code>下生成组件<code>index.jsx</code>和<code>style.less</code>.<br></p>
<p>在<code>static</code>文件夹下放入初始化资源<br><br>css,iconfont,images<br></p>
<ol start="4">
<li>路由支持</li>
</ol>
<p><code>npm install react-router react-router-dom --save</code></p>
<p><code>router</code>文件夹下创建<code>AppRouter.jsx</code>文件,将该文件导出挂载到<code>app.js</code>文件内作为组件.<br><br><code>AppRouter</code>文件引入<code>{Route, HashRouter, Switch}</code>,pages下各个页面,将路径和component填入各个<code>Route</code>中.<br></p>
<ol start="5">
<li>css文件初始化</li>
</ol>
<p>在<code>static/common.less</code>中将样式初始化,或者直接引入<code>normalize.css</code>.</p>
<ol start="6">
<li>底部导航</li>
</ol>
<p>引入iconfont字体图标库.在index.js中也引入.<br><br>底部导航是公共组件,在components下创建FootNav文件夹.<br><br>引入router的NavLink,因为需要点击跳转.(注意首页的路径使用exact精确匹配)<br><br>因为每个页面都会用到底部导航,故在每个页面进行引入.<br><br>在各个底部菜单放入图标<code>&lt;i className=&quot;&quot;&gt;</code>引入各个图标.<br></p>
<ol start="7">
<li>HomeHeader</li>
</ol>
<p>创建<code>Home/HomeHeader</code>,按照划分分为3部分,<code>home-header-left,right,middle</code>.<br><br>其中<code>home-header-middle</code>部分包含一个<code>search-container</code>,之中包含一个iconfont和一个<code>input</code>.<br></p>
<ol start="8">
<li>轮播图</li>
</ol>
<p>安装swiper</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react-swipeable-views</span><br></pre></td></tr></table></figure>

<p>在公共组件components文件夹下创建轮播图文件夹Swiper.<br><br>引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwipeableViews <span class="keyword">from</span> <span class="string">'react-swipeable-views'</span></span><br></pre></td></tr></table></figure>

<p>将图片添加到staic/images文件夹下.<br><br>将引入写到home.jsx中,由home向swiper组件传递banner.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Swiper banners=&#123; [banners1, banners2, banners3] &#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>Swiper中直接将得到的<code>this.props.banners</code>用<code>map</code>方法遍历到<code>SwipeableVIews</code>中.</p>
<h3 id="添加轮播图底部小圆点"><a href="#添加轮播图底部小圆点" class="headerlink" title="添加轮播图底部小圆点"></a>添加轮播图底部小圆点</h3><p>在swiper文件夹下创建Pagination文件夹及相关文件.<br><br><code>&lt;Pagination /&gt;</code>和<code>&lt;SwipeableViews&gt;</code>是同级关系.<br><br>小点的数量由banners的长度决定,在<code>&lt;Pagination dots={banners.length} /&gt;</code>中传递给子组件.<br><br>此时dots是数字,需要的是数组.使用new Array的方法将长度转化为数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//转化为[1,1,1]</span></span><br><span class="line"><span class="keyword">const</span> dotsArr = <span class="keyword">new</span> <span class="built_in">Array</span>(dots).fill(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>将数组map到<code>&lt;li&gt;&lt;/li&gt;</code>中.</p>
<h4 id="将小点和轮播图绑定"><a href="#将小点和轮播图绑定" class="headerlink" title="将小点和轮播图绑定"></a>将小点和轮播图绑定</h4><p>给<code>&lt;SwipeableViews&gt;</code>绑定事件,滑动到的当前的图的下标currentIndex,给赋值到index,传递给<code>&lt;Pagination /&gt;</code>,<br><br>它得到currentIndex后拿到<code>&lt;li&gt;</code>中进行判断,<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;li className=&#123;currentIndex === index ? <span class="string">"selected"</span> : <span class="string">""</span>&#125;&gt;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>搭建服务器</li>
</ol>
<p>在项目根目录创建mock文件夹(或者server).<br><br>包含config,index,router文件和一个data文件夹.<br><br>data文件夹下创建home文件夹,热销商品数据<code>hotdata.js</code>.<br><br>安装express,<code>node index.js</code>启动.<br></p>
<ol start="10">
<li>跨域问题</li>
</ol>
<p>安装<code>npm install http-proxy-middleware --save</code><br><br>创建<code>src/setupProxy.js</code>文件<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createProxyMiddleware &#125; = <span class="built_in">require</span>(<span class="string">"http-proxy-middleware"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(createProxyMiddleware (<span class="string">"/api"</span>, &#123; <span class="attr">target</span>: <span class="string">"http://localhost:5000/"</span> &#125;));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="11">
<li>Http处理网络请求</li>
</ol>
<p><code>utils</code>文件夹下创建<code>http.js</code><br><br>主要由两个函数构成,<code>getData, postData</code><br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> qs <span class="keyword">from</span> <span class="string">'querystring'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getDate</span>(<span class="params">url</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = fetch(url)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> ...</span><br></pre></td></tr></table></figure>

<ol start="12">
<li>创建API</li>
</ol>
<p>创建<code>src/api/base.js</code>和index.js,homehot.js.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//base.js</span></span><br><span class="line"><span class="keyword">const</span> base = &#123;</span><br><span class="line">    baseUrl: <span class="string">"http://localhost:5000"</span>,</span><br><span class="line">    homehot1: <span class="string">"/api/homehot1"</span>,</span><br><span class="line">    homehot2: <span class="string">"/api/homehot2"</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 首页热门推荐</span></span><br><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">"./base"</span></span><br><span class="line"><span class="keyword">import</span> &#123;getData&#125; <span class="keyword">from</span> <span class="string">"../utils/http"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> homehot = &#123;</span><br><span class="line">    homehot1Data()&#123;</span><br><span class="line">        <span class="keyword">return</span> getData(base.homehot1)</span><br><span class="line">    &#125;,</span><br><span class="line">    homehot2Data()&#123;</span><br><span class="line">        <span class="keyword">return</span> getData(base.homehot2)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> homehot</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> homehot <span class="keyword">from</span> <span class="string">'./homehot'</span></span><br><span class="line"><span class="comment">//这里注意加括号</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;homehot&#125;</span><br></pre></td></tr></table></figure>

<ol start="13">
<li>创建HomeHot文件夹</li>
</ol>
<p>引入api.在componentDidMount中调用api请求数据.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount()&#123;</span><br><span class="line">    api.homehot.homehot1Data()</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">        .then(<span class="function"><span class="params">data</span> =&gt;</span>&#123; <span class="built_in">console</span>.log(data)&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="14">
<li>分离HomeHot的UI</li>
</ol>
<p>创建<code>./HomeHot/HomeHotView</code>.<br><br>将data传入HomeHotView,HomeHotView中map遍历数据data,放在li中.<br><br>创建style.less样式.<br></p>
<ol start="15">
<li>城市选项</li>
</ol>
<p>创建<code>src/pages/City</code>.将相关引入放到router中.<br><br>给北京添加<code>&lt;Link&gt;</code>,可以点击跳转到城市页面.<br></p>
<ol start="16">
<li>城市选择页面</li>
</ol>
<p>创建公共头部<code>component/Header</code>.<br><br>有一个返回箭头,一个title.其中title由使用页面传参<br><br>返回箭头绑定返回事件.<br><br><code>window.history.back(-1)</code><br><br><code>this.props.history.push(&quot;/home&quot;)</code><br></p>
<ol start="17">
<li>当前城市</li>
</ol>
<p>创建<code>./City/CurrentCity</code>,city也是从父级传递过来.</p>
<ol start="18">
<li>热门城市</li>
</ol>
<p>创建<code>./City/HotCity</code>.<br>点击传递参数时,建议使用bind传参,属于隐式传递.使用箭头函数属于显式传递.<br><br>此时事件定义时就不能用箭头函数了.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义事件</span></span><br><span class="line">clickHandler(cityName)&#123;</span><br><span class="line">    <span class="built_in">console</span>.lig(cityName)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//向事件函数传参</span></span><br><span class="line"><span class="comment">//bind隐式传递</span></span><br><span class="line">&lt;li onClick=&#123;<span class="keyword">this</span>.clickHandler.bind(<span class="keyword">this</span>,<span class="string">'北京'</span>)&#125;&gt;北京&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/箭头函数,显式传递</span></span><br><span class="line"><span class="regexp">&lt;li onClick=&#123;(e)=&gt;this.clickHandler('北京',e)&#125;&gt;北京&lt;/</span>li&gt;</span><br></pre></td></tr></table></figure>

<ol start="19">
<li>创建Redux</li>
</ol>
<p>由于每个页面都需要获取城市信息,所以需要使用Redux存储.</p>
<p>安装redux</p>
<p><code>npm install --save redux react-redux</code></p>
<p>安装redux调试工具</p>
<p><code>npm install --save-dev redux-dectools</code><br><br> 创建<code>src/store/index.js</code>,<code>src/actions/city.js</code>,<code>src/actions/index.js</code>和<code>src/reducer/index.js</code>.<br><br> 再创建constants文件用于定义基本字符串.<br> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/constants/city.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> INIT_CITY = <span class="string">"INIT_CITY"</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> UPDATE_CITY = <span class="string">"UPDATE_CITY"</span></span><br></pre></td></tr></table></figure></p>
<p>创建初始化城市initCity和更新城市updateCity的函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/actions/city.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cityActions <span class="keyword">from</span> <span class="string">"../constants/city"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initCity</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: cityActions.INIT_CITY,</span><br><span class="line">    data</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">updateCity</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type: cityActions.UPDATE_CITY,</span><br><span class="line">    data</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建city的Reducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/reducers/city.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cityActions <span class="keyword">from</span> <span class="string">'../constants/city'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">city</span>(<span class="params">state = initState, action </span>)</span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(action.type)&#123;</span><br><span class="line">        <span class="keyword">case</span> cityActions.INIT_CITY:</span><br><span class="line">            <span class="keyword">return</span> state = action.data;</span><br><span class="line">        <span class="keyword">case</span> cityActions.UPDATE_CITY:</span><br><span class="line">            <span class="keyword">return</span> state = action.data;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>合并Reducer</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/reducers/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">"redux"</span></span><br><span class="line"><span class="keyword">import</span> city <span class="keyword">from</span> <span class="string">'./city'</span></span><br><span class="line"><span class="keyword">const</span> rootReducers = combineReducers(&#123;</span><br><span class="line">    city</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> rootReducers</span><br></pre></td></tr></table></figure>

<p>将Reducer传入store中,创建好store.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/store/index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span></span><br><span class="line"><span class="keyword">import</span> rootReducers <span class="keyword">from</span> <span class="string">'../reducers'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">configureStore</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> store = createStore(rootReducers, </span><br><span class="line">        <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__ ? <span class="built_in">window</span>.__REDUX_DEVTOOLS_EXTENSION__() :<span class="literal">undefined</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="20">
<li>使用Redux</li>
</ol>
<p>主入口文件index.js进行关联.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;Provider&#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> configtureStore <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"><span class="keyword">const</span> store = configtureStore();</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;AppRouter /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>

<p>创建初始化页面<code>src/pages/app.jsx</code></p>
<p>在index页面包裹所有的二级路由,并且路径指向首页</p>
<h2 id="初始化项目需求"><a href="#初始化项目需求" class="headerlink" title="初始化项目需求"></a>初始化项目需求</h2><p>1.1 城市初始化</p>
<p>引入<code>bindActionCreators</code>,<code>connect</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cityActions <span class="keyword">from</span> <span class="string">"../actions/city"</span></span><br><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">"redux"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="comment">//初始化城市数据</span></span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.cityActions.initCity(&#123;</span><br><span class="line">            cityName: <span class="string">'北京</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    render()&#123;</span></span><br><span class="line"><span class="string">        return(</span></span><br><span class="line"><span class="string">            &lt;div&gt;&#123;this.props.children&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        )</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">mapStateToProps = state =&gt; &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        city: state.city</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">mapDispatchToProps = dispatch =&gt; &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        cityActions: bindActionCreators(cityAction, dispatch)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default connect(</span></span><br><span class="line"><span class="string">    mapStateToProps,</span></span><br><span class="line"><span class="string">    mapDispatchToProps</span></span><br><span class="line"><span class="string">)(App)</span></span><br></pre></td></tr></table></figure>

<p>1.2 在Home页面引入读取操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        city: state.city</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">    mapStateToProps</span><br><span class="line">)(Home)</span><br></pre></td></tr></table></figure>

<p>1.3 在City页面也要引入</p>
<p>1.4 将HotCity选中的城市传递到主组件City</p>
<p>定义自定义事件进行传递</p>
<p>传递之后,引入mapDispatchToProps触发修改</p>
<p>改变之后,返回上一页面</p>
<p>1.5 传递城市信息</p>
<p>修改mock中参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mock/router.js</span></span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">"url"</span>)</span><br><span class="line">router.get(config.homehot1,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//接收城市作为参数</span></span><br><span class="line">    <span class="keyword">var</span> cityName = url.parse(req.url,<span class="literal">true</span>).query.city</span><br><span class="line">    <span class="built_in">console</span>.log(cityName)</span><br><span class="line">    res.send(homehot.hot1)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Home组件中<code>&lt;HomeHot /&gt;</code>得到city参数<br><br>HomeHot组件中接受到city参数<br><br>api中同样接受到参数,注意?符号.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> homehot = &#123;</span><br><span class="line">    homehot1Data(city)&#123;</span><br><span class="line">        <span class="keyword">return</span> getData(base.homehot1+<span class="string">"?city="</span>+city)</span><br></pre></td></tr></table></figure>

<p>city如果被选中后又刷新,需要保存之前的数据.<br><br>在City组件中使用<code>localStorage.setItem(&quot;city&quot;,cityName)</code><br><br>之后再componentDidMount中请求city数据可以默认先查看本地是否有数据<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> city = <span class="keyword">this</span>.props.city || localStorage.getItem(<span class="string">"city"</span>) ||  <span class="string">'北京'</span></span><br></pre></td></tr></table></figure>

<ol start="21">
<li>搜索框</li>
</ol>
<p>搜索框可复用,放在公共组件component中.创建<code>SearchInput</code>组件.绑定相应事件.<br><br>创建<code>src/pages/Search</code>页面.在路由中引入<br><br>搜索框组件中,绑定按下Enter开始搜索<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/components/SearchInput</span></span><br><span class="line">keyUpHandler = <span class="function">(<span class="params">event</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(event.keyCode === <span class="number">13</span>)&#123;</span><br><span class="line">        <span class="keyword">this</span>.props.history.push(<span class="string">'/search'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&lt;input onKeyUp=&#123;<span class="keyword">this</span>.keyUpHandler&#125;/&gt;</span><br></pre></td></tr></table></figure>

<p>由于history在组件SearchInput中并没有(只有直接被路由管理的才有),需要从父组件HomeHeader中获取,也没有,继续向上索取,<br><br>最后在Home组件中获取.</p>
<ol start="22">
<li>搜索页面</li>
</ol>
<p>搜索后跳转到搜索页面,创建搜索页面的顶部搜索框<searchheader>,依旧传入history.<br><br>搜索时所填入的数据需要带到搜索页面,用到路由传参.<br><br>在路由中</searchheader></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/search/:content"</span> component=&#123;Search&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>数据在SearchInput中,将value附加到push的网址后面传递出去.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.history.push(<span class="string">"/search/"</span>+<span class="keyword">this</span>.state.value)</span><br></pre></td></tr></table></figure>

<p>获取数据,</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.match.params.content</span><br></pre></td></tr></table></figure>

<ol start="23">
<li>搜索服务器</li>
</ol>
<p>创建<code>mock/data/search/index.js</code><br><br>在<code>mock/router.js</code>创建搜索接口<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 搜索接口</span></span><br><span class="line">router.get(<span class="string">"/search"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 接受参数:city,searchcontent</span></span><br><span class="line">    <span class="keyword">var</span> cityName = url.parse(req.url, <span class="literal">true</span>).query.city;</span><br><span class="line">    <span class="keyword">var</span> searchContent = url.parse(req.url, <span class="literal">true</span>).query.content;</span><br><span class="line">    <span class="keyword">var</span> page = url.parse(req.url, <span class="literal">true</span>).query.page;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"城市："</span>+cityName,<span class="string">"搜索内容："</span>+searchContent,<span class="string">"页码："</span>+page);</span><br><span class="line">    res.send(searchData)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">24. 添加API</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">创建`</span>api/search<span class="string">`</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>js</span><br><span class="line"><span class="comment">// 搜索接口</span></span><br><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">"./base"</span></span><br><span class="line"><span class="keyword">import</span> &#123;getData&#125; <span class="keyword">from</span> <span class="string">"../utils/http"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> search = &#123;</span><br><span class="line">    searchData(city,content)&#123;</span><br><span class="line">        <span class="keyword">return</span> getData(base.search+<span class="string">"?city="</span>+city+<span class="string">"&amp;content="</span>+content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> search</span><br></pre></td></tr></table></figure>

<p><code>/api/index</code>中引入再导出.</p>
<ol start="25">
<li>Search页面</li>
</ol>
<p>创建处理搜索结果的页面SearchList<br><br>SearchList下创建SearchListView<br><br>SearchListView下创建Item</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SearchList</span></span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="comment">//获取城市</span></span><br><span class="line">    <span class="keyword">const</span> city = <span class="keyword">this</span>.props.city</span><br><span class="line">    <span class="comment">//获取搜索内容</span></span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">this</span>.props.content</span><br><span class="line">    api.search.searchData(city,content)</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">        .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                searchData: data</span><br><span class="line">            &#125;)               </span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                 <span class="keyword">this</span>.state.searchData.data ?</span><br><span class="line">                 &lt;SearchListView data=&#123;<span class="keyword">this</span>.state.searchData.data&#125;/&gt; </span><br><span class="line">                 : <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>数据正在加载<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">                &#125;</span><br><span class="line">           &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br></pre></td></tr></table></figure>

<p>SearchListView中将得到的data使用map方法return出Item进行展示.<br><br>Item将data传入组件内.<br><br>组件内将传入的data拆解,渲染.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Item</span></span><br><span class="line"><span class="keyword">const</span> item = <span class="keyword">this</span>.props.data</span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"list-item"</span>&gt;</span><br><span class="line">        &lt;img src=&#123;item.img&#125; alt=<span class="string">''</span>/&gt;</span><br><span class="line">        &lt;div className=<span class="string">"mask"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"left"</span>&gt;</span><br><span class="line">                &lt;p&gt;&#123;item.title&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;&#123;item.houseType&#125;&lt;/</span>p&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div className="right"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="btn"&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;item.rentType&#125;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;p dangerouslySetInnerHTML=&#123;&#123;<span class="attr">__html</span>: item.price+<span class="string">"/月"</span>&#125;&#125;/&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="再次请求的刷新问题"><a href="#再次请求的刷新问题" class="headerlink" title="再次请求的刷新问题"></a>再次请求的刷新问题</h4><p>在生命周期的<code>componentDidUpdate</code>中再次请求<br><br>这时组件渲染之后加载<br><br>将多次使用的api函数封装成一个函数<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">http(city,content)&#123;</span><br><span class="line">        api.search.searchData(city,content)</span><br><span class="line">        .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">        .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                searchData: data</span><br><span class="line">            &#125;)               </span><br><span class="line">        &#125;)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>将上面的函数在<code>componentDidMount</code>和<code>componentDidUpdate</code>中分别调用.<br><br>注意这里容易死循环,组件更新后data被setState重新赋值,然后更新,更新后得到新的参数,又继续更新.死循环.<br></p>
<blockquote>
<p>解决办法:<br>加上判断,componentDidUpdate有两个参数,prevProps和prevState,表示上一次的属性和state.<br><br>比较本次搜索的content和上次是否相等,如果是,就return.<br><br>否则,发起网络请求.<br></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">componentDidUpdate(prevProps,prevState)&#123;</span><br><span class="line">    <span class="keyword">const</span> city = <span class="keyword">this</span>.props.city</span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">this</span>.props.content</span><br><span class="line">    <span class="keyword">if</span>(prevProps.content === content)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.http(city, content)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="26">
<li>搜索详情页的瀑布流</li>
</ol>
<p>封装上拉加载组件<code>LoadMore</code><br><br>判断是否加载到<code>LoadMore</code>，监听滚动事件.<br><br>获取元素偏移量,创建<code>Refs</code>.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>()&#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">     <span class="keyword">this</span>.load = React.crateRef()</span><br><span class="line">&#125;</span><br><span class="line">componentDidMount()&#123;</span><br><span class="line">    <span class="built_in">window</span>.onScroll = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">         <span class="built_in">console</span>.log(<span class="keyword">this</span>.load.current)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        &lt;div ref=&#123;<span class="keyword">this</span>.load&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>滚动事件需要加上函数防抖,只要滚动就不加载触发函数,稍等100ms后加载一次.这就是函数防抖<code>debounce</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//loadMore.js</span></span><br><span class="line">componentDidMount()&#123;</span><br><span class="line"><span class="comment">//事件防抖</span></span><br><span class="line"><span class="keyword">let</span> timer = <span class="literal">null</span></span><br><span class="line"><span class="keyword">const</span> winHeight = <span class="built_in">document</span>.documentElement.clientHeight</span><br><span class="line"><span class="built_in">window</span>.onscroll = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(timer)&#123;</span><br><span class="line">        clearTimeout(timer)</span><br><span class="line">    &#125;</span><br><span class="line">    timer = setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.load.current.getBoundingClientRect().top &lt; winHeight)&#123;</span><br><span class="line">            <span class="keyword">this</span>.props.onLoadMore()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,<span class="number">100</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">componentWillUnmount()&#123;</span><br><span class="line">    <span class="comment">// 取消滚动事件</span></span><br><span class="line">    <span class="built_in">window</span>.onscroll = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>数据加载时是会更新数据,需要把新数据和旧数据拼接在一起.注意要设置初始化的state.<br><br>状态上再添加hasMore,判断是否还有数据.<br><br>将SearchData全部更改为[],获取时也就只要获取对象里的data.<br></p>
<p>在SearchList中增加生命周期componentWillUnmount,将请求取消.<br><br>因为页面如果被点击而跳转到其他页面,请求是异步操作,有可能还没返回.<br><br>等回来了数据发现没有state接收请求了,会报错.需要在页面卸载时取消请求.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//searchList.js</span></span><br><span class="line">http(city,content,page)&#123;</span><br><span class="line">    api.search.searchData(city,content,page)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            searchData: <span class="keyword">this</span>.state.searchData.concat(data.data),</span><br><span class="line">            page: <span class="keyword">this</span>.state.page + <span class="number">1</span>,</span><br><span class="line">            hasMore: data.hasMore</span><br><span class="line">        &#125;)               </span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//如果数据请求未完成就跳转到其他页面需要取消网络请求,否则报错</span></span><br><span class="line">componentWillUnmount()&#123;</span><br><span class="line">    <span class="comment">// 取消网络请求</span></span><br><span class="line">    <span class="keyword">this</span>.setState = <span class="function">(<span class="params">state,callback</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>增加页码,修改服务器.<br>注意修改api</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//api/search.js</span></span><br><span class="line"><span class="keyword">const</span> search = &#123;</span><br><span class="line">    searchData(city,content,page)&#123;</span><br><span class="line">        <span class="keyword">return</span> getData(base.search+<span class="string">"?city="</span>+city+<span class="string">"&amp;content="</span>+content+<span class="string">"&amp;page="</span>+page)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每次做网络请求,page+1.<br>添加hasMore参数,判断是否还有数据.</p>
<ol start="27">
<li>详情页路由配置</li>
</ol>
<p>创建<code>pages/Details</code>.路由中增加详情页.<br><br>在Item页面进行路由传参,item由Link包裹.<code>&lt;Link to={</code>/detail/${item.id}<code>}&gt;</code></p>
<ol start="28">
<li>详情页服务端配置</li>
</ol>
<p>创建<code>mock/data/details/index.js</code>.<br><br>在<code>mock/router.js</code>中增加详情接口.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mock/router.js</span></span><br><span class="line"><span class="comment">//详情接口</span></span><br><span class="line">router.get(<span class="string">"/details"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//接收商品id</span></span><br><span class="line">  <span class="keyword">var</span> id = url.parse(req.url, <span class="literal">true</span>).query.id</span><br><span class="line">  <span class="built_in">console</span>.log(id)</span><br><span class="line">  res.send(detailData)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>同时导入detailData数据.</p>
<ol start="29">
<li>详情页API部分<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//api/details.js</span></span><br><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">"./base"</span></span><br><span class="line"><span class="keyword">import</span> &#123; getData &#125; <span class="keyword">from</span> <span class="string">"../utils/http"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> details = &#123;</span><br><span class="line">    detailsData(id)&#123;</span><br><span class="line">        <span class="keyword">return</span> getData(base.details+<span class="string">"?id="</span>+id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> details;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>其他文件中增加detail的选项.</p>
<ol start="30">
<li>detailData分离</li>
</ol>
<p>创建<code>page/Details/DetailsData</code>.用来请求数据.<br><br>在detail中把id传递进去.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      datas: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="keyword">this</span>.props.id;</span><br><span class="line">    api.detail</span><br><span class="line">      .detailsData(id)</span><br><span class="line">      .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">      .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">          datas: data</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.datas.img ? (</span><br><span class="line">          &lt;DetailsDataView data=&#123;<span class="keyword">this</span>.state.datas&#125; /&gt;</span><br><span class="line">        ) : (</span><br><span class="line">          &lt;div&gt;数据请求中&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建<code>page/Details/DetailsDataView</code>.用来将请求数据展示出来.<br><br>再把请求到的datas传递给DetailsDataView.<br><br>DetailsDataView需要多个公共组件,可以直接引入.<br></p>
<ol start="31">
<li>Tab切换</li>
</ol>
<p>创建公共组件Tabs.<br><br>使用React.children.map()去遍历子元素.<br><br>绑定onClick事件给点击的绑定高亮.将index赋值给currentIndex.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">"Tab_title_wrap"</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    React.Children.map(<span class="keyword">this</span>.props.children, (element,index)=&gt;&#123;</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div className=&#123;<span class="keyword">this</span>.check_title_index(index)&#125; </span><br><span class="line">            onClick=&#123;<span class="keyword">this</span>.tabHandler.bind(<span class="keyword">this</span>,index)&#125;&gt;</span><br><span class="line">                &#123;element.props.tabname&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>使用函数赋值给className的显隐切换.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">check_title_index = <span class="function"><span class="params">index</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> index === <span class="keyword">this</span>.state.currentIndex ? <span class="string">"Tab_title active"</span> : <span class="string">"Tab_title"</span></span><br><span class="line">&#125;</span><br><span class="line">check_item_index = <span class="function"><span class="params">index</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> index === <span class="keyword">this</span>.state.currentIndex ? <span class="string">"show"</span> : <span class="string">"hide"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="32">
<li><p>将信息放到Tabs内</p>
</li>
<li><p>增加评论服务端数据</p>
</li>
</ol>
<p>创建<code>mock/data/comment</code>.<br>增加<code>mock/router</code>评论接口.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//评论接口</span></span><br><span class="line">router.get(<span class="string">"/comment"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//获取商品ID</span></span><br><span class="line">  <span class="keyword">var</span> id = url.parse(req.url, <span class="literal">true</span>).query.id</span><br><span class="line">  res.send(commentData)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="34">
<li><p>增加api中comment</p>
</li>
<li><p>创建详情页DetailData的CommentView组件<br><br>将其中的Item拆分出来</p>
</li>
<li><p>Star组件</p>
</li>
</ol>
<p>创建公共组件Star.<br><br>使用数组判断星星是否高亮.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">if</span>(star &gt;= <span class="number">5</span>)&#123;</span><br><span class="line">        star = <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        &lt;div className=<span class="string">"star-container"</span>&gt;</span><br><span class="line">            &#123;[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].map(<span class="function">(<span class="params">item,index</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> lightClass = star &gt;= item ? <span class="string">' light'</span> : <span class="string">''</span></span><br><span class="line">                <span class="keyword">return</span>(</span><br><span class="line">                    &lt;i key=&#123;index&#125; className=&#123;<span class="string">'icon-star'</span> + lightClass&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">                )</span><br><span class="line">            &#125;)&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="37">
<li>登录页面</li>
</ol>
<p>创建<code>pages/Login</code>页面,储存到Redux.<br><br>引入到路由.<br><br>创建<code>actions/userinfo.js</code><br><br>创建<code>reducers/userinfo.js</code>,将userinfo写到<code>reducers/index.js</code>中.<br></p>
<p>创建<code>pages/Login/LoginView</code>页面.展示登录界面.<br><br>绑定到Login页面,通过绑定事件loginHandler获取user</p>
<ol start="38">
<li>收藏功能</li>
</ol>
<p>新增<code>pages/Details/DetailsData/StoreBuy/StoreBuyView</code>.<br><br>在DetailsDataView中引入.<br><br>收藏页面也增加Redux的连接.点击收藏存在redux中.<br><br>创建Redux一套流程.<br><br>注意此时actions中的收藏初始数据应为数组.<br><br>state存储也是数组形式,<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> collectActions <span class="keyword">from</span> <span class="string">"../constants/collect"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initState = [];</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">collect</span>(<span class="params">state = initState, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> collectActions.COLLECT:</span><br><span class="line">            state.push(action.data)</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">        <span class="keyword">case</span> collectActions.UNCOLLECT:</span><br><span class="line">            <span class="keyword">return</span> state.filter(<span class="function">(<span class="params">element</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">//filter作用把当前数组的element遍历,如果和当前所选不等,就是为true</span></span><br><span class="line">                <span class="comment">//就把该element添加到新数组里,否则,不添加,这样就排除了所选元素</span></span><br><span class="line">                <span class="keyword">if</span> (element.id !== action.data.id) &#123;</span><br><span class="line">                    <span class="keyword">return</span> element;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>判断是否收藏.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//StoreBuy</span></span><br><span class="line">storeHandler = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> username = <span class="keyword">this</span>.props.userinfo.name</span><br><span class="line">    <span class="keyword">const</span> goods_id = <span class="keyword">this</span>.props.id</span><br><span class="line">    <span class="keyword">if</span>(username)&#123;</span><br><span class="line">        <span class="comment">//调用函数判断</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.isStore())&#123;</span><br><span class="line">            <span class="comment">//为true,说明有,取消收藏</span></span><br><span class="line">            <span class="keyword">this</span>.props.collectActions.cancelCollect(&#123;</span><br><span class="line">                id: goods_id</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//收藏实现</span></span><br><span class="line">            <span class="keyword">this</span>.props.collectActions.setCollect(&#123;</span><br><span class="line">                id: goods_id</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//去登陆</span></span><br><span class="line">        <span class="keyword">this</span>.props.history.push(<span class="string">"/login"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//收藏判断</span></span><br><span class="line">isStore = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="keyword">this</span>.props.id</span><br><span class="line">    <span class="keyword">const</span> collects = <span class="keyword">this</span>.props.collect</span><br><span class="line">    <span class="comment">//some判断集合中是否有该id,有返回true</span></span><br><span class="line">    <span class="keyword">return</span> collects.some(<span class="function">(<span class="params">element</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> element.id === id </span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="39">
<li>购物车功能</li>
</ol>
<p>创建<code>pages/ShopCart</code>.<br><br>子组件在创建<code>OrderView</code>和<code>UserView</code><br><br>给<code>HomeHeader</code>中购物车图标增加<code>Link</code>标签跳转.<br><br>进入组件之前判断登录状态.关联redux.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ShopCart</span></span><br><span class="line">componentWillMount()&#123;</span><br><span class="line"><span class="keyword">const</span> userinfo = <span class="keyword">this</span>.props.userinfo.name</span><br><span class="line">    <span class="keyword">if</span>(userinfo)&#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//重定向到登录</span></span><br><span class="line">        <span class="keyword">this</span>.props.history.push(<span class="string">"/login"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="40">
<li>新增order的服务端数据</li>
</ol>
<p>创建<code>mock/data/order</code>文件夹.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//order</span></span><br><span class="line"><span class="built_in">module</span>.exports = [</span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="built_in">Math</span>.random().toString().slice(<span class="number">2</span>),</span><br><span class="line">        title: <span class="string">"东城区 安外大街3号院"</span>,</span><br><span class="line">        houseType: <span class="string">"1室1厅1卫 - 48m²"</span>,</span><br><span class="line">        price: <span class="string">"4800"</span>,</span><br><span class="line">        rentType: <span class="string">"整租"</span>,</span><br><span class="line">        commentState: <span class="number">0</span>,</span><br><span class="line">        img: <span class="string">"http://iwenwiki.com/api/livable/shop/z1.jpg"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="built_in">Math</span>.random().toString().slice(<span class="number">2</span>),</span><br><span class="line">        title: <span class="string">"整租 · 义宾北区2居室-南北"</span>,</span><br><span class="line">        houseType: <span class="string">"2室1厅1卫 - 78m²"</span>,</span><br><span class="line">        price: <span class="string">"7200"</span>,</span><br><span class="line">        rentType: <span class="string">"整租"</span>,</span><br><span class="line">        commentState: <span class="number">0</span>,</span><br><span class="line">        img: <span class="string">"http://iwenwiki.com/api/livable/shop/z5.jpg"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        id: <span class="built_in">Math</span>.random().toString().slice(<span class="number">2</span>),</span><br><span class="line">        title: <span class="string">"整租 · 杨庄北区2居室-南北"</span>,</span><br><span class="line">        houseType: <span class="string">"1室1厅1卫 - 48m²"</span>,</span><br><span class="line">        price: <span class="string">"4300"</span>,</span><br><span class="line">        rentType: <span class="string">"整租"</span>,</span><br><span class="line">        commentState: <span class="number">2</span>,</span><br><span class="line">        img: <span class="string">"http://iwenwiki.com/api/livable/shop/z6.jpg"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>mock/router.js</code>中新增order.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 购物车</span></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">"/car"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> user =  url.parse(req.url, <span class="literal">true</span>).query.user;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"用户："</span>+user);</span><br><span class="line">  res.send(orderComment)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">"/ordercomment"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> info = req.body.info;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"评论信息："</span>+info);</span><br><span class="line">  res.send(&#123;</span><br><span class="line">      msg:<span class="string">'评价成功'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ol start="41">
<li>新增order的api</li>
</ol>
<p>创建<code>api/order</code>和<code>api/ordercomment</code>.<br><br>在<code>base.js</code>中新增order和ordercomment的路由.<br><br>在<code>index.js</code>中新增order和ordercomment的引入.<br><br>购物车评价接口需要写入数据,所以是postData.<br></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ordercomment.js</span></span><br><span class="line"><span class="comment">// 订单评价接口</span></span><br><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">"./base"</span></span><br><span class="line"><span class="keyword">import</span> &#123;postData&#125; <span class="keyword">from</span> <span class="string">"../utils/http"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> orderComment = &#123;</span><br><span class="line">    orderCommentData(info)&#123;</span><br><span class="line">        <span class="keyword">return</span> postData(base.ordercomment,info)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> orderComment</span><br></pre></td></tr></table></figure>

<ol start="42">
<li>网络请求</li>
</ol>
<p>引入api,在登录后发送网络请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//shopcar</span></span><br><span class="line">componentWillMount()&#123;</span><br><span class="line">    <span class="keyword">const</span> userinfo = <span class="keyword">this</span>.props.userinfo.name</span><br><span class="line">    <span class="keyword">if</span>(userinfo)&#123;</span><br><span class="line">    <span class="comment">//网络请求</span></span><br><span class="line">    api.order.orderData(userinfo)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span>=&gt;</span>res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            order: data</span><br><span class="line">        &#125;)       </span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//重定向到登录</span></span><br><span class="line">        <span class="keyword">this</span>.props.history.push(<span class="string">"/login"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>把数据order传给<code>&lt;OrderView /&gt;</code>.<br><br>还是先判断数据是否到来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.state.order.length &gt; <span class="number">0</span> ?</span><br><span class="line">    &lt;OrderView data=&#123;<span class="keyword">this</span>.state.order&#125; /&gt;</span><br><span class="line">    : <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>数据加载中<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="43">
<li>数据接收渲染</li>
</ol>
<p>OrderView接收上级传过来的数据,使用map渲染到页面.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">this</span>.props.order</span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &#123;data.map(item, index)=&gt;&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Item</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">data</span>=<span class="string">&#123;item&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">            &#125;&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="44">
<li><p>Item渲染</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">this</span>.props.data</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=<span class="string">"clear-fix order-item-container"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"order-item-img float-left"</span>&gt;</span><br><span class="line">                &lt;img src=&#123;data.img&#125; alt=&#123;data.title&#125;/&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div className="order-item-comment float-right"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                    data.commentState === 0?</span></span><br><span class="line"><span class="regexp">                    &lt;button className="btn"&gt;评价&lt;/</span>button&gt;</span><br><span class="line">                    : <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"btn  unselected-btn"</span>&gt;</span>已评价<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line">                &#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;div className="order-item-content"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;商户:&#123;data.title&#125;&lt;/</span>span&gt;</span><br><span class="line">                &lt;span&gt;类型:&#123;data.houseType&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt;价格:&#123;data.price&#125;&lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加评价</p>
</li>
</ol>
<p>给评价绑定事件.<br><br>评价状态commentState的值0,1,2分别代表未评价,评价中,已评价.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.state.commentState === <span class="number">0</span> ?</span><br><span class="line">&lt;button className=<span class="string">"btn"</span> onClick=&#123;<span class="keyword">this</span>.commentHandler &#125;&gt;评价&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">: this.state.commentState === 1 ?</span></span><br><span class="line"><span class="regexp">&lt;button className="btn"&gt;评价中&lt;/</span>button&gt;</span><br><span class="line">: <span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"btn  unselected-btn"</span>&gt;</span>已评价<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ol start="46">
<li><p>添加评价框</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>.state.commentState === <span class="number">1</span> ?</span><br><span class="line">&lt;div className=<span class="string">"comment-text-container"</span>&gt;</span><br><span class="line">&lt;textarea style=&#123;&#123; <span class="attr">width</span>: <span class="string">'100%'</span>, <span class="attr">height</span>: <span class="string">'80px'</span> &#125;&#125; className=<span class="string">"comment-text"</span> ref=&#123; <span class="keyword">this</span>.commentText &#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line">&lt;button className=<span class="string">"btn"</span> onClick=&#123;<span class="keyword">this</span>.submitCommentHandler&#125;&gt;提交&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&amp;nbsp;</span></span><br><span class="line"><span class="regexp">        &lt;button className="btn unseleted-btn" onClick=&#123;this.hideComment&#125;&gt;取消&lt;/</span>button&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">:  ""</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>评价事件提交到后台</p>
</li>
</ol>
<p>后台mock/router里创建评价接口.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mock/router.js</span></span><br><span class="line">router.post(<span class="string">"/ordercomment"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> info = req.body.info;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"评论信息："</span>+info);</span><br><span class="line">  res.send(&#123;</span><br><span class="line">      msg:<span class="string">'评价成功'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>mock/index.js</code>中添加解析.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//mock/index.js</span></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>)</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">    extended: <span class="literal">true</span></span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<ol start="51">
<li>增加相关API</li>
</ol>
<p>创建<code>api/ordercomment</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订单评价接口</span></span><br><span class="line"><span class="keyword">import</span> base <span class="keyword">from</span> <span class="string">"./base"</span></span><br><span class="line"><span class="keyword">import</span> &#123;postData&#125; <span class="keyword">from</span> <span class="string">"../utils/http"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> orderComment = &#123;</span><br><span class="line">    orderCommentData(info)&#123;</span><br><span class="line">        <span class="keyword">return</span> postData(base.ordercomment,info)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> orderComment</span><br></pre></td></tr></table></figure>

<ol start="52">
<li>创建非受控组件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.commentText = React.createRef()</span><br><span class="line"></span><br><span class="line">submitCommentHandler()&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        commentState:<span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 发送网络请求</span></span><br><span class="line">    api.orderComment.orderCommentData(&#123;</span><br><span class="line">        info:<span class="keyword">this</span>.commentText.current.value</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> res.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        alert(data.msg);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;textarea ref=&#123;<span class="keyword">this</span>.commentText&#125;&gt;<span class="xml"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>页面暂时写这么多.</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2020/08/28/Todo/" rel="next" title="Todo">
                  <i class="fa fa-chevron-left"></i> Todo
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.gif"
      alt="Zax Tseng">
  <p class="site-author-name" itemprop="name">Zax Tseng</p>
  <div class="site-description motion-element" itemprop="description">Zax's BLOG</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/zaxtseng" title="GitHub &rarr; https://github.com/zaxtseng" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:lanfein9@hotmail.com" title="E-Mail &rarr; mailto:lanfein9@hotmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#React移动端项目-宜居租房"><span class="nav-number">1.</span> <span class="nav-text">React移动端项目-宜居租房</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简介"><span class="nav-number">1.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#技术栈"><span class="nav-number">1.2.</span> <span class="nav-text">技术栈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目启动"><span class="nav-number">1.3.</span> <span class="nav-text">项目启动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环境配置"><span class="nav-number">1.4.</span> <span class="nav-text">环境配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#经验之谈"><span class="nav-number">1.5.</span> <span class="nav-text">经验之谈</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#添加轮播图底部小圆点"><span class="nav-number">1.5.1.</span> <span class="nav-text">添加轮播图底部小圆点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#将小点和轮播图绑定"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">将小点和轮播图绑定</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#初始化项目需求"><span class="nav-number">1.6.</span> <span class="nav-text">初始化项目需求</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#再次请求的刷新问题"><span class="nav-number">1.6.0.1.</span> <span class="nav-text">再次请求的刷新问题</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zax Tseng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> v7.3.0</div>

        








        
      </div>
    </footer>

    

  </div>

  
    
  
  <script color='0,0,255' opacity='0.3' zIndex='-3' count='29' src="/lib/canvas-nest/canvas-nest-nomobile.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/fancybox/source/jquery.fancybox.pack.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/schemes/muse.js?v=7.3.0"></script>



<script src="/js/next-boot.js?v=7.3.0"></script>




  















  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


</body>
</html>
