<!DOCTYPE html>





<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    save_scroll: false,
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta name="description" content="Zax&apos;s BLOG">
<meta name="keywords" content="javascript, Vue, HTML5">
<meta property="og:type" content="website">
<meta property="og:title" content="Zax&#39;s BLOG">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Zax&#39;s BLOG">
<meta property="og:description" content="Zax&apos;s BLOG">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zax&#39;s BLOG">
<meta name="twitter:description" content="Zax&apos;s BLOG">
  <link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Zax's BLOG</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zax's BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

    

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content page-home">
            
  <section id="posts" class="posts-expand">
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/03/he/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/12/03/he/" class="post-title-link" itemprop="url">he</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-12-03 19:48:11" itemprop="dateCreated datePublished" datetime="2019-12-03T19:48:11+08:00">2019-12-03</time>
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/03/HTTP和TCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/12/03/HTTP和TCP/" class="post-title-link" itemprop="url">HTTP/TCP</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-12-03 19:17:45 / 修改时间：19:34:22" itemprop="dateCreated datePublished" datetime="2019-12-03T19:17:45+08:00">2019-12-03</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/03/HTTP、TCP-IP-协议的原理及应用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/12/03/HTTP、TCP-IP-协议的原理及应用/" class="post-title-link" itemprop="url">HTTP、TCP/IP 协议的原理及应用</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-12-03 13:18:21" itemprop="dateCreated datePublished" datetime="2019-12-03T13:18:21+08:00">2019-12-03</time>
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/12/03/前端常见跨域解决方案/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/12/03/前端常见跨域解决方案/" class="post-title-link" itemprop="url">前端常见跨域解决方案</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-12-03 12:34:54" itemprop="dateCreated datePublished" datetime="2019-12-03T12:34:54+08:00">2019-12-03</time>
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/28/虚拟dom/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/28/虚拟dom/" class="post-title-link" itemprop="url">虚拟dom</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-28 19:21:32 / 修改时间：20:19:21" itemprop="dateCreated datePublished" datetime="2019-11-28T19:21:32+08:00">2019-11-28</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>一、真实DOM和其解析流程<br>本节我们主要介绍真实 DOM 的解析过程，通过介绍其解析过程以及存在的问题，从而引出为什么需要虚拟DOM。一图胜千言，如下图为 webkit 渲染引擎工作流程图<br><img src="https://s2.ax1x.com/2019/11/28/QFFJz9.png" alt="QFFJz9.png"><br>所有的浏览器渲染引擎工作流程大致分为5步：创建 DOM 树 —&gt; 创建 Style Rules -&gt; 构建 Render 树 —&gt; 布局 Layout -—&gt; 绘制 Painting。</p>
<p>第一步，构建 DOM 树：用 HTML 分析器，分析 HTML 元素，构建一棵 DOM 树；</p>
<p>第二步，生成样式表：用 CSS 分析器，分析 CSS 文件和元素上的 inline 样式，生成页面的样式表；</p>
<p>第三步，构建 Render 树：将 DOM 树和样式表关联起来，构建一棵 Render 树（Attachment）。每个 DOM 节点都有 attach 方法，接受样式信息，返回一个 render 对象（又名 renderer），这些 render 对象最终会被构建成一棵 Render 树；</p>
<p>第四步，确定节点坐标：根据 Render 树结构，为每个 Render 树上的节点确定一个在显示屏上出现的精确坐标；</p>
<p>第五步，绘制页面：根据 Render 树和节点显示坐标，然后调用每个节点的 paint 方法，将它们绘制出来。</p>
<h4 id="注意点："><a href="#注意点：" class="headerlink" title="注意点："></a>注意点：</h4><p>1、DOM 树的构建是文档加载完成开始的？ 构建 DOM 树是一个渐进过程，为达到更好的用户体验，渲染引擎会尽快将内容显示在屏幕上，它不必等到整个 HTML 文档解析完成之后才开始构建 render 树和布局。</p>
<p>2、Render 树是 DOM 树和 CSS 样式表构建完毕后才开始构建的？ 这三个过程在实际进行的时候并不是完全独立的，而是会有交叉，会一边加载，一边解析，以及一边渲染。</p>
<p>3、CSS 的解析注意点？ CSS 的解析是从右往左逆向解析的，嵌套标签越多，解析越慢。</p>
<p>4、JS 操作真实 DOM 的代价？ 用我们传统的开发模式，原生 JS 或 JQ 操作 DOM 时，浏览器会从构建 DOM 树开始从头到尾执行一遍流程。在一次操作中，我需要更新 10 个 DOM 节点，浏览器收到第一个 DOM 请求后并不知道还有 9 次更新操作，因此会马上执行流程，最终执行10 次。例如，第一次计算完，紧接着下一个 DOM 更新请求，这个节点的坐标值就变了，前一次计算为无用功。计算 DOM 节点坐标值等都是白白浪费的性能。即使计算机硬件一直在迭代更新，操作 DOM 的代价仍旧是昂贵的，频繁操作还是会出现页面卡顿，影响用户体验</p>
<h1 id="二、Virtual-DOM-基础"><a href="#二、Virtual-DOM-基础" class="headerlink" title="二、Virtual-DOM 基础"></a>二、Virtual-DOM 基础</h1><h2 id="2-1、虚拟-DOM-的好处"><a href="#2-1、虚拟-DOM-的好处" class="headerlink" title="2.1、虚拟 DOM 的好处"></a>2.1、虚拟 DOM 的好处</h2><p>​ 虚拟 DOM 就是为了解决浏览器性能问题而被设计出来的。如前，若一次操作中有 10 次更新 DOM 的动作，虚拟 DOM 不会立即操作 DOM，而是将这 10 次更新的 diff 内容保存到本地一个 JS 对象中，最终将这个 JS 对象一次性 attch 到 DOM 树上，再进行后续操作，避免大量无谓的计算量。所以，用 JS 对象模拟 DOM 节点的好处是，页面的更新可以先全部反映在 JS 对象(虚拟 DOM )上，操作内存中的 JS 对象的速度显然要更快，等更新完成后，再将最终的 JS 对象映射成真实的 DOM，交由浏览器去绘制。</p>
<h2 id="2-2、算法实现"><a href="#2-2、算法实现" class="headerlink" title="2.2、算法实现"></a>2.2、算法实现</h2><h3 id="2-2-1、用-JS-对象模拟-DOM-树"><a href="#2-2-1、用-JS-对象模拟-DOM-树" class="headerlink" title="2.2.1、用 JS 对象模拟 DOM 树"></a>2.2.1、用 JS 对象模拟 DOM 树</h3><h4 id="（1）如何用-JS-对象模拟-DOM-树"><a href="#（1）如何用-JS-对象模拟-DOM-树" class="headerlink" title="（1）如何用 JS 对象模拟 DOM 树"></a>（1）如何用 JS 对象模拟 DOM 树</h4><p>例如一个真实的 DOM 节点如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"virtual-dom"</span>&gt;</span><br><span class="line">&lt;p&gt;Virtual DOM&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;ul id="list"&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li class="item"&gt;Item 1&lt;/</span>li&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"item"</span>&gt;Item <span class="number">2</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li class="item"&gt;Item 3&lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">&lt;div&gt;Hello World&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们用 JavaScript 对象来表示 DOM 节点，使用对象的属性记录节点的类型、属性、子节点等。</p>
<p>element.js 中表示节点对象代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Element virdual-dom 对象定义</span></span><br><span class="line"><span class="comment"> * @param &#123;String&#125; tagName - dom 元素名称</span></span><br><span class="line"><span class="comment"> * @param &#123;Object&#125; props - dom 属性</span></span><br><span class="line"><span class="comment"> * @param &#123;Array&lt;Element|String&gt;&#125; - 子节点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Element</span>(<span class="params">tagName, props, children</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.tagName = tagName</span><br><span class="line">    <span class="keyword">this</span>.props = props</span><br><span class="line">    <span class="keyword">this</span>.children = children</span><br><span class="line">    <span class="comment">// dom 元素的 key 值，用作唯一标识符</span></span><br><span class="line">    <span class="keyword">if</span>(props.key)&#123;</span><br><span class="line">       <span class="keyword">this</span>.key = props.key</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span></span><br><span class="line">    children.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">child, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (child <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">            count += child.count</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            children[i] = <span class="string">''</span> + child</span><br><span class="line">        &#125;</span><br><span class="line">        count++</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 子元素个数</span></span><br><span class="line">    <span class="keyword">this</span>.count = count</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">tagName, props, children</span>)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> Element(tagName, props, children);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = createElement;</span><br></pre></td></tr></table></figure>

<p>根据 element 对象的设定，则上面的 DOM 结构就可以简单表示为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> el = <span class="built_in">require</span>(<span class="string">"./element.js"</span>);</span><br><span class="line"><span class="keyword">var</span> ul = el(<span class="string">'div'</span>,&#123;<span class="attr">id</span>:<span class="string">'virtual-dom'</span>&#125;,[</span><br><span class="line">  el(<span class="string">'p'</span>,&#123;&#125;,[<span class="string">'Virtual DOM'</span>]),</span><br><span class="line">  el(<span class="string">'ul'</span>, &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;, [</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 1'</span>]),</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 2'</span>]),</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 3'</span>])</span><br><span class="line">  ]),</span><br><span class="line">  el(<span class="string">'div'</span>,&#123;&#125;,[<span class="string">'Hello World'</span>])</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<p>现在 ul 就是我们用 JavaScript 对象表示的 DOM 结构，我们输出查看 ul 对应的数据结构如下：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFE3i8.png" alt="QFE3i8.png"></p>
<h4 id="（2）渲染用-JS-表示的-DOM-对象"><a href="#（2）渲染用-JS-表示的-DOM-对象" class="headerlink" title="（2）渲染用 JS 表示的 DOM 对象"></a>（2）渲染用 JS 表示的 DOM 对象</h4><p>但是页面上并没有这个结构，下一步我们介绍如何将 ul 渲染成页面上真实的 DOM 结构，相关渲染函数如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * render 将virdual-dom 对象渲染为实际 DOM 元素</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Element.prototype.render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="keyword">this</span>.tagName)</span><br><span class="line">    <span class="keyword">var</span> props = <span class="keyword">this</span>.props</span><br><span class="line">    <span class="comment">// 设置节点的DOM属性</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> propName <span class="keyword">in</span> props) &#123;</span><br><span class="line">        <span class="keyword">var</span> propValue = props[propName]</span><br><span class="line">        el.setAttribute(propName, propValue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> children = <span class="keyword">this</span>.children || []</span><br><span class="line">    children.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">child</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> childEl = (child <span class="keyword">instanceof</span> Element)</span><br><span class="line">            ? child.render() <span class="comment">// 如果子节点也是虚拟DOM，递归构建DOM节点</span></span><br><span class="line">            : <span class="built_in">document</span>.createTextNode(child) <span class="comment">// 如果字符串，只构建文本节点</span></span><br><span class="line">        el.appendChild(childEl)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> el</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们通过查看以上 render 方法，会根据 tagName 构建一个真正的 DOM 节点，然后设置这个节点的属性，最后递归地把自己的子节点也构建起来。</p>
<p>我们将构建好的 DOM 结构添加到页面 body 上面，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ulRoot = ul.render();</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(ulRoot);</span><br></pre></td></tr></table></figure>

<p>这样，页面 body 里面就有真正的 DOM 结构，效果如下图所示：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFSQaQ.png" alt="QFSQaQ.png"></p>
<h3 id="2-2-2、比较两棵虚拟-DOM-树的差异-—-diff-算法"><a href="#2-2-2、比较两棵虚拟-DOM-树的差异-—-diff-算法" class="headerlink" title="2.2.2、比较两棵虚拟 DOM 树的差异 — diff 算法"></a>2.2.2、比较两棵虚拟 DOM 树的差异 — diff 算法</h3><p>diff 算法用来比较两棵 Virtual DOM 树的差异，如果需要两棵树的完全比较，那么 diff 算法的时间复杂度为O(n^3)。但是在前端当中，你很少会跨越层级地移动 DOM 元素，所以 Virtual DOM 只会对同一个层级的元素进行对比，如下图所示， div 只会和同一层级的 div 对比，第二层级的只会跟第二层级对比，这样算法复杂度就可以达到 O(n)。</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFSwa4.png" alt="QFSwa4.png"></p>
<p>####（1）深度优先遍历，记录差异</p>
<p>在实际的代码中，会对新旧两棵树进行一个深度优先的遍历，这样每个节点都会有一个唯一的标记：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFScM6.png" alt="QFScM6.png"></p>
<p>在深度优先遍历的时候，每遍历到一个节点就把该节点和新的的树进行对比。如果有差异的话就记录到一个对象里面。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// diff 函数，对比两棵树</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diff</span>(<span class="params">oldTree, newTree</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> index = <span class="number">0</span> <span class="comment">// 当前节点的标志</span></span><br><span class="line">  <span class="keyword">var</span> patches = &#123;&#125; <span class="comment">// 用来记录每个节点差异的对象</span></span><br><span class="line">  dfsWalk(oldTree, newTree, index, patches)</span><br><span class="line">  <span class="keyword">return</span> patches</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对两棵树进行深度优先遍历</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dfsWalk</span>(<span class="params">oldNode, newNode, index, patches</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> currentPatch = []</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> (oldNode) === <span class="string">"string"</span> &amp;&amp; <span class="keyword">typeof</span> (newNode) === <span class="string">"string"</span>) &#123;</span><br><span class="line">    <span class="comment">// 文本内容改变</span></span><br><span class="line">    <span class="keyword">if</span> (newNode !== oldNode) &#123;</span><br><span class="line">      currentPatch.push(&#123; <span class="attr">type</span>: patch.TEXT, <span class="attr">content</span>: newNode &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (newNode!=<span class="literal">null</span> &amp;&amp; oldNode.tagName === newNode.tagName &amp;&amp; oldNode.key === newNode.key) &#123;</span><br><span class="line">    <span class="comment">// 节点相同，比较属性</span></span><br><span class="line">    <span class="keyword">var</span> propsPatches = diffProps(oldNode, newNode)</span><br><span class="line">    <span class="keyword">if</span> (propsPatches) &#123;</span><br><span class="line">      currentPatch.push(&#123; <span class="attr">type</span>: patch.PROPS, <span class="attr">props</span>: propsPatches &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 比较子节点，如果子节点有'ignore'属性，则不需要比较</span></span><br><span class="line">    <span class="keyword">if</span> (!isIgnoreChildren(newNode)) &#123;</span><br><span class="line">      diffChildren(</span><br><span class="line">        oldNode.children,</span><br><span class="line">        newNode.children,</span><br><span class="line">        index,</span><br><span class="line">        patches,</span><br><span class="line">        currentPatch</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(newNode !== <span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="comment">// 新节点和旧节点不同，用 replace 替换</span></span><br><span class="line">    currentPatch.push(&#123; <span class="attr">type</span>: patch.REPLACE, <span class="attr">node</span>: newNode &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (currentPatch.length) &#123;</span><br><span class="line">    patches[index] = currentPatch</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从以上可以得出，patches[1] 表示 p ，patches[3] 表示 ul ，以此类推。</p>
<h4 id="（2）差异类型"><a href="#（2）差异类型" class="headerlink" title="（2）差异类型"></a>（2）差异类型</h4><p>DOM 操作导致的差异类型包括以下几种：</p>
<p>节点替换：节点改变了，例如将上面的 div 换成 h1;<br>顺序互换：移动、删除、新增子节点，例如上面 div 的子节点，把 p 和 ul 顺序互换；<br>属性更改：修改了节点的属性，例如把上面 li 的 class 样式类删除；<br>文本改变：改变文本节点的文本内容，例如将上面 p 节点的文本内容更改为 “Real Dom”；<br>以上描述的几种差异类型在代码中定义如下所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> REPLACE = <span class="number">0</span> <span class="comment">// 替换原先的节点</span></span><br><span class="line"><span class="keyword">var</span> REORDER = <span class="number">1</span> <span class="comment">// 重新排序</span></span><br><span class="line"><span class="keyword">var</span> PROPS = <span class="number">2</span> <span class="comment">// 修改了节点的属性</span></span><br><span class="line"><span class="keyword">var</span> TEXT = <span class="number">3</span> <span class="comment">// 文本内容改变</span></span><br></pre></td></tr></table></figure>

<p>####（3）列表对比算法</p>
<p>​ 子节点的对比算法，例如 p, ul, div 的顺序换成了 div, p, ul。这个该怎么对比？如果按照同层级进行顺序对比的话，它们都会被替换掉。如 p 和 div 的 tagName 不同，p 会被 div 所替代。最终，三个节点都会被替换，这样 DOM 开销就非常大。而实际上是不需要替换节点，而只需要经过节点移动就可以达到，我们只需知道怎么进行移动。</p>
<p>​ 将这个问题抽象出来其实就是字符串的最小编辑距离问题（Edition Distance），最常见的解决方法是 Levenshtein Distance , Levenshtein Distance 是一个度量两个字符序列之间差异的字符串度量标准，两个单词之间的 Levenshtein Distance 是将一个单词转换为另一个单词所需的单字符编辑（插入、删除或替换）的最小数量。Levenshtein Distance 是1965年由苏联数学家 Vladimir Levenshtein 发明的。Levenshtein Distance 也被称为编辑距离（Edit Distance），通过动态规划求解，时间复杂度为 O(M*N)。</p>
<p>定义：对于两个字符串 a、b，则他们的 Levenshtein Distance 为：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFp50U.png" alt="QFp50U.png"></p>
<p>示例：字符串 a 和 b，a=“abcde” ，b=“cabef”，根据上面给出的计算公式，则他们的 Levenshtein Distance 的计算过程如下：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFpTk4.png" alt="QFpTk4.png"><br>本文的 demo 使用插件 list-diff2 算法进行比较，该算法的时间复杂度伟 O(n*m)，虽然该算法并非最优的算法，但是用于对于 dom 元素的常规操作是足够的。该算法具体的实现过程这里不再详细介绍，该算法的具体介绍可以参照：<a href="https://github.com/livoras/list-diff" target="_blank" rel="noopener">https://github.com/livoras/list-diff</a></p>
<p>（4）实例输出</p>
<p>两个虚拟 DOM 对象如下图所示，其中 ul1 表示原有的虚拟 DOM 树，ul2 表示改变后的虚拟 DOM 树</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ul1 = el(<span class="string">'div'</span>,&#123;<span class="attr">id</span>:<span class="string">'virtual-dom'</span>&#125;,[</span><br><span class="line">  el(<span class="string">'p'</span>,&#123;&#125;,[<span class="string">'Virtual DOM'</span>]),</span><br><span class="line">  el(<span class="string">'ul'</span>, &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;, [</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 1'</span>]),</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 2'</span>]),</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 3'</span>])</span><br><span class="line">  ]),</span><br><span class="line">  el(<span class="string">'div'</span>,&#123;&#125;,[<span class="string">'Hello World'</span>])</span><br><span class="line">]) </span><br><span class="line"><span class="keyword">var</span> ul2 = el(<span class="string">'div'</span>,&#123;<span class="attr">id</span>:<span class="string">'virtual-dom'</span>&#125;,[</span><br><span class="line">  el(<span class="string">'p'</span>,&#123;&#125;,[<span class="string">'Virtual DOM'</span>]),</span><br><span class="line">  el(<span class="string">'ul'</span>, &#123; <span class="attr">id</span>: <span class="string">'list'</span> &#125;, [</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 21'</span>]),</span><br><span class="line">	el(<span class="string">'li'</span>, &#123; <span class="attr">class</span>: <span class="string">'item'</span> &#125;, [<span class="string">'Item 23'</span>])</span><br><span class="line">  ]),</span><br><span class="line">  el(<span class="string">'p'</span>,&#123;&#125;,[<span class="string">'Hello World'</span>])</span><br><span class="line">]) </span><br><span class="line"><span class="keyword">var</span> patches = diff(ul1,ul2);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'patches:'</span>,patches);</span><br></pre></td></tr></table></figure>

<p>我们查看输出的两个虚拟 DOM 对象之间的差异对象如下图所示，我们能通过差异对象得到，两个虚拟 DOM 对象之间进行了哪些变化，从而根据这个差异对象（patches）更改原先的真实 DOM 结构，从而将页面的 DOM 结构进行更改。</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFp7tJ.png" alt="QFp7tJ.png"></p>
<h3 id="2-2-3、将两个虚拟-DOM-对象的差异应用到真正的-DOM-树"><a href="#2-2-3、将两个虚拟-DOM-对象的差异应用到真正的-DOM-树" class="headerlink" title="2.2.3、将两个虚拟 DOM 对象的差异应用到真正的 DOM 树"></a>2.2.3、将两个虚拟 DOM 对象的差异应用到真正的 DOM 树</h3><h4 id="（1）深度优先遍历-DOM-树"><a href="#（1）深度优先遍历-DOM-树" class="headerlink" title="（1）深度优先遍历 DOM 树"></a>（1）深度优先遍历 DOM 树</h4><p>​ 因为步骤一所构建的 JavaScript 对象树和 render 出来真正的 DOM 树的信息、结构是一样的。所以我们可以对那棵 DOM 树也进行深度优先的遍历，遍历的时候从步骤二生成的 patches 对象中找出当前遍历的节点差异，如下相关代码所示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span> (<span class="params">node, patches</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> walker = &#123;<span class="attr">index</span>: <span class="number">0</span>&#125;</span><br><span class="line">  dfsWalk(node, walker, patches)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dfsWalk</span> (<span class="params">node, walker, patches</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 从patches拿出当前节点的差异</span></span><br><span class="line">  <span class="keyword">var</span> currentPatches = patches[walker.index]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> len = node.childNodes</span><br><span class="line">    ? node.childNodes.length</span><br><span class="line">    : <span class="number">0</span></span><br><span class="line">  <span class="comment">// 深度遍历子节点</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> child = node.childNodes[i]</span><br><span class="line">    walker.index++</span><br><span class="line">    dfsWalk(child, walker, patches)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 对当前节点进行DOM操作</span></span><br><span class="line">  <span class="keyword">if</span> (currentPatches) &#123;</span><br><span class="line">    applyPatches(node, currentPatches)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）对原有-DOM-树进行-DOM-操作"><a href="#（2）对原有-DOM-树进行-DOM-操作" class="headerlink" title="（2）对原有 DOM 树进行 DOM 操作"></a>（2）对原有 DOM 树进行 DOM 操作</h4><p>我们根据不同类型的差异对当前节点进行不同的 DOM 操作 ，例如如果进行了节点替换，就进行节点替换 DOM 操作；如果节点文本发生了改变，则进行文本替换的 DOM 操作；以及子节点重排、属性改变等 DOM 操作，相关代码如 applyPatches 所示 ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyPatches</span> (<span class="params">node, currentPatches</span>) </span>&#123;</span><br><span class="line">  currentPatches.forEach(<span class="function"><span class="params">currentPatch</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (currentPatch.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> REPLACE:</span><br><span class="line">        <span class="keyword">var</span> newNode = (<span class="keyword">typeof</span> currentPatch.node === <span class="string">'string'</span>)</span><br><span class="line">          ? <span class="built_in">document</span>.createTextNode(currentPatch.node)</span><br><span class="line">          : currentPatch.node.render()</span><br><span class="line">        node.parentNode.replaceChild(newNode, node)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> REORDER:</span><br><span class="line">        reorderChildren(node, currentPatch.moves)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> PROPS:</span><br><span class="line">        setProps(node, currentPatch.props)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> TEXT:</span><br><span class="line">        node.textContent = currentPatch.content</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unknown patch type '</span> + currentPatch.type)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（3）DOM结构改变"><a href="#（3）DOM结构改变" class="headerlink" title="（3）DOM结构改变"></a>（3）DOM结构改变</h4><p>通过将第 2.2.2 得到的两个 DOM 对象之间的差异，应用到第一个（原先）DOM 结构中，我们可以看到 DOM 结构进行了预期的变化，如下图所示：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFpI7F.png" alt="QFpI7F.png"></p>
<h2 id="2-3、结语"><a href="#2-3、结语" class="headerlink" title="2.3、结语"></a>2.3、结语</h2><p>Virtual DOM 算法主要实现上面三个步骤来实现：</p>
<p>用 JS 对象模拟 DOM 树 — element.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"virtual-dom"</span>&gt;</span><br><span class="line">&lt;p&gt;Virtual DOM&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;ul id="list"&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li class="item"&gt;Item 1&lt;/</span>li&gt;</span><br><span class="line">  &lt;li <span class="class"><span class="keyword">class</span></span>=<span class="string">"item"</span>&gt;Item <span class="number">2</span>&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li class="item"&gt;Item 3&lt;/</span>li&gt;</span><br><span class="line">&lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">&lt;div&gt;Hello World&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>比较两棵虚拟 DOM 树的差异 — diff.js</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QF9XCj.png" alt="QF9XCj.png"></p>
<p>将两个虚拟 DOM 对象的差异应用到真正的 DOM 树 — patch.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyPatches</span> (<span class="params">node, currentPatches</span>) </span>&#123;</span><br><span class="line">  currentPatches.forEach(<span class="function"><span class="params">currentPatch</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (currentPatch.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> REPLACE:</span><br><span class="line">        <span class="keyword">var</span> newNode = (<span class="keyword">typeof</span> currentPatch.node === <span class="string">'string'</span>)</span><br><span class="line">          ? <span class="built_in">document</span>.createTextNode(currentPatch.node)</span><br><span class="line">          : currentPatch.node.render()</span><br><span class="line">        node.parentNode.replaceChild(newNode, node)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> REORDER:</span><br><span class="line">        reorderChildren(node, currentPatch.moves)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> PROPS:</span><br><span class="line">        setProps(node, currentPatch.props)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> TEXT:</span><br><span class="line">        node.textContent = currentPatch.content</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Unknown patch type '</span> + currentPatch.type)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三、Vue-源码-Virtual-DOM-简析"><a href="#三、Vue-源码-Virtual-DOM-简析" class="headerlink" title="三、Vue 源码 Virtual-DOM 简析"></a>三、Vue 源码 Virtual-DOM 简析</h1><p>我们从第二章节（Virtual-DOM 基础）中已经掌握 Virtual DOM 渲染成真实的 DOM 实际上要经历 VNode 的定义、diff、patch 等过程，所以本章节 Vue 源码的解析也按这几个过程来简析。</p>
<h2 id="3-1、VNode-模拟-DOM-树"><a href="#3-1、VNode-模拟-DOM-树" class="headerlink" title="3.1、VNode 模拟 DOM 树"></a>3.1、VNode 模拟 DOM 树</h2><h3 id="3-1-1、VNode-类简析"><a href="#3-1-1、VNode-类简析" class="headerlink" title="3.1.1、VNode 类简析"></a>3.1.1、VNode 类简析</h3><p>在 Vue.js 中，Virtual DOM 是用 VNode 这个 Class 去描述，它定义在 src/core/vdom/vnode.js 中 ，从以下代码块中可以看到 Vue.js 中的 Virtual DOM 的定义较为复杂一些，因为它这里包含了很多 Vue.js 的特性。实际上 Vue.js 中 Virtual DOM 是借鉴了一个开源库  snabbdom 的实现，然后加入了一些 Vue.js 的一些特性。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">VNode</span> </span>&#123;</span><br><span class="line">  tag: string | <span class="keyword">void</span>;</span><br><span class="line">  data: VNodeData | <span class="keyword">void</span>;</span><br><span class="line">  children: ?<span class="built_in">Array</span>&lt;VNode&gt;;</span><br><span class="line">  text: string | <span class="keyword">void</span>;</span><br><span class="line">  elm: Node | <span class="keyword">void</span>;</span><br><span class="line">  ns: string | <span class="keyword">void</span>;</span><br><span class="line">  context: Component | <span class="keyword">void</span>; <span class="comment">// rendered in this component's scope</span></span><br><span class="line">  key: string | number | <span class="keyword">void</span>;</span><br><span class="line">  componentOptions: VNodeComponentOptions | <span class="keyword">void</span>;</span><br><span class="line">  componentInstance: Component | <span class="keyword">void</span>; <span class="comment">// component instance</span></span><br><span class="line">  parent: VNode | <span class="keyword">void</span>; <span class="comment">// component placeholder node</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// strictly internal</span></span><br><span class="line">  raw: boolean; <span class="comment">// contains raw HTML? (server only)</span></span><br><span class="line">  isStatic: boolean; <span class="comment">// hoisted static node</span></span><br><span class="line">  isRootInsert: boolean; <span class="comment">// necessary for enter transition check</span></span><br><span class="line">  isComment: boolean; <span class="comment">// empty comment placeholder?</span></span><br><span class="line">  isCloned: boolean; <span class="comment">// is a cloned node?</span></span><br><span class="line">  isOnce: boolean; <span class="comment">// is a v-once node?</span></span><br><span class="line">  asyncFactory: <span class="built_in">Function</span> | <span class="keyword">void</span>; <span class="comment">// async component factory function</span></span><br><span class="line">  asyncMeta: <span class="built_in">Object</span> | <span class="keyword">void</span>;</span><br><span class="line">  isAsyncPlaceholder: boolean;</span><br><span class="line">  ssrContext: <span class="built_in">Object</span> | <span class="keyword">void</span>;</span><br><span class="line">  fnContext: Component | <span class="keyword">void</span>; <span class="comment">// real context vm for functional nodes</span></span><br><span class="line">  fnOptions: ?ComponentOptions; <span class="comment">// for SSR caching</span></span><br><span class="line">  devtoolsMeta: ?<span class="built_in">Object</span>; <span class="comment">// used to store functional render context for devtools</span></span><br><span class="line">  fnScopeId: ?string; <span class="comment">// functional scope id support</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span> (</span><br><span class="line">    tag?: string,</span><br><span class="line">    data?: VNodeData,</span><br><span class="line">    children?: ?Array&lt;VNode&gt;,</span><br><span class="line">    text?: string,</span><br><span class="line">    elm?: Node,</span><br><span class="line">    context?: Component,</span><br><span class="line">    componentOptions?: VNodeComponentOptions,</span><br><span class="line">    asyncFactory?: Function</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">this</span>.tag = tag</span><br><span class="line">    <span class="keyword">this</span>.data = data</span><br><span class="line">    <span class="keyword">this</span>.children = children</span><br><span class="line">    <span class="keyword">this</span>.text = text</span><br><span class="line">    <span class="keyword">this</span>.elm = elm</span><br><span class="line">    <span class="keyword">this</span>.ns = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.context = context</span><br><span class="line">    <span class="keyword">this</span>.fnContext = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.fnOptions = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.fnScopeId = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.key = data &amp;&amp; data.key</span><br><span class="line">    <span class="keyword">this</span>.componentOptions = componentOptions</span><br><span class="line">    <span class="keyword">this</span>.componentInstance = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.parent = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.raw = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.isStatic = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.isRootInsert = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">this</span>.isComment = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.isCloned = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.isOnce = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.asyncFactory = asyncFactory</span><br><span class="line">    <span class="keyword">this</span>.asyncMeta = <span class="literal">undefined</span></span><br><span class="line">    <span class="keyword">this</span>.isAsyncPlaceholder = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里千万不要因为 VNode 的这么属性而被吓到，或者咬紧牙去摸清楚每个属性的意义，其实，我们主要了解其几个核心的关键属性就差不多了，例如：</p>
<ul>
<li><code>tag</code> 属性即这个vnode的标签属性</li>
<li><code>data</code> 属性包含了最后渲染成真实dom节点后，节点上的class，attribute，style以及绑定的事件</li>
<li><code>children</code> 属性是vnode的子节点</li>
<li><code>text</code> 属性是文本属性</li>
<li><code>elm</code> 属性为这个vnode对应的真实dom节点</li>
<li><code>key</code> 属性是vnode的标记，在diff过程中可以提高diff的效率</li>
</ul>
<h3 id="3-1-2、源码创建-VNode-过程"><a href="#3-1-2、源码创建-VNode-过程" class="headerlink" title="3.1.2、源码创建 VNode 过程"></a>3.1.2、源码创建 VNode 过程</h3><h4 id="（1）初始化-vue"><a href="#（1）初始化-vue" class="headerlink" title="（1）初始化 vue"></a>（1）初始化 vue</h4><p>我们在实例化一个 vue 实例，也即 new Vue( ) 时，实际上是执行 src/core/instance/index.js 中定义的 Function 函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp;</span><br><span class="line">    !(<span class="keyword">this</span> <span class="keyword">instanceof</span> Vue)</span><br><span class="line">  ) &#123;</span><br><span class="line">    warn(<span class="string">'Vue is a constructor and should be called with the `new` keyword'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>._init(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过查看 Vue 的 function，我们知道 Vue 只能通过 new 关键字初始化，然后调用 this._init 方法，该方法在 src/core/instance/init.js 中定义。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options?: Object</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 省略一系列其它初始化的代码</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">if</span> (vm.$options.el) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'vm.$options.el:'</span>,vm.$options.el);</span><br><span class="line">    vm.$mount(vm.$options.el)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="（2）Vue-实例挂载"><a href="#（2）Vue-实例挂载" class="headerlink" title="（2）Vue 实例挂载"></a>（2）Vue 实例挂载</h4><p>Vue 中是通过 $mount 实例方法去挂载 dom 的，下面我们通过分析 compiler 版本的 mount 实现，相关源码在目录 src/platforms/web/entry-runtime-with-compiler.js 文件中定义：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mount = Vue.prototype.$mount</span><br><span class="line">Vue.prototype.$mount = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el?: string | Element,</span></span></span><br><span class="line"><span class="function"><span class="params">  hydrating?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  el = el &amp;&amp; query(el)</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// 省略一系列初始化以及逻辑判断代码  </span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> mount.call(<span class="keyword">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们发现最终还是调用用原先原型上的 $mount 方法挂载 ，原先原型上的 $mount 方法在 src/platforms/web/runtime/index.js 中定义 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$mount = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  el?: string | Element,</span></span></span><br><span class="line"><span class="function"><span class="params">  hydrating?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? query(el) : <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">return</span> mountComponent(<span class="keyword">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们发现$mount 方法实际上会去调用 mountComponent 方法，这个方法定义在 src/core/instance/lifecycle.js 文件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mountComponent</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  vm: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  el: ?Element,</span></span></span><br><span class="line"><span class="function"><span class="params">  hydrating?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  vm.$el = el</span><br><span class="line">  <span class="comment">// 省略一系列其它代码</span></span><br><span class="line">  <span class="keyword">let</span> updateComponent</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 生成虚拟 vnode   </span></span><br><span class="line">      <span class="keyword">const</span> vnode = vm._render()</span><br><span class="line">      <span class="comment">// 更新 DOM</span></span><br><span class="line">      vm._update(vnode, hydrating)</span><br><span class="line">     </span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      vm._update(vm._render(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实例化一个渲染Watcher，在它的回调函数中会调用 updateComponent 方法  </span></span><br><span class="line">  <span class="keyword">new</span> Watcher(vm, updateComponent, noop, &#123;</span><br><span class="line">    before () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123;</span><br><span class="line">        callHook(vm, <span class="string">'beforeUpdate'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>)</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看到，mountComponent 核心就是先实例化一个渲染Watcher，在它的回调函数中会调用 updateComponent 方法，在此方法中调用 vm._render 方法先生成虚拟 Node，最终调用 vm._update 更新 DOM。</p>
<h4 id="（3）创建虚拟-Node"><a href="#（3）创建虚拟-Node" class="headerlink" title="（3）创建虚拟 Node"></a>（3）创建虚拟 Node</h4><p>Vue 的 _render 方法是实例的一个私有方法，它用来把实例渲染成一个虚拟 Node。它的定义在 src/core/instance/render.js 文件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>): <span class="title">VNode</span> </span>&#123;</span><br><span class="line">   <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">   <span class="keyword">const</span> &#123; render, _parentVnode &#125; = vm.$options</span><br><span class="line">   <span class="keyword">let</span> vnode</span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// 省略一系列代码  </span></span><br><span class="line">     currentRenderingInstance = vm</span><br><span class="line">     <span class="comment">// 调用 createElement 方法来返回 vnode</span></span><br><span class="line">     vnode = render.call(vm._renderProxy, vm.$createElement)</span><br><span class="line">   &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">     handleError(e, vm, <span class="string">`render`</span>)&#123;&#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">// set parent</span></span><br><span class="line">   vnode.parent = _parentVnode</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"vnode...:"</span>,vnode);</span><br><span class="line">   <span class="keyword">return</span> vnode</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>Vue.js 利用 _createElement 方法创建 VNode，它定义在 src/core/vdom/create-elemenet.js 中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">_createElement</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  context: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  tag?: string | Class&lt;Component&gt; | Function | Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  data?: VNodeData,</span></span></span><br><span class="line"><span class="function"><span class="params">  children?: any,</span></span></span><br><span class="line"><span class="function"><span class="params">  normalizationType?: number</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">VNode</span> | <span class="title">Array</span>&lt;<span class="title">VNode</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// 省略一系列非主线代码</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (normalizationType === ALWAYS_NORMALIZE) &#123;</span><br><span class="line">    <span class="comment">// 场景是 render 函数不是编译生成的</span></span><br><span class="line">    children = normalizeChildren(children)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (normalizationType === SIMPLE_NORMALIZE) &#123;</span><br><span class="line">    <span class="comment">// 场景是 render 函数是编译生成的</span></span><br><span class="line">    children = simpleNormalizeChildren(children)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> vnode, ns</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> tag === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> Ctor</span><br><span class="line">    ns = (context.$vnode &amp;&amp; context.$vnode.ns) || config.getTagNamespace(tag)</span><br><span class="line">    <span class="keyword">if</span> (config.isReservedTag(tag)) &#123;</span><br><span class="line">      <span class="comment">// 创建虚拟 vnode</span></span><br><span class="line">      vnode = <span class="keyword">new</span> VNode(</span><br><span class="line">        config.parsePlatformTagName(tag), data, children,</span><br><span class="line">        <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">      )</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((!data || !data.pre) &amp;&amp; isDef(Ctor = resolveAsset(context.$options, <span class="string">'components'</span>, tag))) &#123;</span><br><span class="line">      <span class="comment">// component</span></span><br><span class="line">      vnode = createComponent(Ctor, data, context, children, tag)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vnode = <span class="keyword">new</span> VNode(</span><br><span class="line">        tag, data, children,</span><br><span class="line">        <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    vnode = createComponent(tag, data, context, children)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(vnode)) &#123;</span><br><span class="line">    <span class="keyword">return</span> vnode</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(vnode)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isDef(ns)) applyNS(vnode, ns)</span><br><span class="line">    <span class="keyword">if</span> (isDef(data)) registerDeepBindings(data)</span><br><span class="line">    <span class="keyword">return</span> vnode</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> createEmptyVNode()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>_createElement 方法有 5 个参数，context 表示 VNode 的上下文环境，它是 Component 类型；tag表示标签，它可以是一个字符串，也可以是一个 Component；data 表示 VNode 的数据，它是一个 VNodeData 类型，可以在 flow/vnode.js 中找到它的定义；children 表示当前 VNode 的子节点，它是任意类型的，需要被规范为标准的 VNode 数组；</p>
<h3 id="3-1-3、实例查看"><a href="#3-1-3、实例查看" class="headerlink" title="3.1.3、实例查看"></a>3.1.3、实例查看</h3><p>为了更直观查看我们平时写的 Vue 代码如何用 VNode 类来表示，我们通过一个实例的转换进行更深刻了解。</p>
<p>例如，实例化一个 Vue 实例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  render: <span class="function"><span class="keyword">function</span> (<span class="params">createElement</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> createElement(<span class="string">'div'</span>, &#123;</span><br><span class="line">      attrs: &#123;</span><br><span class="line">        id: <span class="string">'app'</span>,</span><br><span class="line">        class: "class_box"</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;, <span class="keyword">this</span>.message)</span><br><span class="line">  &#125;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">'Hello Vue!'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我们打印出其对应的 VNode 表示：</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QF9L5Q.png" alt="QF9L5Q.png"></p>
<h2 id="3-2、diff-过程"><a href="#3-2、diff-过程" class="headerlink" title="3.2、diff 过程"></a>3.2、diff 过程</h2><h3 id="3-2-1、Vue-js-源码的-diff-调用逻辑"><a href="#3-2-1、Vue-js-源码的-diff-调用逻辑" class="headerlink" title="3.2.1、Vue.js 源码的 diff 调用逻辑"></a>3.2.1、Vue.js 源码的 diff 调用逻辑</h3><p>Vue.js 源码实例化了一个 watcher，这个 ~ 被添加到了在模板当中所绑定变量的依赖当中，一旦 model 中的响应式的数据发生了变化，这些响应式的数据所维护的 dep 数组便会调用 dep.notify() 方法完成所有依赖遍历执行的工作，这包括视图的更新，即 updateComponent 方法的调用。watcher 和 updateComponent 方法定义在  src/core/instance/lifecycle.js 文件中 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mountComponent</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  vm: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  el: ?Element,</span></span></span><br><span class="line"><span class="function"><span class="params">  hydrating?: boolean</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  vm.$el = el</span><br><span class="line">  <span class="comment">// 省略一系列其它代码</span></span><br><span class="line">  <span class="keyword">let</span> updateComponent</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 生成虚拟 vnode   </span></span><br><span class="line">      <span class="keyword">const</span> vnode = vm._render()</span><br><span class="line">      <span class="comment">// 更新 DOM</span></span><br><span class="line">      vm._update(vnode, hydrating)</span><br><span class="line">     </span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      vm._update(vm._render(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 实例化一个渲染Watcher，在它的回调函数中会调用 updateComponent 方法  </span></span><br><span class="line">  <span class="keyword">new</span> Watcher(vm, updateComponent, noop, &#123;</span><br><span class="line">    before () &#123;</span><br><span class="line">      <span class="keyword">if</span> (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123;</span><br><span class="line">        callHook(vm, <span class="string">'beforeUpdate'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span>)</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成视图的更新工作事实上就是调用了vm._update方法，这个方法接收的第一个参数是刚生成的Vnode，调用的vm._update方法定义在 src/core/instance/lifecycle.js中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype._update = <span class="function"><span class="keyword">function</span> (<span class="params">vnode: VNode, hydrating?: boolean</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="keyword">this</span></span><br><span class="line">  <span class="keyword">const</span> prevEl = vm.$el</span><br><span class="line">  <span class="keyword">const</span> prevVnode = vm._vnode</span><br><span class="line">  <span class="keyword">const</span> restoreActiveInstance = setActiveInstance(vm)</span><br><span class="line">  vm._vnode = vnode</span><br><span class="line">  <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">    <span class="comment">// 第一个参数为真实的node节点，则为初始化</span></span><br><span class="line">    vm.$el = vm.__patch__(vm.$el, vnode, hydrating, <span class="literal">false</span> <span class="comment">/* removeOnly */</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果需要diff的prevVnode存在，那么对prevVnode和vnode进行diff</span></span><br><span class="line">    vm.$el = vm.__patch__(prevVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  restoreActiveInstance()</span><br><span class="line">  <span class="comment">// update __vue__ reference</span></span><br><span class="line">  <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">    prevEl.__vue__ = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.$el) &#123;</span><br><span class="line">    vm.$el.__vue__ = vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// if parent is an HOC, update its $el as well</span></span><br><span class="line">  <span class="keyword">if</span> (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) &#123;</span><br><span class="line">    vm.$parent.$el = vm.$el</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个方法当中最为关键的就是 <code>vm.__patch__</code> 方法，这也是整个 virtual-dom 当中最为核心的方法，主要完成了prevVnode 和 vnode 的 diff 过程并根据需要操作的 vdom 节点打 patch，最后生成新的真实 dom 节点并完成视图的更新工作。</p>
<p>接下来，让我们看下 <code>vm.__patch__</code> 的逻辑过程， <code>vm.__patch__</code> 方法定义在 src/core/vdom/patch.js 中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patch</span> (<span class="params">oldVnode, vnode, hydrating, removeOnly</span>) </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">    <span class="keyword">if</span> (isUndef(oldVnode)) &#123;</span><br><span class="line">      <span class="comment">// 当oldVnode不存在时，创建新的节点</span></span><br><span class="line">      isInitialPatch = <span class="literal">true</span></span><br><span class="line">      createElm(vnode, insertedVnodeQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 对oldVnode和vnode进行diff，并对oldVnode打patch  </span></span><br><span class="line">      <span class="keyword">const</span> isRealElement = isDef(oldVnode.nodeType)</span><br><span class="line">      <span class="keyword">if</span> (!isRealElement &amp;&amp; sameVnode(oldVnode, vnode)) &#123;</span><br><span class="line">        <span class="comment">// patch existing root node</span></span><br><span class="line">        patchVnode(oldVnode, vnode, insertedVnodeQueue, <span class="literal">null</span>, <span class="literal">null</span>, removeOnly)</span><br><span class="line">      &#125; </span><br><span class="line">	......</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 patch 方法中，我们看到会分为两种情况，一种是当 oldVnode 不存在时，会创建新的节点；另一种则是已经存在 oldVnode ，那么会对 oldVnode 和 vnode 进行 diff 及 patch 的过程。其中 patch 过程中会调用 sameVnode 方法来对对传入的2个 vnode 进行基本属性的比较，只有当基本属性相同的情况下才认为这个2个vnode 只是局部发生了更新，然后才会对这2个 vnode 进行 diff，如果2个 vnode 的基本属性存在不一致的情况，那么就会直接跳过 diff 的过程，进而依据 vnode 新建一个真实的 dom，同时删除老的 dom 节点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sameVnode</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    a.key === b.key &amp;&amp;</span><br><span class="line">    a.tag === b.tag &amp;&amp;</span><br><span class="line">    a.isComment === b.isComment &amp;&amp;</span><br><span class="line">    isDef(a.data) === isDef(b.data) &amp;&amp;</span><br><span class="line">    sameInputType(a, b)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>diff 过程中主要是通过调用 patchVnode 方法进行的:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">patchVnode</span> (<span class="params">oldVnode, vnode, insertedVnodeQueue, ownerArray, index, removeOnly</span>) </span>&#123;</span><br><span class="line">...... </span><br><span class="line"><span class="keyword">const</span> elm = vnode.elm = oldVnode.elm</span><br><span class="line"><span class="keyword">const</span> oldCh = oldVnode.children</span><br><span class="line"><span class="keyword">const</span> ch = vnode.children</span><br><span class="line"><span class="comment">// 如果vnode没有文本节点</span></span><br><span class="line"><span class="keyword">if</span> (isUndef(vnode.text)) &#123;</span><br><span class="line">    <span class="comment">// 如果oldVnode的children属性存在且vnode的children属性也存在  </span></span><br><span class="line">    <span class="keyword">if</span> (isDef(oldCh) &amp;&amp; isDef(ch)) &#123;</span><br><span class="line">    <span class="comment">// updateChildren，对子节点进行diff  </span></span><br><span class="line">    <span class="keyword">if</span> (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(ch)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">        checkDuplicateKeys(ch)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果oldVnode的text存在，那么首先清空text的内容,然后将vnode的children添加进去  </span></span><br><span class="line">    <span class="keyword">if</span> (isDef(oldVnode.text)) nodeOps.setTextContent(elm, <span class="string">''</span>)</span><br><span class="line">    addVnodes(elm, <span class="literal">null</span>, ch, <span class="number">0</span>, ch.length - <span class="number">1</span>, insertedVnodeQueue)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(oldCh)) &#123;</span><br><span class="line">    <span class="comment">// 删除elm下的oldchildren</span></span><br><span class="line">    removeVnodes(elm, oldCh, <span class="number">0</span>, oldCh.length - <span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDef(oldVnode.text)) &#123;</span><br><span class="line">    <span class="comment">// oldVnode有子节点，而vnode没有，那么就清空这个节点  </span></span><br><span class="line">    nodeOps.setTextContent(elm, <span class="string">''</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (oldVnode.text !== vnode.text) &#123;</span><br><span class="line">    <span class="comment">// 如果oldVnode和vnode文本属性不同，那么直接更新真是dom节点的文本元素</span></span><br><span class="line">    nodeOps.setTextContent(elm, vnode.text)</span><br><span class="line">&#125;</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从以上代码得知，</p>
<p>diff 过程中又分了好几种情况，oldCh 为 oldVnode的子节点，ch 为 Vnode 的子节点：</p>
<p>首先进行文本节点的判断，若 oldVnode.text !== vnode.text，那么就会直接进行文本节点的替换；<br>在vnode 没有文本节点的情况下，进入子节点的 diff；<br>当 oldCh 和 ch 都存在且不相同的情况下，调用 updateChildren 对子节点进行 diff；<br>若 oldCh 不存在，ch 存在，首先清空 oldVnode 的文本节点，同时调用 addVnodes 方法将 ch 添加到elm 真实 dom 节点当中；<br>若 oldCh 存在，ch 不存在，则删除 elm 真实节点下的 oldCh 子节点；<br>若 oldVnode 有文本节点，而 vnode 没有，那么就清空这个文本节点。</p>
<h3 id="3-2-2、子节点-diff-流程分析"><a href="#3-2-2、子节点-diff-流程分析" class="headerlink" title="3.2.2、子节点 diff 流程分析"></a>3.2.2、子节点 diff 流程分析</h3><h4 id="（1）Vue-js-源码"><a href="#（1）Vue-js-源码" class="headerlink" title="（1）Vue.js 源码"></a>（1）Vue.js 源码</h4><p>​ 这里着重分析下 updateChildren方法，它也是整个 diff 过程中最重要的环节，以下为 Vue.js 的源码过程，为了更形象理解 diff 过程，我们给出相关的示意图来讲解。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateChildren</span> (<span class="params">parentElm, oldCh, newCh, insertedVnodeQueue, removeOnly</span>) </span>&#123;</span><br><span class="line"><span class="comment">// 为oldCh和newCh分别建立索引，为之后遍历的依据</span></span><br><span class="line"><span class="keyword">let</span> oldStartIdx = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> newStartIdx = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> oldEndIdx = oldCh.length - <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> oldStartVnode = oldCh[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> oldEndVnode = oldCh[oldEndIdx]</span><br><span class="line"><span class="keyword">let</span> newEndIdx = newCh.length - <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> newStartVnode = newCh[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">let</span> newEndVnode = newCh[newEndIdx]</span><br><span class="line"><span class="keyword">let</span> oldKeyToIdx, idxInOld, vnodeToMove, refElm</span><br><span class="line"></span><br><span class="line"><span class="comment">// 直到oldCh或者newCh被遍历完后跳出循环</span></span><br><span class="line"><span class="keyword">while</span> (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isUndef(oldStartVnode)) &#123;</span><br><span class="line">    oldStartVnode = oldCh[++oldStartIdx] <span class="comment">// Vnode has been moved left</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isUndef(oldEndVnode)) &#123;</span><br><span class="line">    oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">    patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">    oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">    newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">    patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">    oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldStartVnode, newEndVnode)) &#123; <span class="comment">// Vnode moved right</span></span><br><span class="line">    patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)</span><br><span class="line">    canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))</span><br><span class="line">    oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">    newEndVnode = newCh[--newEndIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameVnode(oldEndVnode, newStartVnode)) &#123; <span class="comment">// Vnode moved left</span></span><br><span class="line">    patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">    canMove &amp;&amp; nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)</span><br><span class="line">    oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">    newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">    idxInOld = isDef(newStartVnode.key)</span><br><span class="line">        ? oldKeyToIdx[newStartVnode.key]</span><br><span class="line">        : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">    <span class="keyword">if</span> (isUndef(idxInOld)) &#123; <span class="comment">// New element</span></span><br><span class="line">        createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vnodeToMove = oldCh[idxInOld]</span><br><span class="line">        <span class="keyword">if</span> (sameVnode(vnodeToMove, newStartVnode)) &#123;</span><br><span class="line">        patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)</span><br><span class="line">        oldCh[idxInOld] = <span class="literal">undefined</span></span><br><span class="line">        canMove &amp;&amp; nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// same key but different element. treat as new element</span></span><br><span class="line">        createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, <span class="literal">false</span>, newCh, newStartIdx)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    newStartVnode = newCh[++newStartIdx]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">    refElm = isUndef(newCh[newEndIdx + <span class="number">1</span>]) ? <span class="literal">null</span> : newCh[newEndIdx + <span class="number">1</span>].elm</span><br><span class="line">    addVnodes(parentElm, refElm, newCh, newStartIdx, newEndIdx, insertedVnodeQueue)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">    removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在开始遍历 diff 前，首先给 oldCh 和 newCh 分别分配一个 startIndex 和 endIndex 来作为遍历的索引，当oldCh 或者 newCh 遍历完后(遍历完的条件就是 oldCh 或者 newCh 的 startIndex &gt;= endIndex )，就停止oldCh 和 newCh 的 diff 过程。接下来通过实例来看下整个 diff 的过程(节点属性中不带 key 的情况)。</p>
<h4 id="（2）无-key-的-diff-过程"><a href="#（2）无-key-的-diff-过程" class="headerlink" title="（2）无 key 的 diff 过程"></a>（2）无 key 的 diff 过程</h4><p>我们通过以下示意图对以上代码过程进行讲解：</p>
<p>####（2.1）首先从第一个节点开始比较，不管是 oldCh 还是 newCh 的起始或者终止节点都不存在 sameVnode ，同时节点属性中是不带 key 标记的，因此第一轮的 diff 完后，newCh 的 startVnode 被添加到 oldStartVnode的前面，同时 newStartIndex 前移一位；<br><img src="https://s2.ax1x.com/2019/11/28/QF9qUg.jpg" alt="QF9qUg.jpg"><br>（2.2）第二轮的 diff 中，满足 sameVnode(oldStartVnode, newStartVnode)，因此对这2个 vnode 进行diff，最后将 patch 打到 oldStartVnode 上，同时 oldStartVnode 和 newStartIndex 都向前移动一位 ；<br><img src="https://s2.ax1x.com/2019/11/28/QF9bVS.jpg" alt="QF9bVS.jpg"><br>（2.3）第三轮的 diff 中，满足 sameVnode(oldEndVnode, newStartVnode)，那么首先对 oldEndVnode和newStartVnode 进行 diff，并对 oldEndVnode 进行 patch，并完成 oldEndVnode 移位的操作，最后newStartIndex 前移一位，oldStartVnode 后移一位；<br><img src="https://s2.ax1x.com/2019/11/28/QF9v2n.jpg" alt="QF9v2n.jpg"><br>（2.4）第四轮的 diff 中，过程同步骤3；<br><img src="https://s2.ax1x.com/2019/11/28/QF9xvq.jpg" alt="QF9xvq.jpg"><br>（2.5）第五轮的 diff 中，同过程1；<br><img src="https://s2.ax1x.com/2019/11/28/QFCSK0.jpg" alt="QFCSK0.jpg"><br>（2.6）遍历的过程结束后，newStartIdx &gt; newEndIdx，说明此时 oldCh 存在多余的节点，那么最后就需要将这些多余的节点删除。<br><img src="https://s2.ax1x.com/2019/11/28/QFCprV.jpg" alt="QFCprV.jpg"></p>
<h4 id="（3）有-key-的-diff-流程"><a href="#（3）有-key-的-diff-流程" class="headerlink" title="（3）有 key 的 diff 流程"></a>（3）有 key 的 diff 流程</h4><p>在 vnode 不带 key 的情况下，每一轮的 diff 过程当中都是起始和结束节点进行比较，直到 oldCh 或者newCh 被遍历完。而当为 vnode 引入 key 属性后，在每一轮的 diff 过程中，当起始和结束节点都没有找到sameVnode 时，然后再判断在 newStartVnode 的属性中是否有 key，且是否在 oldKeyToIndx 中找到对应的节点 ：</p>
<p>如果不存在这个 key，那么就将这个 newStartVnode 作为新的节点创建且插入到原有的 root 的子节点中；<br>如果存在这个 key，那么就取出 oldCh 中的存在这个 key 的 vnode，然后再进行 diff 的过；<br>通过以上分析，给vdom上添加 key 属性后，遍历 diff 的过程中，当起始点，结束点的搜寻及 diff 出现还是无法匹配的情况下时，就会用 key 来作为唯一标识，来进行 diff，这样就可以提高 diff 效率。</p>
<p>带有 Key 属性的 vnode的 diff 过程可见下图：</p>
<p>（3.1）首先从第一个节点开始比较，不管是 oldCh 还是 newCh 的起始或者终止节点都不存在 sameVnode，但节点属性中是带 key 标记的， 然后在 oldKeyToIndx 中找到对应的节点，这样第一轮 diff 过后 oldCh 上的B节点被删除了，但是 newCh 上的B节点上 elm 属性保持对 oldCh 上 B节点 的elm引用。</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFC9bT.jpg" alt="QFC9bT.jpg"></p>
<p>（3.2）第二轮的 diff 中，满足 sameVnode(oldStartVnode, newStartVnode)，因此对这2个 vnode 进行diff，最后将 patch 打到 oldStartVnode上，同时 oldStartVnode 和 newStartIndex 都向前移动一位 ；</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFCiaF.jpg" alt="QFCiaF.jpg"></p>
<p>（3.3）第三轮的 diff 中，满足 sameVnode(oldEndVnode, newStartVnode)，那么首先对 oldEndVnode 和newStartVnode 进行 diff，并对 oldEndVnode 进行 patch，并完成 oldEndVnode 移位的操作，最后newStartIndex 前移一位，oldStartVnode 后移一位；</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFCF54.jpg" alt="QFCF54.jpg"></p>
<p>（3.4）第四轮的diff中，过程同步骤2；</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFCAPJ.jpg" alt="QFCAPJ.jpg"></p>
<p>（3.5）第五轮的diff中，因为此时 oldStartIndex 已经大于 oldEndIndex，所以将剩余的 Vnode 队列插入队列最后。</p>
<p><img src="https://s2.ax1x.com/2019/11/28/QFCEG9.jpg" alt="QFCEG9.jpg"></p>
<p>3.3、patch 过程<br>通过3.2章节介绍的 diff 过程中，我们会看到 nodeOps 相关的方法对真实 DOM 结构进行操作，nodeOps 定义在 src/platforms/web/runtime/node-ops.js 中，其为基本 DOM 操作，这里就不在详细介绍。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createElementNS</span> (<span class="params">namespace: string, tagName: string</span>): <span class="title">Element</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.createElementNS(namespaceMap[namespace], tagName)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createTextNode</span> (<span class="params">text: string</span>): <span class="title">Text</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.createTextNode(text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createComment</span> (<span class="params">text: string</span>): <span class="title">Comment</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>.createComment(text)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">insertBefore</span> (<span class="params">parentNode: Node, newNode: Node, referenceNode: Node</span>) </span>&#123;</span><br><span class="line">  parentNode.insertBefore(newNode, referenceNode)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">removeChild</span> (<span class="params">node: Node, child: Node</span>) </span>&#123;</span><br><span class="line">  node.removeChild(child)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.4、总结<br>通过前三小节简析，我们从主线上把模板和数据如何渲染成最终的 DOM 的过程分析完毕了，我们可以通过下图更直观地看到从初始化 Vue 到最终渲染的整个过程。<br><img src="https://s2.ax1x.com/2019/11/28/QFCV2R.png" alt="QFCV2R.png"></p>
<h1 id="转载"><a href="#转载" class="headerlink" title="转载"></a>转载</h1><p>本文转载自<a href="https://github.com/fengshi123/blog/issues/10" target="_blank" rel="noopener">https://github.com/fengshi123/blog/issues/10</a><br>感谢作者@fengshi123</p>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/27/全栈开发后台资金管理系统项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/27/全栈开发后台资金管理系统项目/" class="post-title-link" itemprop="url">全栈开发后台资金管理系统项目</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-27 15:58:28 / 修改时间：16:02:50" itemprop="dateCreated datePublished" datetime="2019-11-27T15:58:28+08:00">2019-11-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h1><h4 id="1-nodemon-使用"><a href="#1-nodemon-使用" class="headerlink" title="1. nodemon 使用"></a>1. nodemon 使用</h4><p>当我们做服务器的时候，每次变更都要重启才能生效。<br>如：我们创建了一个名为 server.js 的文件，作为服务器<br>使用<code>node ./server.js</code>即可启动，但我们对其修改后，要看效果就要关闭之前的再启动。<br>而 nodemon 帮我们解决这个问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon -g <span class="comment">//全局安装nodemon</span></span><br></pre></td></tr></table></figure>

<p>然后就可以使用 nodemon 运行我们的服务器了</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon ./<span class="keyword">server</span>.js</span><br></pre></td></tr></table></figure>

<p>这时，修改文件，服务器会自动重启。<br>将命令设置到 package.json。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在package.json中修改</span></span><br><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"node server.js"</span>,</span><br><span class="line">    <span class="string">"server"</span>: <span class="string">"nodemon server.js"</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>这样在就可以使用<code>npm run start</code>或<code>npm run server</code>来运行服务器</p>
<h4 id="2-连接数据库"><a href="#2-连接数据库" class="headerlink" title="2.连接数据库"></a>2.连接数据库</h4><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//<span class="keyword">node</span><span class="title">-app</span>下执行</span><br><span class="line">npm install mongoose</span><br></pre></td></tr></table></figure>

<p>为方便修改配置，新建文件 /config/keys.js, 内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mongoURI:</span><br><span class="line">    <span class="string">"mongodb://&lt;username&gt;:&lt;password&gt;@cluster0-shard-00-00-oqdfe.mongodb.net:27017,cluster0-shard-00-01-oqdfe.mongodb.net:27017,cluster0-shard-00-02-oqdfe.mongodb.net:27017/test?ssl=true&amp;replicaSet=Cluster0-shard-0&amp;authSource=admin&amp;retryWrites=true&amp;w=majority"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该链接需要到 mongoDB 官网注册账户，获取 500M 免费空间，创建一个 Preject 再创建 Clusters，之后点击”Connect”,选择”Connect your Application”进入下一步，域名选择默认确定即可.DRIVER 选择“node.js”, VERSION 选择”2.2.12 or later”,然后 copy 下面的链接即可，注意修改&lt;username&gt;:&lt;password&gt;为对应的用户名和密码。可以在”Database Access”中添加和修改用户。<br>在 server.js 中引用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DB config</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">"./config/keys"</span>).mongoURI;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="comment">//Connect to mongodb</span></span><br><span class="line">mongoose.connect(db, &#123;</span><br><span class="line">    useNewUrlParser: <span class="literal">true</span>,<span class="comment">//防止弃用警告</span></span><br><span class="line">    useUnifiedTopology: <span class="literal">true</span>,<span class="comment">//防止弃用警告</span></span><br><span class="line">    useFindAndModify: <span class="literal">false</span> <span class="comment">//防止弃用警告</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"mongoDB Connected"</span>)) <span class="comment">//成功</span></span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err)); <span class="comment">//失败</span></span><br></pre></td></tr></table></figure>

<h4 id="3-配置路由和接口"><a href="#3-配置路由和接口" class="headerlink" title="3.配置路由和接口"></a>3.配置路由和接口</h4><p>在 node-app 下创建 /route/api/users.js,内容:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="comment">//实例化路由</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router;</span><br><span class="line"></span><br><span class="line"><span class="comment">//验证路由，访问/test，将返回`msg:"login works"`</span></span><br><span class="line">router.get(<span class="string">"/test"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.json(&#123; <span class="attr">msg</span>: <span class="string">"login works"</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出router</span></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>在 server.js 中引用和使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入users.js</span></span><br><span class="line"><span class="keyword">const</span> users = <span class="built_in">require</span>(<span class="string">"./route/api/users"</span>);</span><br><span class="line">app.use(<span class="string">"/api/users"</span>, users);</span><br></pre></td></tr></table></figure>

<p>这时 使用浏览器访问 <code>http://localhost:5000/api/users/test</code>即可看到返回的<code>msg:&quot;login works&quot;</code></p>
<h4 id="4-创建模型"><a href="#4-创建模型" class="headerlink" title="4.创建模型"></a>4.创建模型</h4><p>新建 /models/User.js,</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create Schema</span></span><br><span class="line"><span class="keyword">const</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  password: &#123;</span><br><span class="line">    type: <span class="built_in">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  avatar: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  date: &#123;</span><br><span class="line">    type: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="built_in">Date</span>.now</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = User = mongoose.model(<span class="string">"users"</span>, UserSchema);</span><br></pre></td></tr></table></figure>

<h4 id="4-5-下载postman-安装"><a href="#4-5-下载postman-安装" class="headerlink" title="4.5 下载postman,安装"></a>4.5 下载postman,安装</h4><p>可以用来测试接口是否通.</p>
<h4 id="4-6-创建register接口"><a href="#4-6-创建register接口" class="headerlink" title="4.6 创建register接口"></a>4.6 创建register接口</h4><p>首先需要安装body-parser.</p>
<h4 id="5-配置注册"><a href="#5-配置注册" class="headerlink" title="5.配置注册"></a>5.配置注册</h4><p>安装 body-parser，方便发送 POST 请求</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> <span class="keyword">body</span>-parser</span><br></pre></td></tr></table></figure>

<p>在 server.js 中引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">"body-parser"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用body-parser中间件</span></span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(bodyParser.json());</span><br></pre></td></tr></table></figure>

<p>在 users.js 中配置接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/uers/register</span></span><br><span class="line"><span class="comment">//@desc 返回请求的JSON数据</span></span><br><span class="line"><span class="comment">//@access public （公有接口）</span></span><br><span class="line">router.post(<span class="string">"/register"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(req.body); <span class="comment">//用来测试是否连接</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>//此处如果连接不上mongoDB,可能是白名单失效.再添加一个白名单在mongoDB即可.</p>
<p>功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.严重是否有邮箱</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">router.post(<span class="string">"/register"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="comment">//查询数据库中是否拥有邮箱</span></span><br><span class="line">  User.findOne(&#123; <span class="attr">email</span>: req.body.email &#125;).then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">      <span class="comment">//如果存在</span></span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123; <span class="attr">email</span>: <span class="string">"邮箱已被注册！"</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//否则不存在</span></span><br><span class="line">      <span class="keyword">const</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">        name: req.body.name,</span><br><span class="line">        email: req.body.email,</span><br><span class="line">        password: req.body.password</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="密码加密"><a href="#密码加密" class="headerlink" title="密码加密"></a>密码加密</h5><p>安装 bcrypt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> bcrypt</span><br></pre></td></tr></table></figure>

<p>在 users.js 中引入，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">"bcrypt"</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>官方详细说明<a href="https://www.npmjs.com/package/bcrypt" target="_blank" rel="noopener">链接</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">bcrypt.genSalt(<span class="number">10</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, salt</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//10是加密的一种模式</span></span><br><span class="line">  bcrypt.hash(newUser.password, salt, (err, hash) =&gt; &#123;</span><br><span class="line">    <span class="comment">//newUser.password 是加密对象，salt是回调函数，最后是加密结果</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err; <span class="comment">//如果存在错误，则抛出。 throw是js语法，抛出</span></span><br><span class="line">    <span class="comment">//没有错误，则</span></span><br><span class="line">    newUser.password = hash;</span><br><span class="line"></span><br><span class="line">    newUser</span><br><span class="line">      .save()</span><br><span class="line">      .then(<span class="function"><span class="params">user</span> =&gt;</span> res.json(user))</span><br><span class="line">      .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="头像-avatar"><a href="#头像-avatar" class="headerlink" title="头像 avatar"></a>头像 avatar</h4><p>gravatar 官方说明<a href="https://www.npmjs.com/package/gravatar" target="_blank" rel="noopener">链接</a><br>安装</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> gravatar</span><br></pre></td></tr></table></figure>

<p>user.js 中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gravatar = <span class="built_in">require</span>(<span class="string">"gravatar"</span>);</span><br></pre></td></tr></table></figure>

<p>在接口位置使用(user.js)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (user) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123; <span class="attr">email</span>: <span class="string">"邮箱已被注册！"</span> &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> avatar = gravatar.url(req.body.email, &#123; <span class="attr">s</span>: <span class="string">"200"</span>, <span class="attr">r</span>: <span class="string">"pg"</span>, <span class="attr">d</span>: <span class="string">"mm"</span> &#125;); <span class="comment">//s是大小。r是头像格式。mm是灰色的头像</span></span><br><span class="line">  <span class="keyword">const</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    name: req.body.name,</span><br><span class="line">    email: req.body.email,</span><br><span class="line">    avatar, <span class="comment">//引入头像</span></span><br><span class="line">    password: req.body.password</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如何得到头像？</p>
<ol>
<li>打开 <a href="https://cn.gravatar.com/" target="_blank" rel="noopener">gravatar 网址</a></li>
<li>注册 gravatar，其注册实际是注册了 wordpress.com 网站的账户，然后登录 gravatar，任意格式的邮箱均可申请成功，但无法收到邮件，则无法验证并修改头像。因此要使用可以收到验证的邮箱。</li>
<li>上传头像。上传图片时，最后会选择图片会有<code>Choose a rating for your Gravatar</code> ，有四个选项，G、PG、R、X,这里我们选择 pg，我们在使用时也是<code>r: &#39;pg&#39;</code>，需要保持一致。</li>
</ol>
<p>这时，我们使用 postman 向 <a href="http://localhost:5000/api/users/register" target="_blank" rel="noopener">http://localhost:5000/api/users/register</a> 发送 post 请求，使用(application/x-www-form-urlencoded)(key:email value:<a href="mailto:user@usertest.com" target="_blank" rel="noopener">user@usertest.com</a>) 就能得到设置的头像了。</p>
<h4 id="7-登录接口"><a href="#7-登录接口" class="headerlink" title="7.登录接口"></a>7.登录接口</h4><p>users.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/users/login</span></span><br><span class="line"><span class="comment">//@desc 返回taken jwt password</span></span><br><span class="line"><span class="comment">//@access public （公有接口）</span></span><br><span class="line">router.post(<span class="string">"/login"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> email = req.body.email;</span><br><span class="line">  <span class="keyword">const</span> password = req.body.password;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//查询数据库</span></span><br><span class="line">  User.findOne(&#123; email &#125;).then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">404</span>).json(&#123; <span class="attr">email</span>: <span class="string">"用户不存在"</span> &#125;); <span class="comment">//如果用户不存在</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//密码匹配</span></span><br><span class="line">    <span class="comment">//第一个password是前端传入密码，user.password是系统内密码</span></span><br><span class="line">    bcrypt.compare(password, user.password).then(<span class="function"><span class="params">isMatch</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isMatch) &#123;</span><br><span class="line">        res.json(&#123; <span class="attr">msg</span>: <span class="string">"success"</span> &#125;); <span class="comment">//如果密码对比正确</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123; <span class="attr">password</span>: <span class="string">"密码错误！"</span> &#125;); <span class="comment">//如果密码对比不正确</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="返回-token"><a href="#返回-token" class="headerlink" title="返回 token"></a>返回 token</h4><p>安装 jsonwebtoken (jwt)</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> jsonwebtoken</span><br></pre></td></tr></table></figure>

<p>在 users.js 引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">"jsonwebtoken"</span>);</span><br></pre></td></tr></table></figure>

<p>在密码验证成功处插入</p>
<blockquote>
<p>我们在 config/keys.js 导出的对象中，加入了 secretOrKey:”secret” 属性和值，再引入到 users.js 以方便统一管理配置。<br>过期时间的 3600 单位为秒<br>token 前必须是 “Bearer ”(送信人的意思)，末尾空格也不可缺少。<br>如果 success 为 true，就应该得到 token 值</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//jwt.sign("规则","加密名字","过期时间","箭头函数")</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rule = &#123; <span class="attr">id</span>: user.id, <span class="attr">name</span>: user.name &#125;; <span class="comment">//可以更多</span></span><br><span class="line">jwt.sign(rule, keys.secretOrKey, &#123; <span class="attr">expiresIn</span>: <span class="number">3600</span> &#125;, (err, token) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    token: <span class="string">"Bearer "</span> + token</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// res.json(&#123;msg:"success"&#125;);</span></span><br></pre></td></tr></table></figure>

<h4 id="验证-token"><a href="#验证-token" class="headerlink" title="验证 token"></a>验证 token</h4><p>users.js 加入接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route GET api/users/current</span></span><br><span class="line"><span class="comment">//@desc return current user</span></span><br><span class="line"><span class="comment">//@access Privates</span></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">"/current"</span>, (req, res) =&gt; &#123;</span><br><span class="line">  res.json(&#123; <span class="attr">msg</span>: <span class="string">"success"</span> &#125;); <span class="comment">//测试使用，后期有修改</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>安装 passport-jwt 和 passport</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install </span>passport-<span class="keyword">jwt </span>passport</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a href="https://www.npmjs.com/package/passport" target="_blank" rel="noopener">passport 网址</a><br><a href="https://www.npmjs.com/package/passport-jwt" target="_blank" rel="noopener">passport-jwt 网址</a><br>在 server.js 中引入,并初始化</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">"passport"</span>);</span><br><span class="line"></span><br><span class="line">app.use(passport.initialize());</span><br></pre></td></tr></table></figure>

<p>新建文件 /config/passport.js,内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> JwtStrategy = <span class="built_in">require</span>(<span class="string">"passport-jwt"</span>).Strategy,</span><br><span class="line">  ExtractJwt = <span class="built_in">require</span>(<span class="string">"passport-jwt"</span>).ExtractJwt;</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"users"</span>);</span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">"../config/keys"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;&#125;;</span><br><span class="line">opts.jwtFromRequest = ExtractJwt.fromAuthHeaderAsBearerToken();</span><br><span class="line">opts.secretOrKey = keys.secretOrKey;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">passport</span> =&gt;</span> &#123;</span><br><span class="line">  passport.use(</span><br><span class="line">    <span class="keyword">new</span> JwtStrategy(opts, (jwt_payload, done) =&gt; &#123;</span><br><span class="line">      <span class="comment">//console.log(jwt_payload);</span></span><br><span class="line">      <span class="comment">//通过id获取用户</span></span><br><span class="line">      User.findById(jwt_payload.id)</span><br><span class="line">        <span class="comment">//获取成功</span></span><br><span class="line">        .then(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//如果用户存在</span></span><br><span class="line">          <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            <span class="keyword">return</span> done(<span class="literal">null</span>, user);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//如果用户不存在</span></span><br><span class="line">          <span class="keyword">return</span> done(full, <span class="literal">false</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//获取失败</span></span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 server.js 中引入 passport.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app.use(passport.initialize());</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"./config/passport"</span>)(passport); <span class="comment">//这样代码就不需要在当前server.js中写了</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里使用了一个技巧，<code>require(&quot;xxx.js&quot;)（对象）</code> 将对象传入xxx.js,同时将该js引入当前文件中。这样就可以在<code>xxx.js</code>中编写代码，实现分离，而且在xxx.js可以使用传入的对象。</p>
</blockquote>
<p>在 users.js 中引入 passport，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">"passport"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//完成token验证，返回部分信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$route GET api/users/current</span></span><br><span class="line"><span class="comment">//@desc return current user</span></span><br><span class="line"><span class="comment">//@access Privates</span></span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">"/current"</span>,</span><br><span class="line">  passport.authenticate(<span class="string">"jwt"</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      id: req.user.id,</span><br><span class="line">      name: req.user.name,</span><br><span class="line">      email: req.user.email</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="这里调整了一些输出的内容，将输出对象改为了字符串，可能造成代码实际和上面有些出入。"><a href="#这里调整了一些输出的内容，将输出对象改为了字符串，可能造成代码实际和上面有些出入。" class="headerlink" title="这里调整了一些输出的内容，将输出对象改为了字符串，可能造成代码实际和上面有些出入。"></a>这里调整了一些输出的内容，将输出对象改为了字符串，可能造成代码实际和上面有些出入。</h4><p>——-=</p>
<h4 id="添加身份"><a href="#添加身份" class="headerlink" title="添加身份"></a>添加身份</h4><p>如果想在 user 中添加其他信息(比如添加管理员)可参考此内容<br>在 models/User.js 的 UserSchema 中添加身份字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">identity:&#123;</span><br><span class="line">    type:<span class="built_in">String</span>,</span><br><span class="line">    required:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>在 api/users.js 中加入信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// newUser中</span></span><br><span class="line"><span class="keyword">const</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">  name: req.body.name,</span><br><span class="line">  email: req.body.email,</span><br><span class="line">  avatar,</span><br><span class="line">  password: req.body.password,</span><br><span class="line">  identity: req.body.identity <span class="comment">//添加的信息</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码匹配规则中</span></span><br><span class="line"><span class="keyword">const</span> rule = &#123;</span><br><span class="line">  id: user.id,</span><br><span class="line">  name: user.name,</span><br><span class="line">  avatar: user.avatar,</span><br><span class="line">  identity: user.identity</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//验证token输出信息时</span></span><br><span class="line">router.get(<span class="string">"/current"</span>,passport.authenticate(<span class="string">"jwt"</span>,&#123;<span class="attr">session</span>:<span class="literal">false</span>&#125;), (req,res) =&gt; &#123;</span><br><span class="line">  res.json(&#123;</span><br><span class="line">    id:req.user.id,</span><br><span class="line">    name:req.user.name,</span><br><span class="line">    email:req.user.email,</span><br><span class="line">    identity:req.user.identity <span class="comment">//添加的内容</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="配置信息接口"><a href="#配置信息接口" class="headerlink" title="配置信息接口"></a>配置信息接口</h4><p>新建 models/Profile.js 建立ProfileSchema，内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create Schema</span></span><br><span class="line"><span class="keyword">const</span> ProfileSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  type:&#123;</span><br><span class="line">    type:<span class="built_in">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  describe:&#123;</span><br><span class="line">    type:<span class="built_in">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  income:&#123;</span><br><span class="line">    type:<span class="built_in">String</span>,</span><br><span class="line">    required:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  expend:&#123;</span><br><span class="line">    type:<span class="built_in">String</span>,</span><br><span class="line">    required:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  cash:&#123;</span><br><span class="line">    type:<span class="built_in">String</span>,</span><br><span class="line">    required:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  remark:&#123;</span><br><span class="line">    type:<span class="built_in">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  date:&#123;</span><br><span class="line">    type:<span class="built_in">Date</span>,</span><br><span class="line">    <span class="keyword">default</span>:<span class="built_in">Date</span>.now</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Profile = mongoose.model(<span class="string">"profile"</span>,ProfileSchema);</span><br></pre></td></tr></table></figure>

<p>新建 api/profiles.js 暂不写内容，将其在server.js中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"><span class="keyword">const</span> profiles = <span class="built_in">require</span>(<span class="string">"./route/api/profiles"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用route</span></span><br><span class="line">app.use(<span class="string">"/api/profiles"</span>, profiles);</span><br></pre></td></tr></table></figure>

<p>在 api/profiles.js 配置信息进行测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@login &amp; register </span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">"express"</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">"passport"</span>);</span><br><span class="line"><span class="keyword">const</span> Profile = <span class="built_in">require</span>(<span class="string">"../../models/Profile"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//$route GET api/profile/test</span></span><br><span class="line"><span class="comment">//@desc 返回请求的JSON数据</span></span><br><span class="line"><span class="comment">//@access public （公有接口）</span></span><br><span class="line">router.get(<span class="string">"/test"</span>,(req,res)=&gt;&#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>:<span class="string">"Profile works"</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>postman 发送到 <a href="http://localhost:5000/api/profiles/test" target="_blank" rel="noopener">http://localhost:5000/api/profiles/test</a> 返回 Profile works 即链接成功。</p>
<h4 id="更改数据库接口"><a href="#更改数据库接口" class="headerlink" title="更改数据库接口"></a>更改数据库接口</h4><p>如果要更改数据库接口，可以<code>/config/keys.js</code>中的<code>mongoURI</code>的值，该值的获取方法，参考上述创建时的内容。</p>
<h4 id="创建添加信息的接口"><a href="#创建添加信息的接口" class="headerlink" title="创建添加信息的接口"></a>创建添加信息的接口</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/profile/add</span></span><br><span class="line"><span class="comment">//@desc 创建信息接口</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line">router.post(<span class="string">"/add"</span>,passport.authenticate(<span class="string">"jwt"</span>,&#123;<span class="attr">session</span>:<span class="literal">false</span>&#125;),(req,res)=&gt;&#123;</span><br><span class="line">  <span class="keyword">const</span> profileFields = &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (req.body.type) profileFields.type = req.body.type;</span><br><span class="line">  <span class="keyword">if</span> (req.body.describe) profileFields.describe = req.body.describe;</span><br><span class="line">  <span class="keyword">if</span> (req.body.income) profileFields.income = req.body.income;</span><br><span class="line">  <span class="keyword">if</span> (req.body.expend) profileFields.expend = req.body.expend;</span><br><span class="line">  <span class="keyword">if</span> (req.body.cash) profileFields.cash = req.body.cash;</span><br><span class="line">  <span class="keyword">if</span> (req.body.remark) profileFields.remark = req.body.remark;</span><br><span class="line"><span class="keyword">new</span> Profile(profileFields).save().then(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">res.json(profile);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="获取所有信息"><a href="#获取所有信息" class="headerlink" title="获取所有信息"></a>获取所有信息</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route GET api/profile</span></span><br><span class="line"><span class="comment">//@desc 获取所有信息</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line"></span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">"/"</span>,</span><br><span class="line">  passport.authenticate(<span class="string">"jwt"</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    Profile.find()</span><br><span class="line">      .then(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!profile) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.status(<span class="number">404</span>).json(<span class="string">"没有任何内容"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.json(profile);</span><br><span class="line">      &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> res.status(<span class="number">404</span>).json(<span class="string">"err"</span>));</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="获取单个信息"><a href="#获取单个信息" class="headerlink" title="获取单个信息"></a>获取单个信息</h4><p>  profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route GET api/profile/:id</span></span><br><span class="line"><span class="comment">//@desc 获取单个信息</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line"></span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">"/:id"</span>,</span><br><span class="line">  passport.authenticate(<span class="string">"jwt"</span>, &#123;</span><br><span class="line">    session: <span class="literal">false</span></span><br><span class="line">  &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    Profile.findOne(&#123; <span class="attr">_id</span>: req.params.id &#125;)</span><br><span class="line">      .then(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!profile) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.status(<span class="number">404</span>).json(<span class="string">"没有任何内容"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.json(profile);</span><br><span class="line">      &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> res.status(<span class="number">404</span>).json(err));</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="编辑信息"><a href="#编辑信息" class="headerlink" title="编辑信息"></a>编辑信息</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/profile/edit</span></span><br><span class="line"><span class="comment">//@desc 编辑信息接口</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">"/edit/:id"</span>,</span><br><span class="line">  passport.authenticate(<span class="string">"jwt"</span>, &#123;</span><br><span class="line">    session: <span class="literal">false</span></span><br><span class="line">  &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> profileFields = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (req.body.type) profileFields.type = req.body.type;</span><br><span class="line">    <span class="keyword">if</span> (req.body.describe) profileFields.describe = req.body.describe;</span><br><span class="line">    <span class="keyword">if</span> (req.body.income) profileFields.income = req.body.income;</span><br><span class="line">    <span class="keyword">if</span> (req.body.expend) profileFields.expend = req.body.expend;</span><br><span class="line">    <span class="keyword">if</span> (req.body.cash) profileFields.cash = req.body.cash;</span><br><span class="line">    <span class="keyword">if</span> (req.body.remark) profileFields.remark = req.body.remark;</span><br><span class="line">    Profile.findOneAndUpdate(</span><br><span class="line">      &#123; <span class="attr">_id</span>: req.params.id &#125;,</span><br><span class="line">      &#123; <span class="attr">$set</span>: profileFields &#125;,</span><br><span class="line">      &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    ).then(<span class="function"><span class="params">profile</span> =&gt;</span> res.json(profile))</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="删除信息"><a href="#删除信息" class="headerlink" title="删除信息"></a>删除信息</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route delete api/profile/delete/:id</span></span><br><span class="line"><span class="comment">//@desc 删除信息接口</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line">router.delete(</span><br><span class="line">  <span class="string">"/delete/:id"</span>,</span><br><span class="line">  passport.authenticate(<span class="string">"jwt"</span>, &#123;</span><br><span class="line">    session: <span class="literal">false</span></span><br><span class="line">  &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    Profile.findOneAndRemove(&#123; <span class="attr">_id</span>: req.params.id &#125;)</span><br><span class="line">      .then(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">        profile.save().then(<span class="function"><span class="params">profile</span> =&gt;</span> res.json(profile));</span><br><span class="line">      &#125;</span><br><span class="line">      ).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> res.status(<span class="number">404</span>).json(<span class="string">"删除失败"</span>))</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>至此，信息的增删改查均已实现。要创建其他 schema 可以参考此方式</p>
</blockquote>
<h4 id="前后端连载"><a href="#前后端连载" class="headerlink" title="前后端连载"></a>前后端连载</h4><p>查看vue版本，是否在3.0.0以上，我们要求是在3.0.0以上。</p>
<blockquote>
<p>vue-cli的安装见 <a href="https://cn.vuejs.org/" target="_blank" rel="noopener">vue官网</a> ，这里就不说了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//终端中执行</span></span><br><span class="line">vue -V <span class="comment">//查看vue-cli版本 本案例要求3.0.0以上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建项目 client是自己起的名字，意为"客户端"</span></span><br><span class="line">vue create client</span><br><span class="line"></span><br><span class="line">接下来进入选择流程，后面 √ 为我们作出的选择项，-----表示回车到下一选项页</span><br><span class="line">? Please pick a preset: </span><br><span class="line">❯ <span class="keyword">default</span> (babel, eslint)   (默认配置)</span><br><span class="line">  Manually select features （手动选择) √</span><br><span class="line">-----</span><br><span class="line">按键盘a表示全选，i表示反选，空格键 表示切换选中，如果你需要什么就选什么就可以了，这里选择Babel、Router、Vuex。</span><br><span class="line">? Please pick a preset: Manually select features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: (Press &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)</span><br><span class="line">❯◯ Babel    √</span><br><span class="line"> ◯ TypeScript</span><br><span class="line"> ◯ Progressive Web App (PWA) Support   </span><br><span class="line"> ◯ Router   √</span><br><span class="line"> ◯ Vuex     √ </span><br><span class="line"> ◯ CSS Pre-processors</span><br><span class="line"> ◯ Linter / Formatter</span><br><span class="line"> ◯ Unit Testing</span><br><span class="line"> ◯ E2E Testing</span><br><span class="line"> -----</span><br><span class="line"> 是否使用history ，我们输入y，回车，会继续显示其他问题。</span><br><span class="line"> ? Please pick a preset: Manually select features</span><br><span class="line">? Check the features needed <span class="keyword">for</span> your project: Babel, Router, Vuex</span><br><span class="line">? Use history mode <span class="keyword">for</span> router? (Requires proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) (Y/n) </span><br><span class="line"></span><br><span class="line">In dedicated config files </span><br><span class="line">In package.json    √ </span><br><span class="line"></span><br><span class="line"> Save <span class="keyword">this</span> <span class="keyword">as</span> a preset <span class="keyword">for</span> future projects? (y/N) (是否要保存你当前预制模板) N （第一次时可以保存一次方便之后用）</span><br><span class="line"> -----</span><br><span class="line"> 接下来就是等待安装成功。 会产生一个 client的文件夹</span><br><span class="line"></span><br><span class="line"> <span class="comment">//启动项目 </span></span><br><span class="line"> cd client</span><br><span class="line"> npm run serve  <span class="comment">//注意，是serve 不是server</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时使用 <code>http://localhost:8080/</code> 就可以打开前端了,再新建终端，执行 <code>nodemon</code>就打开了后台。<br>这需要两个终端打开，较为繁琐，因此采用前后端连载，借助concurrently将多个终端启动的项目绑在一起<br>安装 concurrently </p>
</blockquote>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> concurrently</span><br></pre></td></tr></table></figure>

<p>打开 /client/package.json</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">   "serve": "vue-cli-service serve",</span><br><span class="line">   "build": "vue-cli-service build",</span><br><span class="line">   "start": "npm run serve"</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时，我们在client中 使用 <code>npm run start</code>即可启动前端     </p>
</blockquote>
<p>在根目录的 package.json 中配置<code>client-stall</code>、<code>client</code>和<code>dev</code>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">   "client-install":"npm install --prefix client",</span><br><span class="line">   "client":"npm start --prefix client",</span><br><span class="line">   "start": "node server.js",</span><br><span class="line">   "server": "nodemon server.js",</span><br><span class="line">   "dev":"concurrently \"npm run server\" \"npm run client\""</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>此时我们可以在根目录的终端下执行</code>npm run dev`即可同时启动 前端和后台 </p>
</blockquote>
<h1 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h1><p>接后端部分，此文档为 前端部分 内容。</p>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>为使内容整洁，我们将vue-cli创建项目时生成的我们不需要的文件进行整理<br>我们接下来更多的是在client这个文件夹下工作，非强调指明，则以client视为根目录。</p>
<ul>
<li><p>删除 /src/assets/logo.png  （vue的logo图片）</p>
</li>
<li><p>删除 /src/components/HelloWorld.vue</p>
</li>
<li><p>删除 /src/views/ 中的About.vue 和Home.vue </p>
</li>
<li><p>新建 /src/views/Index.vue,内容为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;index&quot;&gt;</span><br><span class="line">    初始化页面</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&quot;index&quot;,</span><br><span class="line">  components:&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开 /src/router.js,重新整理为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Index <span class="keyword">from</span> <span class="string">'./views/Index.vue'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  mode: <span class="string">'history'</span>,</span><br><span class="line">  base: process.env.BASE_URL,</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      redirect:<span class="string">'/index'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/index'</span>,</span><br><span class="line">      name:<span class="string">'index'</span>,</span><br><span class="line">      component: Index</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>打开 /src/App.vue,重新整理为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;router-view/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">html,</span><br><span class="line">body,</span><br><span class="line">#app &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>新建 /public/css/reset.css ,在 /public/index.html 中引入该css文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/reset.css"</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>reset.css内容可以访问 <a href="http://meyerweb.com/eric/tools/css/reset/" target="_blank" rel="noopener">CSS reset</a>得到，也可在下面设置自己需要的初始样式<br>本案例中，我们在reset.css中追加了el中加载相关的样式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.el-loading</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2000</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(255, 255, 255, .7);</span><br><span class="line">  <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">-webkit-transition</span>:opacity .<span class="number">3s</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity .<span class="number">3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-loading-spinner</span>&#123;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>:-<span class="number">21px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册页和404"><a href="#注册页和404" class="headerlink" title="注册页和404"></a>注册页和404</h4><p>  安装elementUI<br>  <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此时目录在client中</span></span><br><span class="line">npm <span class="selector-tag">i</span> element-ui -S</span><br></pre></td></tr></table></figure></p>
<p>在/src/main.js中引入 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ElementUI <span class="keyword">from</span> <span class="string">'element-ui'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'element-ui/lib/theme-chalk/index.css'</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(ElementUI);</span><br></pre></td></tr></table></figure>

<p>将 图片文件 放在 /src/asset/ 文件夹下面<br>分别是404.gif,bg.jpg,logo.png,showcase.png</p>
<p>初始注册，新建 /src/views/Register.vue,内容 (只是简单布局，还未设置表单内容)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;register&quot;&gt;</span><br><span class="line">    &lt;section class=&quot;form_container&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;manage_tip&quot;&gt;</span><br><span class="line">        &lt;span class=&quot;title&quot;&gt;米修在线后台管理系统&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/section&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&quot;register&quot;,</span><br><span class="line">  components:&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.register&#123;</span><br><span class="line">  position: relative;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">  background: url(../assets/bg.jpg) no-repeat center center;</span><br><span class="line">  background-size: 100% 100%;</span><br><span class="line">&#125;</span><br><span class="line">.form_container&#123;</span><br><span class="line">  width: 370px;</span><br><span class="line">  height: 210px;</span><br><span class="line">  position: absolute;</span><br><span class="line">  top:10%;</span><br><span class="line">  left:34%;</span><br><span class="line">  padding:25px;</span><br><span class="line">  border-radius: 5px;</span><br><span class="line">  text-align: center;</span><br><span class="line">&#125;</span><br><span class="line">.form_container .manage_tip .title&#123;</span><br><span class="line">  font-family: &apos;Microsooft YaHei&apos;;</span><br><span class="line">  font-weight: bold;</span><br><span class="line">  font-size: 26px;</span><br><span class="line">  color: #fff;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>在 router.js中设置路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入组件</span></span><br><span class="line"><span class="keyword">import</span> Register <span class="keyword">from</span> <span class="string">'./views/Register.vue'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加路由</span></span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/register'</span>,</span><br><span class="line">      name:<span class="string">'register'</span>,</span><br><span class="line">      component: Register</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>设置 404 页面</p>
<ol>
<li>新建 /src/views/404.vue 组件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;notfound&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;../assets/404.png&quot; alt=&quot;页面没找到&quot;&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.notfound&#123;</span><br><span class="line">width: 100%;</span><br><span class="line">height:100%;</span><br><span class="line">overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.notfound img&#123;</span><br><span class="line">width: 100%;</span><br><span class="line">height:100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>在 router.js中设置路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">'*'</span>,</span><br><span class="line">  name:<span class="string">'/404'</span>,</span><br><span class="line">  component: NotFound</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册表单"><a href="#注册表单" class="headerlink" title="注册表单"></a>注册表单</h4><p>此后大量使用 element 的代码，为避免过长，仅提一些重要的点，其他请结合原文件阅读笔记</p>
<h4 id="密码规则与验证"><a href="#密码规则与验证" class="headerlink" title="密码规则与验证"></a>密码规则与验证</h4><h4 id="加载动画和消息提示"><a href="#加载动画和消息提示" class="headerlink" title="加载动画和消息提示"></a>加载动画和消息提示</h4><p>安装 axios</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//client目录下</span></span><br><span class="line">npm install axios</span><br></pre></td></tr></table></figure>

<p>新建 /src/http.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Message,Loading &#125; <span class="keyword">from</span> <span class="string">'element-ui'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loading;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startLoading</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  loading = Loading.service(&#123;</span><br><span class="line">    lock:<span class="literal">true</span>,</span><br><span class="line">    text:<span class="string">"拼命加载中..."</span>,</span><br><span class="line">    background:<span class="string">'rgba(0,0,0,0.7)'</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">endLoading</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  loading.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求拦截</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加载动画</span></span><br><span class="line">  startLoading();</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;,error =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截</span></span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//结束加载动画</span></span><br><span class="line">  endLoading();</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;,error =&gt; &#123;</span><br><span class="line">  <span class="comment">//错误提醒</span></span><br><span class="line">  endLoading();</span><br><span class="line">  Message.error(error.response.data);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios;</span><br></pre></td></tr></table></figure>

<p>在main.js中引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'./http'</span></span><br><span class="line"></span><br><span class="line">Vue.prototype.$axios = axios;</span><br></pre></td></tr></table></figure>

<p>http.js内容(后会变动)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Message,Loading &#125; <span class="keyword">from</span> <span class="string">'element-ui'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loading;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startLoading</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  loading = Loading.service(&#123;</span><br><span class="line">    lock:<span class="literal">true</span>,</span><br><span class="line">    text:<span class="string">"拼命加载中..."</span>,</span><br><span class="line">    background:<span class="string">'rgba(0,0,0,0.7)'</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">endLoading</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  loading.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求拦截</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加载动画</span></span><br><span class="line">  startLoading();</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;,error =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截</span></span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//结束加载动画</span></span><br><span class="line">  endLoading();</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;,error =&gt; &#123;</span><br><span class="line">  <span class="comment">//错误提醒</span></span><br><span class="line">  endLoading();</span><br><span class="line">  Message.error(error.response.data);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios;</span><br></pre></td></tr></table></figure>

<h4 id="配置前端跨域请求-使用vue-cli项目"><a href="#配置前端跨域请求-使用vue-cli项目" class="headerlink" title="配置前端跨域请求(使用vue-cli项目)"></a>配置前端跨域请求(使用vue-cli项目)</h4><p>新建 vue.config.js ，在client目录下,内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> debug = process.env.NODE_ENV !== <span class="string">'production'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  baseUrl:<span class="string">'/'</span>, <span class="comment">//根域上下文目录</span></span><br><span class="line">  outputDir:<span class="string">'dist'</span>, <span class="comment">//构建输出目录</span></span><br><span class="line">  assetsDir: <span class="string">'assets'</span>, <span class="comment">//静态资源目录（js,css,img,fonts）</span></span><br><span class="line">  lintOnSave:<span class="literal">false</span>, <span class="comment">//是否开启eslint保存检测，有效值：true|false|'error'</span></span><br><span class="line">  runtimeCompiler:<span class="literal">true</span>, <span class="comment">//运行时版本是否需要编译</span></span><br><span class="line">  transpileDependencies:[], <span class="comment">//默认babel-loader忽略node_modules,这里可增加例外的依赖包名</span></span><br><span class="line">  productionSourceMap:<span class="literal">true</span>, <span class="comment">//是否在构建生产包时生产 sourceMap 文件，false将提高构建速度</span></span><br><span class="line">  configureWebpack:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//webpack 配置，值为对象时会合并配置，为方法时会改写配置</span></span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">      <span class="comment">//开发环境配置</span></span><br><span class="line">      config.devtool = <span class="string">'cheap-module-eval-source-map'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//生产环境配置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Object.assign(config,&#123; //开发生产共同配置</span></span><br><span class="line">    <span class="comment">//   resolve:&#123;</span></span><br><span class="line">    <span class="comment">//     alias:&#123;</span></span><br><span class="line">    <span class="comment">//       '@':path.resolve(__dirname,'./src'),</span></span><br><span class="line">    <span class="comment">//       '@c':path.resolve(__dirname,'./src/components'),</span></span><br><span class="line">    <span class="comment">//       'vue$':'vue/dist/vue.esm.js'</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  chainWebpack:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//webpack链接API，用于生成和修改webpack配置，</span></span><br><span class="line">    <span class="comment">// https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md</span></span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">      <span class="comment">//本地开发配置</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//生产开发配置</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  parallel:<span class="built_in">require</span>(<span class="string">'os'</span>).cpus().length &gt; <span class="number">1</span>, <span class="comment">//构建时开启多进程处理babel编译</span></span><br><span class="line">  pluginOptions:&#123;</span><br><span class="line">    <span class="comment">//第三方插件配置</span></span><br><span class="line">  &#125;,</span><br><span class="line">  pwa:&#123;</span><br><span class="line">    <span class="comment">//单页插件相关配置</span></span><br><span class="line">    <span class="comment">// https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa</span></span><br><span class="line">  &#125;,</span><br><span class="line">  devServer:&#123;</span><br><span class="line">    open:<span class="literal">true</span>,</span><br><span class="line">    host:<span class="string">'localhost'</span>,</span><br><span class="line">    port:<span class="number">8080</span>,</span><br><span class="line">    https:<span class="literal">false</span>,</span><br><span class="line">    hotOnly:<span class="literal">false</span>,</span><br><span class="line">    proxy:&#123;<span class="comment">//配置跨域</span></span><br><span class="line">      <span class="string">'/api'</span>:&#123;</span><br><span class="line">        target:<span class="string">'http://localhost:5000/api'</span>,</span><br><span class="line">        ws:<span class="literal">true</span>,</span><br><span class="line">        changOrigin:<span class="literal">true</span>,</span><br><span class="line">        pathRewrite:&#123;</span><br><span class="line">          <span class="string">'^/api'</span>:<span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    before:<span class="function"><span class="params">app</span> =&gt;</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样就可以访问我们的后台了</p>
</blockquote>
<p>在register.vue中配置跳转,这样就可以注册用户了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">submitForm(formName) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs[formName].validate(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">            <span class="keyword">this</span>.$axios</span><br><span class="line">            .post(<span class="string">"/api/users/register"</span>, <span class="keyword">this</span>.registerUser)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">//注册成功</span></span><br><span class="line">              <span class="keyword">this</span>.$message(&#123;</span><br><span class="line">                message: <span class="string">"账号注册成功！"</span>,</span><br><span class="line">                type: <span class="string">"success"</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="keyword">this</span>.$router.push(<span class="string">"/login"</span>); </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="登录逻辑"><a href="#登录逻辑" class="headerlink" title="登录逻辑"></a>登录逻辑</h4><p>新建组件和添加路由参考注册，这里讲下登录逻辑. Login.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">submitForm(formName) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$refs[formName].validate(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">          <span class="keyword">this</span>.$axios.post(<span class="string">"/api/users/login"</span>, <span class="keyword">this</span>.loginUser).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//token</span></span><br><span class="line">            <span class="keyword">const</span> &#123; token &#125; = res.data;</span><br><span class="line">            <span class="comment">// 存储到ls</span></span><br><span class="line">             localStorage.setItem(<span class="string">"eleToken"</span>,token);</span><br><span class="line">             <span class="keyword">this</span>.$router.push(<span class="string">'/index'</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="keyword">this</span>.$router.push(<span class="string">"/login"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="路由守卫"><a href="#路由守卫" class="headerlink" title="路由守卫"></a>路由守卫</h4><p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路由守卫</span></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLogin = localStorage.eleToken ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(to.path == <span class="string">"/login"</span> || to.path == <span class="string">"/register"</span>)&#123;</span><br><span class="line">    next();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    isLogin ? next() : next(<span class="string">"login"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>http.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求拦截</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加载动画</span></span><br><span class="line">  startLoading();</span><br><span class="line"><span class="keyword">if</span>(localStorage.eleToken)&#123;</span><br><span class="line">  <span class="comment">//设置统一的请求header</span></span><br><span class="line">  config.headers.Authorization = localStorage.eleToken;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;,error =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//结束加载动画</span></span><br><span class="line">  endLoading();</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;,error =&gt; &#123;</span><br><span class="line">  <span class="comment">//错误提醒</span></span><br><span class="line">  endLoading();</span><br><span class="line">  Message.error(error.response.data);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//获取错误状态码</span></span><br><span class="line">  <span class="keyword">const</span> &#123; status &#125; = error.response;</span><br><span class="line">  <span class="keyword">if</span> (status == <span class="number">401</span>)&#123;</span><br><span class="line">    Message.error(<span class="string">'token失效，请重新登录！'</span>);</span><br><span class="line">    <span class="comment">//清除token</span></span><br><span class="line">    localStorage.removeItem(<span class="string">"eleToken"</span>);</span><br><span class="line">    <span class="comment">//跳转到登录页面</span></span><br><span class="line">    router.push(<span class="string">'/login'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="token-过期"><a href="#token-过期" class="headerlink" title="token 过期"></a>token 过期</h4><p>解析token的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jwt-decode</span><br></pre></td></tr></table></figure>

<h4 id="设置Vuex"><a href="#设置Vuex" class="headerlink" title="设置Vuex"></a>设置Vuex</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Login.vue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//登录成功后将数据存储到Vuex中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//token存储到Vuex中</span></span><br><span class="line"><span class="keyword">this</span>,$store.dispatch(<span class="string">"setAuthenticated"</span>)</span><br></pre></td></tr></table></figure>

<p>方法: 判断是否为空</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">isEmpty(value)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    value === <span class="literal">undefined</span> ||</span><br><span class="line">    value === <span class="literal">null</span> ||</span><br><span class="line">    (<span class="keyword">typeof</span> value === <span class="string">"object"</span> &amp;&amp; <span class="built_in">Object</span>.keys(value).length === <span class="number">0</span>) ||</span><br><span class="line">    (<span class="keyword">typeof</span> value === <span class="string">"string"</span> &amp;&amp; value.trim().length === <span class="number">0</span>)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>

<h4 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h4><p>新建/component/HeadNav.vue</p>
<p>将HeadNav.vue引入到Index.vue,并注册,然后template中调用</p>
<p>在HeadNav.vue中布局</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//看代码</span></span><br></pre></td></tr></table></figure>

<p>写向下箭头的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  methods: &#123;</span><br><span class="line">    setDialogInfo(cmdItem) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (cmdItem) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"info"</span>:</span><br><span class="line">          <span class="keyword">this</span>.showInfoList();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">"logout"</span>:</span><br><span class="line">          <span class="keyword">this</span>.logout();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    showInfoList() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"个人信息"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    logout() &#123;</span><br><span class="line">      <span class="comment">//清除token</span></span><br><span class="line">      localStorage.removeItem(<span class="string">"eleToken"</span>);</span><br><span class="line">      <span class="comment">//设置Vuex store</span></span><br><span class="line">      <span class="keyword">this</span>.$store.dispatch(<span class="string">"clearCurrentState"</span>);</span><br><span class="line">      <span class="comment">//跳转到login</span></span><br><span class="line">      <span class="keyword">this</span>.$router.push(<span class="string">"/login"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//vuex中记得在actions中添加clearCurrentState</span></span><br></pre></td></tr></table></figure>

<h4 id="个人信息"><a href="#个人信息" class="headerlink" title="个人信息"></a>个人信息</h4><p>新建views/Home.vue</p>
<p>在router.js中设置二级路由</p>
<p>新建views/InfoShow.vue</p>
<h4 id="侧面导航栏"><a href="#侧面导航栏" class="headerlink" title="侧面导航栏"></a>侧面导航栏</h4><p>新建assets/component/LeftMenu.vue</p>
<p>编辑收支类型</p>
<h4 id="创建资金列表"><a href="#创建资金列表" class="headerlink" title="创建资金列表"></a>创建资金列表</h4><p>新建views/FundList.vue</p>
<p>添加各个按钮,事件<br>设置添加按钮,新增对话框component/Dialog.vue组件</p>
<h4 id="编辑和添加"><a href="#编辑和添加" class="headerlink" title="编辑和添加"></a>编辑和添加</h4><p>编辑和添加功能雷同,把formData放到父级fundlist中,并用props传递<br>修改父级中dialog的属性,新增title,options,方便切换弹窗的标题和选项</p>
<p>在handleEdit中修改dialog的title,当点击编辑时title就切换成’编辑’<br>编辑时已经拿到数据了.this.formData的值也就是传入值了<br>同样,添加的也可以新增this.formData.但是添加的数据默认是空的</p>
<p>在onSubmit中判断提交的类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="keyword">this</span>.dialog.option == <span class="string">"add"</span> ? <span class="string">"add"</span> : <span class="string">`edit/<span class="subst">$&#123;<span class="keyword">this</span>.formData.id&#125;</span>`</span></span><br></pre></td></tr></table></figure>

<h4 id="删除按钮"><a href="#删除按钮" class="headerlink" title="删除按钮"></a>删除按钮</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$axios.delete(<span class="string">`/api/profiles/delete/<span class="subst">$&#123;row._id&#125;</span>`</span>)</span><br><span class="line"><span class="comment">//之后可以then调用$message弹出删除成功的提示</span></span><br></pre></td></tr></table></figure>

<h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><p>elementUI布局整行分为24列.<br>使用标准分页</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-pagination</span><br><span class="line">  @size-change=<span class="string">"handleSizeChange"</span></span><br><span class="line">  @current-change=<span class="string">"handleCurrentChange"</span></span><br><span class="line">  :current-page=<span class="string">"currentPage4"</span></span><br><span class="line">  :page-sizes=<span class="string">"[100, 200, 300, 400]"</span></span><br><span class="line">  :page-size=<span class="string">"100"</span></span><br><span class="line">  layout=<span class="string">"total, sizes, prev, pager, next, jumper"</span></span><br><span class="line">  :total=<span class="string">"400"</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/el-pagination&gt;</span></span><br></pre></td></tr></table></figure>

<p>  //修改绑定数据</p>
<p>  //设置全部数据容器(数组)<br>  allTableData: []</p>
<p>  //在获取数据时就开始设置分页数据<br>  this.setPaginations()</p>
<p>  在setPaginations中设置默认属性</p>
<h4 id="筛选和权限"><a href="#筛选和权限" class="headerlink" title="筛选和权限"></a>筛选和权限</h4><p>定义筛选组件<el-form-item label="按照时间筛选"><br>复制elementUI的时间选择器.<br>添加筛选按钮,绑定筛选事件handleSearch()<br>绑定开始时间,结束时间.在data中定义开始时间startTime,结束时间endTime</el-form-item></p>
<p>添加过滤容器filterTableData:{},在getProfile()时也存储一次.</p>
<h5 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h5><p>使用计算属性computed获取此时用户的身份</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    user()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.user</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>使用v-if决定是否可以使用添加,编辑,删除操作.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v-<span class="keyword">if</span>=<span class="string">"user.indentity == 'manager'"</span></span><br><span class="line"><span class="comment">//将此判断加到添加事件之前和label='操作'后</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/27/cNode社区项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/27/cNode社区项目/" class="post-title-link" itemprop="url">cNode社区项目</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-27 15:57:45 / 修改时间：16:03:19" itemprop="dateCreated datePublished" datetime="2019-11-27T15:57:45+08:00">2019-11-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            
          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/27/多人博客项目/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/27/多人博客项目/" class="post-title-link" itemprop="url">多人博客项目</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-27 15:53:44 / 修改时间：16:07:56" itemprop="dateCreated datePublished" datetime="2019-11-27T15:53:44+08:00">2019-11-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="blog3"><a href="#blog3" class="headerlink" title="blog3"></a>blog3</h1><h1 id="前后端接口约定"><a href="#前后端接口约定" class="headerlink" title="前后端接口约定"></a>前后端接口约定</h1><h2 id="后端接口规范"><a href="#后端接口规范" class="headerlink" title="后端接口规范"></a>后端接口规范</h2><ol>
<li>当前接口路径</li>
<li>当前接口提交数据类型,如:</li>
</ol>
<p>GET: 获取数据</p>
<p>POST: 提交或者创建</p>
<p>PUT: 修改数据</p>
<p>DELETE: 删除数据</p>
<p>PATCH: 修改数据,部分修改</p>
<ol start="3">
<li>参数类型格式: json或者application/x-www-form-urlencoded的数据</li>
<li>参数字段及限制条件</li>
<li>返回成功的数据格式</li>
<li>返回失败的数据格式</li>
</ol>
<p>下面和后端做以下接口约定,开发阶段使用postman或者curl命令测试接口</p>
<p>认证相关</p>
<h3 id="POST-auth-register"><a href="#POST-auth-register" class="headerlink" title="POST /auth/register"></a>POST /auth/register</h3><p>功能: 用户注册</p>
<p>提交参数</p>
<p>参数类型: Content-type: application/x-www-form-urlencoded;chratset=utf-8</p>
<p>参数字段:</p>
<p>username: 用户名,长度1-15个字符,只能是字母数字下划线</p>
<p>password: 密码,长度6-16位任意字符</p>
<p>返回数据</p>
<p>失败: </p>
<p>返回格式: <code>{&quot;status&quot;: &quot;fail&quot;, &quot;msg&quot;: &quot;错误原因&quot;}</code></p>
<p>成功:</p>
<p>返回格式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"注册成功"</span>,</span><br><span class="line">    <span class="string">"data"</span>:  &#123;</span><br><span class="line">        <span class="string">"id"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="string">"username"</span>: <span class="string">"Tom"</span>,</span><br><span class="line">        <span class="string">"avatar"</span>: <span class="string">"http://avatar.com/1.png"</span>,</span><br><span class="line">        <span class="string">"createdAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>,</span><br><span class="line">        <span class="string">"updatedAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试命令</p>
<p><code># -d用来传递数据</code></p>
<p><code># 对于POST和PUT可以: -X POST,对于GET,不加-X</code></p>
<p><code>curl -d &quot;usernme=Tom&amp;password=123456&quot; -X POST &quot;http://localhost:3000/auth/regitster&quot;</code></p>
<h3 id="GET-auth-login"><a href="#GET-auth-login" class="headerlink" title="GET /auth/login"></a>GET /auth/login</h3><p>功能: 用户登录</p>
<p>提交参数</p>
<p>参数类型: Content-type: application/x-www-form-urlencoded;chratset=utf-8</p>
<p>参数字段: </p>
<pre><code>username: 用户名,长度1-15个字符,只能是字母数字下划线
password: 密码,长度6-16位任意字符</code></pre><p>返回数据</p>
<p>失败: </p>
<pre><code>返回格式: `{&quot;status&quot;: &quot;fail&quot;, &quot;msg&quot;: &quot;用户不存在&quot;}或者 {&quot;status&quot;: &quot;fail&quot;, &quot;msg&quot;: &quot;密码不正确&quot;}`</code></pre><p>成功:</p>
<p>返回格式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"注册成功"</span>,</span><br><span class="line">    <span class="string">"data"</span>:  &#123;</span><br><span class="line">        <span class="string">"id"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="string">"username"</span>: <span class="string">"Tom"</span>,</span><br><span class="line">        <span class="string">"avatar"</span>: <span class="string">"http://avatar.com/1.png"</span>,</span><br><span class="line">        <span class="string">"createdAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>,</span><br><span class="line">        <span class="string">"updatedAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试命令</p>
<p><code># -d用来传递数据</code></p>
<p><code># -i 可以显示响应头</code></p>
<p><code># 会发现响应头里有setCookie信息,得到cookie</code></p>
<p><code>curl -d &quot;usernme=Tom&amp;password=123456&quot;  &quot;http://localhost:3000/auth/login&quot; -i</code></p>
<h3 id="GET-auth"><a href="#GET-auth" class="headerlink" title="GET /auth"></a>GET /auth</h3><p>功能: 判断用户是否登录</p>
<p>提交参数: 无</p>
<p>返回数据:<br>已经登录的情况</p>
<p>返回格式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line">    <span class="string">"isLogin"</span>: <span class="string">"true"</span>,</span><br><span class="line">    <span class="string">"data"</span>:  &#123;</span><br><span class="line">        <span class="string">"id"</span> : <span class="number">1</span>,</span><br><span class="line">        <span class="string">"username"</span>: <span class="string">"Tom"</span>,</span><br><span class="line">        <span class="string">"createdAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>,</span><br><span class="line">        <span class="string">"updatedAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有登录的情况</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"status"</span>: <span class="string">"ok"</span></span><br><span class="line"><span class="string">"isLogin"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试命令</p>
<p><code>#先通过登录接口获取 cookie，带上 cookie 就能测试登录</code></p>
<p><code>curl &quot;http://localhost:3000/auth&quot; -b &quot;connect.sid=s%3AmeDbrn03UtTM8fqChaPQ20wmWlnKeHiu.e3uMtu7j1zQ1iNeaajCmxkYYGQ%2FyHV1ZsozMvZYWC6s&quot;</code></p>
<h3 id="GET-auth-logout"><a href="#GET-auth-logout" class="headerlink" title="GET /auth/logout"></a>GET /auth/logout</h3><p>功能: 注销登录</p>
<p>提交参数:无</p>
<p>返回数据: </p>
<pre><code>失败:
返回格式: `{ &quot;status&quot;: &quot;fail&quot;, &quot;msg&quot;: &quot;用户尚未登录&quot;}`

成功:
返回格式: `{ &quot;status&quot;: &quot;success&quot;, &quot;msg&quot;: &quot;注销成功&quot;}`</code></pre><p>测试命令</p>
<p><code>curl &quot;http://localhost:3000/auth/logout&quot; -b &quot;connect.sid=s%3AmeDbrn03UtTM8fqChaPQ20wmWlnKeHiu.e3uMtu7j1zQ1iNeaajCmxkYYGQ%2FyHV11ZsozMvZYWC6s&quot;</code></p>
<h1 id="博客相关"><a href="#博客相关" class="headerlink" title="博客相关"></a>博客相关</h1><h3 id="GET-blog"><a href="#GET-blog" class="headerlink" title="GET /blog"></a>GET /blog</h3><p>功能: 获取博客列表</p>
<p>提交参数:</p>
<pre><code>page: 页码,不传默认为1.
userId: 用户ID,不传获取全部用户ID
atIndex: 是否展示在首页.true只得到展示到首页的博客列表,false得到不展示到首页的列表,不传得到全部类型的博客列表</code></pre><p>如 /blog?page=2&amp;userId=1 获取属于用户1的第二页博客列表</p>
<p>返回数据: </p>
<pre><code>失败: { &quot;status&quot;: &quot;系统异常&quot;}</code></pre><p>成功:<br>返回格式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line">    <span class="string">"msg"</span>: <span class="string">"获取成功"</span>,</span><br><span class="line">    <span class="string">"total"</span>: <span class="number">200</span>,<span class="comment">//全部博客总数</span></span><br><span class="line">    <span class="string">"page"</span>: <span class="number">2</span>,<span class="comment">//当前页数</span></span><br><span class="line">    <span class="string">"totalPage"</span>: <span class="number">10</span>, <span class="comment">//总页数</span></span><br><span class="line">    <span class="string">"data"</span>: &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"title"</span>: <span class="string">"博客标题"</span>,</span><br><span class="line">        <span class="string">"description"</span>: <span class="string">"博客内容简要描述"</span>,</span><br><span class="line">        <span class="string">"user"</span>: &#123;</span><br><span class="line">            <span class="string">"id"</span>: <span class="number">100</span>, <span class="comment">//博客所属用户id</span></span><br><span class="line">            <span class="string">"username"</span>: <span class="string">"博客所属用户username"</span>,</span><br><span class="line">            <span class="string">"avatar"</span>: <span class="string">"头像"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"createdAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>, <span class="comment">//创建时间</span></span><br><span class="line">        <span class="string">"updatedAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>, <span class="comment">//更新时间</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试命令</p>
<p><code>curl &quot;http://localhost:3000/blog?page=1&amp;userId=1&quot;</code></p>
<p><code>curl &quot;http://localhost:3000/blog?page=1&quot;</code></p>
<p><code>curl &quot;http://localhost:3000/blog&quot;</code></p>
<h3 id="GET-blog-blogId"><a href="#GET-blog-blogId" class="headerlink" title="GET /blog/:blogId"></a>GET /blog/:blogId</h3><p>功能: 获取id为blogId的博客详情,如 /blog/1</p>
<p>提交参数: 无</p>
<p>返回数据:<br>    失败: <code>{ &quot;status&quot;: &quot;fail&quot;, &quot;msg&quot;: &quot;系统异常&quot;}</code></p>
<p>成功: </p>
<p>返回格式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line"><span class="string">"msg"</span>: <span class="string">"获取成功"</span>,</span><br><span class="line"><span class="string">"data"</span>: &#123;</span><br><span class="line">    <span class="string">"id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"title"</span>: <span class="string">"博客标题"</span>,</span><br><span class="line">    <span class="string">"description"</span>: <span class="string">"博客内容简要描述"</span>,</span><br><span class="line">    <span class="string">"content"</span>: <span class="string">"博客内容"</span>,</span><br><span class="line">    <span class="string">"user"</span>: &#123;</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">100</span>, <span class="comment">//博客所属用户id</span></span><br><span class="line">        <span class="string">"username"</span>: <span class="string">"博客所属用户username"</span>,</span><br><span class="line">        <span class="string">"avatar"</span>: <span class="string">"头像"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"createdAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>, <span class="comment">//创建时间</span></span><br><span class="line">    <span class="string">"updatedAt"</span>: <span class="string">"2019-10-19T15:15:33.343Z"</span>, <span class="comment">//更新时间</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="POST-blog"><a href="#POST-blog" class="headerlink" title="POST /blog"></a>POST /blog</h3><p>功能: 创建博客</p>
<p>提交参数:</p>
<pre><code>参数类型: Content-type: application/x-www-form-urlencoded; charset=utf-8;
参数字段:
    title : 博客标题, 博客标题不能为空，且不超过100个字符
    content : 博客内容, 博客内容不能为空，且不超过10000个字符
    description: 博客内容简要描述,可为空，如果为空则后台自动从content 中提取</code></pre><p>返回数据: </p>
<pre><code>失败: { &quot;status&quot;: &quot;fail&quot;, &quot;msg&quot;: &quot;登录后才能操作&quot;}</code></pre><p>成功: </p>
<p>返回格式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">&quot;status&quot;: &quot;ok&quot;,</span><br><span class="line">&quot;msg&quot;: 创建成功&quot;,</span><br><span class="line">&quot;data&quot;: &#123;</span><br><span class="line">    &quot;id&quot;: 1,</span><br><span class="line">    &quot;title&quot;: &quot;博客标题&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;博客内容简要描述&quot;,</span><br><span class="line">    &quot;content&quot;: &quot;博客内容&quot;,</span><br><span class="line">    &quot;user&quot;: &#123;</span><br><span class="line">        &quot;id&quot;: 100, //博客所属用户id</span><br><span class="line">        &quot;username&quot;: &quot;博客所属用户username&quot;,</span><br><span class="line">        &quot;avatar&quot;: &quot;头像&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;createdAt&quot;: &quot;2019-10-19T15:15:33.343Z&quot;, //创建时间</span><br><span class="line">    &quot;updatedAt&quot;: &quot;2019-10-19T15:15:33.343Z&quot;, //更新时间</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试命令<br><code>curl -d &quot;title=hello&amp;content=world&amp;description=jirengu&quot; -X POST &quot;http://localhost:3000/blog&quot; -b &quot;connect.sid=s%3AdyZh-z5fqPU_ThG9Qn8nGD6euI0UI75e.8uso0k4P6WzqWv02iQCUwxbUML2RdlOCnpKp7RSJpj0&quot;</code></p>
<h3 id="PATCH-blog-blogid"><a href="#PATCH-blog-blogid" class="headerlink" title="PATCH /blog/:blogid"></a>PATCH /blog/:blogid</h3><p>功能: 修改博客id为:blogid的博客</p>
<p>范例: /blog/1</p>
<p>提交参数</p>
<p>参数类型: Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>
<p>参数字段:</p>
<pre><code>title: 博客标题
content : 博客内容, 博客内容不能为空，且不超过10000个字符
description: 博客内容简要描述,可为空，如果为空则后台自动从content 中提取
atIndex: true/false， 展示到首页/从首页异常, 可选</code></pre><p>返回数据</p>
<p>失败</p>
<p>返回格式:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"fail"</span>, <span class="string">"msg"</span>: <span class="string">"登录后才能操作"</span>&#125;</span><br><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"fail"</span>, <span class="string">"msg"</span>: <span class="string">"博客不存在"</span>&#125;</span><br><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"fail"</span>, <span class="string">"msg"</span>: <span class="string">"无法修改别人的博客"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>成功</p>
<p>返回格式:</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line"><span class="string">"msg"</span>: 修改成功<span class="string">",</span></span><br><span class="line"><span class="string">"d</span>ata<span class="string">": &#123;</span></span><br><span class="line"><span class="string">    "</span>id<span class="string">": 1,</span></span><br><span class="line"><span class="string">    "</span>title<span class="string">": "</span>博客标题<span class="string">",</span></span><br><span class="line"><span class="string">    "d</span>escription<span class="string">": "</span>博客内容简要描述<span class="string">",</span></span><br><span class="line"><span class="string">    "c</span>ontent<span class="string">": "</span>博客内容<span class="string">",</span></span><br><span class="line"><span class="string">    "</span>use<span class="string">r": &#123;</span></span><br><span class="line"><span class="string">        "</span>id<span class="string">": 100, //博客所属用户id</span></span><br><span class="line"><span class="string">        "</span>username<span class="string">": "</span>博客所属用户username<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>avata<span class="string">r": "</span>头像<span class="string">"</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    "c</span>reatedAt<span class="string">": "</span><span class="number">2019</span>-<span class="number">10</span>-<span class="number">19</span>T15:<span class="number">15</span>:<span class="number">33.343</span>Z<span class="string">", //创建时间</span></span><br><span class="line"><span class="string">    "</span>updatedAt<span class="string">": "</span><span class="number">2019</span>-<span class="number">10</span>-<span class="number">19</span>T15:<span class="number">15</span>:<span class="number">33.343</span>Z<span class="string">", //更新时间</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>测试命令</p>
<p><code>curl -d &quot;title=hello100&amp;content=world1&amp;description=jirengu2234444444&amp;atIndex=true&quot; -X PATCH &quot;http://localhost:3000/blog/12&quot; -b &quot;connect.sid=s%3At_9V2bMXA7U9oSAmr1dhRXpdRPAsNM2B.jlpWgkwiWdpgTjexeTHGNydt8gvc%2F%2BEkJpQ9yaAmTg0&quot;</code></p>
<h3 id="DELETE-bog-blogid"><a href="#DELETE-bog-blogid" class="headerlink" title="DELETE /bog/:blogid"></a>DELETE /bog/:blogid</h3><p>功能: 删除id为:blogid的博客</p>
<p>提交参数：无</p>
<p>返回数据</p>
<p>失败</p>
<p>返回格式范例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"fail"</span>, <span class="string">"msg"</span>: <span class="string">"登录后才能操作"</span>&#125;</span><br><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"fail"</span>, <span class="string">"msg"</span>: <span class="string">"博客不存在"</span>&#125;</span><br><span class="line">&#123;<span class="string">"status"</span>: <span class="string">"fail"</span>, <span class="string">"msg"</span>: <span class="string">"无法删除别人的博客"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>成功</p>
<p>返回格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="string">"status"</span>: <span class="string">"ok"</span>,</span><br><span class="line"><span class="string">"msg"</span>: <span class="string">"删除成功"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试命令</p>
<p><code>curl -X DELETE &quot;http://localhost:3000/blog/12&quot; -b &quot;connect.sid=s%3AG_Chytg2F0RLWh2wTSCdLWVxpNg1MWWb.nPuMcgyMN6zxuxjSkyu8qSqM1boruol1Nce7egaXrPw&quot;</code></p>
<h1 id="文件介绍"><a href="#文件介绍" class="headerlink" title="文件介绍"></a>文件介绍</h1><h2 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h2><p>项目入口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue,app,router <span class="keyword">from</span> ...</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el:<span class="string">"#app"</span>,</span><br><span class="line">    router,</span><br><span class="line">    component: &#123; App &#125;,</span><br><span class="line">    template: <span class="string">'&lt;App /&gt;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre></td></tr></table></figure>

<h2 id="App-vue"><a href="#App-vue" class="headerlink" title="App.vue"></a>App.vue</h2><p>当前整个项目的模板</p>
<p><code>tempalte,js,style</code></p>
<h2 id="component-xxx-vue"><a href="#component-xxx-vue" class="headerlink" title="component/xxx.vue"></a>component/xxx.vue</h2><p>各个组件,也可以同名的文件夹,包含vue,css,js</p>
<h2 id="router-js"><a href="#router-js" class="headerlink" title="router.js"></a>router.js</h2><p>路由组件</p>
<h1 id="请求接口封装"><a href="#请求接口封装" class="headerlink" title="请求接口封装"></a>请求接口封装</h1><h2 id="helpers-request-js"><a href="#helpers-request-js" class="headerlink" title="helpers/request.js"></a>helpers/request.js</h2><p>请求组件</p>
<p>import axios</p>
<p>//约定请求文件格式</p>
<p><code>axios.defaults.headers.post[&#39;Content-Type&#39;] = &#39;application/x-www-form-urlencoded&#39;</code></p>
<p>//接口路径</p>
<p><code>axios.defaults.baseURL = &#39;http://blog-server.hunger-valley.com&#39;</code></p>
<p>//前后端分离,即使异步请求也带上cookie</p>
<p><code>axios.defaults.withCredentials = true</code></p>
<p>//函数导出</p>
<p><code>export default function request(){
    ...
}</code></p>
<h2 id="api接口封装"><a href="#api接口封装" class="headerlink" title="api接口封装"></a>api接口封装</h2><h3 id="api-auth-js"><a href="#api-auth-js" class="headerlink" title="@/api/auth.js"></a>@/api/auth.js</h3><p>//引入请求接口</p>
<p><code>import request from &#39;@/helpers/request&#39;</code></p>
<p>把各个接口进行封装,便于后续调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL = &#123;</span><br><span class="line">    REGISTER: <span class="string">'/auth/register'</span>,</span><br><span class="line">    LOGIN: <span class="string">'/auth/login'</span>,</span><br><span class="line">    LOGOUT: <span class="string">'/auth/logout'</span>,</span><br><span class="line">    GET_INFO: <span class="string">'/auth'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    register(&#123;username, password&#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.REGISTER, <span class="string">'POST'</span>, &#123; username, password &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    login(&#123; username, password&#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.LOGIN, <span class="string">'POST'</span>, &#123; username, password &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    logout()&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.LOGOUT)</span><br><span class="line">    &#125;,</span><br><span class="line">    getInfo()&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.GET_INFO)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="封装blog接口"><a href="#封装blog接口" class="headerlink" title="封装blog接口"></a>封装blog接口</h2><p>同样引入请求接口<br><code>import request from &#39;@/helpers/request&#39;</code></p>
<p>封装blog的各个接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> URL = &#123;</span><br><span class="line">    GET_LIST: <span class="string">'/blog'</span>,</span><br><span class="line">    GET_DETAIL: <span class="string">'/blog/:blogId'</span>,</span><br><span class="line">    CREATE: <span class="string">'/blog'</span>,</span><br><span class="line">    UPDATE: <span class="string">'/blog/:blogId'</span>,</span><br><span class="line">    DELETE: <span class="string">'/blog/:blogId'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    getBlogs(&#123; page=<span class="number">1</span>, userId, atIndex &#125; = &#123; <span class="attr">page</span>:<span class="number">1</span> &#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.GET_LIST, <span class="string">'GET'</span>, &#123; page, userId, atIndex &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    getIndexBlogs(&#123; page=<span class="number">1</span> &#125; = &#123; <span class="attr">page</span>: <span class="number">1</span> &#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getBlogs(&#123; userId, page, atIndex &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    getDetail(&#123; blogId &#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span>  reuqest(URL.GET_DETAIL, replace(<span class="string">':blogId'</span>, blogId))</span><br><span class="line">    &#125;,</span><br><span class="line">    updateBlog(&#123; blogId &#125;, &#123; title, content, description, atIndex &#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.UPDATE, replace(<span class="string">':blogId'</span>, blogId), <span class="string">'PATCH'</span>, &#123; title, content, description, atIndex &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteBlog(&#123; blogId &#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.DELETE, replace(<span class="string">':blogId'</span>,blogId), <span class="string">'DELETE'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    createBlog(&#123; title = <span class="string">''</span>, content = <span class="string">''</span>, description = <span class="string">''</span>,atIndex = <span class="literal">false</span> &#125; = &#123; title = <span class="string">''</span>, content = <span class="string">''</span>&#125;)&#123;</span><br><span class="line">        <span class="keyword">return</span> request(URL.CREATE, <span class="string">'POST'</span>, &#123; title, content, description &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="首页布局"><a href="#首页布局" class="headerlink" title="首页布局"></a>首页布局</h1><p>…</p>
<h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><p>store.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @/assets/moudles/auth.js</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">    user: <span class="literal">null</span>,</span><br><span class="line">    isLogin: <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">    user:<span class="function"><span class="params">state</span> =&gt;</span> state.user,</span><br><span class="line">    isLogin:<span class="function"><span class="params">state</span> =&gt;</span> state.isLogin</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">    setUser(state, payload)&#123;</span><br><span class="line">        state.user = payloag.user</span><br><span class="line">    &#125;,</span><br><span class="line">    setLogin(state, payload)&#123;</span><br><span class="line">        state.isLogin = payload.isLogin</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">    <span class="keyword">async</span> login(&#123; commit &#125;, &#123; username, password &#125;)&#123;</span><br><span class="line">        <span class="keyword">let</span> res = <span class="keyword">await</span> auth.login(&#123; username, password &#125;)</span><br><span class="line">        commit(<span class="string">'setUser'</span>, &#123; <span class="attr">user</span>: res.data&#125;)</span><br><span class="line">        commit(<span class="string">'setLogin'</span>, &#123; <span class="attr">isLogin</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        <span class="keyword">return</span> res.data</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> register(&#123; commit &#125;, &#123; username, password &#125;)&#123;</span><br><span class="line">        <span class="keyword">let</span> res = <span class="keyword">await</span> auth.register(&#123; username, password&#125;)</span><br><span class="line">        commit(<span class="string">'setUser'</span>, &#123; <span class="attr">user</span>: res.data&#125;)</span><br><span class="line">        commit(<span class="string">'setLogin'</span>, &#123; <span class="attr">isLogin</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">        <span class="keyword">return</span> res.data</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> logout(&#123; commit &#125;)&#123;</span><br><span class="line">        <span class="keyword">await</span> auth.logout()</span><br><span class="line">        commit(<span class="string">'setUser'</span>, &#123; <span class="attr">user</span>: <span class="literal">null</span> &#125;)</span><br><span class="line">        commit(<span class="string">'setLogin'</span>, &#123; <span class="attr">isLogin</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">async</span> checkLogin(&#123; commit, state &#125;)&#123;</span><br><span class="line">        <span class="comment">//判断state中是否有登录状态,有返回true</span></span><br><span class="line">        <span class="keyword">if</span>(state.isLogin) <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        <span class="comment">//如果state中没有,调用res</span></span><br><span class="line">        <span class="keyword">let</span> res = <span class="keyword">await</span> auth.getInfo()</span><br><span class="line">        <span class="comment">//从res中获取isLogin状态设置Login</span></span><br><span class="line">        commit(<span class="string">'setLogin'</span>, &#123; <span class="attr">isLogin</span>: res.isLogin &#125;) </span><br><span class="line">        <span class="comment">//如果res中未登录,返回false</span></span><br><span class="line">        <span class="keyword">if</span>(!res.isLogin) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment">//如果res中已登录,设置user并返回true</span></span><br><span class="line">        commit(<span class="string">'setUser'</span>, &#123; <span class="attr">user</span>: res.data &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    state,</span><br><span class="line">    getters,</span><br><span class="line">    mutations,</span><br><span class="line">    actions</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="在header-vue中调用vuex中的参数"><a href="#在header-vue中调用vuex中的参数" class="headerlink" title="在header.vue中调用vuex中的参数"></a>在header.vue中调用vuex中的参数</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//header.vue</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapState, mapActions &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed()&#123;</span><br><span class="line">        ...mapGetters([</span><br><span class="line">            <span class="string">'isLogin'</span>,</span><br><span class="line">            <span class="string">'user'</span></span><br><span class="line">        ])</span><br><span class="line">    &#125;,</span><br><span class="line">    created()&#123;</span><br><span class="line">        <span class="comment">//在生命周期created调用methods的方法</span></span><br><span class="line">        <span class="keyword">this</span>.checkLogin()</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">        <span class="comment">//将state中的方法映射进来</span></span><br><span class="line">        ...mapActions(&#123;</span><br><span class="line">            <span class="string">'checkLogin'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="登录和注册"><a href="#登录和注册" class="headerlink" title="登录和注册"></a>登录和注册</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Login/template.vue</span></span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"login"</span>&gt;</span><br><span class="line">        &lt;h4&gt;用户名&lt;<span class="regexp">/h4&gt;</span></span><br><span class="line"><span class="regexp">        &lt;input v-model="username" placeholder="用户名"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;h4&gt;密码&lt;/</span>h4&gt;</span><br><span class="line">        &lt;input v-model=<span class="string">"password"</span> type=<span class="string">"password"</span> placeholder=<span class="string">"密码"</span> @key.enter=<span class="string">"onLogin"</span>&gt;</span><br><span class="line">        &lt;el-button size=<span class="string">"medium"</span> @click=<span class="string">"onLogin"</span>&gt;立即登录&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p class="notice"&gt;没有账号?&lt;router-link to="/</span>register<span class="string">"&gt;注册新用户&lt;/router-link&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/template&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Login/template.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; mapActions &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data()&#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            username: <span class="string">''</span>,</span><br><span class="line">            password: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        <span class="comment">//把login从vuex中拿出来</span></span><br><span class="line">        ...mapActions([<span class="string">'login'</span>])</span><br><span class="line"></span><br><span class="line">        onLogin()&#123;</span><br><span class="line">            <span class="comment">//test</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.username + <span class="keyword">this</span>.password)</span><br><span class="line">            <span class="comment">//执行登录,把用户名密码传递</span></span><br><span class="line">            <span class="keyword">this</span>.login(&#123;<span class="attr">username</span>: <span class="keyword">this</span>.username, <span class="attr">password</span>: <span class="keyword">this</span>.password&#125;)</span><br><span class="line">            <span class="comment">//调用then下一步操作,跳转到首页或者定向页面</span></span><br><span class="line">                .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">this</span>.$router.push(&#123;<span class="attr">path</span>: <span class="keyword">this</span>.$route.query.redirect || <span class="string">'/'</span>&#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h2><p>注册类似于登录<br>将login换成register即可.</p>
<h1 id="路由组件router-js"><a href="#路由组件router-js" class="headerlink" title="路由组件router.js"></a>路由组件router.js</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入store为了checkin</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./src/store.js'</span></span><br><span class="line"></span><br><span class="line">Vue.use(Router)</span><br><span class="line"></span><br><span class="line"><span class="comment">//先声明,最后再导出</span></span><br><span class="line"><span class="keyword">const</span> router =  <span class="keyword">new</span> Router(&#123;</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      <span class="comment">//使用匿名函数import方式实现异步懒加载</span></span><br><span class="line">      <span class="comment">//当需要跳转该模块时才会引入相关路径</span></span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Index/template.vue'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/login'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Login/template.vue'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/detail/:blogId'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Detail/template.vue'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/edit/:blogId'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Edit/template.vue'</span>),</span><br><span class="line">      meta: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/create'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Create/template.vue'</span>),</span><br><span class="line">      meta: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/user/:userId'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/User/template.vue'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/my'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/My/template.vue'</span>),</span><br><span class="line">      meta: &#123; <span class="attr">requiresAuth</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/register'</span>,</span><br><span class="line">      component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'@/pages/Register/template.vue'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.beforeEach(<span class="function">(<span class="params">to,<span class="keyword">from</span>,next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//判断是否有元信息meta</span></span><br><span class="line">    <span class="keyword">if</span>(to.matched.some(<span class="function"><span class="params">record</span> =&gt;</span> record.meta.requiresAuth))&#123;</span><br><span class="line">        <span class="comment">//如果有就触发checkLogin检查登录状态</span></span><br><span class="line">        store.dispatch(<span class="string">'checkLogin'</span>).then(<span class="function"><span class="params">isLogin</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(!isLogin)&#123;</span><br><span class="line">                next(&#123;</span><br><span class="line">                    path: <span class="string">'/login'</span>,</span><br><span class="line">                    query: &#123; <span class="attr">redirect</span>: to.fullPath &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                next()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        next()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure>

<h1 id="创建博客页面"><a href="#创建博客页面" class="headerlink" title="创建博客页面"></a>创建博客页面</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div id=<span class="string">"edit"</span>&gt;</span><br><span class="line">    &lt;!-- 创建博客 --&gt;</span><br><span class="line">        &lt;h1&gt;创建文章&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;h3&gt;文章标题&lt;/</span>h3&gt;</span><br><span class="line">        &lt;el-input v-model=<span class="string">"title"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">"msg"</span>&gt;限<span class="number">30</span>个字&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;h3&gt;内容简介&lt;/</span>h3&gt;</span><br><span class="line">        &lt;el-input type=<span class="string">"textarea"</span> v-model=<span class="string">"description"</span> :autosize=<span class="string">"&#123; minRow: 2, maxRows: 4 &#125;"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">"msg"</span>&gt;限<span class="number">30</span>个字&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;h3&gt;文章内容&lt;/</span>h3&gt;</span><br><span class="line">        &lt;el-input type=<span class="string">"textarea"</span> v-model=<span class="string">"content"</span> :autosize=<span class="string">"&#123; minRow: 4, maxRows: 30 &#125;"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span><br><span class="line">        &lt;p <span class="class"><span class="keyword">class</span></span>=<span class="string">"msg"</span>&gt;限<span class="number">30</span>个字&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;label&gt;是否展示到首页&lt;/</span>label&gt;</span><br><span class="line">            &lt;el-<span class="keyword">switch</span> v-model=<span class="string">"atIndex"</span> active-color=<span class="string">"#13ce66"</span> inactive-color=<span class="string">"#fff"</span>&gt;</span><br><span class="line">            &lt;<span class="regexp">/el-switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>p&gt;</span><br><span class="line">            &lt;el-button @click=<span class="string">"onCreate"</span>&gt;确定&lt;<span class="regexp">/el-button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/template&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">import blog from '@/</span>api/blog<span class="string">'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string">    data()&#123;</span></span><br><span class="line"><span class="string">        return &#123;</span></span><br><span class="line"><span class="string">            title: '</span><span class="string">',</span></span><br><span class="line"><span class="string">            description: '</span><span class="string">',</span></span><br><span class="line"><span class="string">            content: '</span><span class="string">',</span></span><br><span class="line"><span class="string">            atIndex: false</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    methods: &#123;</span></span><br><span class="line"><span class="string">        onCreate()&#123;</span></span><br><span class="line"><span class="string">            blog.createBlog(&#123; title: this.title, content: this.content, description: this.description, atIndex: this.atIndex&#125;)</span></span><br><span class="line"><span class="string">                .then(res =&gt; &#123;</span></span><br><span class="line"><span class="string">                    this.$message.success(res.msg)</span></span><br><span class="line"><span class="string">                    this.$router.push(&#123; path: `/detail/$&#123;res.data.id&#125;`&#125;)</span></span><br><span class="line"><span class="string">                &#125;)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="完善首页"><a href="#完善首页" class="headerlink" title="完善首页"></a>完善首页</h1><h1 id="详情页"><a href="#详情页" class="headerlink" title="详情页"></a>详情页</h1><h1 id="时间插件"><a href="#时间插件" class="headerlink" title="时间插件"></a>时间插件</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">friendlyDate</span>(<span class="params">datsStr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> dateObj = <span class="keyword">typeof</span> datsStr === <span class="string">'object'</span> ? datsStr : <span class="keyword">new</span> <span class="built_in">Date</span>(datsStr)</span><br><span class="line">    <span class="keyword">let</span> time = dateObj.getTime()</span><br><span class="line">    <span class="keyword">let</span> now = <span class="built_in">Date</span>.now()</span><br><span class="line">    <span class="keyword">let</span> space = now - time</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">''</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">switch</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> space &lt; <span class="number">60000</span>:</span><br><span class="line">            str = <span class="string">'刚刚'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> space &lt; <span class="number">1000</span>*<span class="number">3600</span>:</span><br><span class="line">            str = <span class="built_in">Math</span>.floor(space/<span class="number">60000</span>) + <span class="string">'分钟前'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">case</span> space &lt; <span class="number">1000</span>*<span class="number">3600</span>*<span class="number">24</span>:</span><br><span class="line">            str = <span class="built_in">Math</span>.floor(space/(<span class="number">1000</span>*<span class="number">3600</span>)) + <span class="string">'小时前'</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            str = <span class="built_in">Math</span>.floor(space/(<span class="number">1000</span>*<span class="number">3600</span>*<span class="number">24</span>)) + <span class="string">'天前'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    install(Vue, options) &#123;</span><br><span class="line">        Vue.prototype.friendlyDate = friendlyDate</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="个人页面user"><a href="#个人页面user" class="headerlink" title="个人页面user"></a>个人页面user</h1><p>有点东西</p>
<h1 id="登陆者的个人页面my"><a href="#登陆者的个人页面my" class="headerlink" title="登陆者的个人页面my"></a>登陆者的个人页面my</h1><h1 id="遇到过的问题"><a href="#遇到过的问题" class="headerlink" title="遇到过的问题"></a>遇到过的问题</h1><ol>
<li>vuex中actions错误(原因: modules拼错了)</li>
<li>登录时enter无法使用.(解决方法: 加.native)</li>
<li>文章内容应有一定区域(原因: 没写palceholder)</li>
<li>编辑时少一个设置为首页的按钮(原因:按钮初始颜色透明)</li>
<li>my页面无法显示(原因: 因为错误6)</li>
<li>过滤器getMouth错误,(原因: mouth单词拼错)</li>
<li>my页面编辑删除两个按钮靠的太近</li>
<li>header布局错误(原因: h1标签没有把router-link包裹,如果包裹,less有设置h1下a标签的颜色为白色.<br>没有包裹的时候,a标签的颜色是common.less设置的黑色,会覆盖)<br>标题颜色错误,把标题文本和普通文本颜色算在一起了.</li>
</ol>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/16/其他人面试题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/16/其他人面试题/" class="post-title-link" itemprop="url">其他人面试题</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-16 18:40:25" itemprop="dateCreated datePublished" datetime="2019-11-16T18:40:25+08:00">2019-11-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-25 16:04:00" itemprop="dateModified" datetime="2019-11-25T16:04:00+08:00">2019-11-25</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="第一份"><a href="#第一份" class="headerlink" title="第一份"></a>第一份</h1><ol>
<li><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">Person.prototype.name = <span class="string">"nick"</span></span><br><span class="line">Person.prototype.age = <span class="number">20</span></span><br><span class="line">Person.prototype.job = <span class="string">"Engineer"</span></span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person()</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person()</span><br><span class="line">person1.name = <span class="string">"Greg"</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.name)</span><br><span class="line"><span class="built_in">console</span>.log(person2.name)</span><br><span class="line"><span class="built_in">console</span>.log(person1.hasOwnProperty(<span class="string">"name"</span>))</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Greg</span><br><span class="line">nick <span class="comment">//实例并没有改变对象的属性</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>请列举js的数据类型</li>
<li>请写出dom事件流的三个阶段</li>
<li>js如何添加,移除,创建,复制,查找dom节点</li>
<li>jQuery的bind,live,delegate的区别</li>
<li>请写出至少4种vue的指令和用法</li>
<li>什么是闭包,什么时候使用闭包</li>
<li>如何编写响应式网页</li>
<li>简单描述一下微信小程序的文件类型</li>
<li>如何优化代码</li>
<li>请列举ES6的语法</li>
</ol>
<h1 id="第二份"><a href="#第二份" class="headerlink" title="第二份"></a>第二份</h1><ol>
<li>this原型链new结合的题,问输出什么</li>
<li>css有什么选择器,优先级,什么属性,哪些可以继承,哪些不能继承,css3新增的伪类有哪些</li>
<li>vue组件通信</li>
<li>ajax返回三个状态码,成功失败未知,假如是未知就轮询,1到5秒延迟3秒发请求,6到10秒延迟1秒,10到20延迟0.5秒,轮询20次失败,手写可运行的代码</li>
<li>数组{城市,省份,代号}输出成{省份,城市[城市名,代号]}</li>
<li>js有什么bug让你写代码出错,答类型判断.追问,怎么通过原型链判断一个对象是json,</li>
<li>平时写代码有什么逻辑上的错误</li>
<li>当前端有什么技巧?(不是优化).答:console二分法定位错误</li>
</ol>
<h1 id="第三份"><a href="#第三份" class="headerlink" title="第三份"></a>第三份</h1><ol>
<li>将下列数据封装成json</li>
</ol>
<table>
<thead>
<tr>
<th>数据名</th>
<th>值</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>kate</td>
<td>string</td>
</tr>
<tr>
<td>age</td>
<td>10</td>
<td>int</td>
</tr>
<tr>
<td>phone</td>
<td>15455234376</td>
<td>string</td>
</tr>
<tr>
<td>phone</td>
<td>15455234376</td>
<td>string</td>
</tr>
<tr>
<td>date_time</td>
<td>2019-01-01 15:00:00</td>
<td>string</td>
</tr>
</tbody></table>
<ol start="2">
<li>将如下json字符串转化成js对象并获取到name的值<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> json_str = &#123;<span class="string">"name"</span>: <span class="string">"tiger"</span>&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> json_str = &#123;<span class="string">"name"</span>: <span class="string">"tiger"</span>&#125;</span><br><span class="line"><span class="keyword">var</span> str = <span class="built_in">JSON</span>.parse(<span class="string">'json_str'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(str.name)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>获取如下变量中的月和日<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> date_time = <span class="string">"2019-01-01 15:00:00"</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(date_time).getMonth() + <span class="number">1</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Date</span>(date_time).getDate()</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>写出尽可能多的dom事件和js事件</li>
<li>写出尽可能多的伪类和伪元素</li>
<li>css3 2D转换,如右图效果(效果是第二个div方块向上位移一半,能够覆盖一点第一个div,然后顺时针旋转30度),代码如下,请填写div2的代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">div &#123;</span><br><span class="line">    width: <span class="number">100</span>px;</span><br><span class="line">    height: <span class="number">75</span>px;</span><br><span class="line">    background-color: lightgray;</span><br><span class="line">    border: <span class="number">1</span>px solid black;</span><br><span class="line">&#125;</span><br><span class="line">div#div2&#123;</span><br><span class="line">    <span class="comment">/*请写代码 */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div&gt;<span class="number">1</span>号div元素&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;div id="div2"&gt;2号div元素&lt;/</span>div&gt;</span><br><span class="line">&lt;<span class="regexp">/body&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>html&gt;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">div#div2&#123;</span><br><span class="line">transform: translateY(<span class="number">-20</span>%);</span><br><span class="line">transform: rotate(<span class="number">30</span>deg);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>css动画使用哪个属性,过渡使用哪个属性</li>
<li>写一种灰色的rgb值</li>
<li>尽可能多的vue的生命周期,并标注运行时间</li>
<li>控制元素是否显示的vue属性</li>
<li>下面代码的打印结果. 简述什么是变量的作用域,全局变量和局部变量的区别<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    a = <span class="number">100</span></span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">    <span class="keyword">var</span> a </span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">100</span> <span class="comment">//声明前置,函数内部a=100</span></span><br><span class="line"><span class="number">10</span> <span class="comment">//this指向window,a=10</span></span><br><span class="line"><span class="number">100</span> <span class="comment">//继续输出函数内部的a</span></span><br><span class="line"><span class="number">10</span> <span class="comment">//函数内部的a只在函数内有效,在外部看全局的a,a=10</span></span><br></pre></td></tr></table></figure>

<ol start="12">
<li>简述cookie和session的区别</li>
<li>简述axios的作用和优势.</li>
</ol>
<h1 id="第四份"><a href="#第四份" class="headerlink" title="第四份"></a>第四份</h1><ol>
<li>v-show和v-if的区别</li>
<li>let和const的区别</li>
<li>fetch和axios支持跨域请求吗?fetch第一次得到什么数据,怎么进行转换?</li>
<li>什么是MVC和MVVM,vue属于那一种?小程序是什么思想实现双向数据绑定的?</li>
<li>async和await实现同步的好处</li>
<li>React/Vue中key会影响diff算法吗</li>
<li>Vue-router的路由原理</li>
<li>什么是虚拟dom</li>
</ol>
<h1 id="第五份"><a href="#第五份" class="headerlink" title="第五份"></a>第五份</h1><ol>
<li>使用css让该节点不可见,方法越多越好<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"hidden"</span>&gt;Hi&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在哪些场景下用过position的哪些值,他们分别有什么特性.</li>
<li>什么是单进程?什么是单进程异步?</li>
<li>输出结果<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fn = []</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">    fn[i] = <span class="function"><span class="keyword">function</span>(<span class="params">param</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i + param)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn[<span class="number">5</span>](<span class="number">5</span>)</span><br><span class="line"><span class="keyword">var</span> data = &#123; <span class="attr">a</span>:<span class="number">10</span>, <span class="attr">b</span>:<span class="number">20</span> &#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'第'</span>+ i +<span class="string">'条数据:'</span> + data)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">15</span> <span class="comment">//闭包,打印最后是10个闭包,且i=10,传入[5],打出来i也是10</span></span><br><span class="line"><span class="string">"第10条数据:[object Object]"</span> <span class="comment">//字符串+对象就会把对象打印成[object Object].这是+运算符的特点</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>输出结果<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">4</span>)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">5</span>)</span><br><span class="line">&#125;, ()=&gt;&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">6</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">7</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//考察微任务和宏任务</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span> <span class="comment">//此时并未执行异步,仍属于宏任务中script下同步代码</span></span><br><span class="line"><span class="number">7</span> <span class="comment">//此时同步代码执行完毕,执行栈为空,</span></span><br><span class="line"><span class="number">5</span> <span class="comment">//开始执行微任务,promise属于微任务</span></span><br><span class="line">  <span class="comment">//不输出6是因为那是失败时的回调</span></span><br><span class="line"><span class="number">2</span> <span class="comment">//开始下一轮event loop,执行宏任务中的异步代码.setTimeout开始执行.</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li>输出结果<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;<span class="number">5</span>;j++)&#123;</span><br><span class="line">        a[i] = a[i] + a[j]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//双重遍历</span></span><br><span class="line"><span class="comment">//可以假设外层的不变</span></span><br><span class="line"><span class="comment">//当i=0时,内层开始遍历,得到</span></span><br><span class="line">a[<span class="number">0</span>] = a[<span class="number">0</span>] + a[<span class="number">0</span>] <span class="comment">//2</span></span><br><span class="line">a[<span class="number">0</span>] = a[<span class="number">0</span>] + a[<span class="number">1</span>] <span class="comment">//3</span></span><br><span class="line">a[<span class="number">0</span>] = a[<span class="number">0</span>] + a[<span class="number">2</span>] <span class="comment">//4</span></span><br><span class="line">a[<span class="number">0</span>] = a[<span class="number">0</span>] + a[<span class="number">3</span>] <span class="comment">//5</span></span><br><span class="line">a[<span class="number">0</span>] = a[<span class="number">0</span>] + a[<span class="number">4</span>] <span class="comment">//6,</span></span><br><span class="line"><span class="comment">//此时a[0] = 6</span></span><br><span class="line"><span class="comment">//当i=1时,内层再次遍历,得到</span></span><br><span class="line">a[<span class="number">1</span>] = a[<span class="number">1</span>] + a[<span class="number">0</span>] <span class="comment">//7</span></span><br><span class="line">a[<span class="number">1</span>] = a[<span class="number">1</span>] + a[<span class="number">1</span>] <span class="comment">//14</span></span><br><span class="line">a[<span class="number">1</span>] = a[<span class="number">1</span>] + a[<span class="number">2</span>] <span class="comment">//15</span></span><br><span class="line">a[<span class="number">1</span>] = a[<span class="number">1</span>] + a[<span class="number">3</span>] <span class="comment">//16</span></span><br><span class="line">a[<span class="number">1</span>] = a[<span class="number">1</span>] + a[<span class="number">4</span>] <span class="comment">//17,</span></span><br><span class="line"><span class="comment">//此时a[1] = 17</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//以此类推,得到</span></span><br><span class="line">a = [<span class="number">6</span>,<span class="number">17</span>,<span class="number">50</span>,<span class="number">149</span>,<span class="number">446</span>]</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>写出1所在的while循环的作用.补全2的代码<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//isSymmetry用来判断正整数n是否是一个对称数.例如:12321是对称数,123不是.</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isSymmetry</span>(<span class="params">n</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> i = n</span><br><span class="line">    <span class="keyword">let</span> j = <span class="number">0</span></span><br><span class="line">    <span class="comment">//位置1</span></span><br><span class="line">    <span class="keyword">while</span>(i)&#123;</span><br><span class="line">        j = j * <span class="number">10</span> + i % <span class="number">10</span></span><br><span class="line">        i = <span class="built_in">parseInt</span>(i/<span class="number">10</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="comment">//位置2补充代码</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(isSymmetry(<span class="number">12321</span>)) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(isSymmetry(<span class="number">12312</span>)) <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">假设: n = <span class="number">11</span>,</span><br><span class="line">i = <span class="number">11</span>,j = <span class="number">0</span>;</span><br><span class="line">i = <span class="number">1</span>,j = <span class="number">1</span>;</span><br><span class="line">i = <span class="number">0</span> ,j = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">111</span>,</span><br><span class="line">i = <span class="number">111</span>,j = <span class="number">0</span>;</span><br><span class="line">i = <span class="number">11</span>,j = <span class="number">1</span>;</span><br><span class="line">i = <span class="number">1</span>,j = <span class="number">11</span>;</span><br><span class="line">i = <span class="number">0</span>,j = <span class="number">111.</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">12</span>,</span><br><span class="line">i = <span class="number">12</span>,j = <span class="number">0</span>;</span><br><span class="line">i = <span class="number">1</span>,j = <span class="number">2</span>;</span><br><span class="line">i = <span class="number">0</span>,j = <span class="number">21.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结论</span></span><br><span class="line"><span class="keyword">return</span> n == j</span><br><span class="line"><span class="keyword">while</span>的作用: 循环判断是否将输入值的高低位置颠倒.</span><br></pre></td></tr></table></figure>

<ol start="8">
<li>把数组倒序输出(不是排序,不能用内置方法)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">'name'</span>, <span class="string">'first'</span>, <span class="string">'5'</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="string">'2'</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> arr)&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(arr[key])</span><br><span class="line">    &#125;,<span class="number">100</span>-key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>(过一面必做题)数组中的重复项最多出现N次.(时间复杂度越低得分越高)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//原题</span></span><br><span class="line">outputNth([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>], <span class="number">2</span>) <span class="comment">//return [1,1]</span></span><br><span class="line">outputNth([<span class="number">20</span>, <span class="number">37</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">21</span>], <span class="number">2</span>) <span class="comment">//return [20,20,37,21]</span></span><br><span class="line"><span class="comment">//预估时间复杂度</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//附加题</span></span><br><span class="line"><span class="comment">//如果要求</span></span><br><span class="line">outputNth([<span class="number">20</span>, <span class="number">37</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">21</span>], <span class="number">2</span>) <span class="comment">//return [20,37,20,21] 按原数组的先后返回</span></span><br><span class="line"><span class="comment">//预估时间复杂度</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第六份"><a href="#第六份" class="headerlink" title="第六份"></a>第六份</h1><ol>
<li><p>假设有两个数组a和b,数组的内容都是从小到大排好序的数字.现在我们合并这两个数字.并且合并之后的数字也是从小到大排好序的.<br>请写下你的实现.不要直接使用js的sort方法,并且确保只使用一次for循环.<br>例如,a=[2,5,10],b=[4,7,9,11],那么合并的结果是c=[2,4,5,7,9,10,11]<br>提示,你可以在一个for循环中同时控制两个数组下标i和j.比较a[i]和a[j].将小的数字加到c中,同时更新相应的下标.但是注意各种边界条件.<br>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//考察排序算法</span></span><br><span class="line"><span class="keyword">var</span> arr = a.concat(b) <span class="comment">//arr=[2,5,10,4,7,9,11]</span></span><br><span class="line"><span class="keyword">var</span> c =[]</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入一个数字组成的字符串,请把它转化成整数并输出.<br>例如,输入字符串’123’,输出整数123.不要使用库函数,函数原型为: <code>function strToInt(str)</code><br>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'123'</span></span><br><span class="line"><span class="built_in">console</span>.log(+str)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">parseInt</span>(str))</span><br></pre></td></tr></table></figure>
</li>
<li><p>合并数组中相邻且重复的元素<br>说明: 请实现一个函数merge,传入一个数组,合并数组中相邻且重复的元素,示例:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">merge([<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">1</span>]) <span class="comment">//[3,2,4,5,6,2,1]</span></span><br><span class="line">merge([<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">//[3,2,3]</span></span><br><span class="line">merge([<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment">//[2,3]</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> </span><br></pre></td></tr></table></figure>

<ol start="4">
<li>请按顺序取出下方log<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 start"</span>)</span><br><span class="line">    <span class="keyword">await</span> async2()</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async1 end"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">async2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"async2"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script start"</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"setTimeout"</span>)</span><br><span class="line">&#125;,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">async1()</span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise1"</span>)</span><br><span class="line">    resolve()</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"promise2"</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"script end"</span>)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">script start </span><br><span class="line">async1 start <span class="comment">//async 表达式定义的函数是立即执行的</span></span><br><span class="line">async2</span><br><span class="line">promise1</span><br><span class="line">script end</span><br><span class="line">async1 end <span class="comment">//</span></span><br><span class="line">promise2</span><br><span class="line">setTimeout</span><br></pre></td></tr></table></figure>

<h1 id="第七份"><a href="#第七份" class="headerlink" title="第七份"></a>第七份</h1><ol>
<li>对MVC,MVVM的理解.</li>
<li>vue对于jquery在开发上有什么优点</li>
<li>前后端分离的思想了解吗</li>
<li>你上一个项目都用了哪些方法优化js的性能</li>
<li>说一下你对vue和veux的使用方法,vue的组件复用机制</li>
<li>js怎样实现一个类,怎么实例化这个类</li>
</ol>
<h1 id="第八份"><a href="#第八份" class="headerlink" title="第八份"></a>第八份</h1><ol>
<li>下面的函数执行后会输出什么<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> b = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="string">"hello world"</span>)</span><br><span class="line">        reject(<span class="string">"error"</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;<span class="number">10</span>; ++i)&#123;</span><br><span class="line">        b.then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data + i)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a() <span class="comment">//输出什么</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hello world0</span><br><span class="line">hello world1</span><br><span class="line">hello world2</span><br><span class="line">hello world3</span><br><span class="line">hello world4</span><br><span class="line">hello world5</span><br><span class="line">hello world6</span><br><span class="line">hello world7</span><br><span class="line">hello world8</span><br><span class="line">hello world9</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下面的函数执行后会输出什么<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve,reject</span>)</span>&#123;</span><br><span class="line">            resolve(<span class="string">"hello"</span>)</span><br><span class="line">            reject(<span class="string">"error"</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(data + i)</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;++i)&#123;</span><br><span class="line">        <span class="keyword">await</span> b()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a() <span class="comment">//输出什么</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hello0</span><br><span class="line">hello1</span><br><span class="line">hello2</span><br><span class="line">hello3</span><br><span class="line">hello4</span><br><span class="line">hello5</span><br><span class="line">hello6</span><br><span class="line">hello7</span><br><span class="line">hello8</span><br><span class="line">hello9</span><br></pre></td></tr></table></figure>

<h1 id="第九份-半截"><a href="#第九份-半截" class="headerlink" title="第九份(半截)"></a>第九份(半截)</h1><ol start="7">
<li><p>什么是延迟加载?</p>
</li>
<li><p>请谈谈vue中的mvvm模式</p>
</li>
<li><p>vue中引入组件的步骤</p>
</li>
<li><p>什么是vuex?为什么要用vuex?</p>
</li>
</ol>
<h1 id="第十份"><a href="#第十份" class="headerlink" title="第十份"></a>第十份</h1><ol>
<li>请说明值类型和引用类型的区别?那些是值类型,哪些是引用类型?</li>
<li>请简述private,protected,public,internal修饰符的访问权限.</li>
<li>简述session和cookie的作用和区别</li>
<li>请简述ajax工作原理和常用的ajax框架</li>
<li>css规范中, <code>.</code>后面跟一个名称代表什么?<code>#</code>代表什么?</li>
<li>字符串反转,给定字符串<code>&quot;we;tonight;you;&quot;</code>,编码实现输出<code>&quot;ew;thginot;uoy;&quot;</code></li>
</ol>
<h1 id="第十一份"><a href="#第十一份" class="headerlink" title="第十一份"></a>第十一份</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"My Obj"</span>,</span><br><span class="line">    getNameFunc: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.getNameFunc()()) <span class="comment">//输出什么</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">obj.getNameFunc()的<span class="keyword">this</span>是obj</span><br><span class="line">obj.getNameFunc()()的<span class="keyword">this</span>是<span class="built_in">window</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">"The Window"</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"My Obj"</span>,</span><br><span class="line">    getNameFunc: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> that = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> that.name</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj.getNameFunc()()) <span class="comment">//输出什么</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">My Obj</span><br></pre></td></tr></table></figure>

<h1 id="第十二份"><a href="#第十二份" class="headerlink" title="第十二份"></a>第十二份</h1><ol>
<li>vue-router原理</li>
<li>相关钩子函数</li>
<li>nexttick</li>
<li>css3常用属性</li>
<li>keep-alive</li>
<li>屏幕滚动</li>
<li>箭头函数什么时候就已经绑定this</li>
<li>数组方法,map和forEach的区别</li>
<li>route和router的区别</li>
<li>中间件原理</li>
</ol>
<h1 id="第十三份"><a href="#第十三份" class="headerlink" title="第十三份"></a>第十三份</h1><ol>
<li>虚拟dom</li>
<li>生命周期,常用的那些,在这些阶段一般都做了什么</li>
<li>Vuex是干什么的?有哪些属性?怎么操作state中的属性</li>
<li>vue-router有哪些方法?怎么传递参数,获取参数,路由导航钩子有哪几种,全局钩子的移动端适配(媒体查询,flex,viewport,rem)</li>
<li>常用的ES6内容.const a ={b:1},改变b的值会不会报错.模板字符串,解构赋值,拓展运算符及使用场景.</li>
<li>element-UI常用的插件,之前项目是怎么搭建的</li>
</ol>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/11/16/电话面试题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zax Tseng">
      <meta itemprop="description" content="Zax's BLOG">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zax's BLOG">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
              
              <a href="/2019/11/16/电话面试题/" class="post-title-link" itemprop="url">电话面试题</a>
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-11-16 16:29:01" itemprop="dateCreated datePublished" datetime="2019-11-16T16:29:01+08:00">2019-11-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-11-19 10:29:10" itemprop="dateModified" datetime="2019-11-19T10:29:10+08:00">2019-11-19</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>#CSS</p>
<ol>
<li>重绘和回流(那些操作会引起重回和回流,如何减少回流)</li>
<li>Css伪类有哪些?</li>
<li>Position的几个属性,各个区别?</li>
<li>Css3常用的属性</li>
<li>实现水平垂直居中的方法</li>
<li>Visible:none和display:none,hidden的区别</li>
<li>Css的预处理器,好处,优点作用.</li>
<li>Css实现三角形.</li>
<li>Css引入的方法与区别</li>
</ol>
<h1 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h1><ol>
<li>闭包的理解,作用,场景,缺点.</li>
<li>类如何创建和继承</li>
<li>深拷贝有哪些</li>
<li>微任务和宏任务</li>
<li>setInterval如何实现,用setTimeout实现.</li>
<li>for循环里面有setTimeout,里面有console.log(i).不属于for循环最后面再有个console.log(i).17:40处.</li>
<li>如果把var改为let,结果如何</li>
<li>[] == ![]结果如何?为什么?</li>
<li>Promise的理解</li>
<li>Async/Await与Promise的区别和联系.<br>Await相对于Promise相当于Promise的什么?</li>
<li>随机生成一个100-200之间的数</li>
</ol>
<h1 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h1><ol>
<li>虚拟DOM的理解</li>
<li>Vue如何实现双向绑定,底层</li>
<li>如何监听数组</li>
<li>异步组件在哪用,优点</li>
<li>计算属性和侦听器的区别(watch和computed)</li>
<li>Slot插槽,用在哪里.<br>独立配置webpack?有过修改吗?</li>
</ol>

          
        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zax Tseng</p>
  <div class="site-description motion-element" itemprop="description">Zax's BLOG</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>



        </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zax Tseng</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/schemes/muse.js?v=7.3.0"></script>


<script src="/js/next-boot.js?v=7.3.0"></script>




  




























  

  

  


  
</body>
</html>
