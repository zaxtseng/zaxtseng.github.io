<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一、模块化开发Commonjs 规范 Commonjs 是以同步模式加载模块 一个文件就是一个模块 每个模块都有单独的作用域 通过module.exports导出成员 通过require函数载入模块  ES ModuleESM 是 ES6 引入的 JS 标准模块化规范，它的设计思想是尽量的静态化，使得编译时就能确定模块的依赖关系和输入和输出的变量。功能：模块功能主要由两个命令构成：export 和">
<meta property="og:type" content="article">
<meta property="og:title" content="webpack">
<meta property="og:url" content="http://example.com/2022/10/24/webpack/index.html">
<meta property="og:site_name" content="ZAX">
<meta property="og:description" content="一、模块化开发Commonjs 规范 Commonjs 是以同步模式加载模块 一个文件就是一个模块 每个模块都有单独的作用域 通过module.exports导出成员 通过require函数载入模块  ES ModuleESM 是 ES6 引入的 JS 标准模块化规范，它的设计思想是尽量的静态化，使得编译时就能确定模块的依赖关系和输入和输出的变量。功能：模块功能主要由两个命令构成：export 和">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-10-24T14:20:43.000Z">
<meta property="article:modified_time" content="2023-04-28T00:59:31.137Z">
<meta property="article:author" content="Zax Tseng">
<meta property="article:tag" content="javascript, React, Vue, HTML5">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2022/10/24/webpack/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2022/10/24/webpack/","path":"2022/10/24/webpack/","title":"webpack"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>webpack | ZAX</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ZAX</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91"><span class="nav-number">1.</span> <span class="nav-text">一、模块化开发</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Commonjs-%E8%A7%84%E8%8C%83"><span class="nav-number">1.1.</span> <span class="nav-text">Commonjs 规范</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ES-Module"><span class="nav-number">1.2.</span> <span class="nav-text">ES Module</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%80%A7"><span class="nav-number">1.2.1.</span> <span class="nav-text">特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#export-%E5%AF%BC%E5%87%BA"><span class="nav-number">1.2.2.</span> <span class="nav-text">export 导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%AF%BC%E5%87%BA%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">1.2.3.</span> <span class="nav-text">导入导出的注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#import-%E5%AF%BC%E5%85%A5%E7%94%A8%E6%B3%95"><span class="nav-number">1.2.4.</span> <span class="nav-text">import 导入用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E5%AF%BC%E5%85%A5%E6%88%90%E5%91%98"><span class="nav-number">1.2.5.</span> <span class="nav-text">导出导入成员</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES-Modules-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83-Polyfill"><span class="nav-number">1.2.6.</span> <span class="nav-text">ES Modules 浏览器环境 Polyfill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES-Modules-in-Node-js-%E6%94%AF%E6%8C%81%E6%83%85%E5%86%B5"><span class="nav-number">1.2.7.</span> <span class="nav-text">ES Modules in Node.js - 支持情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES-Modules-in-Node-js-%E4%B8%8E-CommonJS-%E4%BA%A4%E4%BA%92"><span class="nav-number">1.2.8.</span> <span class="nav-text">ES Modules in Node.js - 与 CommonJS 交互</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES-Modules-in-Node-js-%E4%B8%8E-CommonJS-%E7%9A%84%E5%B7%AE%E5%BC%82"><span class="nav-number">1.2.9.</span> <span class="nav-text">ES Modules in Node.js - 与 CommonJS 的差异</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES-Modules-in-Node-js-%E6%96%B0%E7%89%88%E6%9C%AC%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%94%AF%E6%8C%81"><span class="nav-number">1.2.10.</span> <span class="nav-text">ES Modules in Node.js - 新版本进一步支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ES-Modules-in-Node-js-Babel-%E5%85%BC%E5%AE%B9%E6%96%B9%E6%A1%88"><span class="nav-number">1.2.11.</span> <span class="nav-text">ES Modules in Node.js - Babel 兼容方案</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81Webpack-%E6%89%93%E5%8C%85"><span class="nav-number">2.</span> <span class="nav-text">二、Webpack 打包</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85%E5%B7%A5%E5%85%B7%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="nav-number">2.1.</span> <span class="nav-text">模块打包工具的由来</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">2.2.</span> <span class="nav-text">Webpack 配置文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.3.</span> <span class="nav-text">Webpack 工作模式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#loader"><span class="nav-number">3.</span> <span class="nav-text">loader</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E8%B5%84%E6%BA%90%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD"><span class="nav-number">3.1.</span> <span class="nav-text">Webpack 资源模块加载</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#file-loader-%E6%96%87%E4%BB%B6%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">3.2.</span> <span class="nav-text">file-loader 文件资源加载器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#url-loader-URL-%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="nav-number">3.3.</span> <span class="nav-text">url-loader URL 加载器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%B8%B8%E7%94%A8%E5%8A%A0%E8%BD%BD%E5%99%A8-loader-%E5%88%86%E7%B1%BB"><span class="nav-number">3.4.</span> <span class="nav-text">Webpack 常用加载器 loader 分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E4%B8%8E-ES6"><span class="nav-number">3.5.</span> <span class="nav-text">Webpack 与 ES6</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="nav-number">3.6.</span> <span class="nav-text">Webpack 加载资源的方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E6%A0%B8%E5%BF%83%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">3.7.</span> <span class="nav-text">Webpack 核心工作原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA-Loader"><span class="nav-number">3.8.</span> <span class="nav-text">Webpack 开发一个 Loader</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#plugin"><span class="nav-number">4.</span> <span class="nav-text">plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin-%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.1.</span> <span class="nav-text">plugin 插件机制介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin-%E4%B9%8B-%E8%87%AA%E5%8A%A8%E6%B8%85%E9%99%A4%E8%BE%93%E5%87%BA%E7%9B%AE%E5%BD%95%E6%8F%92%E4%BB%B6"><span class="nav-number">4.2.</span> <span class="nav-text">plugin 之 自动清除输出目录插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin-%E4%B9%8B-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90-HTML-%E6%8F%92%E4%BB%B6"><span class="nav-number">4.3.</span> <span class="nav-text">plugin 之 自动生成 HTML 插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin-%E4%B9%8B-%E5%A4%8D%E5%88%B6%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6"><span class="nav-number">4.4.</span> <span class="nav-text">plugin 之 复制静态文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#plugin-%E4%B9%8B-%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%8F%92%E4%BB%B6"><span class="nav-number">4.5.</span> <span class="nav-text">plugin 之 开发一个插件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#webpack-dev-server"><span class="nav-number">5.</span> <span class="nav-text">webpack-dev-server</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-Dev-Server-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E8%AE%BF%E9%97%AE"><span class="nav-number">5.1.</span> <span class="nav-text">Webpack Dev Server 静态资源访问</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-Dev-Server-%E4%BB%A3%E7%90%86-API"><span class="nav-number">5.2.</span> <span class="nav-text">Webpack Dev Server 代理 API</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Source-Map"><span class="nav-number">6.</span> <span class="nav-text">Source Map</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Source-Map-%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.1.</span> <span class="nav-text">Source Map 介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E9%85%8D%E7%BD%AE-Source-Map"><span class="nav-number">6.2.</span> <span class="nav-text">Webpack 配置 Source Map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-eval-%E6%A8%A1%E5%BC%8F%E7%9A%84-Source-Map"><span class="nav-number">6.3.</span> <span class="nav-text">Webpack eval 模式的 Source Map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E9%80%89%E6%8B%A9-Source-Map-%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.4.</span> <span class="nav-text">Webpack 选择 Source Map 模式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%83%AD%E6%9B%B4%E6%96%B0-HMR"><span class="nav-number">7.</span> <span class="nav-text">热更新 HMR</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-HMR-%E4%BD%93%E9%AA%8C%EF%BC%88%E7%83%AD%E6%9B%B4%E6%96%B0%EF%BC%89"><span class="nav-number">7.1.</span> <span class="nav-text">Webpack HMR 体验（热更新）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E4%BD%BF%E7%94%A8-HMR-API"><span class="nav-number">7.2.</span> <span class="nav-text">Webpack 使用 HMR API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%A4%84%E7%90%86-JS-%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2"><span class="nav-number">7.3.</span> <span class="nav-text">Webpack 处理 JS 模块热替换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HMR-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">7.4.</span> <span class="nav-text">HMR 注意事项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Webpack-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%BC%98%E5%8C%96"><span class="nav-number">8.</span> <span class="nav-text">Webpack 生产环境优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="nav-number">8.1.</span> <span class="nav-text">Webpack 不同环境下的配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Webpack-DefinePlugin"><span class="nav-number">9.</span> <span class="nav-text">Webpack DefinePlugin</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tree-Shaking"><span class="nav-number">10.</span> <span class="nav-text">Tree Shaking</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%90%88%E5%B9%B6%E6%A8%A1%E5%9D%97%E2%80%94concatenateModules"><span class="nav-number">10.1.</span> <span class="nav-text">Webpack 合并模块—concatenateModules</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-Tree-Shaking-%E4%B8%8E-Babel"><span class="nav-number">10.2.</span> <span class="nav-text">Webpack Tree Shaking 与 Babel</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sideEffects"><span class="nav-number">11.</span> <span class="nav-text">sideEffects</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-sideEffects-%E6%B3%A8%E6%84%8F"><span class="nav-number">11.1.</span> <span class="nav-text">Webpack sideEffects 注意</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2"><span class="nav-number">12.</span> <span class="nav-text">代码分割</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%A4%9A%E5%85%A5%E5%8F%A3%E6%89%93%E5%8C%85"><span class="nav-number">12.1.</span> <span class="nav-text">Webpack 多入口打包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E6%8F%90%E5%8F%96%E5%85%AC%E5%85%B1%E6%A8%A1%E5%9D%97"><span class="nav-number">12.2.</span> <span class="nav-text">Webpack 提取公共模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5"><span class="nav-number">12.3.</span> <span class="nav-text">Webpack 动态导入</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E9%AD%94%E6%B3%95%E6%B3%A8%E9%87%8A"><span class="nav-number">12.4.</span> <span class="nav-text">Webpack 魔法注释</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-MiniCssExtractPlugin%E2%80%94%E6%8F%90%E5%8F%96-css-%E5%88%B0%E5%8D%95%E7%8B%AC%E6%96%87%E4%BB%B6"><span class="nav-number">12.5.</span> <span class="nav-text">Webpack MiniCssExtractPlugin—提取 css 到单独文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-OptimizeCssAssetsWebpackPlugin%E2%80%94-%E5%8E%8B%E7%BC%A9-css"><span class="nav-number">12.6.</span> <span class="nav-text">Webpack OptimizeCssAssetsWebpackPlugin— 压缩 css</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Webpack-%E8%BE%93%E5%87%BA%E6%96%87%E4%BB%B6%E5%90%8D-Hash"><span class="nav-number">12.7.</span> <span class="nav-text">Webpack 输出文件名 Hash</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Polyfill"><span class="nav-number">13.</span> <span class="nav-text">Polyfill</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E6%96%B9%E6%B3%95"><span class="nav-number">13.1.</span> <span class="nav-text">引入方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E8%AE%BE%E9%85%8D%E7%BD%AE"><span class="nav-number">13.2.</span> <span class="nav-text">预设配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#target"><span class="nav-number">13.2.1.</span> <span class="nav-text">target</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E5%90%88browserslistrc"><span class="nav-number">13.2.2.</span> <span class="nav-text">配合browserslistrc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#useBuiltIns"><span class="nav-number">13.2.3.</span> <span class="nav-text">useBuiltIns</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#corejs"><span class="nav-number">13.2.4.</span> <span class="nav-text">corejs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#modules"><span class="nav-number">13.2.5.</span> <span class="nav-text">modules</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8C%83%E4%BE%8B"><span class="nav-number">13.3.</span> <span class="nav-text">范例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Postcss"><span class="nav-number">14.</span> <span class="nav-text">Postcss</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#autoprefixer"><span class="nav-number">14.1.</span> <span class="nav-text">autoprefixer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#post-loader"><span class="nav-number">14.2.</span> <span class="nav-text">post-loader</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zax Tseng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">123</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/24/webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="webpack | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          webpack
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-24 22:20:43" itemprop="dateCreated datePublished" datetime="2022-10-24T22:20:43+08:00">2022-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-04-28 08:59:31" itemprop="dateModified" datetime="2023-04-28T08:59:31+08:00">2023-04-28</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="一、模块化开发"><a href="#一、模块化开发" class="headerlink" title="一、模块化开发"></a>一、模块化开发</h1><h2 id="Commonjs-规范"><a href="#Commonjs-规范" class="headerlink" title="Commonjs 规范"></a>Commonjs 规范</h2><ul>
<li>Commonjs 是以同步模式加载模块</li>
<li>一个文件就是一个模块</li>
<li>每个模块都有单独的作用域</li>
<li>通过<code>module.exports</code>导出成员</li>
<li>通过<code>require</code>函数载入模块</li>
</ul>
<h2 id="ES-Module"><a href="#ES-Module" class="headerlink" title="ES Module"></a>ES Module</h2><p>ESM 是 ES6 引入的 JS 标准模块化规范，它的设计思想是尽量的静态化，使得编译时就能确定模块的依赖关系和输入和输出的变量。<br>功能：模块功能主要由两个命令构成：export 和 import。export 命令用于规定模块的对外接口，import 命令用于输入其他模块提供的功能。</p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><p>通过给 script 添加 <code>type = module</code> 的属性，就可以以 ES Module 的标准执行其中的 js 代码了</p>
<ul>
<li>自动采用严格模式，忽略‘use strict’</li>
<li>每个 ES Module 模块都是单独的私有作用域</li>
<li>ES Module 是通过 CORS 去请求外部 js 模块的，服务器要支持 CORS</li>
<li>ES Module 的 script 标签会延迟执行脚本（页面渲染完在执行脚本）</li>
</ul>
<h3 id="export-导出"><a href="#export-导出" class="headerlink" title="export 导出"></a>export 导出</h3><ul>
<li>导出<ul>
<li>导出成员使用 export 修饰成员声明的方式，如：</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> name = <span class="string">&#x27;yan;</span></span><br><span class="line"><span class="string">export var age = 18&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>export 可以单独使用，如:</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;yan&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> age = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; name, age &#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 as 给导出的成员重命名，导入时就要使用重命名后的变量名，如：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;yan&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; name <span class="keyword">as</span> firstName &#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果重命名为 default 那这个成员就会做为当前模块默认导出的成员</li>
<li>在导入这个成员就必须要给这个成员重命名，default 是一个关键词不能作为一个变量使用</li>
<li>导入<ul>
<li>导入使用 import 导入，如：<code>import &#123; name &#125; from &#39;./module.js&#39;</code>，name 为导出的变量名</li>
<li>导入默认导出传成员可以不使用花括号，变量名可以根据需要随便取，如：<code>import name from &#39;./module.js&#39;</code></li>
<li>如果导入的变量名为 default，需要使用 as 重命名，如：<code>import &#123; default as firstName &#125; from &#39;./module.js&#39;</code></li>
</ul>
</li>
</ul>
<h3 id="导入导出的注意事项"><a href="#导入导出的注意事项" class="headerlink" title="导入导出的注意事项"></a>导入导出的注意事项</h3><ul>
<li><code>export &#123; name, age &#125;</code> 该写法不是对象字面量的，如果要对象字面量的写法应该是：<code>export default &#123; name, age &#125;</code>，这样花括号会被理解为对象</li>
<li><code>import &#123;&#125; from &#39;./module.js&#39;</code>，花括号不是解构</li>
<li>导出成员时，导出的是这个成员的引用，导出的变量是只读的（在导入的文件中无法改变变量的值），如，在导出成员的文件中在一秒后改变变量的值，在导入变量的文件中两秒后输出变量值，输出的结果是改变后的值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  a = <span class="number">2</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">&quot;./module.js&quot;</span>;</span><br><span class="line"><span class="comment">// a = 22 // 报错，Assignment to constant variable</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2</span></span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="import-导入用法"><a href="#import-导入用法" class="headerlink" title="import 导入用法"></a>import 导入用法</h3><ul>
<li>import 必须使用完整的路径不能省略扩展名，即使是引入 index 也要完整的路径不能省略 index</li>
<li>import 可以使用完整的 url 加载模块 <code>import &#123; name &#125; from &#39;https://xxx.com/xxx.js&#39;</code></li>
<li>相对路径，在网页引用资源是可以省略‘.&#x2F;’的，但是 import 不可以省略，如果省略了就是以字母开头 ES Module 会以为在加载第三方模块，可以使用绝对路径和完整的 url</li>
<li>如果想要执行某个模块而不用提取模块成员，花括号为空即可，这是就只会执行这个模块，不会提出成员，如：<code>import &#123;&#125; from &#39;./module.js&#39;</code>，简写：<code>import &#39;./module.js&#39;</code></li>
<li>如果模块导出的成员特别多，而导入的都用到，可以使用星号‘_’，把这个模块的成员全部导入，在通过 as 将导入的成员全部放到一个对象中,导出的成员都会作为这个对象的属性，如：<code>import _ as mod from &#39;./module.js&#39;</code></li>
<li>动态导入模块，不可以通过判断使用<code>if (true)&#123;import &#123;name&#125; from &#39;./module.js&#39;&#125;</code>，如果需要动态导入，可以使用 import 函数<code>import(&#39;./module.js&#39;)</code>，import 函数返回的是一个 promise</li>
<li>如果模块同时导出默认成员和命名成员，在导入时可以给默认成员重命名<code>import &#123; name, default as age &#125; from &#39;./module.js&#39;</code>，也可以<code>import age(默认成员), &#123; name &#125; from &#39;./module.js&#39;</code></li>
</ul>
<h3 id="导出导入成员"><a href="#导出导入成员" class="headerlink" title="导出导入成员"></a>导出导入成员</h3><ul>
<li>import 可以配合 export 使用，效果就是将导入的结果直接作为当前模块的导出成员，那么在当前作用域就不能访问这些成员，如：<code>export &#123; name, age &#125; from &#39;./module&#39;</code>，利用这种特性可以把散落的模块组织在一起，如，一个 index 把零散的模块组织一起，然后再导出</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// button.js</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Button</span> = <span class="string">&quot;Button Component&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Button</span>;</span><br><span class="line"><span class="comment">// avatar.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> <span class="title class_">Avatar</span> = <span class="string">&quot;Avatar Component&quot;</span>;</span><br><span class="line"><span class="comment">// index.mjs</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./button.js&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Avatar</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./avatar.js&quot;</span>;</span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span>, <span class="title class_">Avatar</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./index.mjs&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-浏览器环境-Polyfill"><a href="#ES-Modules-浏览器环境-Polyfill" class="headerlink" title="ES Modules 浏览器环境 Polyfill"></a>ES Modules 浏览器环境 Polyfill</h3><ul>
<li>在不支持 ES Module 的浏览器中，可以使用 browser-es-module-loader 第三方库，在执行的时候解析</li>
<li>但是在支持 ES Module 的浏览器中，这样会执行两次，可以添加 script 标签的新属性 nomodule</li>
<li>nomodule:在不支持 ES Module 的浏览器工作</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nomodule</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/promise-polyfill@8.1.3/dist/polyfill.min.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nomodule</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/browser-es-module-loader@0.4.1/dist/babel-browser-build.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nomodule</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/browser-es-module-loader@0.4.1/dist/browser-es-module-loader.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-in-Node-js-支持情况"><a href="#ES-Modules-in-Node-js-支持情况" class="headerlink" title="ES Modules in Node.js - 支持情况"></a>ES Modules in Node.js - 支持情况</h3><ul>
<li>在 node 中使用 ES Module 文件后缀名为‘mjs’</li>
<li>执行 <code>node --experimental-modules 文件</code>，experimental-modules：启用 ES Module 实验特性</li>
<li>可以通过 import 导入原生的模块和第三方模块<code>import fs from &#39;fs&#39;; import _ form &#39;loadsh&#39;</code></li>
<li><code>import &#123; camelCase &#125; from &#39;lodash&#39;</code>，不支持，因为第三方模块都是导出默认成员；内置模块兼容了 ES Module 的提取成员方式，所以<code>import &#123; writeFileSync &#125; from &#39;fs&#39;</code>支持</li>
</ul>
<h3 id="ES-Modules-in-Node-js-与-CommonJS-交互"><a href="#ES-Modules-in-Node-js-与-CommonJS-交互" class="headerlink" title="ES Modules in Node.js - 与 CommonJS 交互"></a>ES Modules in Node.js - 与 CommonJS 交互</h3><ul>
<li>ES Module 中可以导入 Commonjs 模块</li>
<li>Commonjs 中不能导入 ES Module 模块</li>
<li>Commonjs 始终只会导出一个默认成员</li>
<li>注意 import 不是解构导出对象</li>
</ul>
<h3 id="ES-Modules-in-Node-js-与-CommonJS-的差异"><a href="#ES-Modules-in-Node-js-与-CommonJS-的差异" class="headerlink" title="ES Modules in Node.js - 与 CommonJS 的差异"></a>ES Modules in Node.js - 与 CommonJS 的差异</h3><ul>
<li>ES Module 中没有 Commonjs 中的那些模块全局成员（require&#x2F;module&#x2F;exports&#x2F;**filename&#x2F;**dirname）</li>
<li>Commonjs 中 require&#x2F;module&#x2F;exports 在 ES Module 中使用 import 和 export 替代，**filename 和 **dirname 可以通过<code>import.meta.url </code>可以拿到当前工作文件的文件 url 地址，可以使用原生的 url 模块的<code>fileURLToPath()</code>方法可以把文件 url 转换为路径</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">&quot;url&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dirname &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> __filename = <span class="title function_">fileURLToPath</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>);</span><br><span class="line"><span class="keyword">const</span> __dirname = <span class="title function_">dirname</span>(__filename);</span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-in-Node-js-新版本进一步支持"><a href="#ES-Modules-in-Node-js-新版本进一步支持" class="headerlink" title="ES Modules in Node.js - 新版本进一步支持"></a>ES Modules in Node.js - 新版本进一步支持</h3><ul>
<li>在 package.json 文件添加 type 字段值为 module，此时文件扩展名可以用 js，而不需要 mjs</li>
<li>此时想要使用 Commonjs 规范，那么文件后缀名要改为 cjs</li>
</ul>
<h3 id="ES-Modules-in-Node-js-Babel-兼容方案"><a href="#ES-Modules-in-Node-js-Babel-兼容方案" class="headerlink" title="ES Modules in Node.js - Babel 兼容方案"></a>ES Modules in Node.js - Babel 兼容方案</h3><ul>
<li>安装 babel 相关依赖 <code>yarn add @babel/node @babel/core @babel/preset-env</code> babel 工作依赖插件，preset 是一个插件集合</li>
<li>执行 <code>yarn babel-node index.js(想要转换的文件) --presets=@babel/preset-env</code></li>
<li>或者添加一个<code>.babelrc</code> 文件</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="二、Webpack-打包"><a href="#二、Webpack-打包" class="headerlink" title="二、Webpack 打包"></a>二、Webpack 打包</h1><h2 id="模块打包工具的由来"><a href="#模块打包工具的由来" class="headerlink" title="模块打包工具的由来"></a>模块打包工具的由来</h2><ul>
<li>ES Module 存在环境兼容问题</li>
<li>模块文件过多，网络请求频繁</li>
<li>所有的前端资源都需要模块化</li>
</ul>
<h2 id="Webpack-配置文件"><a href="#Webpack-配置文件" class="headerlink" title="Webpack 配置文件"></a>Webpack 配置文件</h2><ul>
<li>webpack 默认以<code>src/index.js</code> 为入口文件</li>
<li>在项目的根目录添加<code>webpack.config.js</code>文件，可以自定义相应的配置，该文件是运行在 nodejs 环境中</li>
<li>该文件导出一个对象，通过导出对象的属性就可以完成相应的配置选项</li>
<li>entry 属性：webpack 打包入口文件的路径，如果是相对路径<code>‘./’</code>不能省略</li>
<li>output 属性：webpack 打包输出的位置，值要求是一个对象，通过对象的 filename 属性指定输出的文件名，path 属性指定输出的目录(绝对路径)</li>
</ul>
<h2 id="Webpack-工作模式"><a href="#Webpack-工作模式" class="headerlink" title="Webpack 工作模式"></a>Webpack 工作模式</h2><ul>
<li>在 webpack.config.js 文件对象中添加 mode 属性</li>
<li>mode 默认值是 production，mode 可选值有 production、development、none</li>
<li>production：自动启动优化，会把代码压缩加密</li>
<li>development：会自动优化打包速度，添加一些调式过程中的辅助</li>
<li>none：运行最原始的打包，不做额外的处理</li>
</ul>
<h1 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h1><h2 id="Webpack-资源模块加载"><a href="#Webpack-资源模块加载" class="headerlink" title="Webpack 资源模块加载"></a>Webpack 资源模块加载</h2><ul>
<li>webpack 内容默认只会处理 js 文件</li>
<li>处理其他类型的文件要安装使用对角的 loader（加载器）</li>
<li>loader 的输入和输出都是字符串.</li>
<li>使用 loader，在<code>webpack.config.js</code>导出的对象中的 module 属性，添加一个 rules 数组</li>
<li>rules 数组就是针对加载其他资源模块的规则配置</li>
<li>每个规则对象要设置两个属性，<ul>
<li>test：正则表达式，匹配打包过程中遇到的文件；</li>
<li>use：匹配到的文件使用的 loader，use 的值可以是单个 loader 字符串也可以是一个数组 loader，<strong>如果是一个数组，会从右往左执行</strong></li>
</ul>
</li>
<li>css-loader 的作用就是将 css 文件转换为一个 js 模块；具体实现就是将 css 代码 push 到一个数组中</li>
<li>style-loader 的作用就是将 css-loader 转换后的结果通过 style 标签追加到页面上</li>
<li>loader 是 webpack 的核心特性</li>
<li>借助不同的 loader 就可以加载任何类型的资源</li>
</ul>
<h2 id="file-loader-文件资源加载器"><a href="#file-loader-文件资源加载器" class="headerlink" title="file-loader 文件资源加载器"></a>file-loader 文件资源加载器</h2><ul>
<li>安装依赖 <code>yarn add file-loader</code></li>
<li>在配置文件中添加 rules <code>&#123; test: /.png$/, use: &#39;file-loader&#39; &#125;</code></li>
<li>webpack 默认所有打包的结果放在网站根目录；为项目中的所有资源指定一个基础路径，在 output 中添加 publicPath 属性，默认值为空表示网站的根目录</li>
<li>把 publicPath 值修改为 ‘dist&#x2F;‘ 注意“&#x2F;”不能省略，打包后是一个变量名（publicPath 值）拼接资源名（资源名前面没有“&#x2F;”）所有“&#x2F;”不能省略</li>
</ul>
<p><code>publicPath</code>是整个项目的静态资源的基础路径,一般在生产模式下使用.<br>而<code>webpack-dev-server</code>中的<code>publicPath</code>是打包后代码存放的路径.这里的文件访问的静态资源路径还是<code>output</code>中的<code>publicPath</code>.所以二者要保持一致.<br>假设 <code>output.publicPath</code> 设置成了 <code>&#39;./dist/&#39;</code>，那么打包后的 JS 引用路径为 <code>./dist/main.js</code>。这里会存在一个问题，相对路径在本地能正常访问到。但是如果把静态资源托管到 CDN 上，访问路径显然不能使用相对路径的。如果设置成 <code>&#39;/dist/&#39;</code>，则打包后的访问路径是 <code>localhost:8080/dist/main.js</code>，此时本地无法访问。一般解决方法就是利用 <code>webpack.DefinePlugin</code> 来定义一个全局变量（process.env.NODE_ENV）区分开发、生产环境来设定不同的值，或者是采用两份不同的配置文件来进行打包。<br>一般来说，output.publicPath 应该以 ‘&#x2F;‘ 结尾，而其他 loader 或插件的配置不要以 ‘&#x2F;‘ 开头。</p>
<h2 id="url-loader-URL-加载器"><a href="#url-loader-URL-加载器" class="headerlink" title="url-loader URL 加载器"></a>url-loader URL 加载器</h2><p>优点: 不用再发起 http 请求</p>
<ul>
<li>Data URLS 格式：data(协议):[mediatype(媒体类型和编码)][;base64],</li>
<li>安装插件 <code>yarn add url-loader --dev</code></li>
<li>在配置文件中添加 rules</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.png$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">          <span class="attr">option</span>: &#123;</span><br><span class="line">            <span class="attr">limit</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 对于小于10kb的png图片使用url-loader打包；而大于10kb的会使用file-loader打包</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>loader 中做大小限制还是需要安装 file-loader,不然无法解析.</p>
<ul>
<li>打包后，图片将是以 base64 的格式显示</li>
</ul>
<p>最佳实践</p>
<ul>
<li>小文件使用 Data URLs，减少请求次数</li>
<li>大文件单独提取存放，提高加载速度</li>
</ul>
<h2 id="Webpack-常用加载器-loader-分类"><a href="#Webpack-常用加载器-loader-分类" class="headerlink" title="Webpack 常用加载器 loader 分类"></a>Webpack 常用加载器 loader 分类</h2><ul>
<li>编译转换类：会把加载的资源转为 js 代码,如<code>css-loader</code></li>
<li>文件操作类：会把加载的资源拷贝到输出的目录，导出文件访问路径,如<code>file-loader</code></li>
<li>代码检查类：目的是统一代码风格,如<code>eslint-loader</code></li>
</ul>
<h2 id="Webpack-与-ES6"><a href="#Webpack-与-ES6" class="headerlink" title="Webpack 与 ES6"></a>Webpack 与 ES6</h2><p>wepack 并不能转换 es6 中的其他特性,只能处理模块相关的<code>import,export</code></p>
<ul>
<li>安装<code>babel-loader @babel/core @babel/preset-env</code></li>
<li>在配置文件中 module rules 添加</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-加载资源的方式"><a href="#Webpack-加载资源的方式" class="headerlink" title="Webpack 加载资源的方式"></a>Webpack 加载资源的方式</h2><ul>
<li>遵循 ES Modules 标准的 import 声明</li>
<li>遵循 Commonjs 标准的 require 函数</li>
<li>遵循 AMD 标准的 define 函数和 require 函数</li>
<li>Loader 加载器的非 JavaScript 也会触发资源加载<ul>
<li>样式代码中的@import 指令和 url 函数</li>
<li>HTML 代码中图片标签的 src 属性</li>
</ul>
</li>
</ul>
<p>如果用<code>require</code>导致 esm 模块代码,需要用导入值的<code>default</code>属性导入.不过,除非必要,不要混用.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> heading = <span class="built_in">require</span>(<span class="string">&quot;./heading.js&quot;</span>).<span class="property">default</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-核心工作原理"><a href="#Webpack-核心工作原理" class="headerlink" title="Webpack 核心工作原理"></a>Webpack 核心工作原理</h2><ul>
<li>webpack 会根据配置找到打包入口文件，然后顺着入口文件的代码</li>
<li>根据代码中的 import 或者 require 解析推断这个文件依赖的资源模块</li>
<li>然后分别解析每个资源模块对应的依赖，形成整个项目中所有用到文件之间的依赖关系的依赖树</li>
<li>webpack 递归依赖树，找到每个节点对于的资源文件</li>
<li>根据配置文件中的 rules 属性找到模块对应的加载器，找到对于的资源放在打包结果中，实现整个项目的打包</li>
</ul>
<h2 id="Webpack-开发一个-Loader"><a href="#Webpack-开发一个-Loader" class="headerlink" title="Webpack 开发一个 Loader"></a>Webpack 开发一个 Loader</h2><p>loader 都需要导出一个函数,这个函数就是对加载资源的处理.</p>
<ul>
<li>loader 负责资源文件从输入到输出的转换</li>
<li>对于同一个资源可以依次使用多个 loader （css-loader -&gt; style-loader）</li>
<li>loader 模块导出一个函数；该函数输入的是加载到的资源文件内容；函数体是处理内容的过程；输出的是经过处理过的资源文件内容结果，结果必须是 javascript 代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> about <span class="keyword">from</span> <span class="string">&quot;./about.md&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(about);</span><br><span class="line"></span><br><span class="line"><span class="comment">// markdown-loader.js</span></span><br><span class="line"><span class="keyword">const</span> marked = <span class="built_in">require</span>(<span class="string">&quot;marked&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">source</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// source接受输入</span></span><br><span class="line">  <span class="comment">// console.log(source);</span></span><br><span class="line">  <span class="comment">// return &#x27;hello&#x27;;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法一</span></span><br><span class="line">  <span class="keyword">const</span> html = marked.<span class="title function_">parse</span>(source);</span><br><span class="line">  <span class="comment">// return `module.exports = $&#123;JSON.stringify(html)&#125;`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法二 返回 html 字符串交给下一个 loader处理 (html-loader)</span></span><br><span class="line">  <span class="keyword">return</span> html;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;dist/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.md$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;html-loader&quot;</span>, <span class="string">&quot;./markdown-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h1><p>loader 实现资源加载,plugin 解决除了资源加载,其他的自动化工作.<br>比如,打包前清除 dist 目录(为了清除上一次代码),文件压缩,拷贝静态文件到输出目录.<br>也就实现了大部分的前端工程化的工作.</p>
<h2 id="plugin-插件机制介绍"><a href="#plugin-插件机制介绍" class="headerlink" title="plugin 插件机制介绍"></a>plugin 插件机制介绍</h2><ul>
<li>增强 webpack 自动化能力</li>
<li>loader 专注实现资源模块加载</li>
<li>plugin 解决其他自动化工作<ul>
<li>清除 dist 目录</li>
<li>拷贝静态文件至输出目录</li>
<li>压缩输出代码</li>
</ul>
</li>
</ul>
<h2 id="plugin-之-自动清除输出目录插件"><a href="#plugin-之-自动清除输出目录插件" class="headerlink" title="plugin 之 自动清除输出目录插件"></a>plugin 之 自动清除输出目录插件</h2><ul>
<li>安装插件 <code>yarn add clean-webpack-plugin --dev</code></li>
<li>配置文件中导入插件</li>
<li>在配置对象中 plugins 属性，该属性是专门配置插件的地方，属性值是一个数组</li>
<li>数组里就是导入的类型创建的实例.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="plugin-之-自动生成-HTML-插件"><a href="#plugin-之-自动生成-HTML-插件" class="headerlink" title="plugin 之 自动生成 HTML 插件"></a>plugin 之 自动生成 HTML 插件</h2><ul>
<li>安装插件 <code>yarn add html-webpack-plugin --dev</code></li>
<li>在配置文件中导入插件</li>
<li>在配置对象中 plugins 属性，该属性是专门配置插件的地方，属性值是一个数组</li>
<li>同时输出多个页面文件，可以再通过 HtmlWebpackPlugin 生成多个实例,通过 filename 指定文件名</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 用于生成 index.html</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Webpack Plugin Sample&quot;</span>, <span class="comment">// html文件的title</span></span><br><span class="line">      <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">viewport</span>: <span class="string">&quot;width=device-width&quot;</span>, <span class="comment">// 设置meta的viewport</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>, <span class="comment">// 模版,写法见最下方</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="comment">// 输出多个文件</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;about.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="comment">// &lt;h1&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/h1&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="plugin-之-复制静态文件"><a href="#plugin-之-复制静态文件" class="headerlink" title="plugin 之 复制静态文件"></a>plugin 之 复制静态文件</h2><ul>
<li>安装插件 <code>yarn add copy-webpack-plugin --dev</code></li>
</ul>
<p>有些文件不需要打包,比如网站图标 icon,可以使用<code>copy-webpack-plugin</code>直接复制.</p>
<div style="background: #E8F7FF;padding:10px;border: 1px solid #ABD2DA;border-radius:5px;margin-bottom:5px;">建议上线前再使用此插件,否则频繁打包会影响性能,平时开发可以使用的devserver中的contentBase属性设置静态资源路径</div>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">CopyWebpackPlugin</span>([</span><br><span class="line">  <span class="string">&#x27;public&#x27;</span><span class="comment">// 将public下所有文件拷贝到输出目录  </span></span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h2 id="plugin-之-开发一个插件"><a href="#plugin-之-开发一个插件" class="headerlink" title="plugin 之 开发一个插件"></a>plugin 之 开发一个插件</h2><p>原理: 钩子机制,通过在生命周期的钩子中挂载函数实现的.</p>
<ul>
<li><p>相比于 loader，plugin 拥有更宽的能力范围</p>
</li>
<li><p>plugin 通过钩子机制实现</p>
<div style="background: #E8F7FF;padding:10px;border: 1px solid #ABD2DA;border-radius:5px;margin-bottom:5px;"></li>
<li><p>插件必须是一个函数或者是一个包含 apply 方法的对象</div></p>
</li>
<li><p>通过在生命周期的钩子中挂载函数实现扩展</p>
</li>
</ul>
<p>一般就是定义一个类,在类中定义 apply 方法,使用的时候就是通过这个类去构建实例.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPlugin</span> &#123;</span><br><span class="line">  <span class="comment">// 目标 删除bundle.js中的注释</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">// 会自动执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;my plugin 启动&quot;</span>);</span><br><span class="line">    <span class="comment">// https://webpack.js.org/api/compiler-hooks/</span></span><br><span class="line">    <span class="comment">// emit钩子：即将输出文件时执行</span></span><br><span class="line">    <span class="comment">// 参数一：插件名 参数二、挂载到钩子上的函数</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tap</span>(<span class="string">&quot;MyPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// compilation =&gt; 可以理解为此次打包的上下文</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">in</span> compilation.<span class="property">assets</span>) &#123;</span><br><span class="line">        <span class="comment">// assets:资源文件</span></span><br><span class="line">        <span class="comment">// console.log(name); // 文件名</span></span><br><span class="line">        <span class="comment">// console.log(compilation.assets[name].source());//文件内容</span></span><br><span class="line">        <span class="keyword">if</span> (name.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>)) &#123;</span><br><span class="line">          <span class="comment">// 判断是js文件</span></span><br><span class="line">          <span class="keyword">const</span> contents = compilation.<span class="property">assets</span>[name].<span class="title function_">source</span>(); <span class="comment">// 文件内容</span></span><br><span class="line">          <span class="keyword">const</span> withoutComments = contents.<span class="title function_">replace</span>(<span class="regexp">/\/\*\*+\*\//g</span>, <span class="string">&quot;&quot;</span>); <span class="comment">// 全局替换注释</span></span><br><span class="line">          compilation.<span class="property">assets</span>[name] = &#123;</span><br><span class="line">            <span class="comment">// 覆盖原有内容</span></span><br><span class="line">            <span class="attr">source</span>: <span class="function">() =&gt;</span> withoutComments, <span class="comment">// 返回新的内容</span></span><br><span class="line">            <span class="attr">size</span>: <span class="function">() =&gt;</span> withoutComments.<span class="property">length</span>, <span class="comment">// 返回内容的大小 webpack内部规定必须</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h1><p>集成了<code>自动编译</code>,<code>自动刷新浏览器</code>功能</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">pnpm add webpack-dev-server -D</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行</span></span><br><span class="line">pnpm webpack-dev-server</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果加--open会自动打开浏览器</span></span><br></pre></td></tr></table></figure>

<h2 id="Webpack-Dev-Server-静态资源访问"><a href="#Webpack-Dev-Server-静态资源访问" class="headerlink" title="Webpack Dev Server 静态资源访问"></a>Webpack Dev Server 静态资源访问</h2><ul>
<li>Dev Server 默认只会 serve 打包输出文件</li>
<li>只要是 webpack 打包输出的文件都可以直接被访问</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="comment">// 额外开发服务指定静态资源路径，可以是字符串或数组</span></span><br><span class="line">  <span class="attr">contentBase</span>: <span class="string">&quot;./public&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-Dev-Server-代理-API"><a href="#Webpack-Dev-Server-代理-API" class="headerlink" title="Webpack Dev Server 代理 API"></a>Webpack Dev Server 代理 API</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">// 前缀</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">// http://localhost:8080/api/users =&gt; https://api.github.com/api/users</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;https://api.github.com&quot;</span>,</span><br><span class="line">        <span class="comment">// 路径重写</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 去除 /api</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 不能使用 localhost:8080 作为请求github的主机名</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Source-Map"><a href="#Source-Map" class="headerlink" title="Source Map"></a>Source Map</h1><h2 id="Source-Map-介绍"><a href="#Source-Map-介绍" class="headerlink" title="Source Map 介绍"></a>Source Map 介绍</h2><ul>
<li>调试和报错都是基于运行代码</li>
<li>source map 映射转换后代码和源代码关系，通过 source map 逆向解析</li>
<li>解决源代码与运行代码不一致所产生的调试问题</li>
</ul>
<h2 id="Webpack-配置-Source-Map"><a href="#Webpack-配置-Source-Map" class="headerlink" title="Webpack 配置 Source Map"></a>Webpack 配置 Source Map</h2><p>在配置项添加 <code>devtool: &#39;source-map&#39;</code></p>
<h2 id="Webpack-eval-模式的-Source-Map"><a href="#Webpack-eval-模式的-Source-Map" class="headerlink" title="Webpack eval 模式的 Source Map"></a>Webpack eval 模式的 Source Map</h2><ul>
<li>eval 是否使用 eval 执行模块代码，带 eval，用 eval 执行模块代码,只能定位文件,不能定位具体位置.</li>
<li>eval-source-map 可以定位具体位置</li>
<li>cheap-eval-source-map 可以定位行,不能定位列.</li>
<li>cheap-source map 是否包含行信息</li>
<li>module 是否能够得到 Loader 处理之前的源代码</li>
<li>带 module 的模式下解析的出来的原代码是没有经过 loader 加工，手写的源代码</li>
<li>不带 module 是 loader 加工过后的代码</li>
<li>inline-source-map：source map 是因 dataURL 嵌入代码，其他的 source map 是以物理文件存在</li>
<li>hidden-source-map：开发工具看不到 source map 效果 在开发第三方包比较有用</li>
</ul>
<h2 id="Webpack-选择-Source-Map-模式"><a href="#Webpack-选择-Source-Map-模式" class="headerlink" title="Webpack 选择 Source Map 模式"></a>Webpack 选择 Source Map 模式</h2><ul>
<li>开发模式<ul>
<li><code>cheap-module-eval-source-map</code>：代码每行不会超过 80 个字符；代码进过 loader 转换后差异较大需要 module 模式（loader 处理前的源代码）；首次打包速度慢无所谓，重写打包相对较快</li>
</ul>
</li>
<li>生成模式<ul>
<li><code>none</code>或<code>nosources-source-map</code>：Source Map 会暴露源代码</li>
</ul>
</li>
</ul>
<h1 id="热更新-HMR"><a href="#热更新-HMR" class="headerlink" title="热更新 HMR"></a>热更新 HMR</h1><h2 id="Webpack-HMR-体验（热更新）"><a href="#Webpack-HMR-体验（热更新）" class="headerlink" title="Webpack HMR 体验（热更新）"></a>Webpack HMR 体验（热更新）</h2><ul>
<li>应用运行过程中实时替换某个模块，应用运行状态不受影响</li>
<li>HMR 集成在<code>webpack-dev-server</code>中</li>
<li>开启 HMR<ul>
<li>css 样式（经过 loader 处理的）可以热更新但是 js 还是会刷新浏览器，webpack 中的 HMR 不可以开箱即用</li>
<li>webpack 中的 HMR 需要手动处理模块热替换逻辑</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">target</span>: <span class="string">&quot;web&quot;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-使用-HMR-API"><a href="#Webpack-使用-HMR-API" class="headerlink" title="Webpack 使用 HMR API"></a>Webpack 使用 HMR API</h2><h2 id="Webpack-处理-JS-模块热替换"><a href="#Webpack-处理-JS-模块热替换" class="headerlink" title="Webpack 处理 JS 模块热替换"></a>Webpack 处理 JS 模块热替换</h2><p>js 热更新：保存旧数据，代码发生变化后把数据回填</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> lastEditor = editor;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./editor&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;editor HMR&#x27;)</span></span><br><span class="line">  <span class="comment">// console.log(createEditor)</span></span><br><span class="line">  <span class="keyword">const</span> value = lastEditor.<span class="property">innerHTML</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">removeChild</span>(editor);</span><br><span class="line">  <span class="keyword">const</span> newEditor = <span class="title function_">createEditor</span>();</span><br><span class="line">  newEditor.<span class="property">innerHTML</span> = value;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(newEditor);</span><br><span class="line">  lastEditor = newEditor;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片热更新</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./better.png&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  img.<span class="property">src</span> = background;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(background);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="HMR-注意事项"><a href="#HMR-注意事项" class="headerlink" title="HMR 注意事项"></a>HMR 注意事项</h2><ul>
<li>如果没有开启热更新，但是 js 代码做了热更新处理，先做判断 <code>if (module.hot)&#123;// 热更新逻辑&#125;</code></li>
<li>hot 会刷新浏览器，报错信息会被刷走；<code>hotOnly</code>不会刷新浏览器，可以把错误信息输出</li>
<li>打包后会自动去除 js 热更新逻辑代码</li>
</ul>
<h1 id="Webpack-生产环境优化"><a href="#Webpack-生产环境优化" class="headerlink" title="Webpack 生产环境优化"></a>Webpack 生产环境优化</h1><ul>
<li>mode：none、production、development</li>
<li>为不同的工作环境创建不同的配置</li>
</ul>
<h2 id="Webpack-不同环境下的配置"><a href="#Webpack-不同环境下的配置" class="headerlink" title="Webpack 不同环境下的配置"></a>Webpack 不同环境下的配置</h2><ul>
<li>配置文件根据环境不同导出不同的配置<ul>
<li>webpack 可以导出一个函数，函数返回配置</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数一：cli传递的环境名参数；参数二：运行cli传递的所有参数</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env, argv</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (env === <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 执行 yarn webpack --env production</span></span><br></pre></td></tr></table></figure>

<ul>
<li>一个环境对应一个配置文件<ul>
<li>webpack.common.js 存放公共配置</li>
<li>webpack.dev.js 开发配置，把公共配置和开发配置合并（使用 loadsh merge）</li>
<li>webpack.prod.js 生产环境，把公共配置和生产配置合并（使用 loadsh merge）</li>
<li>使用<code>webpack-merge</code>插件替换 loadsh 工具.</li>
<li>在没有默认配置文件的情况就要执行 <code>pnpm webpack --config webpack.dev.js</code></li>
<li>或者在 scripts 中添加命令 <code>&quot;build&quot;: &quot;webpack --config webpack.dev.js&quot;</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> common = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.common&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">merge</span>(common, &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Webpack-DefinePlugin"><a href="#Webpack-DefinePlugin" class="headerlink" title="Webpack DefinePlugin"></a>Webpack DefinePlugin</h1><ul>
<li>DefinePlugin 为代码注入全局成员</li>
<li>接收的是一个对象，每一个键值都会注入到代码中</li>
<li>文件代码中直接使用键，打包后把注入的值 直接替换到代码中，definePlugin 传递的字符串应该是代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 想要输出的是字符串要个引号，否则输出的不是字符串</span></span><br><span class="line">      <span class="comment">// 输出值可以使用JSON.stringify(&#x27;https://api.github.com&#x27;)</span></span><br><span class="line">      <span class="attr">API_BASE_URL</span>: <span class="string">&#x27;&quot;https://api.github.com&quot;&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ==</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">API_BASE_URL</span>);</span><br></pre></td></tr></table></figure>

<h1 id="Tree-Shaking"><a href="#Tree-Shaking" class="headerlink" title="Tree Shaking"></a>Tree Shaking</h1><div style="background: #E8F7FF;padding:10px;border: 1px solid #ABD2DA;border-radius:5px;margin-bottom:5px;">tree shaking 是一个术语，通常用于描述移除 JavaScript 上下文中的未引用代码(dead-code)</div>

<ul>
<li>在生成模式下自动开启，对于冗余、未引用代码不会打包</li>
<li>不是指某个配置选项，是一组功能搭配使用后的优化效果</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 使用 Tree Shaking</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 集中配置webpack内部优化功能</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>, <span class="comment">// 只到处外部使用了的成员 （相当于标记没使用的代码）</span></span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>, <span class="comment">// 开启webpack代码压缩  会把外部没使用的代码去除</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-合并模块—concatenateModules"><a href="#Webpack-合并模块—concatenateModules" class="headerlink" title="Webpack 合并模块—concatenateModules"></a>Webpack 合并模块—concatenateModules</h2><ul>
<li>尽可能的将所有模块合并输出到一个函数中</li>
<li>提升运行效率，减少代码体积</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 集中配置webpack内部优化功能</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">concatenateModules</span>: <span class="literal">true</span>, <span class="comment">// 打包后把所有的模块放在同一个函数中；</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-Tree-Shaking-与-Babel"><a href="#Webpack-Tree-Shaking-与-Babel" class="headerlink" title="Webpack Tree Shaking 与 Babel"></a>Webpack Tree Shaking 与 Babel</h2><ul>
<li>babel 和 tree shaking 同时使用会导致 tree shaking 失效<ul>
<li>tree shaking 前提是 ES Modules，由 webpack 打包的代码必须使用 ESM</li>
<li>babel-loader 转换代码时可能会把 ES Modules 转为 CommonJS<br>新版的 babel-loader 不会导致 tree shaking 失效，</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [</span><br><span class="line">              <span class="comment">// modules：默认值是auto 根据环境判断是否开启ESM，可以设为false</span></span><br><span class="line">              [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123; <span class="attr">modules</span>: <span class="string">&quot;commonjs&quot;</span> &#125;], <span class="comment">// 强制使用babel ESM，把ESM转为commonjs</span></span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="sideEffects"><a href="#sideEffects" class="headerlink" title="sideEffects"></a>sideEffects</h1><ul>
<li>允许通过配置方式标识代码是否有副作用（模块执行时除了导出成员之外所做的事情）</li>
<li>一般用于开发 npm 包时 标记是否有副作用</li>
<li>生产模式自动开启 会检查当前代码所属的 package.json 有没有 sideEffects 标识，以此来判断这个模块是否有副作用</li>
<li>如果这个模块没有副作用，那些没有用到的模块不会被打包</li>
<li>package.json 添加 <code>sideEffects: false</code> 表示 package.json 所影响的项目当中所有的代码都没有副作用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">sideEffects</span>: <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-sideEffects-注意"><a href="#Webpack-sideEffects-注意" class="headerlink" title="Webpack sideEffects 注意"></a>Webpack sideEffects 注意</h2><ul>
<li>使用 sideEffects 前提确保代码真的没有副作用，否则 webpack 再打报时会误删有副作用的代码</li>
<li>如在 Number 原型添加方法然后载入、载入 css 也是</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extend.js</span></span><br><span class="line"><span class="comment">// 为Number的原型添加一个扩展方法</span></span><br><span class="line"><span class="comment">// 副作用代码 在package.json声明没有副作用，在打包时会被去除</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pad</span> = <span class="keyword">function</span>(<span class="params">size</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="variable language_">this</span> + <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">while</span>(result.<span class="property">length</span> &lt; size) &#123;</span><br><span class="line">    result = <span class="string">&#x27;0&#x27;</span> + result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./extend.js&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">8.</span><span class="title function_">pad</span>(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>解决：在 package.json 关闭副作用(设置为 false)或者标识哪些文件有副作用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>: [ <span class="comment">// 标识有副作用的文件</span></span><br><span class="line">  <span class="string">&#x27;./src/extends.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;*.css&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h1 id="代码分割"><a href="#代码分割" class="headerlink" title="代码分割"></a>代码分割</h1><ul>
<li>所有代码最终都被打包到一起，打包文件体积过大</li>
<li>分包，按需加载</li>
<li>多入口打包</li>
<li>动态导入</li>
</ul>
<h2 id="Webpack-多入口打包"><a href="#Webpack-多入口打包" class="headerlink" title="Webpack 多入口打包"></a>Webpack 多入口打包</h2><ul>
<li>多页应用程序，一个页面对应一个打包入口，公共部分单独提取</li>
<li>多个入口可以把 entry 定义为对象，一个属性就是一个入口，键就是入口名，值就是入口对应的文件路径</li>
<li>多入口，输出也要多个，可以给 filename 的值添加 <code>[name]</code>占位 <code>outpur:&#123;filename: &#39;[name].bundle.js&#39;&#125;</code> 这样 <code>[name]</code>就会被替换为入口名称</li>
<li>plugins 中的 HtmlWebpackPlugin 插件会自动输入注入所有打包结果的 html，所以此时入口文件会注入所有的打包结果</li>
<li>可以给 HtmlWebpackPlugin 插件配置注入的打包文件 <code>new HtmlWebpackPlugin(&#123;chunks:[&#39;index&#39;]&#125;), new HtmlWebpackPlugin(&#123;chunks:[&#39;album&#39;]&#125;)</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">album</span>: <span class="string">&quot;./src/album.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Multi Entry&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;index&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Multi Entry&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/album.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;album.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;album&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-提取公共模块"><a href="#Webpack-提取公共模块" class="headerlink" title="Webpack 提取公共模块"></a>Webpack 提取公共模块</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="comment">// 自动提取所有公共模块到单独 bundle</span></span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-动态导入"><a href="#Webpack-动态导入" class="headerlink" title="Webpack 动态导入"></a>Webpack 动态导入</h2><ul>
<li>需要用到某个模块时，再加载这个模块</li>
<li>动态导入的模块会被自动分包</li>
<li>一般我们都是在文件头直接 import 文件的，这会造成资源浪费</li>
<li>可以使用 ES Modules 的 import()在需要导入的地方导入模块，该方法返回的是 promise 可以拿到导出的对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">import</span>(<span class="string">&quot;./posts&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: posts &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    mainElement.<span class="title function_">append</span>(<span class="title function_">posts</span>());</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-魔法注释"><a href="#Webpack-魔法注释" class="headerlink" title="Webpack 魔法注释"></a>Webpack 魔法注释</h2><ul>
<li>在 import()方法中添加特定的注释 <code>import(/* webpackChunkName: &#39;posts&#39; */ &#39;./posts&#39;)</code> 这样在打包后文件名就会带上这个 webpackChunkName 值</li>
<li>如果 webpackChunkName 相同，打包后会打包在一起</li>
</ul>
<h2 id="Webpack-MiniCssExtractPlugin—提取-css-到单独文件"><a href="#Webpack-MiniCssExtractPlugin—提取-css-到单独文件" class="headerlink" title="Webpack MiniCssExtractPlugin—提取 css 到单独文件"></a>Webpack MiniCssExtractPlugin—提取 css 到单独文件</h2><ul>
<li>安装插件 <code>yarn add mini-css-extract-plugin --dev</code></li>
</ul>
<p>注意: 如果 css 小于 150k,就不要用这个了,不然单独生成一个文件,就多次请求,效果可能不如<code>style-loader</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// &#x27;style-loader&#x27;, // 将样式通过 style 标签注入</span></span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="comment">// 通过 link 标签注入</span></span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-OptimizeCssAssetsWebpackPlugin—-压缩-css"><a href="#Webpack-OptimizeCssAssetsWebpackPlugin—-压缩-css" class="headerlink" title="Webpack OptimizeCssAssetsWebpackPlugin— 压缩 css"></a>Webpack OptimizeCssAssetsWebpackPlugin— 压缩 css</h2><ul>
<li>安装插件 <code>yarn add optimize-css-assets-webpack-plugin --dev</code></li>
<li>如果配置在 plugins 中这个插件在任何情况都会正常工作</li>
<li>配置在 minimizer 中 只有 minimizer 开启（生产环境自动开启）是才工作</li>
<li>webpack 建议压缩创建配置在 minimizer 中，以便通过 minimizer 选项统一控制</li>
<li>当 minimizer 使用一个数组，webpack 认为我们要自定义所使用的压缩器插件，webpack 内部的 js 压缩器就会被覆盖，如果不配置 js 压缩器，这是打包，js 代码不会被压缩</li>
<li>手动把 js 压缩器添加回来，安装插件 <code>yarn add terser-webpack-plugin --dev</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;optimize-css-assets-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserWebpackPlugin</span>(), <span class="comment">//压缩js</span></span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span>(), <span class="comment">// 压缩css</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-输出文件名-Hash"><a href="#Webpack-输出文件名-Hash" class="headerlink" title="Webpack 输出文件名 Hash"></a>Webpack 输出文件名 Hash</h2><ul>
<li>在部署时服务器开启静态文件缓存，如果缓存时间过长，程序发生更改，得不到更新</li>
<li>生产环境下，文件名使用 Hash，文件名发生变化 对客户端而言全新的文件名就是全新的请求，就不会有缓存问题</li>
<li>[hash]【占位符】：整个项目级别的，项目中有任何地方改动，这次打包的 hash 值都会发生变化</li>
<li>[chunkhash]【占位符】：chuankhash 级别，打包过程中只要是同一路的打包 chunkhash 都是相同的</li>
<li>[contenthask]【占位符】：文件级别 hash，根据文件输出内容生成 hash 值（不同的文件就有不同的 hash 值）</li>
<li>指定 hash 值长度[chunkhash:8]【占位符】</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name]-[contenthash:8].bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Polyfill"><a href="#Polyfill" class="headerlink" title="Polyfill"></a>Polyfill</h1><p>可翻译为垫片,</p>
<h2 id="引入方法"><a href="#引入方法" class="headerlink" title="引入方法"></a>引入方法</h2><ol>
<li>入口文件引入</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">npm安装</span></span><br><span class="line">pnpm add core-js regenerator-runtime</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在入口文件顶部导入</span></span><br><span class="line">import &#x27;core-js/stable&#x27;</span><br><span class="line">import &#x27;regenerator-runtime/runtime&#x27;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>webpack 引入</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">moduls.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: [<span class="string">&quot;core-js/stable&quot;</span>, <span class="string">&quot;./src/index.js&quot;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="预设配置"><a href="#预设配置" class="headerlink" title="预设配置"></a>预设配置</h2><h3 id="target"><a href="#target" class="headerlink" title="target"></a>target</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//babel.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">target</span>: &#123;</span><br><span class="line">          <span class="attr">chrome</span>: <span class="number">30</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="配合browserslistrc"><a href="#配合browserslistrc" class="headerlink" title="配合browserslistrc"></a>配合<code>browserslistrc</code></h3><p>这个文件是目标环境配置表，也就是说通过配置，可以让我们的代码运行在哪些指定的浏览器或 node 环境，比如下边这种配置的意思就是，市场份额大于 1%的浏览器，并且不考虑 ie10 以下版本的浏览器，并且不是已’死亡’（指 24 个月没有官方的更新）的浏览器.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .browserslistrc 文件</span></span><br><span class="line">&gt; <span class="number">1</span>%</span><br><span class="line">not ie &lt;= <span class="number">10</span></span><br><span class="line">not dead</span><br></pre></td></tr></table></figure>

<p>上面预设配置第一个参数 targets 里边就可以填写.browserslistrc 中的内容，效果是一样的，</p>
<h3 id="useBuiltIns"><a href="#useBuiltIns" class="headerlink" title="useBuiltIns"></a>useBuiltIns</h3><p><code>useBuiltIns</code>有三个值.默认是<code>false</code>.其他是<code>entry</code>和<code>usage</code>.<br><code>entry</code>: 需要在入口或者 webpack 配置文件中引入<code>core-js</code>.<br>Babel 会根据我们<code>.browserslistrc</code>文件中的环境配置（这里是 chrome 60 版本），来补齐 chrome 60 版本所有不支持的新增 ES6API，引入 chrome60 版本所有的 polyfill，不管你的入口文件中有没有用到相应的 API。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">npm install core-js -S</span><br><span class="line">npm install regenerator-runtime -S (根据@babel/core版本判断是否需要安装)</span><br><span class="line"><span class="comment">// babel.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [[<span class="string">&quot;@babel/preset-env&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">useBuiltIns</span>: <span class="string">&#x27;entry&#x27;</span>,</span><br><span class="line">    <span class="attr">corejs</span>: <span class="number">3</span></span><br><span class="line">  &#125;]],</span><br><span class="line">  <span class="attr">plugins</span>: []</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// before.js，在第一行引入&#x27;core-js/stable&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;core-js/stable&#x27;</span></span><br><span class="line"><span class="keyword">let</span> promise = <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"><span class="comment">//.browserslintrc文件中，我们配置一个chrome浏览器的低版本</span></span><br><span class="line">chrome <span class="number">60</span></span><br></pre></td></tr></table></figure>

<p><code>usage</code>: 就把上面 entry 改了就行,作用就是类似于按需加载,只把用的 Promsie 进行 polyfill 补齐.</p>
<h3 id="corejs"><a href="#corejs" class="headerlink" title="corejs"></a>corejs</h3><p>就是 corejs 的版本,推荐 3.</p>
<h3 id="modules"><a href="#modules" class="headerlink" title="modules"></a>modules</h3><p>可以配置成”amd” | “umd” | “systemjs” | “commonjs” | “cjs” | “auto” | false，默认为 auto，这个参数的含义是，是否将 ES6 模块化语法转译成其他的语法，设置为 false 的话，转译的结果就还是 ES6 模块化语法，就是 import,export default 这种，不会使用 require（CommonJs 语法）这种进行导入导出，如果使用 webpack 或 rollup 等打包工具，推荐将 modules 设置为 false，这样的话就有利于打包工具进行静态分析，从而做 tree shaking 等优化操作</p>
<h2 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// targets不做配置，默认使用我们 .browserslistrc文件中的配置</span></span><br><span class="line">        <span class="comment">// targets: &#123;&#125;,</span></span><br><span class="line">        <span class="comment">// 对所用语法进行polyfill</span></span><br><span class="line">        <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">        <span class="attr">corejs</span>: &#123;</span><br><span class="line">          <span class="comment">// 使用最新版本的core-js进行polyfill</span></span><br><span class="line">          <span class="attr">version</span>: <span class="string">&quot;^3.25.2&quot;</span>,</span><br><span class="line">          <span class="comment">// 开启草案中的polyfill转译</span></span><br><span class="line">          <span class="attr">proposals</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 使用es6模块进行</span></span><br><span class="line">        <span class="attr">modules</span>: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Postcss"><a href="#Postcss" class="headerlink" title="Postcss"></a>Postcss</h1><p>用来处理 css 样式兼容性的工具,用于适配不同的浏览器.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm add postcss-cli postcss-loader autoprefixer</span><br></pre></td></tr></table></figure>

<h2 id="autoprefixer"><a href="#autoprefixer" class="headerlink" title="autoprefixer"></a>autoprefixer</h2><p>自动适配浏览器,在<code>browserslistrc</code>文件中写上要适配的浏览器种类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .browserslistrc</span></span><br><span class="line"><span class="comment">// 使用率大于0.01%</span></span><br><span class="line">&gt;<span class="number">0.01</span>%</span><br><span class="line"><span class="comment">// 往上数两个版本</span></span><br><span class="line">last <span class="number">2</span> versions</span><br><span class="line"><span class="comment">// 还没停更的</span></span><br><span class="line">not dead</span><br></pre></td></tr></table></figure>

<p>可以将配置写在单独的<code>postcss.config.js</code>中,或者 webpack 配置中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&quot;autoprefixer&quot;</span>)],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="post-loader"><a href="#post-loader" class="headerlink" title="post-loader"></a>post-loader</h2><p>在 webpack 中的配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">moudule.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">//...,</span></span><br><span class="line">  <span class="attr">modules</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;postcss-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/10/24/React%20Query/" rel="prev" title="React Query">
                  <i class="fa fa-chevron-left"></i> React Query
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/10/24/rolllup/" rel="next" title="rolllup">
                  rolllup <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zax Tseng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
