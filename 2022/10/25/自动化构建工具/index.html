<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="自动化构建自动化构建简介一切重复工作本应自动化  自动化构建（自动化构建工作流）：把开发阶段代码自动转换为生产环境运行的代码&#x2F;程序； 作用：脱离运行环境兼容带来的问题，使用提高效率的语法、规范和标准 自动化构建工具，构建转换那些不被支持的【特性】（sass、ECMAScript next、模板引擎）  自动化构建初体验NPM Scripts 可以在 NPM Scripts 中定义一些与项">
<meta property="og:type" content="article">
<meta property="og:title" content="自动化构建工具">
<meta property="og:url" content="http://example.com/2022/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/index.html">
<meta property="og:site_name" content="ZAX">
<meta property="og:description" content="自动化构建自动化构建简介一切重复工作本应自动化  自动化构建（自动化构建工作流）：把开发阶段代码自动转换为生产环境运行的代码&#x2F;程序； 作用：脱离运行环境兼容带来的问题，使用提高效率的语法、规范和标准 自动化构建工具，构建转换那些不被支持的【特性】（sass、ECMAScript next、模板引擎）  自动化构建初体验NPM Scripts 可以在 NPM Scripts 中定义一些与项">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-10-25T11:17:34.000Z">
<meta property="article:modified_time" content="2023-05-18T14:24:21.688Z">
<meta property="article:author" content="Zax Tseng">
<meta property="article:tag" content="javascript, React, Vue, HTML5">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2022/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2022/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/","path":"2022/10/25/自动化构建工具/","title":"自动化构建工具"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>自动化构建工具 | ZAX</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">ZAX</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA"><span class="nav-number">1.</span> <span class="nav-text">自动化构建</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E7%AE%80%E4%BB%8B"><span class="nav-number">1.1.</span> <span class="nav-text">自动化构建简介</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="nav-number">1.2.</span> <span class="nav-text">自动化构建初体验</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7"><span class="nav-number">1.3.</span> <span class="nav-text">常用的自动化构建工具</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Grunt"><span class="nav-number">2.</span> <span class="nav-text">Grunt</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Grunt-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">2.1.</span> <span class="nav-text">Grunt 的基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grunt-%E6%A0%87%E8%AE%B0%E4%BB%BB%E5%8A%A1%E5%A4%B1%E8%B4%A5"><span class="nav-number">2.2.</span> <span class="nav-text">Grunt 标记任务失败</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grunt-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E6%B3%95"><span class="nav-number">2.3.</span> <span class="nav-text">Grunt 的配置方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grunt-%E5%A4%9A%E7%9B%AE%E6%A0%87%E4%BB%BB%E5%8A%A1%EF%BC%88%E5%AD%90%E4%BB%BB%E5%8A%A1%EF%BC%89"><span class="nav-number">2.4.</span> <span class="nav-text">Grunt 多目标任务（子任务）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grunt-%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">2.5.</span> <span class="nav-text">Grunt 插件的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Grunt-%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6%E5%8F%8A%E6%80%BB%E7%BB%93"><span class="nav-number">2.6.</span> <span class="nav-text">Grunt 常用插件及总结</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Gulp"><span class="nav-number">3.</span> <span class="nav-text">Gulp</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="nav-number">3.1.</span> <span class="nav-text">Gulp 的基本使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E7%9A%84%E7%BB%84%E5%90%88%E4%BB%BB%E5%8A%A1"><span class="nav-number">3.2.</span> <span class="nav-text">Gulp 的组合任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E7%9A%84%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="nav-number">3.3.</span> <span class="nav-text">Gulp 的异步任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E6%A0%B8%E5%BF%83%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">3.4.</span> <span class="nav-text">Gulp 构建过程核心工作原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C-API"><span class="nav-number">3.5.</span> <span class="nav-text">Gulp 文件操作 API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E6%A0%B7%E5%BC%8F%E7%BC%96%E8%AF%91"><span class="nav-number">3.6.</span> <span class="nav-text">Gulp 案例 - 样式编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E8%84%9A%E6%9C%AC%E7%BC%96%E8%AF%91"><span class="nav-number">3.7.</span> <span class="nav-text">Gulp 案例 - 脚本编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E9%A1%B5%E9%9D%A2%E6%A8%A1%E6%9D%BF%E7%BC%96%E8%AF%91"><span class="nav-number">3.8.</span> <span class="nav-text">Gulp 案例 - 页面模板编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E5%9B%BE%E7%89%87%E5%92%8C%E5%AD%97%E4%BD%93%E6%96%87%E4%BB%B6%E8%BD%AC%E6%8D%A2"><span class="nav-number">3.9.</span> <span class="nav-text">Gulp 案例 - 图片和字体文件转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E5%85%B6%E4%BB%96%E6%96%87%E4%BB%B6%E5%8F%8A%E6%96%87%E4%BB%B6%E6%B8%85%E9%99%A4"><span class="nav-number">3.10.</span> <span class="nav-text">Gulp 案例 - 其他文件及文件清除</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E8%87%AA%E5%8A%A8%E5%8A%A0%E8%BD%BD%E6%8F%92%E4%BB%B6"><span class="nav-number">3.11.</span> <span class="nav-text">Gulp 案例 - 自动加载插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E5%BC%80%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">3.12.</span> <span class="nav-text">Gulp 案例 - 开发服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E7%9B%91%E8%A7%86%E5%8F%98%E5%8C%96%E4%BB%A5%E5%8F%8A%E6%9E%84%E5%BB%BA%E4%BC%98%E5%8C%96"><span class="nav-number">3.13.</span> <span class="nav-text">Gulp 案例 - 监视变化以及构建优化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-useref-%E6%96%87%E4%BB%B6%E5%BC%95%E7%94%A8%E5%A4%84%E7%90%86"><span class="nav-number">3.14.</span> <span class="nav-text">Gulp 案例 - useref 文件引用处理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9"><span class="nav-number">3.15.</span> <span class="nav-text">Gulp 案例 - 文件压缩</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E9%87%8D%E6%96%B0%E8%A7%84%E5%88%92%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="nav-number">3.16.</span> <span class="nav-text">Gulp 案例 - 重新规划构建过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E6%9E%84%E5%BB%BA"><span class="nav-number">3.17.</span> <span class="nav-text">完整构建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Gulp-%E6%A1%88%E4%BE%8B-%E8%A1%A5%E5%85%85"><span class="nav-number">3.18.</span> <span class="nav-text">Gulp 案例 - 补充</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E5%B7%A5%E4%BD%9C%E6%B5%81-%E6%8F%90%E5%8F%96-gulpfile"><span class="nav-number">3.19.</span> <span class="nav-text">封装工作流 - 提取 gulpfile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E5%B7%A5%E4%BD%9C%E6%B5%81-%E6%8A%BD%E8%B1%A1%E8%B7%AF%E5%BE%84%E9%85%8D%E7%BD%AE"><span class="nav-number">3.20.</span> <span class="nav-text">封装工作流 - 抽象路径配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E5%B7%A5%E4%BD%9C%E6%B5%81-%E5%8C%85%E8%A3%85-Gulp-CLI"><span class="nav-number">3.21.</span> <span class="nav-text">封装工作流 - 包装 Gulp CLI</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B0%81%E8%A3%85%E5%B7%A5%E4%BD%9C%E6%B5%81-%E5%8F%91%E5%B8%83%E5%B9%B6%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">3.22.</span> <span class="nav-text">封装工作流 - 发布并使用模块</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zax Tseng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">123</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="自动化构建工具 | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          自动化构建工具
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-25 19:17:34" itemprop="dateCreated datePublished" datetime="2022-10-25T19:17:34+08:00">2022-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-18 22:24:21" itemprop="dateModified" datetime="2023-05-18T22:24:21+08:00">2023-05-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="自动化构建"><a href="#自动化构建" class="headerlink" title="自动化构建"></a>自动化构建</h1><h2 id="自动化构建简介"><a href="#自动化构建简介" class="headerlink" title="自动化构建简介"></a>自动化构建简介</h2><p>一切重复工作本应自动化</p>
<ul>
<li>自动化构建（自动化构建工作流）：把开发阶段代码自动转换为生产环境运行的代码&#x2F;程序；</li>
<li>作用：脱离运行环境兼容带来的问题，使用提高效率的语法、规范和标准</li>
<li>自动化构建工具，构建转换那些不被支持的【特性】（sass、ECMAScript next、模板引擎）</li>
</ul>
<h2 id="自动化构建初体验"><a href="#自动化构建初体验" class="headerlink" title="自动化构建初体验"></a>自动化构建初体验</h2><p>NPM Scripts 可以在 NPM Scripts 中定义一些与项目开发过程有关的脚本命令便于后期开发使用</p>
<ul>
<li>使用过程<ul>
<li>在命令行执行<code>yarn init -y</code>生成 package.json 文件</li>
<li>在 package.json 文件添加 scripts 字段，该字段是一个对象，键是 scripts 名称，值是需要执行的命令；scripts 可以自动发现 node_modules 里面的命令，所以不用写完整的路径直接使用命令的名称即可</li>
<li>使用 npm&#x2F;yarn 启动 scripts</li>
<li><code>--watch: scss</code>在工作是会监听文件的变化，scss 文件发生改变时会自动编译</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sass scss/main.scss css/style.css --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>NPM Scripts 实现自动化构建工作流的最简单方式</li>
</ul>
<p>使用 browser-sync 模块可以开启测试服务器运行项目，在 scripts 中添加命令<code>&quot;serve&quot;: &quot;browser-sync .&quot;</code>运行项目</p>
<p><code>--files &quot;css/*.css&quot;</code> 参数可以让 browser-sync 在启动过后监听项目下文件的变化，browser-sync 会将文件内容自动同步到浏览器，更新浏览器界面</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sass scss/main.scss css/style.css --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;browser-sync . --files \&quot;css/*.css\&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>在启动 serve 前让 build 工作可以借助 NPM Scripts 钩子机制定义一个 preserve，它可以在 serve 执行前去执行</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sass scss/main.scss css/style.css --watch&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;preserve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yarn build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;browser-sync . --files \&quot;css/*.css\&quot;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<p>可以使用<code>npm-run-all</code>模块同时执行多个任务</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sass scss/main.scss css/style.css&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;browser-sync . --files \&quot;css/*.css\&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;run-p build serve&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h2 id="常用的自动化构建工具"><a href="#常用的自动化构建工具" class="headerlink" title="常用的自动化构建工具"></a>常用的自动化构建工具</h2><ul>
<li>Grunt 最早的构建系统；插件生态完善；工作过程基于临时文件实现所以构建速度较慢，如使用它完成 scss 文件构建，我们会先对 scss 文件进行编译工作，自动添加属性前缀，压缩代码，Grunt 每一步都有磁盘读写操作，处理环节越多，磁盘的读写越多；大型项目中速度会非常慢</li>
<li>Gulp 可以解决 Grunt 中构建速度慢的问题，他基于内存实现的，对文件的读写都是基于内存完成的，相对与磁盘读写就快了；支持同时执行多个任务效率高；使用方式相对于 Grunt 更直观易懂；插件生态完善</li>
<li>FIS 微内核；更像是一种捆绑套餐，把项目中典型的需求尽可能集成在内部</li>
</ul>
<h1 id="Grunt"><a href="#Grunt" class="headerlink" title="Grunt"></a>Grunt</h1><h2 id="Grunt-的基本使用"><a href="#Grunt-的基本使用" class="headerlink" title="Grunt 的基本使用"></a>Grunt 的基本使用</h2><ul>
<li>项目命令行输入 <code>yarn init -y</code> 生成 package.json 文件</li>
<li>安装 grunt <code>yarn add grunt</code></li>
<li>项目根目录创建 gruntfile.js 文件，该文件是 Grunt 入口文件，用于定义一些需要 Grunt 自动执行的任务，需要导出一个函数，此函数接收一个 grunt 的形参，内部提供一些创建任务时可以用到的 API</li>
<li>最后使用 <code>yanr grunt taskName</code> 执行任务</li>
</ul>
<p>使用 grunt.registerTask() 方法注册一个任务</p>
<ul>
<li>第一个参数为任务名称，如果任务名称为 default，该任务将作为默认任务，运行时不用指定任务名，Grunt 将自动调用 default</li>
<li>第二个参数<ul>
<li>第二个参数是字符串时，该字符串将是任务的描述，命令行输入 <code>yarn grunt --help</code> 可以看到该信息；</li>
<li>一般会使用 default 任务映射一些其他的任务，其他的任务将作为第二个参数，参数是数组，元素为任务名，当执行 default 任务时 Grunt 会依次执行数组中的任务；</li>
<li>当第二个参数为函数时，将制定任务函数，任务发生时自动执行函数</li>
</ul>
</li>
<li>异步任务：需要使用 this.async() 方法得到一个回调函数，在异步回调函数完成后调用这个函数标识任务已经完成</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Grunt 的入口文件</span></span><br><span class="line"><span class="comment">// 用于定义一些需要 Grunt 自动执行的任务</span></span><br><span class="line"><span class="comment">// 需要导出一个函数</span></span><br><span class="line"><span class="comment">// 此函数接收一个 grunt 的对象类型的形参</span></span><br><span class="line"><span class="comment">// grunt 对象中提供一些创建任务时会用到的 API</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;a sample task&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello grunt&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;bar&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;other task&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // default 是默认任务名称</span></span><br><span class="line">  <span class="comment">// // 通过 grunt 执行时可以省略</span></span><br><span class="line">  <span class="comment">// grunt.registerTask(&#x27;default&#x27;, () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(&#x27;default task&#x27;)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第二个参数可以指定此任务的映射任务，</span></span><br><span class="line">  <span class="comment">// 这样执行 default 就相当于执行对应的任务</span></span><br><span class="line">  <span class="comment">// 这里映射的任务会按顺序依次执行，不会同步执行</span></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;default&quot;</span>, [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 也可以在任务函数中执行其他任务</span></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;run-other&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// foo 和 bar 会在当前任务执行完成过后自动依次执行</span></span><br><span class="line">    grunt.<span class="property">task</span>.<span class="title function_">run</span>(<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;current task runing~&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认 grunt 采用同步模式编码</span></span><br><span class="line">  <span class="comment">// 如果需要异步可以使用 this.async() 方法创建回调函数</span></span><br><span class="line">  <span class="comment">// grunt.registerTask(&#x27;async-task&#x27;, () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   setTimeout(() =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;async task working~&#x27;)</span></span><br><span class="line">  <span class="comment">//   &#125;, 1000)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 由于函数体中需要使用 this，所以这里不能使用箭头函数</span></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;async-task&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> done = <span class="variable language_">this</span>.<span class="title function_">async</span>();</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async task working~&quot;</span>);</span><br><span class="line">      <span class="title function_">done</span>();</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Grunt-标记任务失败"><a href="#Grunt-标记任务失败" class="headerlink" title="Grunt 标记任务失败"></a>Grunt 标记任务失败</h2><p>在 grunt.registerTask() 任务函数 return false，在命令行执行该任务时将会提示执行失败，在任务列表中会导致后面的任务无法执行，在执行任务时添加 –force 命令，将会强制执行所有的任务 <code>yarn grunt --force</code>，在异步任务中无法通过 return false 来标记失败，要给异步的回调函数指定 false 实参就可以标记失败了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;foo&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hello grunt~&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;bar&quot;</span>, <span class="string">&quot;任务描述&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;other task~&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;bad-async&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> done = <span class="variable language_">this</span>.<span class="title function_">async</span>();</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async task working~&quot;</span>);</span><br><span class="line">      <span class="title function_">done</span>(<span class="literal">false</span>); <span class="comment">// 出入实参false标识异步任务失败</span></span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;bad&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;bad working~&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;default&quot;</span>, [<span class="string">&quot;foo&quot;</span>, <span class="string">&quot;bad&quot;</span>, <span class="string">&quot;bar&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Grunt-的配置方法"><a href="#Grunt-的配置方法" class="headerlink" title="Grunt 的配置方法"></a>Grunt 的配置方法</h2><ul>
<li>通过 grunt.initConfig() 方法为任务添加一些配置项</li>
<li>grunt.initConfig() 参数为一个对象，键一般对应任务的名，值可以是任意类型的数据</li>
<li>在 grunt.registerTask() 中可以通过 grunt.config() 获取配置，如果配置中的属性值是对象的话，config 可以使用点的方式定位对象中的属性值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// grunt.initConfig() 用于为任务添加一些配置选项</span></span><br><span class="line">  grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">    <span class="comment">// 键一般对应任务的名称</span></span><br><span class="line">    <span class="comment">// 值可以是任意类型的数据</span></span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="attr">bar</span>: <span class="string">&quot;baz&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;foo&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 任务中可以使用 grunt.config() 获取配置</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(grunt.<span class="title function_">config</span>(<span class="string">&quot;foo&quot;</span>));</span><br><span class="line">    <span class="comment">// 如果属性值是对象的话，config 中可以使用点的方式定位对象中属性的值</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(grunt.<span class="title function_">config</span>(<span class="string">&quot;foo.bar&quot;</span>));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Grunt-多目标任务（子任务）"><a href="#Grunt-多目标任务（子任务）" class="headerlink" title="Grunt 多目标任务（子任务）"></a>Grunt 多目标任务（子任务）</h2><ul>
<li>grunt.registerMultiTask()<ul>
<li>通过 grunt.registerMultiTask() 定义多目标</li>
<li>多目标模式，可以让任务根据配置形成多个子任务</li>
<li>grunt.registerMultiTask() 第一个参数是任务的名字，第二个参数是任务执行过程要做的事情</li>
<li>多任务，要使用 grunt.initConfig()为任务配置目标</li>
<li>当运行任务时会去执行目标（子任务），如果要运行指定的目标可以使用“:目标名”，yarn grunt build:css</li>
<li>可以通过 this.target 拿到当前执行的目标名称，通过 this.data 拿到目标的配置数据</li>
<li>可以通过 this.options()方法拿到配置选项</li>
</ul>
</li>
<li>grunt.initConfig()<ul>
<li>参数为对象，键名与任务名相同(registerMultiTask()方法的第一个参数)，值必须为对象，对象中每个属性名就是目标名称</li>
<li>除了 options 键，其他都会作为目标，options 指定的信息会作为这个任务的配置选项</li>
<li>目标当中也可以添加 options，运行目标是可以获取相应的 options（目标 options 覆盖任务 options），如果目标没指定而任务指定了则可以获取任务的 options</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">      <span class="comment">// ‘build’名与</span></span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">foo</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">css</span>: &#123;</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">foo</span>: <span class="string">&quot;baz&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">js</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  grunt.<span class="title function_">registerMultiTask</span>(<span class="string">&quot;build&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="title function_">options</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`task: <span class="subst">$&#123;<span class="variable language_">this</span>.target&#125;</span>, data:<span class="subst">$&#123;<span class="variable language_">this</span>.data&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Grunt-插件的使用"><a href="#Grunt-插件的使用" class="headerlink" title="Grunt 插件的使用"></a>Grunt 插件的使用</h2><ul>
<li>通过 npm 安装</li>
<li>在 gruntfile.js 文件中通过 grunt.loadNpmTasks() 方法把插件中提供的任务加载进来，根据插件文档配置</li>
<li>在 grunt.initConfig() 方法中为任务添加配置选项</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除文件的任务</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">    <span class="attr">clean</span>: &#123;</span><br><span class="line">      <span class="comment">// temp:&#x27;temp/app.js&#x27; // 需要清除的文件，可以使用通配符&quot;*&quot;，“**”表示找到该目录下的文件以及子目录的文件（即该目录下的所有文件）</span></span><br><span class="line">      <span class="attr">temp</span>: <span class="string">&quot;temp/*.txt&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过 loadNpmTasks 加载插件中提供的任务</span></span><br><span class="line">  grunt.<span class="title function_">loadNpmTasks</span>(<span class="string">&quot;grunt-contrib-clean&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Grunt-常用插件及总结"><a href="#Grunt-常用插件及总结" class="headerlink" title="Grunt 常用插件及总结"></a>Grunt 常用插件及总结</h2><ul>
<li>grunt-sass<ul>
<li>安装 <code>yarn grunt-sass sass --dev</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">&quot;sass&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">    <span class="attr">sass</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">implementation</span>: sass,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">main</span>: &#123;</span><br><span class="line">        <span class="comment">// 目标main(随便写)</span></span><br><span class="line">        <span class="attr">files</span>: &#123;</span><br><span class="line">          <span class="string">&quot;dist/css/main.css&quot;</span>: <span class="string">&quot;src/scss/main.scss&quot;</span>, <span class="comment">// 键是输出文件，值是输入文件</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 通过 loadNpmTasks 加载插件中提供的任务</span></span><br><span class="line">  grunt.<span class="title function_">loadNpmTasks</span>(<span class="string">&quot;grunt-sass&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>load-grunt-tasks<br>自动加载所有的 grunt 插件<ul>
<li>安装 <code>yarn add load-grunt-tasks --dev</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadGruntTasks = <span class="built_in">require</span>(<span class="string">&quot;load-grunt-tasks&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-sass&#x27;)</span></span><br><span class="line">  <span class="title function_">loadGruntTasks</span>(grunt); <span class="comment">// 自动加载所有的 grunt 插件中的任务</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>babel<ul>
<li>安装 <code>yarn add grunt-babel @babel/core @babel/preset-env --dev</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">&quot;sass&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> loadGruntTasks = <span class="built_in">require</span>(<span class="string">&quot;load-grunt-tasks&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">    <span class="attr">sass</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">implementation</span>: sass,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">main</span>: &#123;</span><br><span class="line">        <span class="comment">// 目标main(随便写)</span></span><br><span class="line">        <span class="attr">files</span>: &#123;</span><br><span class="line">          <span class="string">&quot;dist/css/main.css&quot;</span>: <span class="string">&quot;src/scss/main.scss&quot;</span>, <span class="comment">// 键是输出文件，值是输入文件</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">babel</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">main</span>: &#123;</span><br><span class="line">        <span class="attr">files</span>: &#123;</span><br><span class="line">          <span class="string">&quot;dist/js/app.js&quot;</span>: <span class="string">&quot;src/js/app.js&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-sass&#x27;)</span></span><br><span class="line">  <span class="title function_">loadGruntTasks</span>(grunt); <span class="comment">// 自动加载所有的 grunt 插件中的任务</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>grunt-contrib-watch 自动编译<ul>
<li>安装 <code>yarn add grunt-contrib-watch --dev</code></li>
<li>执行 <code>yarn grunt watch</code>，当监听的文件发生变化的时候会执行相应的任务，但是刚开始的时候不会执行，可以使用 grunt.registerTask() 方法，执行<code>yarn grunt</code></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">&quot;sass&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> loadGruntTasks = <span class="built_in">require</span>(<span class="string">&quot;load-grunt-tasks&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">grunt</span>) =&gt;</span> &#123;</span><br><span class="line">  grunt.<span class="title function_">initConfig</span>(&#123;</span><br><span class="line">    <span class="attr">sass</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">implementation</span>: sass,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">main</span>: &#123;</span><br><span class="line">        <span class="comment">// 目标main(随便写)</span></span><br><span class="line">        <span class="attr">files</span>: &#123;</span><br><span class="line">          <span class="string">&quot;dist/css/main.css&quot;</span>: <span class="string">&quot;src/scss/main.scss&quot;</span>, <span class="comment">// 键是输出文件，值是输入文件</span></span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">babel</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">sourceMap</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">main</span>: &#123;</span><br><span class="line">        <span class="attr">files</span>: &#123;</span><br><span class="line">          <span class="string">&quot;dist/js/app.js&quot;</span>: <span class="string">&quot;src/js/app.js&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">watch</span>: &#123;</span><br><span class="line">      <span class="attr">js</span>: &#123;</span><br><span class="line">        <span class="attr">files</span>: [<span class="string">&quot;src/js/*.js&quot;</span>], <span class="comment">// 监听的文件</span></span><br><span class="line">        <span class="attr">tasks</span>: [<span class="string">&quot;babel&quot;</span>], <span class="comment">// 当文件发生改变要执行什么任务</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">css</span>: &#123;</span><br><span class="line">        <span class="attr">files</span>: [<span class="string">&quot;src/scss/*.scss&quot;</span>], <span class="comment">// 监听的文件</span></span><br><span class="line">        <span class="attr">tasks</span>: [<span class="string">&quot;sass&quot;</span>], <span class="comment">// 当文件发生改变要执行什么任务</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// grunt.loadNpmTasks(&#x27;grunt-sass&#x27;)</span></span><br><span class="line">  <span class="title function_">loadGruntTasks</span>(grunt); <span class="comment">// 自动加载所有的 grunt 插件中的任务</span></span><br><span class="line">  grunt.<span class="title function_">registerTask</span>(<span class="string">&quot;default&quot;</span>, [<span class="string">&quot;sass&quot;</span>, <span class="string">&quot;babel&quot;</span>, <span class="string">&quot;watch&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Gulp"><a href="#Gulp" class="headerlink" title="Gulp"></a>Gulp</h1><h2 id="Gulp-的基本使用"><a href="#Gulp-的基本使用" class="headerlink" title="Gulp 的基本使用"></a>Gulp 的基本使用</h2><ul>
<li>执行 <code>yarn init -y</code></li>
<li>安装 <code>yarn add gulp --dev</code></li>
<li>在根目录新建 gulpfile.js，此文件作为 gulp 入口文件</li>
<li>导出函数，导出的函数都会作为 gulp 任务</li>
<li>gulp 的任务函数都是异步的，可以通过调用回调函数标识任务完成</li>
<li>default 是默认任务，在运行是可以省略任务名参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gulp入口文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出的函数都会作为 gulp 任务</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">foo</span> = <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// gulp 的任务函数都是异步的</span></span><br><span class="line">  <span class="comment">// 可以通过调用回调函数标识任务完成</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;foo task working~&quot;</span>);</span><br><span class="line">  <span class="title function_">done</span>(); <span class="comment">// 标识任务执行完成</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// default 是默认任务</span></span><br><span class="line"><span class="comment">// 在运行是可以省略任务名参数</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">default</span> = <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;default task working~&quot;</span>);</span><br><span class="line">  <span class="title function_">done</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-的组合任务"><a href="#Gulp-的组合任务" class="headerlink" title="Gulp 的组合任务"></a>Gulp 的组合任务</h2><p><code>series()</code>,<code>parallel()</code> 可以创建并行任务和串行任务</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 可以没导出的理解为私有任务</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">task1</span> = (<span class="params">done</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;task1 working~&quot;</span>);</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">task2</span> = (<span class="params">done</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;task2 working~&quot;</span>);</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">task3</span> = (<span class="params">done</span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;task3 working~&quot;</span>);</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">foo</span> = <span class="title function_">series</span>(task1, task2, task3); <span class="comment">// // 让多个任务按照顺序依次执行</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">bar</span> = <span class="title function_">parallel</span>(task1, task2, task3); <span class="comment">// // 让多个任务同时执行</span></span><br></pre></td></tr></table></figure>

<h2 id="Gulp-的异步任务"><a href="#Gulp-的异步任务" class="headerlink" title="Gulp 的异步任务"></a>Gulp 的异步任务</h2><ul>
<li>回调函数<ul>
<li>gulp 的任务为异步，异步函数无法知道是否执行完成，可以通过回调解决（done），任务执行完后调用回调函数通知 gulp 任务执行完成</li>
<li>回调函数叫做一种错误优先的回调函数，在执行过程中报错，阻止剩下任务执行可以通过给回调函数的第一个参数指定一个错误对象</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">callback_error</span> = <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;callback task~&quot;</span>);</span><br><span class="line">  <span class="title function_">done</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;task failed!&quot;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>promise<ul>
<li>使用 promise 通知任务执行完成</li>
<li>任务中返回一个 Promise 对象，如果 resolve 意味着任务结束了，不需要返回任何的值，如果 reject，gulp 会认为是一个失败任务结束后续任务的执行</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">promise</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise task~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>();</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">promise</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;promise task~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;task failed~&quot;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>async await</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">timeout</span> = (<span class="params">time</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, time);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">async</span> = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">timeout</span>(<span class="number">1000</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;async task~&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>stream</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// exports.stream = () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     const readStream = fs.createReadStream(&#x27;package.json&#x27;)</span></span><br><span class="line"><span class="comment">//     const writeStream = fs.createWriteStream(&#x27;temp.txt&#x27;)</span></span><br><span class="line"><span class="comment">//     readStream.pipe(writeStream)</span></span><br><span class="line"><span class="comment">//     return readStream</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">stream</span> = <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> readStream = fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;package.json&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> writeStream = fs.<span class="title function_">createWriteStream</span>(<span class="string">&quot;temp.txt&quot;</span>);</span><br><span class="line">  readStream.<span class="title function_">pipe</span>(writeStream);</span><br><span class="line">  readStream.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">done</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-构建过程核心工作原理"><a href="#Gulp-构建过程核心工作原理" class="headerlink" title="Gulp 构建过程核心工作原理"></a>Gulp 构建过程核心工作原理</h2><ul>
<li>工作过程：输入(读取流) &#x3D;&gt; 加工(转换流) &#x3D;&gt; 输出(写入流)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Transform</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;stream&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">default</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 文件读取流</span></span><br><span class="line">  <span class="keyword">const</span> read = fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;normalize.css&quot;</span>);</span><br><span class="line">  <span class="comment">// 文件写入流</span></span><br><span class="line">  <span class="keyword">const</span> write = fs.<span class="title function_">createWriteStream</span>(<span class="string">&quot;normalize.min.css&quot;</span>);</span><br><span class="line">  <span class="comment">// 文件转换流</span></span><br><span class="line">  <span class="keyword">const</span> transform = <span class="keyword">new</span> <span class="title class_">Transform</span>(&#123;</span><br><span class="line">    <span class="attr">transform</span>: <span class="function">(<span class="params">chunk, encoding, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 核心转换过程</span></span><br><span class="line">      <span class="comment">// chunk =&gt; 读取流中读取到的内容（Buffer）</span></span><br><span class="line">      <span class="keyword">const</span> input = chunk.<span class="title function_">toString</span>();</span><br><span class="line">      <span class="comment">// 替换空格、注释（压缩代码）</span></span><br><span class="line">      <span class="keyword">const</span> output = input.<span class="title function_">replace</span>(<span class="regexp">/\s+/g</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">replace</span>(<span class="regexp">/\/\*.+?\*\//g</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      <span class="comment">// 把内容传出</span></span><br><span class="line">      <span class="title function_">callback</span>(<span class="literal">null</span>, output); <span class="comment">// 错误优先的回调函数</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把读取出来的文件流导入写入文件流</span></span><br><span class="line">  read</span><br><span class="line">    .<span class="title function_">pipe</span>(transform) <span class="comment">// 转换</span></span><br><span class="line">    .<span class="title function_">pipe</span>(write); <span class="comment">// 写入</span></span><br><span class="line">  <span class="keyword">return</span> read;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-文件操作-API"><a href="#Gulp-文件操作-API" class="headerlink" title="Gulp 文件操作 API"></a>Gulp 文件操作 API</h2><ul>
<li>src：读取流，方法参数为文件路径，可以使用通配符匹配所以的文件</li>
<li>dest：写入流</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cleanCss = <span class="built_in">require</span>(<span class="string">&quot;gulp-clean-css&quot;</span>); <span class="comment">// 压缩代码转换流模块</span></span><br><span class="line"><span class="keyword">const</span> rename = <span class="built_in">require</span>(<span class="string">&quot;gulp-rename&quot;</span>); <span class="comment">// 重命名扩展名模块</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">default</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// gulp读取流 和 写入流，可以使用统配符</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/*.css&quot;</span>)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">cleanCss</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">rename</span>(&#123; <span class="attr">extname</span>: <span class="string">&quot;.min.css&quot;</span> &#125;)) <span class="comment">// 指定重命名的扩展名</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-样式编译"><a href="#Gulp-案例-样式编译" class="headerlink" title="Gulp 案例 - 样式编译"></a>Gulp 案例 - 样式编译</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 该依赖会把下划线文件名的文件认为是主文件中依赖的文件，所以不会吧下划线文件名的文件转换</span></span><br><span class="line"><span class="keyword">const</span> sass = <span class="built_in">require</span>(<span class="string">&quot;gulp-sass&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">style</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// base 基准路径，会把src后面的路径保留下来，否则不会按照原本路径输出</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/styles/*.scss&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">sass</span>(&#123; <span class="attr">outputStyle</span>: <span class="string">&quot;expanded&quot;</span> &#125;)) <span class="comment">// outputStyle编译后“&#125;”位于后面</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  style,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-脚本编译"><a href="#Gulp-案例-脚本编译" class="headerlink" title="Gulp 案例 - 脚本编译"></a>Gulp 案例 - 脚本编译</h2><p>安装 babel 依赖 <code>yarn add babel @babel/core @babel/preset-env --dev</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest &#125; = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&quot;gulp-babel&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">script</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// base 基准路径，会把src后面的路径保留下来，否则不会按照原本路径输出</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/scripts/*.js&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">babel</span>(&#123; <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>] &#125;)) <span class="comment">// 如果不添加presets转换无效</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  script,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-页面模板编译"><a href="#Gulp-案例-页面模板编译" class="headerlink" title="Gulp 案例 - 页面模板编译"></a>Gulp 案例 - 页面模板编译</h2><p>安装 swig 模板引擎转换插件 <code>yarn add gulp-swig --dev</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> swig = <span class="built_in">require</span>(<span class="string">&quot;gulp-swig&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">menus</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;aperture&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Features&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;features.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;about.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Contact&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;Twitter&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;https://twitter.com/w_zce&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;https://weibo.com/zceme&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;divider&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;https://github.com/zce&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">pkg</span>: <span class="built_in">require</span>(<span class="string">&quot;./package.json&quot;</span>),</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">page</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果存在子目录：&#x27;src/**/*.html&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title function_">src</span>(<span class="string">&quot;src/*.html&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">      <span class="comment">// data 把数据传入到模板中，渲染对应的数据</span></span><br><span class="line">      <span class="comment">// cache 防止模板缓存导致页面不能及时更新</span></span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">swig</span>(&#123; data, <span class="attr">defaults</span>: &#123; <span class="attr">cache</span>: <span class="literal">false</span> &#125; &#125;))</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>))</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  page,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-图片和字体文件转换"><a href="#Gulp-案例-图片和字体文件转换" class="headerlink" title="Gulp 案例 - 图片和字体文件转换"></a>Gulp 案例 - 图片和字体文件转换</h2><p>安装图片压缩转换插件 <code>yarn add gulp-imagemin --dev</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> imagemin = <span class="built_in">require</span>(<span class="string">&quot;gulp-imagemin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">image</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/images/**&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">imagemin</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">font</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/fonts/**&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">imagemin</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-其他文件及文件清除"><a href="#Gulp-案例-其他文件及文件清除" class="headerlink" title="Gulp 案例 - 其他文件及文件清除"></a>Gulp 案例 - 其他文件及文件清除</h2><p>打包是自动删除 dist 文件目录，安装插件 <code>yarn add del --dev</code>，这个模块不是 gulp 的插件，只是可以在 gulp 中使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> del = <span class="built_in">require</span>(<span class="string">&quot;del&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">extra</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 转换其他文件</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;public/**&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;public&quot;</span> &#125;).<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clean</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">del</span>([<span class="string">&quot;dist&quot;</span>]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-自动加载插件"><a href="#Gulp-案例-自动加载插件" class="headerlink" title="Gulp 案例 - 自动加载插件"></a>Gulp 案例 - 自动加载插件</h2><p>安装插件 <code>yarn add gulp-load-plugins --dev</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadPlugins = <span class="built_in">require</span>(<span class="string">&quot;gulp-load-plugins&quot;</span>);</span><br><span class="line"><span class="comment">// 自动加载所有的插件</span></span><br><span class="line"><span class="keyword">const</span> plugins = <span class="title function_">loadPlugins</span>(); <span class="comment">// 把‘gulp-’去掉，如果后面有多个‘-’会变为驼峰命名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">style</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// base 基准路径，会把src后面的路径保留下来，否则不会按照原本路径输出</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/styles/*.scss&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">sass</span>(&#123; <span class="attr">outputStyle</span>: <span class="string">&quot;expanded&quot;</span> &#125;)) <span class="comment">// 使用plugins.sass</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-开发服务器"><a href="#Gulp-案例-开发服务器" class="headerlink" title="Gulp 案例 - 开发服务器"></a>Gulp 案例 - 开发服务器</h2><p>热更新开发服务器<br>安装模块 <code>yarn add browser-sync --dev</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">&quot;browser-sync&quot;</span>);</span><br><span class="line"><span class="comment">// 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> bs = browserSync.<span class="title function_">create</span>();</span><br><span class="line"><span class="comment">// 服务任务</span></span><br><span class="line"><span class="comment">// 此时dist文件目录的样式指向node_modules，需要修改配置</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serve</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  bs.<span class="title function_">init</span>(&#123;</span><br><span class="line">    <span class="attr">notify</span>: <span class="literal">false</span>, <span class="comment">// 关闭notify提示</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// 端口</span></span><br><span class="line">    <span class="comment">// open: false, // 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">files</span>: <span class="string">&quot;dist/**&quot;</span>, <span class="comment">// browserSync服务监听的路径通配符，文件发生改变自动刷新浏览器</span></span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">      <span class="attr">baseDir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">      <span class="attr">routes</span>: &#123;</span><br><span class="line">        <span class="comment">// 优先于baseDir，请求发生后会先看routes是否有对应的配置，如果有就走routes配置，否则就走baseDir对应的文件</span></span><br><span class="line">        <span class="string">&quot;/node_modules&quot;</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 键是请求的前缀</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-监视变化以及构建优化"><a href="#Gulp-案例-监视变化以及构建优化" class="headerlink" title="Gulp 案例 - 监视变化以及构建优化"></a>Gulp 案例 - 监视变化以及构建优化</h2><p>使用 gulp 提供的 watch()方法，第一个参数是监听的文件，第二个参数是执行任务</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; watch &#125; = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"><span class="comment">// 服务任务</span></span><br><span class="line"><span class="comment">// 此时dist文件目录的样式指向node_modules，使用路由映射</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serve</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">watch</span>(<span class="string">&quot;src/assets/styles/*.scss&quot;</span>, style);</span><br><span class="line">  <span class="title function_">watch</span>(<span class="string">&quot;src/assets/scripts/*.js&quot;</span>, script);</span><br><span class="line">  <span class="title function_">watch</span>(<span class="string">&quot;src/*.html&quot;</span>, page);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开发阶段对图片、字体不构建，提高构建效率</span></span><br><span class="line">  <span class="comment">// watch(&#x27;src/assets/images/**&#x27;, image)</span></span><br><span class="line">  <span class="comment">// watch(&#x27;src/assets/fonts/**&#x27;, font)</span></span><br><span class="line">  <span class="comment">// watch(&#x27;public/**&#x27;, extra)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 文件变化后自动更新浏览器，浏览器重新发起请求</span></span><br><span class="line">  <span class="title function_">watch</span>(</span><br><span class="line">    [<span class="string">&quot;src/assets/images/**&quot;</span>, <span class="string">&quot;src/assets/fonts/**&quot;</span>, <span class="string">&quot;public/**&quot;</span>],</span><br><span class="line">    bs.<span class="property">reload</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  bs.<span class="title function_">init</span>(&#123;</span><br><span class="line">    <span class="attr">notify</span>: <span class="literal">false</span>, <span class="comment">// 关闭notify提示</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// 端口</span></span><br><span class="line">    <span class="comment">// open: false, // 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">files</span>: <span class="string">&quot;dist/**&quot;</span>, <span class="comment">// browserSync服务监听的路径通配符，文件发生改变自动刷新浏览器</span></span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">      <span class="attr">baseDir</span>: [<span class="string">&quot;dist&quot;</span>, <span class="string">&quot;src&quot;</span>, <span class="string">&quot;public&quot;</span>], <span class="comment">// 如果资源在dist找不到就到src找，还找不到就到public找</span></span><br><span class="line">      <span class="attr">routes</span>: &#123;</span><br><span class="line">        <span class="comment">// 优先于baseDir，请求发生后会先看routes是否有对应的配置，如果有就走routes配置，否则就走baseDir对应的文件</span></span><br><span class="line">        <span class="string">&quot;/node_modules&quot;</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 键是请求的前缀</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-useref-文件引用处理"><a href="#Gulp-案例-useref-文件引用处理" class="headerlink" title="Gulp 案例 - useref 文件引用处理"></a>Gulp 案例 - useref 文件引用处理</h2><p>安装 <code>yarn add gulp-useref --dev</code></p>
<p>把 HTML 文件中的构建注释去除、把构建注释中的内容合并到一个文件（比如上边提到的引用了 node_modules 目录中的文件）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useref</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title function_">src</span>(<span class="string">&quot;dist/*.html&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;dist&quot;</span> &#125;)</span><br><span class="line">      <span class="comment">// 去除HTML文件构建注释、把构建注释的内容合并到一个文件中</span></span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">useref</span>(&#123; <span class="attr">searchPath</span>: [<span class="string">&quot;dist&quot;</span>, <span class="string">&quot;.&quot;</span>] &#125;))</span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>))</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-文件压缩"><a href="#Gulp-案例-文件压缩" class="headerlink" title="Gulp 案例 - 文件压缩"></a>Gulp 案例 - 文件压缩</h2><p>对 html、js、css 压缩</p>
<p>安装插件 <code>yarn add gulp-htmlmin gulp-uglify gulp-clean-css --dev</code></p>
<p>判断读取流的文件使用对应的压缩插件，安装 <code>yarn add gulp-if --dev</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useref</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title function_">src</span>(<span class="string">&quot;dist/*.html&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;dist&quot;</span> &#125;)</span><br><span class="line">      <span class="comment">// 去除HTML文件构建注释、把构建注释的内容合并到一个文件中</span></span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">useref</span>(&#123; <span class="attr">searchPath</span>: [<span class="string">&quot;dist&quot;</span>, <span class="string">&quot;.&quot;</span>] &#125;))</span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.js$/</span>, plugins.<span class="title function_">uglify</span>())) <span class="comment">// 压缩js</span></span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.css$/</span>, plugins.<span class="title function_">cleanCss</span>())) <span class="comment">// 压缩css</span></span><br><span class="line">      .<span class="title function_">pipe</span>(</span><br><span class="line">        plugins.<span class="title function_">if</span>(</span><br><span class="line">          <span class="regexp">/\.html$/</span>,</span><br><span class="line">          plugins.<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">            <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">minifyCSS</span>: <span class="literal">true</span>, <span class="comment">// 把html文件中的style压缩</span></span><br><span class="line">            <span class="attr">minifyJS</span>: <span class="literal">true</span>, <span class="comment">// 把script中的js压缩</span></span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">      ) <span class="comment">// 压缩html</span></span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;release&quot;</span>))</span><br><span class="line">  ); <span class="comment">// 写入到另外一个文件，防止读、写同一个文件引发错乱</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-重新规划构建过程"><a href="#Gulp-案例-重新规划构建过程" class="headerlink" title="Gulp 案例 - 重新规划构建过程"></a>Gulp 案例 - 重新规划构建过程</h2><p>因为 useref 任务导致项目目录结构发生改变，所以构建时先把 html、css、js 文件放到一个临时目录中，开启的服务读取文件也是读取临时目录中的文件；在 useref 任务中把临时目录中的 html、css、js 取出压缩放进最终目录（dist）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">/ 转换样式</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">style</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// base 基准路径，会把src后面的路径保留下来，否则不会按照原本路径输出</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;src/assets/styles/*.scss&#x27;</span>, &#123; <span class="attr">base</span>: <span class="string">&#x27;src&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">sass</span>(&#123; <span class="attr">outputStyle</span>: <span class="string">&#x27;expanded&#x27;</span> &#125;)) <span class="comment">// outputStyle编译后“&#125;”位于后面</span></span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;temp&#x27;</span>))</span><br><span class="line">        .<span class="title function_">page</span>(bs.<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;)) <span class="comment">// 把信息以流的方法推到浏览器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换脚本</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">script</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;src/assets/scripts/*.js&#x27;</span>, &#123; <span class="attr">base</span>: <span class="string">&#x27;src&#x27;</span> &#125;)</span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">babel</span>(&#123; <span class="attr">presets</span>: [<span class="string">&#x27;@babel/preset-env&#x27;</span>] &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;temp&#x27;</span>))</span><br><span class="line">        .<span class="title function_">page</span>(bs.<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换模板</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">page</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果存在子目录：&#x27;src/**/*.html&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;src/*.html&#x27;</span>, &#123; <span class="attr">base</span>: <span class="string">&#x27;src&#x27;</span> &#125;)</span><br><span class="line">        <span class="comment">// data 把数据传入到模板中，渲染对应的数据</span></span><br><span class="line">        <span class="comment">// cache 防止模板缓存导致页面不能及时更新</span></span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">swig</span>(&#123; data, <span class="attr">defaults</span>: &#123; <span class="attr">cache</span>: <span class="literal">false</span> &#125; &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;temp&#x27;</span>))</span><br><span class="line">        .<span class="title function_">page</span>(bs.<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useref</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&#x27;temp/*.html&#x27;</span>, &#123; <span class="attr">base</span>: <span class="string">&#x27;temp&#x27;</span> &#125;)</span><br><span class="line">        <span class="comment">// 去除HTML文件构建注释、把构建注释的内容合并到一个文件中</span></span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">useref</span>(&#123; <span class="attr">searchPath</span>: [<span class="string">&#x27;temp&#x27;</span>, <span class="string">&#x27;.&#x27;</span>] &#125;))</span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.js$/</span>, plugins.<span class="title function_">uglify</span>())) <span class="comment">// 压缩js</span></span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.css$/</span>, plugins.<span class="title function_">cleanCss</span>())) <span class="comment">// 压缩css</span></span><br><span class="line">        .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.html$/</span>, plugins.<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">            <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">minifyCSS</span>: <span class="literal">true</span>, <span class="comment">// 把html文件中的style压缩</span></span><br><span class="line">            <span class="attr">minifyJS</span>: <span class="literal">true</span> <span class="comment">// 把script中的js压缩</span></span><br><span class="line">        &#125;))) <span class="comment">// 压缩html</span></span><br><span class="line">        .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&#x27;dist&#x27;</span>)) <span class="comment">// 写入到另外一个文件，防止读、写同一个文件引发错乱</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="完整构建"><a href="#完整构建" class="headerlink" title="完整构建"></a>完整构建</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; src, dest, parallel, series, watch &#125; = <span class="built_in">require</span>(<span class="string">&quot;gulp&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> del = <span class="built_in">require</span>(<span class="string">&quot;del&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> browserSync = <span class="built_in">require</span>(<span class="string">&quot;browser-sync&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loadPlugins = <span class="built_in">require</span>(<span class="string">&quot;gulp-load-plugins&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自动加载所有的插件</span></span><br><span class="line"><span class="keyword">const</span> plugins = <span class="title function_">loadPlugins</span>(); <span class="comment">// 把‘gulp-’去掉，如果后面有多个‘-’会变为驼峰命名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建服务器</span></span><br><span class="line"><span class="keyword">const</span> bs = browserSync.<span class="title function_">create</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = &#123;</span><br><span class="line">  <span class="attr">menus</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">      <span class="attr">icon</span>: <span class="string">&quot;aperture&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Features&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;features.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;about.html&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Contact&quot;</span>,</span><br><span class="line">      <span class="attr">link</span>: <span class="string">&quot;#&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;Twitter&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;https://twitter.com/w_zce&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;https://weibo.com/zceme&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;divider&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">          <span class="attr">link</span>: <span class="string">&quot;https://github.com/zce&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">pkg</span>: <span class="built_in">require</span>(<span class="string">&quot;./package.json&quot;</span>),</span><br><span class="line">  <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除文件目录</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">clean</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">del</span>([<span class="string">&quot;dist&quot;</span>, <span class="string">&quot;temp&quot;</span>]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">style</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// base 基准路径，会把src后面的路径保留下来，否则不会按照原本路径输出</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/styles/*.scss&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">sass</span>(&#123; <span class="attr">outputStyle</span>: <span class="string">&quot;expanded&quot;</span> &#125;)) <span class="comment">// outputStyle编译后“&#125;”位于后面</span></span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;temp&quot;</span>))</span><br><span class="line">    .<span class="title function_">pipe</span>(bs.<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;)); <span class="comment">// 把信息以流的方法推到浏览器</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">script</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/scripts/*.js&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">babel</span>(&#123; <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>] &#125;))</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;temp&quot;</span>))</span><br><span class="line">    .<span class="title function_">pipe</span>(bs.<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">page</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果存在子目录：&#x27;src/**/*.html&#x27;</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title function_">src</span>(<span class="string">&quot;src/*.html&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">      <span class="comment">// data 把数据传入到模板中，渲染对应的数据</span></span><br><span class="line">      <span class="comment">// cache 防止模板缓存导致页面不能及时更新</span></span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">swig</span>(&#123; data, <span class="attr">defaults</span>: &#123; <span class="attr">cache</span>: <span class="literal">false</span> &#125; &#125;)) <span class="comment">// 防止模板缓存导致页面不能及时更新</span></span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;temp&quot;</span>))</span><br><span class="line">      .<span class="title function_">pipe</span>(bs.<span class="title function_">reload</span>(&#123; <span class="attr">stream</span>: <span class="literal">true</span> &#125;))</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩图片</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">image</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/images/**&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">imagemin</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 压缩字体</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">font</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;src/assets/fonts/**&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;src&quot;</span> &#125;)</span><br><span class="line">    .<span class="title function_">pipe</span>(plugins.<span class="title function_">imagemin</span>())</span><br><span class="line">    .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换其他文件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">extra</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 转换其他文件</span></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">src</span>(<span class="string">&quot;public/**&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;public&quot;</span> &#125;).<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 服务任务</span></span><br><span class="line"><span class="comment">// 此时dist文件目录的样式指向node_modules，需要修改配置</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">serve</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">watch</span>(<span class="string">&quot;src/assets/styles/*.scss&quot;</span>, style);</span><br><span class="line">  <span class="title function_">watch</span>(<span class="string">&quot;src/assets/scripts/*.js&quot;</span>, script);</span><br><span class="line">  <span class="title function_">watch</span>(<span class="string">&quot;src/*.html&quot;</span>, page);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开发阶段对图片、字体不构建，提高构建效率</span></span><br><span class="line">  <span class="comment">// watch(&#x27;src/assets/images/**&#x27;, image)</span></span><br><span class="line">  <span class="comment">// watch(&#x27;src/assets/fonts/**&#x27;, font)</span></span><br><span class="line">  <span class="comment">// watch(&#x27;public/**&#x27;, extra)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 文件变化后自动更新浏览器，浏览器重新发起请求</span></span><br><span class="line">  <span class="title function_">watch</span>(</span><br><span class="line">    [<span class="string">&quot;src/assets/images/**&quot;</span>, <span class="string">&quot;src/assets/fonts/**&quot;</span>, <span class="string">&quot;public/**&quot;</span>],</span><br><span class="line">    bs.<span class="property">reload</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  bs.<span class="title function_">init</span>(&#123;</span><br><span class="line">    <span class="attr">notify</span>: <span class="literal">false</span>, <span class="comment">// 关闭notify提示</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">8080</span>, <span class="comment">// 端口</span></span><br><span class="line">    <span class="comment">// open: false, // 是否自动打开浏览器</span></span><br><span class="line">    <span class="attr">files</span>: <span class="string">&quot;dist/**&quot;</span>, <span class="comment">// browserSync服务监听的路径通配符，文件发生改变自动刷新浏览器</span></span><br><span class="line">    <span class="attr">server</span>: &#123;</span><br><span class="line">      <span class="attr">baseDir</span>: [<span class="string">&quot;temp&quot;</span>, <span class="string">&quot;src&quot;</span>, <span class="string">&quot;public&quot;</span>], <span class="comment">// 如果资源在dist找不到就到src找，还找不到就到public找</span></span><br><span class="line">      <span class="attr">routes</span>: &#123;</span><br><span class="line">        <span class="comment">// 优先于baseDir，请求发生后会先看routes是否有对应的配置，如果有就走routes配置，否则就走baseDir对应的文件</span></span><br><span class="line">        <span class="string">&quot;/node_modules&quot;</span>: <span class="string">&quot;node_modules&quot;</span>, <span class="comment">// 键是请求的前缀</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useref</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="title function_">src</span>(<span class="string">&quot;temp/*.html&quot;</span>, &#123; <span class="attr">base</span>: <span class="string">&quot;temp&quot;</span> &#125;)</span><br><span class="line">      <span class="comment">// 去除HTML文件构建注释、把构建注释的内容合并到一个文件中</span></span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">useref</span>(&#123; <span class="attr">searchPath</span>: [<span class="string">&quot;temp&quot;</span>, <span class="string">&quot;.&quot;</span>] &#125;))</span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.js$/</span>, plugins.<span class="title function_">uglify</span>())) <span class="comment">// 压缩js</span></span><br><span class="line">      .<span class="title function_">pipe</span>(plugins.<span class="title function_">if</span>(<span class="regexp">/\.css$/</span>, plugins.<span class="title function_">cleanCss</span>())) <span class="comment">// 压缩css</span></span><br><span class="line">      .<span class="title function_">pipe</span>(</span><br><span class="line">        plugins.<span class="title function_">if</span>(</span><br><span class="line">          <span class="regexp">/\.html$/</span>,</span><br><span class="line">          plugins.<span class="title function_">htmlmin</span>(&#123;</span><br><span class="line">            <span class="attr">collapseWhitespace</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">minifyCSS</span>: <span class="literal">true</span>, <span class="comment">// 把html文件中的style压缩</span></span><br><span class="line">            <span class="attr">minifyJS</span>: <span class="literal">true</span>, <span class="comment">// 把script中的js压缩</span></span><br><span class="line">          &#125;)</span><br><span class="line">        )</span><br><span class="line">      ) <span class="comment">// 压缩html</span></span><br><span class="line">      .<span class="title function_">pipe</span>(<span class="title function_">dest</span>(<span class="string">&quot;dist&quot;</span>))</span><br><span class="line">  ); <span class="comment">// 写入到另外一个文件，防止读、写同一个文件引发错乱</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 并行执行任务</span></span><br><span class="line"><span class="keyword">const</span> compile = <span class="title function_">parallel</span>(style, script, page);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 串行执行任务，上线前执行的任务</span></span><br><span class="line"><span class="keyword">const</span> build = <span class="title function_">series</span>(</span><br><span class="line">  clean,</span><br><span class="line">  <span class="title function_">parallel</span>(<span class="title function_">series</span>(compile, useref), image, font, extra)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> develop = <span class="title function_">series</span>(compile, serve);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  clean,</span><br><span class="line">  build,</span><br><span class="line">  develop,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Gulp-案例-补充"><a href="#Gulp-案例-补充" class="headerlink" title="Gulp 案例 - 补充"></a>Gulp 案例 - 补充</h2><ul>
<li>不需要全部任务都导出，只需要导出部分用到的就行</li>
<li>把任务写入到 package.json 文件中的 scripts 属性</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;clean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gulp clean&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gulp build&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;gulp develop&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>

<h2 id="封装工作流-提取-gulpfile"><a href="#封装工作流-提取-gulpfile" class="headerlink" title="封装工作流 - 提取 gulpfile"></a>封装工作流 - 提取 gulpfile</h2><ul>
<li>把 gulp 构建文件封装打包为模块发布到 npm</li>
<li>如果模块还在本地没有发布到 npm 可以使用 <code>yarn link</code> 的方式把构建模块 link 到全局，然后在项目中 <code>yarn link zce-pages (脚手架名)</code> 的方式安装进项目（相当于 yarn add xxx）</li>
<li>如果有不应该提取到 gulp 构建模块的内容，应把它们抽离到项目配置文件（约定文件名），然后 gulp 构建模块读取该配置文件<ul>
<li>在 gulp 构建模块中获取抽离的配置，process.cwd()返回当前命令行所在的工作目录</li>
</ul>
</li>
<li>如果报 babel 相关的错误，如@babel&#x2F;preset-env，因为 gulp 构建模块使用 babel 转换语法，@babel&#x2F;preset-env 会查找根目录的 node_modules 目录中的@babel&#x2F;preset-env 模块，所以就报错；可以在 gulp 构建模块 javascript 任务的 babel 修改为 <code>&#123;presets: [require(&#39;@babel/preset-env&#39;)]&#125;</code></li>
<li>如果是通过 link 到全局的话，在构建项目时会报 gulp gulp-cli 相关的错误，是因为构建时在 node_modules 找不到 gulp 相关的命令，这时可以先在项目中安装依赖 <code>yarn add gulp gulp-cli --dev</code></li>
<li>在入口文件 gulpfile.js 导入 gulp 构建模块</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="built_in">require</span>(<span class="string">&quot;zce-pages&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="封装工作流-抽象路径配置"><a href="#封装工作流-抽象路径配置" class="headerlink" title="封装工作流 - 抽象路径配置"></a>封装工作流 - 抽象路径配置</h2><p>封装的 gulp 构建模块中任务使用的路径应该可配置，使任务中的文件路径可根据开发者配置<br>模块中默认路径配置；在开发项目中也可以传入该配置，让封装的 gulp 构建模块灵活</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build</span>: &#123;</span><br><span class="line">  <span class="attr">src</span>: <span class="string">&#x27;src&#x27;</span>,</span><br><span class="line">  <span class="attr">dist</span>: <span class="string">&#x27;dist&#x27;</span>,</span><br><span class="line">  <span class="attr">temp</span>: <span class="string">&#x27;temp&#x27;</span>,</span><br><span class="line">  <span class="attr">public</span>: <span class="string">&#x27;public&#x27;</span>,</span><br><span class="line">  <span class="attr">paths</span>: &#123;</span><br><span class="line">   <span class="attr">styles</span>: <span class="string">&#x27;assets/styles/*.scss&#x27;</span>,</span><br><span class="line">    <span class="attr">scripts</span>: <span class="string">&#x27;assets/scripts/*.js&#x27;</span>,</span><br><span class="line">    <span class="attr">pages</span>: <span class="string">&#x27;*.html&#x27;</span>,</span><br><span class="line">    <span class="attr">images</span>: <span class="string">&#x27;assets/images/**&#x27;</span>,</span><br><span class="line">    <span class="attr">fonts</span>: <span class="string">&#x27;assets/fonts/**&#x27;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="封装工作流-包装-Gulp-CLI"><a href="#封装工作流-包装-Gulp-CLI" class="headerlink" title="封装工作流 - 包装 Gulp CLI"></a>封装工作流 - 包装 Gulp CLI</h2><p>在 gulp 构建模块添加一个 cli，在 cli 里自动传递参数(参数：–gulpfile)： <code>yarn gulp build --gulpfile</code>，然后在内部调用 gulp 提供的可执行程序</p>
<ul>
<li>在模块根目录新建目录 bin，在目录下新建 js 文件作为 cli 的入口，入口文件的文件头需要添加 <code>#!/usr/bin/env node</code></li>
<li>在 package.json 文件中添加‘bin’字段，值为该入口文件路径</li>
<li>把 gulp 的调用和传入的参数放在该文件中</li>
<li>在 window 系统执行 gulp 构建命令，会去 node_modules 下的.bin 目录下的 gulp.cmd 文件，如下代码；在该文件中根据判断执行当前目录外面的 gulp-cli&#x2F;bin&#x2F;gulp.js，该文件就 <code>require (&#39;gulp-cli&#39;)()</code>，所以我们只需在入口文件中引入这个 gulp.js： <code>require(&#39;gulp/bin/gulp&#39;)</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// %~dp0: 当前目录</span></span><br><span class="line">@<span class="variable constant_">IF</span> <span class="variable constant_">EXIST</span> <span class="string">&quot;%~dp0\node.exe&quot;</span> (</span><br><span class="line">  <span class="string">&quot;%~dp0\node.exe&quot;</span>  <span class="string">&quot;%~dp0\..\gulp-cli\bin\gulp.js&quot;</span> %*</span><br><span class="line">) <span class="variable constant_">ELSE</span> (</span><br><span class="line">  @<span class="variable constant_">SETLOCAL</span></span><br><span class="line">  @<span class="variable constant_">SET</span> <span class="variable constant_">PATHEXT</span>=%<span class="attr">PATHEXT</span>:;.<span class="property">JS</span>;=;%</span><br><span class="line">  node  <span class="string">&quot;%~dp0\..\gulp-cli\bin\gulp.js&quot;</span> %*</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>接下来要指定 gulpfile 和 cmd 路径，命令行传递的产生可以通过<code>process.argv</code>获取，该属性返回一个数组</li>
<li>从中可以看出<code>gulp-cli</code>是通过<code>process.argv</code>拿到参数的，可以在代码运行前 push 需要传递的参数</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 入口文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 参数cwd：告诉gulp工作目录是命令行所在的目录</span></span><br><span class="line">process.<span class="property">argv</span>.<span class="title function_">push</span>(<span class="string">&quot;--cwd&quot;</span>);</span><br><span class="line">process.<span class="property">argv</span>.<span class="title function_">push</span>(process.<span class="title function_">cwd</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// gulpfile：告诉gulp gulpfile的目录</span></span><br><span class="line">process.<span class="property">argv</span>.<span class="title function_">push</span>(<span class="string">&quot;--gulpfile&quot;</span>);</span><br><span class="line">process.<span class="property">argv</span>.<span class="title function_">push</span>(<span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&quot;..&quot;</span>));</span><br><span class="line"><span class="comment">// require：载入模块</span></span><br><span class="line"><span class="comment">// resolve：找到模块所对应的路径；这里传递‘..’它会找到package.json中的bin字段对应的文件</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;gulp/bin/gulp&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这时把该构建模块安装在项目，项目中就不在需要 gulpfile.js 文件</p>
<h2 id="封装工作流-发布并使用模块"><a href="#封装工作流-发布并使用模块" class="headerlink" title="封装工作流 - 发布并使用模块"></a>封装工作流 - 发布并使用模块</h2><ul>
<li>在发布 npm 时会把项目根目录的文件和 package.json 中的 files 字段中的目录发布到 npm 仓库，所以要在 files 字段添加一个 cli 入口目录 bin，然后<code>yarn publish --registry https ://registry.yarnpkg.com</code> 推到 npm 仓库</li>
<li>在新项目中安装发布的模块，如果发布时间和安装时间间距短可能会安装到的是老版本，因为国能的镜像同步 npm 原地址需要时间，可以在淘宝镜像中搜索发布的模块，然后点击 <code>SYNC</code></li>
<li>在项目中执行 <code>yarn zce-pages build</code>就可以构建项目了，<code>zce-pages</code> 是发布到 npm 的模块名</li>
<li>也可以在项目的 package.json 文件中的 scripts 字段添加命令</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;clean&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zce-pages clean&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zce-pages build&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;develop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zce-pages develop&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/10/25/%E8%84%9A%E6%89%8B%E6%9E%B6/" rel="prev" title="脚手架">
                  <i class="fa fa-chevron-left"></i> 脚手架
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/11/02/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%E5%8C%96/" rel="next" title="代码规范化">
                  代码规范化 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zax Tseng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
