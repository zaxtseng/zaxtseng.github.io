<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>微信小程序入门 | ZAX</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="小程序的文件结构app.js: 设置一些项目的全局变量 app.json: 每一个新页面都必须在这个页面注册 app.wxss: 项目全局样式 project.config.json: 项目配置文件 一个页面主要是包含以下四个文件，这四个文件的名字应该都是一样的，最好以页面所在的文件夹名字为标准： xxx.wxml: 页面结构 xxx.wxss: 页面样式 xxx.json: 页面配置文件 xxx">
<meta property="og:type" content="article">
<meta property="og:title" content="微信小程序入门">
<meta property="og:url" content="http://example.com/2019/10/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="ZAX">
<meta property="og:description" content="小程序的文件结构app.js: 设置一些项目的全局变量 app.json: 每一个新页面都必须在这个页面注册 app.wxss: 项目全局样式 project.config.json: 项目配置文件 一个页面主要是包含以下四个文件，这四个文件的名字应该都是一样的，最好以页面所在的文件夹名字为标准： xxx.wxml: 页面结构 xxx.wxss: 页面样式 xxx.json: 页面配置文件 xxx">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-10-10T11:22:41.000Z">
<meta property="article:modified_time" content="2022-11-01T09:55:44.553Z">
<meta property="article:author" content="Zax Tseng">
<meta property="article:tag" content="小程序">
<meta property="article:tag" content="基础">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ZAX" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ZAX</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-微信小程序入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/10/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A5%E9%97%A8/" class="article-date">
  <time datetime="2019-10-10T11:22:41.000Z" itemprop="datePublished">2019-10-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      微信小程序入门
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="小程序的文件结构"><a href="#小程序的文件结构" class="headerlink" title="小程序的文件结构"></a>小程序的文件结构</h1><p><code>app.js</code>: 设置一些项目的全局变量</p>
<p><code>app.json</code>: 每一个新页面都必须在这个页面注册</p>
<p><code>app.wxss</code>: 项目全局样式</p>
<p><code>project.config.json</code>: 项目配置文件</p>
<p>一个页面主要是包含以下四个文件，这四个文件的名字应该都是一样的，最好以页面所在的文件夹名字为标准：</p>
<p><code>xxx.wxml</code>: 页面结构</p>
<p><code>xxx.wxss</code>: 页面样式</p>
<p><code>xxx.json</code>: 页面配置文件</p>
<p><code>xxx.js</code>: 页面脚本文件</p>
<p>通过新建目录,新建 component.可以快速建立上述同名称文件.</p>
<p>页面可以嵌套,但不能超过 5 个层级.</p>
<p><code>app.json</code>中<code>tabBar</code>可以设置导航栏颜色背景,下属的<code>list</code>中可以设置下标按钮的信息.</p>
<h1 id="设备分辨率和-RPX"><a href="#设备分辨率和-RPX" class="headerlink" title="设备分辨率和 RPX"></a>设备分辨率和 RPX</h1><p>pt: 视觉单位.与屏幕的物理尺寸有关系,也叫做逻辑分辨率,与移动端的栅格渲染有关.</p>
<p>px: 像素点,物理分辨率.随着屏幕变化不会变化.一般设计稿以 px 为单位.iphone6 的分辨率是 375,设计稿一般是 750,那么</p>
<p>rpx : px &#x3D; 2:1.</p>
<p>rpx 是响应式像素,可以根据屏幕宽度进行自适应。规定屏幕宽为 750rpx.</p>
<p>当需要的元素大小适应屏幕尺寸，就选择 rpx 作为单位，否则使用 px 作为单位。</p>
<h1 id="小程序的事件"><a href="#小程序的事件" class="headerlink" title="小程序的事件"></a>小程序的事件</h1><p>冒泡事件: 当一个组件上的事件被触发,该事件会向父节点传递.</p>
<p>非冒泡事件: 与之相反,不向父节点传递.</p>
<h2 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h2><p>key 以 bind 或者 catch 开头,然后跟上事件的类型,如<code>bindtap</code>,<code>catchtouchstart</code>.</p>
<p>value 是一个字符串,需要在对应的 page 中定义同名的函数,不然当触发时会报错.</p>
<p><strong>区别</strong>: bind 事件绑定不会阻止冒泡事件向上冒泡,catch 事件绑定可以阻止.</p>
<h2 id="下拉刷新"><a href="#下拉刷新" class="headerlink" title="下拉刷新"></a>下拉刷新</h2><p>监听用户下拉刷新事件</p>
<ol>
<li>在 app.json 的 window 选项或者页面配置中开启<code>enablePullDownRefresh</code>.</li>
<li>可以通过<code>wx.startPullDownRefresh</code>触发下拉刷新,调用后触发下拉刷新动画.</li>
<li>当处理完数据刷新后,<code>wx.stopPullDownRefresh</code>可以停止当前页面的下拉刷新.</li>
</ol>
<h2 id="小程序更新数据的值"><a href="#小程序更新数据的值" class="headerlink" title="小程序更新数据的值"></a>小程序更新数据的值</h2><p>函数用于将数据从逻辑层更新到视图层(异步)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setData</span>(object data, <span class="keyword">function</span> callback)</span><br></pre></td></tr></table></figure>

<p><code>data</code>: 传一个 object,是这次要改变的数据</p>
<p><code>callback</code>: 传一个 function,是 setData 引起页面更新渲染完毕后的回调函数</p>
<p>&#x2F;&#x2F;赋值的方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">arr</span>: <span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">arr</span> &#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小程序中 push 方法基本失效.</p>
</blockquote>
<h2 id="改变-object-中的值"><a href="#改变-object-中的值" class="headerlink" title="改变 object 中的值"></a>改变 object 中的值</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="string">&quot;obj.text&quot;</span>: <span class="string">&quot;message2&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h1 id="小程序的路由方式"><a href="#小程序的路由方式" class="headerlink" title="小程序的路由方式"></a>小程序的路由方式</h1><p>打开新页面: <code>wx.navigateTo</code> 或使用组件<code>&lt;navigator open-type=&quot;navigateTo&quot; /&gt;</code></p>
<p>页面重定向: <code>wx.redirectTo</code> 或使用组件<code>&lt;navigator open-type=&quot;redirectTo&quot;/&gt;</code></p>
<p>压面返回: <code>wx.navigateBack</code> 或使用组件<code>&lt;navigator open-type=&quot;navigateBack&quot;/&gt;</code></p>
<p>Tab 切换: <code>wx.switchTab</code>或使用组件<code>&lt;navigator open-type=&quot;switchTab&quot;/&gt;</code></p>
<p>重启动: <code>wx.reLauch</code>或使用组件<code>&lt;navigator open-type=&quot;reLauch&quot;/&gt;</code></p>
<h1 id="小程序请求接口方式"><a href="#小程序请求接口方式" class="headerlink" title="小程序请求接口方式"></a>小程序请求接口方式</h1><p>HTTPS 请求: <code>wx.request</code></p>
<p>上传文件: <code>wx.uploadFile</code></p>
<p>下载文件: <code>wx.downloadFile</code></p>
<p>webSocket 通信: <code>wx.connectSocket</code></p>
<h1 id="小程序的生命周期"><a href="#小程序的生命周期" class="headerlink" title="小程序的生命周期"></a>小程序的生命周期</h1><p><code>onLoad</code>: 页面加载时触发.一个页面只会调用一次.可以在<code>onLoad</code>的参数中获取打开当前页面路径中的参数</p>
<p><code>onShow</code>: 页面显示&#x2F;切入前台时触发</p>
<p><code>onReady</code>: 页面初次渲染时触发.一个页面只调用一次.</p>
<p><code>onHide</code>: 页面隐藏&#x2F;切入后台时触发.如<code>navigateTo</code>或底部 tab 切换到其他页面,小程序切入后台.</p>
<p><code>onUnload</code>: 页面卸载时触发.如<code>navigateTo</code>或<code>navigateBack</code>时触发.</p>
<h1 id="组件通信"><a href="#组件通信" class="headerlink" title="组件通信"></a>组件通信</h1><p>父传子: <code>properties</code></p>
<p>子传父: <code>triggerEvent(&#39;自定义事件名&#39;, &#123;&#125;)</code></p>
<h1 id="AppID-小程序-ID"><a href="#AppID-小程序-ID" class="headerlink" title="AppID(小程序 ID)"></a>AppID(小程序 ID)</h1><p>也是开发者 ID,路径:</p>
<p>微信公众平台-小程序-开发-开发设置</p>
<h1 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h1><p>微信小程序采用自有的标签,但是基本和 h5 标签有对应</p>
<table>
<thead>
<tr>
<th>小程序标签</th>
<th>h5 标签</th>
</tr>
</thead>
<tbody><tr>
<td>view</td>
<td>div</td>
</tr>
<tr>
<td>text</td>
<td>span</td>
</tr>
<tr>
<td>scroll-view</td>
<td>可以滚动的 div</td>
</tr>
</tbody></table>
<h1 id="数据绑定"><a href="#数据绑定" class="headerlink" title="数据绑定"></a>数据绑定</h1><p>数据绑定采用双大括号语法.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;view&gt;&#123;&#123; message &#125;&#125;&lt;/view&gt;</span><br></pre></td></tr></table></figure>

<p>数据来自对应<code>Page</code>的 data 中.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="组件属性-需要在双大括号内"><a href="#组件属性-需要在双大括号内" class="headerlink" title="组件属性(需要在双大括号内)"></a>组件属性(需要在双大括号内)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;view id=<span class="string">&quot;item-&#123;&#123;id&#125;&#125;&quot;</span>&gt;&lt;/view&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h1><p><code>wx: if=&quot;&#123;&#123;判断传入的文本用双括号&#125;&#125;&quot;</code></p>
<p><code>wx: else=&quot;&#123;&#123;判断传入的文本用双括号&#125;&#125;&quot;</code></p>
<h2 id="wx-if-和hidden"><a href="#wx-if-和hidden" class="headerlink" title="wx: if 和hidden"></a><code>wx: if</code> 和<code>hidden</code></h2><p>类似于<code>v-if</code>和<code>v-show</code>,<code>hidden</code>是始终渲染的,<code>wx: if</code>只有为<code>true</code>才渲染.</p>
<h1 id="列表渲染"><a href="#列表渲染" class="headerlink" title="列表渲染"></a>列表渲染</h1><p><code>wx: for</code></p>
<p>在组件上使用 <code>wx:for</code> 控制属性绑定一个数组，即可使用数组中各项的数据重复渲染该组件。</p>
<p>默认数组的当前项的下标变量名默认为 <code>index</code>，数组当前项的变量名默认为 <code>item</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;view <span class="attr">wx</span>:<span class="keyword">for</span>=<span class="string">&quot;&#123;&#123;array&#125;&#125;&quot;</span>&gt;</span><br><span class="line">  &#123;&#123;index&#125;&#125;: &#123;&#123;item.<span class="property">message</span>&#125;&#125;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">array</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;bar&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>使用 <code>wx:for-item</code> 可以指定数组当前元素的变量名，</p>
<p>使用 <code>wx:for-index</code> 可以指定数组当前下标的变量名：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;view <span class="attr">wx</span>:<span class="keyword">for</span>=<span class="string">&quot;&#123;&#123;array&#125;&#125;&quot;</span> <span class="attr">wx</span>:<span class="keyword">for</span>-index=<span class="string">&quot;idx&quot;</span> <span class="attr">wx</span>:<span class="keyword">for</span>-item=<span class="string">&quot;itemName&quot;</span>&gt;</span><br><span class="line">  &#123;&#123;idx&#125;&#125;: &#123;&#123;itemName.<span class="property">message</span>&#125;&#125;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意: 当 <code>wx:for</code> 的值为字符串时，会将字符串解析成字符串数组.</p>
</blockquote>
<p>花括号和引号之间如果有空格，将最终被解析成为字符串.</p>
<h1 id="wx-key"><a href="#wx-key" class="headerlink" title="wx:key"></a><code>wx:key</code></h1><p>wx:key 的值以两种形式提供</p>
<ol>
<li>字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。</li>
</ol>
<blockquote>
<p>key 是字符串,所以不用双大括号.<code>item</code>是默认值,可以不加.</p>
</blockquote>
<ol start="2">
<li>保留关键字 *this 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字，如：</li>
</ol>
<p>当数据改变触发渲染层重新渲染的时候，会校正带有 key 的组件，框架会确保他们被重新排序，而不是重新创建，以确保使组件保持自身的状态，并且提高列表渲染时的效率。</p>
<h1 id="组件中的样式"><a href="#组件中的样式" class="headerlink" title="组件中的样式"></a>组件中的样式</h1><p>组件对应 wxss 文件的样式，只对组件 wxml 内的节点生效。编写组件样式时，需要注意以下几点：</p>
<p>组件和引用组件的页面不能使用 id 选择器（#a）、属性选择器（[a]）和标签名选择器，请改用 class 选择器。</p>
<p>组件和引用组件的页面中使用后代选择器（.a .b）在一些极端情况下会有非预期的表现，如遇，请避免使用。</p>
<p>子元素选择器（.a&gt;.b）只能用于 view 组件与其子节点之间，用于其他组件可能导致非预期的情况。</p>
<p>继承样式，如 font 、 color ，会从组件外继承到组件内。</p>
<p>除继承样式外， app.wxss 中的样式、组件所在页面的的样式对自定义组件无效（除非更改组件样式隔离选项）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#a &#123; &#125; <span class="comment">/* 在组件中不能使用 */</span></span><br><span class="line">[a] &#123; &#125; <span class="comment">/* 在组件中不能使用 */</span></span><br><span class="line">button &#123; &#125; <span class="comment">/* 在组件中不能使用 */</span></span><br><span class="line">.<span class="property">a</span> &gt; .<span class="property">b</span> &#123; &#125; <span class="comment">/* 除非 .a 是 view 组件节点，否则不一定会生效 */</span></span><br></pre></td></tr></table></figure>

<p>除此以外，组件可以指定它所在节点的默认样式，使用 <code>:host</code> 选择器（需要包含基础库 1.7.2 或更高版本的开发者工具支持）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 组件 custom-component.wxss */</span></span><br><span class="line">:host &#123;</span><br><span class="line">  <span class="attr">color</span>: yellow;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 页面的 <span class="variable constant_">WXML</span> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">custom-component</span>&gt;</span>这段文本是黄色的<span class="tag">&lt;/<span class="name">custom-component</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h1 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h1><p>WXML 提供模板（template），可以在模板中定义代码片段，然后在不同的地方调用。</p>
<p>##定义模板</p>
<p>使用 <code>name</code>属性，作为模板的名字。然后在<code>&lt;template/&gt;</code>内定义代码片段，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;template name=<span class="string">&quot;msgItem&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;&#123; index &#125;&#125;: &#123;&#123; msg &#125;&#125;&#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">text</span>&gt;</span> Time: &#123;&#123; time &#125;&#125; <span class="tag">&lt;/<span class="name">text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure>

<h2 id="使用模板"><a href="#使用模板" class="headerlink" title="使用模板"></a>使用模板</h2><p>使用<code>is</code>属性,声明需要的使用模板,然后将模板所需要的 data 传入,</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;template is=<span class="string">&quot;msgItem&quot;</span> data=<span class="string">&quot;&#123;&#123;..item&#125;&#125;&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">item</span>: &#123;</span><br><span class="line">      <span class="attr">index</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;this is a template&quot;</span>,</span><br><span class="line">      <span class="attr">time</span>: <span class="string">&quot;2019-11-11&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>is</code>属性可以用双大括号,来动态决定渲染哪个模板.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;template name=<span class="string">&quot;odd&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">view</span>&gt;</span> odd<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">name</span>=<span class="string">&quot;even&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">view</span>&gt;</span> even <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;[1,2,3,4,5]&#125;&#125;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">is</span>=<span class="string">&quot;&#123;&#123;item % 2 == 0 ? &#x27;even&#x27; : &#x27;odd&#x27;&#125;&#125;&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">block</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h2 id="模板的作用域"><a href="#模板的作用域" class="headerlink" title="模板的作用域"></a>模板的作用域</h2><p>模板拥有自己的作用域，只能使用 <code>data</code> 传入的数据以及模板定义文件中定义的 <code>&lt;wxs /&gt;</code> 模块。</p>
<h1 id="WXS语法-WeiXin-Script"><a href="#WXS语法-WeiXin-Script" class="headerlink" title="WXS语法(WeiXin Script)"></a><code>WXS</code>语法(<code>WeiXin Script</code>)</h1><ol>
<li>WXS 不依赖于运行时的基础库版本，可以在所有版本的小程序中运行。</li>
<li>WXS 与 JavaScript 是不同的语言，有自己的语法，并不和 JavaScript 一致。</li>
<li>WXS 的运行环境和其他 JavaScript 代码是隔离的，WXS 中不能调用其他 JavaScript 文件中定义的函数，也不能调用小程序提供的 API。</li>
<li>WXS 函数不能作为组件的事件回调。</li>
<li>由于运行环境的差异，在 iOS 设备上小程序内的 WXS 会比 JavaScript 代码快 2 ~ 20 倍。在 android 设备上二者运行效率无差异</li>
</ol>
<h1 id="封装小程序-wx-request"><a href="#封装小程序-wx-request" class="headerlink" title="封装小程序 wx.request"></a>封装小程序 wx.request</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 官方例子</span></span><br><span class="line">wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;test.php&quot;</span>, <span class="comment">//仅为示例，并非真实的接口地址</span></span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">y</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">header</span>: &#123;</span><br><span class="line">    <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="comment">// 默认值</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>Promsie 封装</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> baseUrl = <span class="string">&quot;https://api.it120.cc&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">http</span> = (<span class="params">&#123; url = <span class="string">&quot;&quot;</span>, param = &#123;&#125;, ...other &#125; = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  wx.<span class="title function_">showLoading</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;请求中，请耐心等待..&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">let</span> timeStart = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: <span class="title function_">getUrl</span>(url),</span><br><span class="line">      <span class="attr">data</span>: param,</span><br><span class="line">      <span class="attr">header</span>: &#123;</span><br><span class="line">        <span class="string">&quot;content-type&quot;</span>: <span class="string">&quot;application/json&quot;</span>, <span class="comment">// 默认值 ,另一种是 &quot;content-type&quot;: &quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      ...other,</span><br><span class="line">      <span class="attr">complete</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        wx.<span class="title function_">hideLoading</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`耗时<span class="subst">$&#123;<span class="built_in">Date</span>.now() - timeStart&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">statusCode</span> &gt;= <span class="number">200</span> &amp;&amp; res.<span class="property">statusCode</span> &lt; <span class="number">300</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(res.<span class="property">data</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(res);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getUrl</span> = (<span class="params">url</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (url.<span class="title function_">indexOf</span>(<span class="string">&quot;://&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">    url = baseUrl + url;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> url;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// get方法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_get</span> = (<span class="params">url, param = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">http</span>(&#123;</span><br><span class="line">    url,</span><br><span class="line">    param,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_post</span> = (<span class="params">url, param = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">http</span>(&#123;</span><br><span class="line">    url,</span><br><span class="line">    param,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_put</span> = (<span class="params">url, param = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">http</span>(&#123;</span><br><span class="line">    url,</span><br><span class="line">    param,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;put&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">_delete</span> = (<span class="params">url, param = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">http</span>(&#123;</span><br><span class="line">    url,</span><br><span class="line">    param,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;put&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  baseUrl,</span><br><span class="line">  _get,</span><br><span class="line">  _post,</span><br><span class="line">  _put,</span><br><span class="line">  _delete,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>使用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> api = <span class="built_in">require</span>(<span class="string">&quot;../../utils/api.js&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 单个请求</span></span><br><span class="line">api</span><br><span class="line">  .<span class="title function_">get</span>(<span class="string">&quot;list&quot;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一个页面多个请求</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([api.<span class="title function_">get</span>(<span class="string">&quot;list&quot;</span>), api.<span class="title function_">get</span>(<span class="string">`detail/<span class="subst">$&#123;id&#125;</span>`</span>)])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(e);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>登录</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//app.js</span></span><br><span class="line"><span class="title class_">App</span>(&#123;</span><br><span class="line">  <span class="attr">onLaunch</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;App onLaunch&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="comment">//  获取商城名称</span></span><br><span class="line">    wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>:</span><br><span class="line">        <span class="string">&quot;https://api.it120.cc/&quot;</span> +</span><br><span class="line">        that.<span class="property">globalData</span>.<span class="property">subDomain</span> +</span><br><span class="line">        <span class="string">&quot;/config/get-value&quot;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;</span><br><span class="line">        <span class="attr">key</span>: <span class="string">&quot;mallName&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        wx.<span class="title function_">setStorageSync</span>(<span class="string">&quot;mallName&quot;</span>, res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">value</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">login</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUserInfo</span>();</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">login</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">var</span> token = that.<span class="property">globalData</span>.<span class="property">token</span>;</span><br><span class="line">    <span class="comment">// 如果有token</span></span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="comment">// 检查token是否有效</span></span><br><span class="line">      wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:</span><br><span class="line">          <span class="string">&quot;https://api.it120.cc/&quot;</span> +</span><br><span class="line">          that.<span class="property">globalData</span>.<span class="property">subDomain</span> +</span><br><span class="line">          <span class="string">&quot;/user/check-token&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: &#123;</span><br><span class="line">          <span class="attr">token</span>: token,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">          <span class="comment">// 如果token失效了</span></span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">code</span> != <span class="number">0</span>) &#123;</span><br><span class="line">            that.<span class="property">globalData</span>.<span class="property">token</span> = <span class="literal">null</span>;</span><br><span class="line">            that.<span class="title function_">login</span>(); <span class="comment">// 重新登陆</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 【1】调用微信自带登陆</span></span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="comment">// 【2】 拿到code去访问我们的后台换取其他信息</span></span><br><span class="line">        wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">          <span class="attr">url</span>:</span><br><span class="line">            <span class="string">&quot;https://api.it120.cc/&quot;</span> +</span><br><span class="line">            that.<span class="property">globalData</span>.<span class="property">subDomain</span> +</span><br><span class="line">            <span class="string">&quot;/user/wxapp/login&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>: &#123;</span><br><span class="line">            <span class="attr">code</span>: res.<span class="property">code</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果说这个code失效的</span></span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">code</span> == <span class="number">10000</span>) &#123;</span><br><span class="line">              <span class="comment">// 去注册</span></span><br><span class="line">              that.<span class="title function_">registerUser</span>();</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果返回失败了</span></span><br><span class="line">            <span class="keyword">if</span> (res.<span class="property">data</span>.<span class="property">code</span> != <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">// 登录错误</span></span><br><span class="line">              wx.<span class="title function_">hideLoading</span>();</span><br><span class="line">              <span class="comment">// 提示无法登陆</span></span><br><span class="line">              wx.<span class="title function_">showModal</span>(&#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;提示&quot;</span>,</span><br><span class="line">                <span class="attr">content</span>: <span class="string">&quot;无法登录，请重试&quot;</span>,</span><br><span class="line">                <span class="attr">showCancel</span>: <span class="literal">false</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 【3】 如果成功后设置token到本地</span></span><br><span class="line">            that.<span class="property">globalData</span>.<span class="property">token</span> = res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">token</span>;</span><br><span class="line">            <span class="comment">// 保存用户信息</span></span><br><span class="line">            wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">              <span class="attr">key</span>: <span class="string">&quot;token&quot;</span>,</span><br><span class="line">              <span class="attr">data</span>: res.<span class="property">data</span>.<span class="property">data</span>.<span class="property">token</span>,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 注册？？ [这个看需求]</span></span><br><span class="line">  <span class="attr">registerUser</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">    wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> code = res.<span class="property">code</span>; <span class="comment">// 微信登录接口返回的 code 参数，下面注册接口需要用到</span></span><br><span class="line">        wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">          <span class="attr">success</span>: <span class="keyword">function</span> (<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> iv = res.<span class="property">iv</span>;</span><br><span class="line">            <span class="keyword">var</span> encryptedData = res.<span class="property">encryptedData</span>;</span><br><span class="line">            <span class="comment">// 下面开始调用注册接口</span></span><br><span class="line">            wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">              <span class="attr">url</span>:</span><br><span class="line">                <span class="string">&quot;https://api.it120.cc/&quot;</span> +</span><br><span class="line">                that.<span class="property">globalData</span>.<span class="property">subDomain</span> +</span><br><span class="line">                <span class="string">&quot;/user/wxapp/register/complex&quot;</span>,</span><br><span class="line">              <span class="attr">data</span>: &#123; <span class="attr">code</span>: code, <span class="attr">encryptedData</span>: encryptedData, <span class="attr">iv</span>: iv &#125;, <span class="comment">// 设置请求的 参数</span></span><br><span class="line">              <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                wx.<span class="title function_">hideLoading</span>();</span><br><span class="line">                that.<span class="title function_">login</span>();</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 获取用户信息</span></span><br><span class="line">  <span class="attr">getUserInfo</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">userInfo</span> = data.<span class="property">userInfo</span>;</span><br><span class="line">        wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">          <span class="attr">key</span>: <span class="string">&quot;userInfo&quot;</span>,</span><br><span class="line">          <span class="attr">data</span>: data.<span class="property">userInfo</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">userInfo</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">globalData</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">subDomain</span>: <span class="string">&quot;34vu54u7vuiuvc546d&quot;</span>,</span><br><span class="line">    <span class="attr">token</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>授权</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">getUserInfo</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 先调用wx.getSetting 获取用户权限设置</span></span><br><span class="line">  wx.<span class="title function_">getSetting</span>(&#123;</span><br><span class="line">    <span class="title function_">success</span>(<span class="params">res</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (!res.<span class="property">authSetting</span>[<span class="string">&#x27;scope.userInfo&#x27;</span>]) &#123;</span><br><span class="line">        wx.<span class="title function_">authorize</span>(&#123;</span><br><span class="line">          <span class="attr">scope</span>: <span class="string">&#x27;scope.userInfo&#x27;</span>,</span><br><span class="line">          <span class="title function_">success</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="comment">// 用户已经同意小程序使用录音功能，后续调用 wx.getUserInfo接口不会弹窗询问</span></span><br><span class="line">            wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">              <span class="attr">success</span>: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">userInfo</span> = data.<span class="property">userInfo</span>;</span><br><span class="line">                wx.<span class="title function_">setStorage</span>(&#123;</span><br><span class="line">                  <span class="attr">key</span>: <span class="string">&#x27;userInfo&#x27;</span>,</span><br><span class="line">                  <span class="attr">data</span>: data.<span class="property">userInfo</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">globalData</span>.<span class="property">userInfo</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h1 id="小程序的双向绑定和-vue-哪里不一样"><a href="#小程序的双向绑定和-vue-哪里不一样" class="headerlink" title="小程序的双向绑定和 vue 哪里不一样"></a>小程序的双向绑定和 vue 哪里不一样</h1><p>小程序直接<code>this.data</code>的属性不可以直接同步到视图,必须调用<code>this.data</code></p>
<h1 id="data-和-params-的区别"><a href="#data-和-params-的区别" class="headerlink" title="data 和 params 的区别"></a>data 和 params 的区别</h1><h1 id="哪些方法可以用来提高微信小程序的应用速度"><a href="#哪些方法可以用来提高微信小程序的应用速度" class="headerlink" title="哪些方法可以用来提高微信小程序的应用速度"></a>哪些方法可以用来提高微信小程序的应用速度</h1><ol>
<li>提高页面加载速度</li>
<li>用户行为预测</li>
<li>减少默认 data 的大小</li>
<li>组件化方案</li>
</ol>
<h1 id="番茄闹钟的问题"><a href="#番茄闹钟的问题" class="headerlink" title="番茄闹钟的问题"></a>番茄闹钟的问题</h1><ol>
<li>组件内 css 选择器不能有 id,target,attr 选择器,一律使用 class 选择器.</li>
<li><code>wx:key</code>后跟字符串,不能是<code>双大括号</code>.</li>
<li>页面 wxss 样式名不要和<code>app.wxss</code>重复,容易使设置样式失效.</li>
<li>没有出现登录页的情况是需要在<code>app.json</code>中将<code>pages/login/login</code>放在最前面.</li>
<li>登录页面中跳转时,使用<code>wx.reLaunch</code>并未跳转,使用<code>wx.switchTab</code>可以.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//原因:reLaunch必须写相对路径才能正确跳转</span></span><br><span class="line">wx.<span class="title function_">reLaunch</span>(&#123; <span class="attr">url</span>: <span class="string">&quot;../../pages/home/home&quot;</span> &#125;);</span><br><span class="line"><span class="comment">//wx.switchTab可以直接跳转绝对路径</span></span><br><span class="line">wx.<span class="title function_">switchTab</span>(&#123; <span class="attr">url</span>: <span class="string">&quot;/pages/home/home&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>登录验证中的<code>encrypted_data</code>,<code>event</code>返回的是<code>encryptedData</code>.注意</li>
<li>请求头里的设置<code>&#39;t-app-id&#39;: t_app_id</code>,注意横线.</li>
<li>登录存储 storage 时,<code>wx.setStorageSync(&#39;me&#39;, response.res.data.resource)</code>,注意是<code>response.res</code></li>
<li>创建任务时,第一个按照后端 api 文档写的报错,第二个正确</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="title function_">post</span>(<span class="string">&quot;/todos&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">todo</span>: &#123;</span><br><span class="line">    <span class="attr">completed</span>: <span class="literal">false</span>,</span><br><span class="line">    description,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">req.<span class="title function_">post</span>(<span class="string">&quot;/todos&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">completed</span>: <span class="literal">false</span>,</span><br><span class="line">  description,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="10">
<li>创建时多一个空白,并且没有 id 和 index.原因:将 resource 写成 resources.有些有 s,有些没有.</li>
</ol>
<p>11.登录时显示 500 报错,解决方法: 清缓存,全部清除,编译.即可.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/10/10/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%85%A5%E9%97%A8/" data-id="cl9y1bhiq003fdvophqdk9j21" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/10/16/vue-hackernews-2-0-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB-%E9%80%82%E5%90%88%E5%85%A5%E9%97%A8/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          vue-hackernews-2.0 源码解读(适合入门)(一)
        
      </div>
    </a>
  
  
    <a href="/2019/09/15/Vue%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%B8%B2%E6%9F%93/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Vue服务端渲染</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/HTML%E5%9F%BA%E7%A1%80/">HTML基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/HTTP%E5%9F%BA%E7%A1%80/">HTTP基础</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JS/JS%E8%BF%9B%E9%98%B6/">JS进阶</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS%E8%BF%9B%E9%98%B6/" rel="tag">JS进阶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-SSR/" rel="tag">Vue-SSR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js/" rel="tag">Vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js%E8%BF%9B%E9%98%B6/" rel="tag">Vue.js进阶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css3/" rel="tag">css3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/HTML/" style="font-size: 13.33px;">HTML</a> <a href="/tags/JS/" style="font-size: 10px;">JS</a> <a href="/tags/JS%E8%BF%9B%E9%98%B6/" style="font-size: 10px;">JS进阶</a> <a href="/tags/Vue-SSR/" style="font-size: 16.67px;">Vue-SSR</a> <a href="/tags/Vue-js/" style="font-size: 20px;">Vue.js</a> <a href="/tags/Vue-js%E8%BF%9B%E9%98%B6/" style="font-size: 13.33px;">Vue.js进阶</a> <a href="/tags/css/" style="font-size: 10px;">css</a> <a href="/tags/css3/" style="font-size: 10px;">css3</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">基础</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 10px;">小程序</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/25/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/">自动化构建工具</a>
          </li>
        
          <li>
            <a href="/2022/10/25/%E8%84%9A%E6%89%8B%E6%9E%B6/">脚手架</a>
          </li>
        
          <li>
            <a href="/2022/10/24/React%20Query/">React Query</a>
          </li>
        
          <li>
            <a href="/2022/10/19/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/">常用组件</a>
          </li>
        
          <li>
            <a href="/2022/10/12/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">单元测试</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Zax Tseng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>