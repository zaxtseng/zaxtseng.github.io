<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>全栈开发后台资金管理系统项目 | Zax&#39;s BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="后端部分1. nodemon 使用当我们做服务器的时候，每次变更都要重启才能生效。如：我们创建了一个名为 server.js 的文件，作为服务器使用node .&#x2F;server.js即可启动，但我们对其修改后，要看效果就要关闭之前的再启动。而 nodemon 帮我们解决这个问题。 1npm install nodemon -g &#x2F;&#x2F;全局安装nodemon  然后就可以使用 nodemon 运行我们的">
<meta property="og:type" content="article">
<meta property="og:title" content="全栈开发后台资金管理系统项目">
<meta property="og:url" content="http://yoursite.com/2019/11/27/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%90%8E%E5%8F%B0%E8%B5%84%E9%87%91%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/index.html">
<meta property="og:site_name" content="Zax&#39;s BLOG">
<meta property="og:description" content="后端部分1. nodemon 使用当我们做服务器的时候，每次变更都要重启才能生效。如：我们创建了一个名为 server.js 的文件，作为服务器使用node .&#x2F;server.js即可启动，但我们对其修改后，要看效果就要关闭之前的再启动。而 nodemon 帮我们解决这个问题。 1npm install nodemon -g &#x2F;&#x2F;全局安装nodemon  然后就可以使用 nodemon 运行我们的">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-11-27T07:58:28.000Z">
<meta property="article:modified_time" content="2022-11-01T04:33:24.082Z">
<meta property="article:author" content="Zax Tseng">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Zax&#39;s BLOG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Zax&#39;s BLOG</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-全栈开发后台资金管理系统项目" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/27/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%90%8E%E5%8F%B0%E8%B5%84%E9%87%91%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/" class="article-date">
  <time datetime="2019-11-27T07:58:28.000Z" itemprop="datePublished">2019-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      全栈开发后台资金管理系统项目
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="后端部分"><a href="#后端部分" class="headerlink" title="后端部分"></a>后端部分</h1><h4 id="1-nodemon-使用"><a href="#1-nodemon-使用" class="headerlink" title="1. nodemon 使用"></a>1. nodemon 使用</h4><p>当我们做服务器的时候，每次变更都要重启才能生效。<br>如：我们创建了一个名为 server.js 的文件，作为服务器<br>使用<code>node ./server.js</code>即可启动，但我们对其修改后，要看效果就要关闭之前的再启动。<br>而 nodemon 帮我们解决这个问题。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install nodemon -g <span class="comment">//全局安装nodemon</span></span><br></pre></td></tr></table></figure>

<p>然后就可以使用 nodemon 运行我们的服务器了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nodemon ./server.<span class="property">js</span></span><br></pre></td></tr></table></figure>

<p>这时，修改文件，服务器会自动重启。<br>将命令设置到 package.json。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在package.json中修改</span></span><br><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;node server.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;server&quot;</span>: <span class="string">&quot;nodemon server.js&quot;</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>这样在就可以使用<code>npm run start</code>或<code>npm run server</code>来运行服务器</p>
<h4 id="2-连接数据库"><a href="#2-连接数据库" class="headerlink" title="2.连接数据库"></a>2.连接数据库</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//node-app下执行</span></span><br><span class="line">npm install mongoose</span><br></pre></td></tr></table></figure>

<p>为方便修改配置，新建文件 &#x2F;config&#x2F;keys.js, 内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mongoURI</span>:</span><br><span class="line">    <span class="string">&quot;mongodb://&lt;username&gt;:&lt;password&gt;@cluster0-shard-00-00-oqdfe.mongodb.net:27017,cluster0-shard-00-01-oqdfe.mongodb.net:27017,cluster0-shard-00-02-oqdfe.mongodb.net:27017/test?ssl=true&amp;replicaSet=Cluster0-shard-0&amp;authSource=admin&amp;retryWrites=true&amp;w=majority&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该链接需要到 mongoDB 官网注册账户，获取 500M 免费空间，创建一个 Preject 再创建 Clusters，之后点击”Connect”,选择”Connect your Application”进入下一步，域名选择默认确定即可.DRIVER 选择“node.js”, VERSION 选择”2.2.12 or later”,然后 copy 下面的链接即可，注意修改&lt;username&gt;:&lt;password&gt;为对应的用户名和密码。可以在”Database Access”中添加和修改用户。<br>在 server.js 中引用</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DB config</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&quot;./config/keys&quot;</span>).<span class="property">mongoURI</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="comment">//Connect to mongodb</span></span><br><span class="line">mongoose.<span class="title function_">connect</span>(db, &#123;</span><br><span class="line">  <span class="comment">//第一个参数db是在线数据库的地址,也可以直接将地址写入这里,美观起见,另写一个文件存储</span></span><br><span class="line">    <span class="attr">useNewUrlParser</span>: <span class="literal">true</span>,<span class="comment">//防止弃用警告</span></span><br><span class="line">    <span class="attr">useUnifiedTopology</span>: <span class="literal">true</span>,<span class="comment">//防止弃用警告</span></span><br><span class="line">    <span class="attr">useFindAndModify</span>: <span class="literal">false</span> <span class="comment">//防止弃用警告</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">//提供promise调用</span></span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;mongoDB Connected&quot;</span>)) <span class="comment">//成功</span></span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err)); <span class="comment">//失败</span></span><br></pre></td></tr></table></figure>

<h4 id="3-配置路由和接口"><a href="#3-配置路由和接口" class="headerlink" title="3.配置路由和接口"></a>3.配置路由和接口</h4><p>在 node-app 下创建 &#x2F;route&#x2F;api&#x2F;users.js,内容:<br>用于登录和注册</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//users.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="comment">//实例化路由</span></span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// $route GET api/users/test</span></span><br><span class="line"><span class="comment">//@desc 返回请求的json数据</span></span><br><span class="line"><span class="comment">//@access public(公有接口)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//验证路由，访问/test，将返回`msg:&quot;login works&quot;`</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/test&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//返回json数据</span></span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">msg</span>: <span class="string">&quot;login works&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出router</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>在 server.js 中引用和使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="comment">//引入users.js</span></span><br><span class="line"><span class="keyword">const</span> users = <span class="built_in">require</span>(<span class="string">&quot;./route/api/users&quot;</span>);</span><br><span class="line"><span class="comment">//路由访问这个地址时,就会访问users</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/api/users&quot;</span>, users);</span><br></pre></td></tr></table></figure>

<p>这时 使用浏览器访问 <code>http://localhost:5000/api/users/test</code>即可看到返回的<code>msg:&quot;login works&quot;</code></p>
<h4 id="4-创建模型"><a href="#4-创建模型" class="headerlink" title="4.创建模型"></a>4.创建模型</h4><p>新建 &#x2F;models&#x2F;User.js,</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//User.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入mongoose.可以将数据存储到mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="comment">//创建Schema模型</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Schema</span> = mongoose.<span class="property">Schema</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create Schema</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">UserSchema</span> = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">email</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">password</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">avatar</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">date</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">Date</span>,</span><br><span class="line">    <span class="attr">default</span>: <span class="title class_">Date</span>.<span class="property">now</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;users&quot;</span>, <span class="title class_">UserSchema</span>);</span><br></pre></td></tr></table></figure>

<h4 id="4-5-下载postman-安装"><a href="#4-5-下载postman-安装" class="headerlink" title="4.5 下载postman,安装"></a>4.5 下载postman,安装</h4><p>可以用来测试接口是否通.</p>
<h4 id="4-6-创建register接口"><a href="#4-6-创建register接口" class="headerlink" title="4.6 创建register接口"></a>4.6 创建register接口</h4><p>首先需要安装body-parser.</p>
<h4 id="5-配置注册"><a href="#5-配置注册" class="headerlink" title="5.配置注册"></a>5.配置注册</h4><p>安装 body-parser，方便发送 POST 请求</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="keyword">body</span>-parser</span><br></pre></td></tr></table></figure>

<p>在 server.js 中引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&quot;body-parser&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用body-parser中间件</span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br></pre></td></tr></table></figure>

<p>在 users.js 中配置接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/uers/register</span></span><br><span class="line"><span class="comment">//@desc 返回请求的JSON数据</span></span><br><span class="line"><span class="comment">//@access public （公有接口）</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/register&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>); <span class="comment">//用来测试是否连接</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F;此处如果连接不上mongoDB,可能是白名单失效.再添加一个白名单在mongoDB即可.</p>
<p>功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.是否有邮箱</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/register&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//查询数据库中是否拥有邮箱</span></span><br><span class="line">  <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123; <span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span> &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">      <span class="comment">//如果存在</span></span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">email</span>: <span class="string">&quot;邮箱已被注册！&quot;</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//否则不存在</span></span><br><span class="line">      <span class="keyword">const</span> newUser = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;</span><br><span class="line">        <span class="attr">name</span>: req.<span class="property">body</span>.<span class="property">name</span>,</span><br><span class="line">        <span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span>,</span><br><span class="line">        <span class="attr">password</span>: req.<span class="property">body</span>.<span class="property">password</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="密码加密"><a href="#密码加密" class="headerlink" title="密码加密"></a>密码加密</h5><p>安装 bcrypt</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> bcrypt</span><br></pre></td></tr></table></figure>

<p>在 users.js 中引入，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bcrypt = <span class="built_in">require</span>(<span class="string">&quot;bcrypt&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>官方详细说明<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/bcrypt">链接</a></p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bcrypt.<span class="title function_">genSalt</span>(<span class="number">10</span>, <span class="keyword">function</span>(<span class="params">err, salt</span>) &#123;</span><br><span class="line">  <span class="comment">//10是加密的一种模式</span></span><br><span class="line">  bcrypt.<span class="title function_">hash</span>(newUser.<span class="property">password</span>, salt, <span class="function">(<span class="params">err, hash</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//newUser.password 是加密对象，salt是回调函数，最后是加密结果</span></span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err; <span class="comment">//如果存在错误，则抛出。 throw是js语法，抛出</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//没有错误，则把加密过的密码hash赋值给password</span></span><br><span class="line">    newUser.<span class="property">password</span> = hash;</span><br><span class="line">    <span class="comment">//将newUser存储</span></span><br><span class="line">    newUser</span><br><span class="line">      .<span class="title function_">save</span>()</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">user</span> =&gt;</span> res.<span class="title function_">json</span>(user))</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="头像-avatar"><a href="#头像-avatar" class="headerlink" title="头像 avatar"></a>头像 avatar</h4><p>gravatar 官方说明<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/gravatar">链接</a><br>安装</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i gravatar</span><br></pre></td></tr></table></figure>

<p>user.js 中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gravatar = <span class="built_in">require</span>(<span class="string">&quot;gravatar&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>在接口位置使用(user.js)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (user) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">email</span>: <span class="string">&quot;邮箱已被注册！&quot;</span> &#125;);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> avatar = gravatar.<span class="title function_">url</span>(req.<span class="property">body</span>.<span class="property">email</span>, &#123; <span class="attr">s</span>: <span class="string">&quot;200&quot;</span>, <span class="attr">r</span>: <span class="string">&quot;pg&quot;</span>, <span class="attr">d</span>: <span class="string">&quot;mm&quot;</span> &#125;); <span class="comment">//s是大小。r是头像格式。mm是灰色的头像</span></span><br><span class="line">  <span class="keyword">const</span> newUser = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>: req.<span class="property">body</span>.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span>,</span><br><span class="line">    avatar, <span class="comment">//引入头像</span></span><br><span class="line">    <span class="attr">password</span>: req.<span class="property">body</span>.<span class="property">password</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如何得到头像？</p>
<ol>
<li>打开 <a target="_blank" rel="noopener" href="https://cn.gravatar.com/">gravatar 网址</a></li>
<li>注册 gravatar，其注册实际是注册了 wordpress.com 网站的账户，然后登录 gravatar，任意格式的邮箱均可申请成功，但无法收到邮件，则无法验证并修改头像。因此要使用可以收到验证的邮箱。</li>
<li>上传头像。上传图片时，最后会选择图片会有<code>Choose a rating for your Gravatar</code> ，有四个选项，G、PG、R、X,这里我们选择 pg，我们在使用时也是<code>r: &#39;pg&#39;</code>，需要保持一致。</li>
</ol>
<p>这时，我们使用 postman 向 <a target="_blank" rel="noopener" href="http://localhost:5000/api/users/register">http://localhost:5000/api/users/register</a> 发送 post 请求，使用(application&#x2F;x-www-form-urlencoded)(key:email value:<a href="mailto:&#x75;&#115;&#x65;&#x72;&#x40;&#117;&#x73;&#101;&#x72;&#x74;&#101;&#x73;&#x74;&#46;&#99;&#111;&#109;">&#x75;&#115;&#x65;&#x72;&#x40;&#117;&#x73;&#101;&#x72;&#x74;&#101;&#x73;&#x74;&#46;&#99;&#111;&#109;</a>) 就能得到设置的头像了。</p>
<h4 id="7-登录接口"><a href="#7-登录接口" class="headerlink" title="7.登录接口"></a>7.登录接口</h4><p>users.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/users/login</span></span><br><span class="line"><span class="comment">//@desc 返回taken jwt passport</span></span><br><span class="line"><span class="comment">//@access public （公有接口）</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> email = req.<span class="property">body</span>.<span class="property">email</span>;</span><br><span class="line">  <span class="keyword">const</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//查询数据库,看email是否存在</span></span><br><span class="line">  <span class="title class_">User</span>.<span class="title function_">findOne</span>(&#123; email &#125;).<span class="title function_">then</span>(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(&#123; <span class="attr">email</span>: <span class="string">&quot;用户不存在&quot;</span> &#125;); <span class="comment">//如果用户不存在</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果email存在</span></span><br><span class="line">    <span class="comment">//密码匹配</span></span><br><span class="line">    <span class="comment">//第一个password是前端传入密码，user.password是系统内密码</span></span><br><span class="line">    bcrypt.<span class="title function_">compare</span>(password, user.<span class="property">password</span>).<span class="title function_">then</span>(<span class="function"><span class="params">isMatch</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (isMatch) &#123;</span><br><span class="line">        res.<span class="title function_">json</span>(&#123; <span class="attr">msg</span>: <span class="string">&quot;success&quot;</span> &#125;); <span class="comment">//如果密码对比正确,(实际这里返回token,但暂时先返回msg)</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">json</span>(&#123; <span class="attr">password</span>: <span class="string">&quot;密码错误！&quot;</span> &#125;); <span class="comment">//如果密码对比不正确</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="返回-token"><a href="#返回-token" class="headerlink" title="返回 token"></a>返回 token</h4><p>安装 jsonwebtoken (jwt)</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> jsonwebtoken</span><br></pre></td></tr></table></figure>

<p>在 users.js 引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&quot;jsonwebtoken&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>在密码验证成功处插入</p>
<blockquote>
<p>我们在 config&#x2F;keys.js 导出的对象中，加入了 secretOrKey:”secret” 属性和值，再引入到 users.js 以方便统一管理配置。<br>过期时间的 3600 单位为秒<br>token 前必须是 “Bearer ”(送信人的意思)，<strong>末尾空格</strong>也不可缺少。<br>如果 success 为 true，就应该得到 token 值</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//替换上面的res.json(&#123; msg: &quot;success&quot; &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//jwt.sign(&quot;规则&quot;,&quot;加密名字&quot;,&quot;过期时间&quot;,&quot;箭头函数&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rule = &#123; <span class="attr">id</span>: user.<span class="property">id</span>, <span class="attr">name</span>: user.<span class="property">name</span> &#125;; <span class="comment">//可以更多</span></span><br><span class="line"><span class="comment">//sign签名</span></span><br><span class="line">jwt.<span class="title function_">sign</span>(rule, keys.<span class="property">secretOrKey</span>, &#123; <span class="attr">expiresIn</span>: <span class="number">3600</span> &#125;, <span class="function">(<span class="params">err, token</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">success</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//&quot;Bearer &quot;前缀是固定的,意思是送信者.后面有个空格</span></span><br><span class="line">    <span class="attr">token</span>: <span class="string">&quot;Bearer &quot;</span> + token </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// res.json(&#123;msg:&quot;success&quot;&#125;);</span></span><br></pre></td></tr></table></figure>

<h4 id="验证-token"><a href="#验证-token" class="headerlink" title="验证 token"></a>验证 token</h4><p>token相当于一个令牌或者钥匙.<br>使用passport-jwt进行token验证.</p>
<p><code>users.js</code> 加入接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route GET api/users/current</span></span><br><span class="line"><span class="comment">//@desc return current user</span></span><br><span class="line"><span class="comment">//@access Privates</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//router.get(&quot;/current&quot;, &quot;验证token&quot;,(req, res) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//在中间验证token,但是需要passport,还没装,会报错,暂时删掉</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/current&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123; <span class="attr">msg</span>: <span class="string">&quot;success&quot;</span> &#125;); <span class="comment">//测试使用，后期有修改</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="安装-passport-jwt-和-passport"><a href="#安装-passport-jwt-和-passport" class="headerlink" title="安装 passport-jwt 和 passport"></a>安装 passport-jwt 和 passport</h5><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">npm</span> install pass<span class="keyword">port</span>-jwt passport</span><br></pre></td></tr></table></figure>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/passport">passport 网址</a><br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/passport-jwt">passport-jwt 网址</a><br>在 <code>server.js</code> 中引入,并初始化</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&quot;passport&quot;</span>);</span><br><span class="line"><span class="comment">//passport初始化</span></span><br><span class="line">app.<span class="title function_">use</span>(passport.<span class="title function_">initialize</span>());</span><br></pre></td></tr></table></figure>

<p>新建文件 <code>/config/passport.js</code>,内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">JwtStrategy</span> = <span class="built_in">require</span>(<span class="string">&quot;passport-jwt&quot;</span>).<span class="property">Strategy</span>,</span><br><span class="line">  <span class="title class_">ExtractJwt</span> = <span class="built_in">require</span>(<span class="string">&quot;passport-jwt&quot;</span>).<span class="property">ExtractJwt</span>;</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">User</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;users&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> keys = <span class="built_in">require</span>(<span class="string">&quot;../config/keys&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> opts = &#123;&#125;;</span><br><span class="line">opts.<span class="property">jwtFromRequest</span> = <span class="title class_">ExtractJwt</span>.<span class="title function_">fromAuthHeaderAsBearerToken</span>();</span><br><span class="line">opts.<span class="property">secretOrKey</span> = keys.<span class="property">secretOrKey</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function"><span class="params">passport</span> =&gt;</span> &#123;</span><br><span class="line">  passport.<span class="title function_">use</span>(</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">JwtStrategy</span>(opts, <span class="function">(<span class="params">jwt_payload, done</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//console.log(jwt_payload);</span></span><br><span class="line">      <span class="comment">//通过id获取用户</span></span><br><span class="line">      <span class="title class_">User</span>.<span class="title function_">findById</span>(jwt_payload.<span class="property">id</span>)</span><br><span class="line">        <span class="comment">//获取成功</span></span><br><span class="line">        .<span class="title function_">then</span>(<span class="function"><span class="params">user</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">//如果用户存在</span></span><br><span class="line">          <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, user);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//如果用户不存在</span></span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">done</span>(<span class="literal">null</span>, <span class="literal">false</span>); </span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="comment">//获取失败</span></span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(err));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在 server.js 中引入 passport.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(passport.<span class="title function_">initialize</span>());</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&quot;./config/passport&quot;</span>)(passport); <span class="comment">//这样代码就不需要在当前server.js中写了</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里使用了一个技巧，<code>require(&quot;xxx.js&quot;)（对象）</code> 将对象传入xxx.js,同时将该js引入当前文件中。这样就可以在<code>xxx.js</code>中编写代码，实现分离，而且在xxx.js可以使用传入的对象。</p>
</blockquote>
<p>在 users.js 中引入 passport，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//users.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&quot;passport&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//完成token验证，返回部分信息</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$route GET api/users/current</span></span><br><span class="line"><span class="comment">//@desc return current user</span></span><br><span class="line"><span class="comment">//@access Privates</span></span><br><span class="line">router.<span class="title function_">get</span>(</span><br><span class="line">  <span class="string">&quot;/current&quot;</span>,</span><br><span class="line">  passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">id</span>: req.<span class="property">user</span>.<span class="property">id</span>,</span><br><span class="line">      <span class="attr">name</span>: req.<span class="property">user</span>.<span class="property">name</span>,</span><br><span class="line">      <span class="attr">email</span>: req.<span class="property">user</span>.<span class="property">email</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<blockquote>
<p>这里调整了一些输出的内容，将输出对象改为了字符串，可能造成代码实际和上面有些出入。</p>
</blockquote>
<hr>
<h4 id="添加身份"><a href="#添加身份" class="headerlink" title="添加身份"></a>添加身份</h4><p>如果想在 user 中添加其他信息(比如添加管理员)可参考此内容<br>在 <code>models/User.js</code> 的 UserSchema 中添加身份字段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">identity</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p>在 <code>api/users.js</code> 中加入信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// newUser中</span></span><br><span class="line"><span class="keyword">const</span> newUser = <span class="keyword">new</span> <span class="title class_">User</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: req.<span class="property">body</span>.<span class="property">name</span>,</span><br><span class="line">  <span class="attr">email</span>: req.<span class="property">body</span>.<span class="property">email</span>,</span><br><span class="line">  avatar,</span><br><span class="line">  <span class="attr">password</span>: req.<span class="property">body</span>.<span class="property">password</span>,</span><br><span class="line">  <span class="attr">identity</span>: req.<span class="property">body</span>.<span class="property">identity</span> <span class="comment">//添加的信息</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//密码匹配规则中</span></span><br><span class="line"><span class="keyword">const</span> rule = &#123;</span><br><span class="line">  <span class="attr">id</span>: user.<span class="property">id</span>,</span><br><span class="line">  <span class="attr">name</span>: user.<span class="property">name</span>,</span><br><span class="line">  <span class="attr">avatar</span>: user.<span class="property">avatar</span>,</span><br><span class="line">  <span class="attr">identity</span>: user.<span class="property">identity</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//验证token输出信息时</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/current&quot;</span>,passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>,&#123;<span class="attr">session</span>:<span class="literal">false</span>&#125;), <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>:req.<span class="property">user</span>.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">name</span>:req.<span class="property">user</span>.<span class="property">name</span>,</span><br><span class="line">    <span class="attr">email</span>:req.<span class="property">user</span>.<span class="property">email</span>,</span><br><span class="line">    <span class="attr">identity</span>:req.<span class="property">user</span>.<span class="property">identity</span> <span class="comment">//添加的内容</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="配置信息接口"><a href="#配置信息接口" class="headerlink" title="配置信息接口"></a>配置信息接口</h4><p>新建 models&#x2F;Profile.js 建立ProfileSchema，内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Schema</span> = mongoose.<span class="property">Schema</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//create Schema</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ProfileSchema</span> = <span class="keyword">new</span> <span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">type</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">describe</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">income</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">expend</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">cash</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">required</span>:<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">remark</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">String</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">date</span>:&#123;</span><br><span class="line">    <span class="attr">type</span>:<span class="title class_">Date</span>,</span><br><span class="line">    <span class="attr">default</span>:<span class="title class_">Date</span>.<span class="property">now</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">Profile</span> = mongoose.<span class="title function_">model</span>(<span class="string">&quot;profile&quot;</span>,<span class="title class_">ProfileSchema</span>);</span><br></pre></td></tr></table></figure>
<p>新建 api&#x2F;profiles.js 暂不写内容，将其在server.js中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"><span class="keyword">const</span> profiles = <span class="built_in">require</span>(<span class="string">&quot;./route/api/profiles&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用route</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&quot;/api/profiles&quot;</span>, profiles);</span><br></pre></td></tr></table></figure>
<p>在 api&#x2F;profiles.js 配置信息进行测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@login &amp; register </span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&quot;passport&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Profile</span> = <span class="built_in">require</span>(<span class="string">&quot;../../models/Profile&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//$route GET api/profile/test</span></span><br><span class="line"><span class="comment">//@desc 返回请求的JSON数据</span></span><br><span class="line"><span class="comment">//@access public （公有接口）</span></span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&quot;/test&quot;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123;<span class="attr">msg</span>:<span class="string">&quot;Profile works&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure>

<p>postman 发送到 <a target="_blank" rel="noopener" href="http://localhost:5000/api/profiles/test">http://localhost:5000/api/profiles/test</a> 返回 Profile works 即链接成功。</p>
<h4 id="更改数据库接口"><a href="#更改数据库接口" class="headerlink" title="更改数据库接口"></a>更改数据库接口</h4><p>如果要更改数据库接口，可以<code>/config/keys.js</code>中的<code>mongoURI</code>的值，该值的获取方法，参考上述创建时的内容。</p>
<h4 id="创建添加信息的接口"><a href="#创建添加信息的接口" class="headerlink" title="创建添加信息的接口"></a>创建添加信息的接口</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/profile/add</span></span><br><span class="line"><span class="comment">//@desc 创建信息接口</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&quot;/add&quot;</span>,passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>,&#123;<span class="attr">session</span>:<span class="literal">false</span>&#125;),<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> profileFields = &#123;&#125;;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">type</span>) profileFields.<span class="property">type</span> = req.<span class="property">body</span>.<span class="property">type</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">describe</span>) profileFields.<span class="property">describe</span> = req.<span class="property">body</span>.<span class="property">describe</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">income</span>) profileFields.<span class="property">income</span> = req.<span class="property">body</span>.<span class="property">income</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">expend</span>) profileFields.<span class="property">expend</span> = req.<span class="property">body</span>.<span class="property">expend</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">cash</span>) profileFields.<span class="property">cash</span> = req.<span class="property">body</span>.<span class="property">cash</span>;</span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">remark</span>) profileFields.<span class="property">remark</span> = req.<span class="property">body</span>.<span class="property">remark</span>;</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Profile</span>(profileFields).<span class="title function_">save</span>().<span class="title function_">then</span>(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">res.<span class="title function_">json</span>(profile);</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="获取所有信息"><a href="#获取所有信息" class="headerlink" title="获取所有信息"></a>获取所有信息</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route GET api/profile</span></span><br><span class="line"><span class="comment">//@desc 获取所有信息</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(</span><br><span class="line">  <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Profile</span>.<span class="title function_">find</span>()</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!profile) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(<span class="string">&quot;没有任何内容&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">json</span>(profile);</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(<span class="string">&quot;err&quot;</span>));</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="获取单个信息"><a href="#获取单个信息" class="headerlink" title="获取单个信息"></a>获取单个信息</h4><p>  profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route GET api/profile/:id</span></span><br><span class="line"><span class="comment">//@desc 获取单个信息</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line"></span><br><span class="line">router.<span class="title function_">get</span>(</span><br><span class="line">  <span class="string">&quot;/:id&quot;</span>,</span><br><span class="line">  passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">session</span>: <span class="literal">false</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Profile</span>.<span class="title function_">findOne</span>(&#123; <span class="attr">_id</span>: req.<span class="property">params</span>.<span class="property">id</span> &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!profile) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(<span class="string">&quot;没有任何内容&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">json</span>(profile);</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(err));</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="编辑信息"><a href="#编辑信息" class="headerlink" title="编辑信息"></a>编辑信息</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route POST api/profile/edit</span></span><br><span class="line"><span class="comment">//@desc 编辑信息接口</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line">router.<span class="title function_">post</span>(</span><br><span class="line">  <span class="string">&quot;/edit/:id&quot;</span>,</span><br><span class="line">  passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">session</span>: <span class="literal">false</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> profileFields = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">type</span>) profileFields.<span class="property">type</span> = req.<span class="property">body</span>.<span class="property">type</span>;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">describe</span>) profileFields.<span class="property">describe</span> = req.<span class="property">body</span>.<span class="property">describe</span>;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">income</span>) profileFields.<span class="property">income</span> = req.<span class="property">body</span>.<span class="property">income</span>;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">expend</span>) profileFields.<span class="property">expend</span> = req.<span class="property">body</span>.<span class="property">expend</span>;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">cash</span>) profileFields.<span class="property">cash</span> = req.<span class="property">body</span>.<span class="property">cash</span>;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">body</span>.<span class="property">remark</span>) profileFields.<span class="property">remark</span> = req.<span class="property">body</span>.<span class="property">remark</span>;</span><br><span class="line">    <span class="title class_">Profile</span>.<span class="title function_">findOneAndUpdate</span>(</span><br><span class="line">      &#123; <span class="attr">_id</span>: req.<span class="property">params</span>.<span class="property">id</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">$set</span>: profileFields &#125;,</span><br><span class="line">      &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    ).<span class="title function_">then</span>(<span class="function"><span class="params">profile</span> =&gt;</span> res.<span class="title function_">json</span>(profile))</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="删除信息"><a href="#删除信息" class="headerlink" title="删除信息"></a>删除信息</h4><p>profiles.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//$route delete api/profile/delete/:id</span></span><br><span class="line"><span class="comment">//@desc 删除信息接口</span></span><br><span class="line"><span class="comment">//@access Private</span></span><br><span class="line">router.<span class="title function_">delete</span>(</span><br><span class="line">  <span class="string">&quot;/delete/:id&quot;</span>,</span><br><span class="line">  passport.<span class="title function_">authenticate</span>(<span class="string">&quot;jwt&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">session</span>: <span class="literal">false</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Profile</span>.<span class="title function_">findOneAndRemove</span>(&#123; <span class="attr">_id</span>: req.<span class="property">params</span>.<span class="property">id</span> &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">profile</span> =&gt;</span> &#123;</span><br><span class="line">        profile.<span class="title function_">save</span>().<span class="title function_">then</span>(<span class="function"><span class="params">profile</span> =&gt;</span> res.<span class="title function_">json</span>(profile));</span><br><span class="line">      &#125;</span><br><span class="line">      ).<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> res.<span class="title function_">status</span>(<span class="number">404</span>).<span class="title function_">json</span>(<span class="string">&quot;删除失败&quot;</span>))</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>至此，信息的增删改查均已实现。要创建其他 schema 可以参考此方式</p>
</blockquote>
<h4 id="前后端连载"><a href="#前后端连载" class="headerlink" title="前后端连载"></a>前后端连载</h4><p>查看vue版本，是否在3.0.0以上，我们要求是在3.0.0以上。</p>
<blockquote>
<p>vue-cli的安装见 <a target="_blank" rel="noopener" href="https://cn.vuejs.org/">vue官网</a> ，这里就不说了</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//终端中执行</span></span><br><span class="line">vue -V <span class="comment">//查看vue-cli版本 本案例要求3.0.0以上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//创建项目 client是自己起的名字，意为&quot;客户端&quot;</span></span><br><span class="line">vue create client</span><br><span class="line"></span><br><span class="line">接下来进入选择流程，后面 √ 为我们作出的选择项，-----表示回车到下一选项页</span><br><span class="line">? <span class="title class_">Please</span> pick a <span class="attr">preset</span>: </span><br><span class="line">❯ <span class="keyword">default</span> (babel, eslint)   (默认配置)</span><br><span class="line">  <span class="title class_">Manually</span> select features （手动选择) √</span><br><span class="line">-----</span><br><span class="line">按键盘a表示全选，i表示反选，空格键 表示切换选中，如果你需要什么就选什么就可以了，这里选择<span class="title class_">Babel</span>、<span class="title class_">Router</span>、<span class="title class_">Vuex</span>。</span><br><span class="line">? <span class="title class_">Please</span> pick a <span class="attr">preset</span>: <span class="title class_">Manually</span> select features</span><br><span class="line">? <span class="title class_">Check</span> the features needed <span class="keyword">for</span> your <span class="attr">project</span>: (<span class="title class_">Press</span> &lt;space&gt; to select, &lt;a&gt; to toggle all, &lt;i&gt; to invert selection)</span><br><span class="line">❯◯ <span class="title class_">Babel</span>    √</span><br><span class="line"> ◯ <span class="title class_">TypeScript</span></span><br><span class="line"> ◯ <span class="title class_">Progressive</span> <span class="title class_">Web</span> <span class="title class_">App</span> (<span class="variable constant_">PWA</span>) <span class="title class_">Support</span>   </span><br><span class="line"> ◯ <span class="title class_">Router</span>   √</span><br><span class="line"> ◯ <span class="title class_">Vuex</span>     √ </span><br><span class="line"> ◯ <span class="variable constant_">CSS</span> <span class="title class_">Pre</span>-processors</span><br><span class="line"> ◯ <span class="title class_">Linter</span> / <span class="title class_">Formatter</span></span><br><span class="line"> ◯ <span class="title class_">Unit</span> <span class="title class_">Testing</span></span><br><span class="line"> ◯ <span class="variable constant_">E2E</span> <span class="title class_">Testing</span></span><br><span class="line"> -----</span><br><span class="line"> 是否使用history ，我们输入y，回车，会继续显示其他问题。</span><br><span class="line"> ? <span class="title class_">Please</span> pick a <span class="attr">preset</span>: <span class="title class_">Manually</span> select features</span><br><span class="line">? <span class="title class_">Check</span> the features needed <span class="keyword">for</span> your <span class="attr">project</span>: <span class="title class_">Babel</span>, <span class="title class_">Router</span>, <span class="title class_">Vuex</span></span><br><span class="line">? <span class="title class_">Use</span> history mode <span class="keyword">for</span> router? (<span class="title class_">Requires</span> proper server setup <span class="keyword">for</span> index fallback <span class="keyword">in</span> production) (Y/n) </span><br><span class="line"></span><br><span class="line"><span class="title class_">In</span> dedicated config files </span><br><span class="line"><span class="title class_">In</span> package.<span class="property">json</span>    √ </span><br><span class="line"></span><br><span class="line"> <span class="title class_">Save</span> <span class="variable language_">this</span> <span class="keyword">as</span> a preset <span class="keyword">for</span> future projects? (y/N) (是否要保存你当前预制模板) N （第一次时可以保存一次方便之后用）</span><br><span class="line"> -----</span><br><span class="line"> 接下来就是等待安装成功。 会产生一个 client的文件夹</span><br><span class="line"></span><br><span class="line"> <span class="comment">//启动项目 </span></span><br><span class="line"> cd client</span><br><span class="line"> npm run serve  <span class="comment">//注意，是serve 不是server</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时使用 <code>http://localhost:8080/</code> 就可以打开前端了,再新建终端，执行 <code>nodemon</code>就打开了后台。<br>这需要两个终端打开，较为繁琐，因此采用前后端连载，借助concurrently将多个终端启动的项目绑在一起<br>安装 concurrently </p>
</blockquote>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install <span class="keyword">concurrently</span></span><br></pre></td></tr></table></figure>
<p>打开 &#x2F;client&#x2F;package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;serve&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service serve&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vue-cli-service build&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npm run serve&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时，我们在client中 使用 <code>npm run start </code>即可启动前端     </p>
</blockquote>
<p>在根目录的 package.json 中配置<code>client-stall</code>、<code>client</code>和<code>dev</code>。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;client-install&quot;</span><span class="punctuation">:</span><span class="string">&quot;npm install --prefix client&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;client&quot;</span><span class="punctuation">:</span><span class="string">&quot;npm start --prefix client&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;server&quot;</span><span class="punctuation">:</span> <span class="string">&quot;nodemon server.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span><span class="string">&quot;concurrently \&quot;npm run server\&quot; \&quot;npm run client\&quot;&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>此时我们可以在根目录的终端下执行<code>npm run dev</code>即可同时启动 前端和后台 </p>
</blockquote>
<h1 id="前端部分"><a href="#前端部分" class="headerlink" title="前端部分"></a>前端部分</h1><p>接后端部分，此文档为 前端部分 内容。</p>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>为使内容整洁，我们将vue-cli创建项目时生成的我们不需要的文件进行整理<br>我们接下来更多的是在client这个文件夹下工作，非强调指明，则以client视为根目录。</p>
<ul>
<li>删除 &#x2F;src&#x2F;assets&#x2F;logo.png  （vue的logo图片）</li>
<li>删除 &#x2F;src&#x2F;components&#x2F;HelloWorld.vue</li>
<li>删除 &#x2F;src&#x2F;views&#x2F; 中的About.vue 和Home.vue </li>
<li>新建 &#x2F;src&#x2F;views&#x2F;Index.vue,内容为<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;index&quot;&gt;</span><br><span class="line">    初始化页面</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name:&quot;index&quot;,</span><br><span class="line">  components:&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li>
<li>打开 &#x2F;src&#x2F;router.js,重新整理为:<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Router</span> <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Index</span> <span class="keyword">from</span> <span class="string">&#x27;./views/Index.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">Router</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Router</span>(&#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">  <span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">BASE_URL</span>,</span><br><span class="line">  <span class="attr">routes</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">      <span class="attr">redirect</span>:<span class="string">&#x27;/index&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/index&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>:<span class="string">&#x27;index&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Index</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>打开 &#x2F;src&#x2F;App.vue,重新整理为<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;router-view/&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">html,</span><br><span class="line">body,</span><br><span class="line">#app &#123;</span><br><span class="line">  width: 100%;</span><br><span class="line">  height: 100%;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure></li>
<li>新建 &#x2F;public&#x2F;css&#x2F;reset.css ,在 &#x2F;public&#x2F;index.html 中引入该css文件<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/reset.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
reset.css内容可以访问 <a target="_blank" rel="noopener" href="http://meyerweb.com/eric/tools/css/reset/">CSS reset</a>得到，也可在下面设置自己需要的初始样式<br>本案例中，我们在reset.css中追加了el中加载相关的样式</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.el-loading</span>&#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2000</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, .<span class="number">7</span>);</span><br><span class="line">  <span class="attribute">margin</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  -webkit-<span class="attribute">transition</span>:opacity .<span class="number">3s</span>;</span><br><span class="line">  <span class="attribute">transition</span>: opacity .<span class="number">3s</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.el-loading-spinner</span>&#123;</span><br><span class="line">  <span class="attribute">top</span>:<span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">margin-top</span>:-<span class="number">21px</span>;</span><br><span class="line">  <span class="attribute">width</span>:<span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="注册页和404"><a href="#注册页和404" class="headerlink" title="注册页和404"></a>注册页和404</h4><p>  安装elementUI<br>  <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>此时目录在client中</span><br><span class="line">npm i element-ui -S</span><br></pre></td></tr></table></figure><br>在&#x2F;src&#x2F;main.js中引入 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">ElementUI</span> <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;element-ui/lib/theme-chalk/index.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(<span class="title class_">ElementUI</span>);</span><br></pre></td></tr></table></figure>
<p>将 图片文件 放在 &#x2F;src&#x2F;asset&#x2F; 文件夹下面<br>分别是404.gif,bg.jpg,logo.png,showcase.png</p>
<p>初始注册，新建 &#x2F;src&#x2F;views&#x2F;Register.vue,内容 (只是简单布局，还未设置表单内容)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;register&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;form_container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;manage_tip&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>万事屋在线后台管理系统<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">name</span>:<span class="string">&quot;register&quot;</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="attr">components</span>:&#123;&#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.register</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">../assets/bg.jpg</span>) no-repeat center center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.form_container</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">370px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">210px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">top</span>:<span class="number">10%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">left</span>:<span class="number">34%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding</span>:<span class="number">25px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.form_container</span> <span class="selector-class">.manage_tip</span> <span class="selector-class">.title</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">font-family</span>: <span class="string">&#x27;Microsooft YaHei&#x27;</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">font-weight</span>: bold;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">font-size</span>: <span class="number">26px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>在 router.js中设置路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入组件</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Register</span> <span class="keyword">from</span> <span class="string">&#x27;./views/Register.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//添加路由</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;/register&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>:<span class="string">&#x27;register&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">Register</span></span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>
<p>设置 404 页面</p>
<ol>
<li>新建 &#x2F;src&#x2F;views&#x2F;404.vue 组件</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;notfound&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../assets/404.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;页面没找到&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.notfound</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">height</span>:<span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">overflow</span>: hidden;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.notfound</span> <span class="selector-tag">img</span>&#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="attribute">height</span>:<span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>在 router.js中设置路由</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//router.js</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">      <span class="attr">name</span>:<span class="string">&#x27;/404&#x27;</span>,</span><br><span class="line">      <span class="attr">component</span>: <span class="title class_">NotFound</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="注册表单"><a href="#注册表单" class="headerlink" title="注册表单"></a>注册表单</h4><p>此后大量使用 element 的代码，为避免过长，仅提一些重要的点，其他请结合原文件阅读笔记</p>
<h4 id="密码规则与验证"><a href="#密码规则与验证" class="headerlink" title="密码规则与验证"></a>密码规则与验证</h4><h4 id="加载动画和消息提示"><a href="#加载动画和消息提示" class="headerlink" title="加载动画和消息提示"></a>加载动画和消息提示</h4><p>安装 axios</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span>client目录下</span><br><span class="line">npm install axios</span><br></pre></td></tr></table></figure>
<p>新建 &#x2F;src&#x2F;http.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Message</span>,<span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loading;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">startLoading</span>(<span class="params"></span>)&#123;</span><br><span class="line">  loading = <span class="title class_">Loading</span>.<span class="title function_">service</span>(&#123;</span><br><span class="line">    <span class="attr">lock</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">text</span>:<span class="string">&quot;拼命加载中...&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>:<span class="string">&#x27;rgba(0,0,0,0.7)&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">endLoading</span>(<span class="params"></span>)&#123;</span><br><span class="line">  loading.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求拦截</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加载动画</span></span><br><span class="line">  <span class="title function_">startLoading</span>();</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截</span></span><br><span class="line"></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//结束加载动画</span></span><br><span class="line">  <span class="title function_">endLoading</span>();</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//错误提醒</span></span><br><span class="line">  <span class="title function_">endLoading</span>();</span><br><span class="line">  <span class="title class_">Message</span>.<span class="title function_">error</span>(error.<span class="property">response</span>.<span class="property">data</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios;</span><br></pre></td></tr></table></figure>

<p>在main.js中引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;./http&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$axios</span> = axios;</span><br></pre></td></tr></table></figure>

<p>http.js内容(后会变动)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Message</span>,<span class="title class_">Loading</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;element-ui&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loading;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">startLoading</span>(<span class="params"></span>)&#123;</span><br><span class="line">  loading = <span class="title class_">Loading</span>.<span class="title function_">service</span>(&#123;</span><br><span class="line">    <span class="attr">lock</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">text</span>:<span class="string">&quot;拼命加载中...&quot;</span>,</span><br><span class="line">    <span class="attr">background</span>:<span class="string">&#x27;rgba(0,0,0,0.7)&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">endLoading</span>(<span class="params"></span>)&#123;</span><br><span class="line">  loading.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//请求拦截</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加载动画</span></span><br><span class="line">  <span class="title function_">startLoading</span>();</span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截</span></span><br><span class="line"></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//结束加载动画</span></span><br><span class="line">  <span class="title function_">endLoading</span>();</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//错误提醒</span></span><br><span class="line">  <span class="title function_">endLoading</span>();</span><br><span class="line">  <span class="title class_">Message</span>.<span class="title function_">error</span>(error.<span class="property">response</span>.<span class="property">data</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> axios;</span><br></pre></td></tr></table></figure>

<h4 id="配置前端跨域请求-使用vue-cli项目"><a href="#配置前端跨域请求-使用vue-cli项目" class="headerlink" title="配置前端跨域请求(使用vue-cli项目)"></a>配置前端跨域请求(使用vue-cli项目)</h4><p>新建 vue.config.js ，在client目录下,内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> debug = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">baseUrl</span>:<span class="string">&#x27;/&#x27;</span>, <span class="comment">//根域上下文目录</span></span><br><span class="line">  <span class="attr">outputDir</span>:<span class="string">&#x27;dist&#x27;</span>, <span class="comment">//构建输出目录</span></span><br><span class="line">  <span class="attr">assetsDir</span>: <span class="string">&#x27;assets&#x27;</span>, <span class="comment">//静态资源目录（js,css,img,fonts）</span></span><br><span class="line">  <span class="attr">lintOnSave</span>:<span class="literal">false</span>, <span class="comment">//是否开启eslint保存检测，有效值：true|false|&#x27;error&#x27;</span></span><br><span class="line">  <span class="attr">runtimeCompiler</span>:<span class="literal">true</span>, <span class="comment">//运行时版本是否需要编译</span></span><br><span class="line">  <span class="attr">transpileDependencies</span>:[], <span class="comment">//默认babel-loader忽略node_modules,这里可增加例外的依赖包名</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>:<span class="literal">true</span>, <span class="comment">//是否在构建生产包时生产 sourceMap 文件，false将提高构建速度</span></span><br><span class="line">  <span class="attr">configureWebpack</span>:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//webpack 配置，值为对象时会合并配置，为方法时会改写配置</span></span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">      <span class="comment">//开发环境配置</span></span><br><span class="line">      config.<span class="property">devtool</span> = <span class="string">&#x27;cheap-module-eval-source-map&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//生产环境配置</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Object.assign(config,&#123; //开发生产共同配置</span></span><br><span class="line">    <span class="comment">//   resolve:&#123;</span></span><br><span class="line">    <span class="comment">//     alias:&#123;</span></span><br><span class="line">    <span class="comment">//       &#x27;@&#x27;:path.resolve(__dirname,&#x27;./src&#x27;),</span></span><br><span class="line">    <span class="comment">//       &#x27;@c&#x27;:path.resolve(__dirname,&#x27;./src/components&#x27;),</span></span><br><span class="line">    <span class="comment">//       &#x27;vue$&#x27;:&#x27;vue/dist/vue.esm.js&#x27;</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">chainWebpack</span>:<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//webpack链接API，用于生成和修改webpack配置，</span></span><br><span class="line">    <span class="comment">// https://github.com/vuejs/vue-cli/blob/dev/docs/webpack.md</span></span><br><span class="line">    <span class="keyword">if</span>(debug)&#123;</span><br><span class="line">      <span class="comment">//本地开发配置</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//生产开发配置</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">parallel</span>:<span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).<span class="title function_">cpus</span>().<span class="property">length</span> &gt; <span class="number">1</span>, <span class="comment">//构建时开启多进程处理babel编译</span></span><br><span class="line">  <span class="attr">pluginOptions</span>:&#123;</span><br><span class="line">    <span class="comment">//第三方插件配置</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">pwa</span>:&#123;</span><br><span class="line">    <span class="comment">//单页插件相关配置</span></span><br><span class="line">    <span class="comment">// https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devServer</span>:&#123;</span><br><span class="line">    <span class="attr">open</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">host</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>:<span class="number">8080</span>,</span><br><span class="line">    <span class="attr">https</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">hotOnly</span>:<span class="literal">false</span>,</span><br><span class="line">    <span class="attr">proxy</span>:&#123;<span class="comment">//配置跨域</span></span><br><span class="line">      <span class="string">&#x27;/api&#x27;</span>:&#123;</span><br><span class="line">        <span class="attr">target</span>:<span class="string">&#x27;http://localhost:5000/api&#x27;</span>,</span><br><span class="line">        <span class="attr">ws</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">changOrigin</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>:&#123;</span><br><span class="line">          <span class="string">&#x27;^/api&#x27;</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">before</span>:<span class="function"><span class="params">app</span> =&gt;</span> &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样就可以访问我们的后台了</p>
</blockquote>
<p>在register.vue中配置跳转,这样就可以注册用户了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">submitForm</span>(<span class="params">formName</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>[formName].<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$axios</span></span><br><span class="line">            .<span class="title function_">post</span>(<span class="string">&quot;/api/users/register&quot;</span>, <span class="variable language_">this</span>.<span class="property">registerUser</span>)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">//注册成功</span></span><br><span class="line">              <span class="variable language_">this</span>.$message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&quot;账号注册成功！&quot;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&quot;success&quot;</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>); </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="登录逻辑"><a href="#登录逻辑" class="headerlink" title="登录逻辑"></a>登录逻辑</h4><p>新建组件和添加路由参考注册，这里讲下登录逻辑. Login.vue</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">submitForm</span>(<span class="params">formName</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$refs</span>[formName].<span class="title function_">validate</span>(<span class="function"><span class="params">valid</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (valid) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$axios</span>.<span class="title function_">post</span>(<span class="string">&quot;/api/users/login&quot;</span>, <span class="variable language_">this</span>.<span class="property">loginUser</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//拿到token</span></span><br><span class="line">            <span class="keyword">const</span> &#123; token &#125; = res.<span class="property">data</span>;</span><br><span class="line">            <span class="comment">// 存储到localStorage</span></span><br><span class="line">             <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;eleToken&quot;</span>, token);</span><br><span class="line">             <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&#x27;/index&#x27;</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="路由守卫"><a href="#路由守卫" class="headerlink" title="路由守卫"></a>路由守卫</h4><p>router.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路由守卫</span></span><br><span class="line">router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to, <span class="keyword">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//如果token存在返回boolean值true,否则false</span></span><br><span class="line">  <span class="keyword">const</span> isLogin = <span class="variable language_">localStorage</span>.<span class="property">eleToken</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span>(to.<span class="property">path</span> == <span class="string">&quot;/login&quot;</span> || to.<span class="property">path</span> == <span class="string">&quot;/register&quot;</span>)&#123;</span><br><span class="line">    <span class="title function_">next</span>();</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//如果有token,为true,就正常跳转;为false,就跳转到登录页</span></span><br><span class="line">    isLogin ? <span class="title function_">next</span>() : <span class="title function_">next</span>(<span class="string">&quot;login&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="设置token和token-过期"><a href="#设置token和token-过期" class="headerlink" title="设置token和token 过期"></a>设置token和token 过期</h4><p>在请求拦截中,如果存在token,就把token设置到请求头中.<br>在响应拦截里的error里,如果状态码是401未授权,表示token过期.就在error返回函数里清除token,并跳转到登录页.</p>
<p>http.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//请求拦截</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">request</span>.<span class="title function_">use</span>(<span class="function"><span class="params">config</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//加载动画</span></span><br><span class="line">  <span class="title function_">startLoading</span>();</span><br><span class="line">  <span class="comment">//如果有token</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable language_">localStorage</span>.<span class="property">eleToken</span>)&#123;</span><br><span class="line">  <span class="comment">//设置统一的请求头header</span></span><br><span class="line">  config.<span class="property">headers</span>.<span class="property">Authorization</span> = <span class="variable language_">localStorage</span>.<span class="property">eleToken</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> config;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//响应拦截</span></span><br><span class="line">axios.<span class="property">interceptors</span>.<span class="property">response</span>.<span class="title function_">use</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//结束加载动画</span></span><br><span class="line">  <span class="title function_">endLoading</span>();</span><br><span class="line">  <span class="keyword">return</span> response;</span><br><span class="line">&#125;,<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//错误提醒</span></span><br><span class="line">  <span class="title function_">endLoading</span>();</span><br><span class="line">  <span class="title class_">Message</span>.<span class="title function_">error</span>(error.<span class="property">response</span>.<span class="property">data</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//获取错误状态码</span></span><br><span class="line">  <span class="keyword">const</span> &#123; status &#125; = error.<span class="property">response</span>;</span><br><span class="line">  <span class="comment">//401未授权,表示token过期</span></span><br><span class="line">  <span class="keyword">if</span> (status == <span class="number">401</span>)&#123;</span><br><span class="line">    <span class="title class_">Message</span>.<span class="title function_">error</span>(<span class="string">&#x27;token失效，请重新登录！&#x27;</span>);</span><br><span class="line">    <span class="comment">//清除token</span></span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;eleToken&quot;</span>);</span><br><span class="line">    <span class="comment">//跳转到登录页面</span></span><br><span class="line">    router.<span class="title function_">push</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h4 id="解析token存储到Vuex中"><a href="#解析token存储到Vuex中" class="headerlink" title="解析token存储到Vuex中"></a>解析token存储到Vuex中</h4><p>安装解析token的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install jwt-decode</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Login.vue</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//引入解析模块</span></span><br><span class="line"><span class="keyword">import</span> jwt_decode <span class="keyword">from</span> <span class="string">&#x27;jwt_decode&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//解析token</span></span><br><span class="line"><span class="keyword">const</span> decoded = <span class="title function_">jwt_decode</span>(token)</span><br><span class="line"></span><br><span class="line"><span class="comment">//token存储到vuex中</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;setAuthenticated&quot;</span>, !<span class="variable language_">this</span>.<span class="title function_">isEmpty</span>(decoded));</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;setUser&quot;</span>, decoded);</span><br></pre></td></tr></table></figure>
<h4 id="设置Vuex"><a href="#设置Vuex" class="headerlink" title="设置Vuex"></a>设置Vuex</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//store.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//登录成功后将数据存储到Vuex中</span></span><br><span class="line"><span class="comment">//判断是否认证通过</span></span><br><span class="line"><span class="keyword">const</span> types = &#123;</span><br><span class="line">  <span class="attr">SET_AUTHENTICATED</span>: <span class="string">&quot;SET_AUTHENTICATED&quot;</span>,</span><br><span class="line">  <span class="attr">SET_USER</span>: <span class="string">&quot;SET_USER&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">isAuthenticated</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">user</span>: &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  <span class="attr">isAuthenticated</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">isAuthenticated</span>,</span><br><span class="line">  <span class="attr">user</span>: <span class="function"><span class="params">state</span> =&gt;</span> state.<span class="property">user</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  [types.<span class="property">SET_AUTHENTICATED</span>](state, isAuthenticated) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isAuthenticated) state.<span class="property">isAuthenticated</span> = isAuthenticated;</span><br><span class="line">    <span class="keyword">else</span> state.<span class="property">isAuthenticated</span> = <span class="literal">false</span>;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  [types.<span class="property">SET_USER</span>](state, user) &#123;</span><br><span class="line">    <span class="keyword">if</span> (user) state.<span class="property">user</span> = user;</span><br><span class="line">    <span class="keyword">else</span> state.<span class="property">user</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  <span class="attr">setAuthenticated</span>: <span class="function">(<span class="params">&#123; commit &#125;, isAuthenticated</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">commit</span>(types.<span class="property">SET_AUTHENTICATED</span>, isAuthenticated);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">setUser</span>: <span class="function">(<span class="params">&#123; commit &#125;, user</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">commit</span>(types.<span class="property">SET_USER</span>, user);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//清除当前的状态</span></span><br><span class="line">  <span class="attr">clearCurrentState</span>: <span class="function">(<span class="params">&#123; commit &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">commit</span>(types.<span class="property">SET_AUTHENTICATED</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="title function_">commit</span>(types.<span class="property">SET_USER</span>, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> <span class="title class_">Vuex</span>.<span class="title class_">Store</span>(&#123;</span><br><span class="line">  state,</span><br><span class="line">  getters,</span><br><span class="line">  mutations,</span><br><span class="line">  actions</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>方法: 判断是否为空</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">isEmpty</span>(<span class="params">value</span>)&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    value === <span class="literal">undefined</span> ||</span><br><span class="line">    value === <span class="literal">null</span> ||</span><br><span class="line">    (<span class="keyword">typeof</span> value === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="title class_">Object</span>.<span class="title function_">keys</span>(value).<span class="property">length</span> === <span class="number">0</span>) ||</span><br><span class="line">    (<span class="keyword">typeof</span> value === <span class="string">&quot;string&quot;</span> &amp;&amp; value.<span class="title function_">trim</span>().<span class="property">length</span> === <span class="number">0</span>)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>

<h4 id="在根组件App-vue中判断token"><a href="#在根组件App-vue中判断token" class="headerlink" title="在根组件App.vue中判断token"></a>在根组件App.vue中判断token</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">localStorage</span>.<span class="property">eleToken</span>) &#123;</span><br><span class="line">    <span class="comment">//解析token</span></span><br><span class="line">    <span class="keyword">const</span> decoded = <span class="title function_">jwt_decode</span>(<span class="variable language_">localStorage</span>.<span class="property">eleToken</span>);</span><br><span class="line">    <span class="comment">//token存储到vuex中</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;setAuthenticated&quot;</span>, !<span class="variable language_">this</span>.<span class="title function_">isEmpty</span>(decoded));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;setUser&quot;</span>, decoded);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h4><p>新建&#x2F;component&#x2F;HeadNav.vue</p>
<p>将HeadNav.vue引入到Index.vue,并注册,然后template中调用</p>
<p>在HeadNav.vue中布局</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//看代码</span></span><br></pre></td></tr></table></figure>

<p>写向下箭头的方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">methods</span>: &#123;</span><br><span class="line">    <span class="title function_">setDialogInfo</span>(<span class="params">cmdItem</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (cmdItem) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;info&quot;</span>:</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">showInfoList</span>();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;logout&quot;</span>:</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">logout</span>();</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">showInfoList</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;个人信息&quot;</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">logout</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">//清除token</span></span><br><span class="line">      <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(<span class="string">&quot;eleToken&quot;</span>);</span><br><span class="line">      <span class="comment">//设置Vuex store</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="title function_">dispatch</span>(<span class="string">&quot;clearCurrentState&quot;</span>);</span><br><span class="line">      <span class="comment">//跳转到login</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">$router</span>.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//vuex中记得在actions中添加clearCurrentState</span></span><br></pre></td></tr></table></figure>

<h4 id="个人信息"><a href="#个人信息" class="headerlink" title="个人信息"></a>个人信息</h4><p>新建views&#x2F;Home.vue</p>
<p>在router.js中设置二级路由</p>
<p>新建views&#x2F;InfoShow.vue</p>
<h4 id="侧面导航栏"><a href="#侧面导航栏" class="headerlink" title="侧面导航栏"></a>侧面导航栏</h4><p>新建assets&#x2F;component&#x2F;LeftMenu.vue</p>
<p>编辑收支类型</p>
<h4 id="创建资金列表"><a href="#创建资金列表" class="headerlink" title="创建资金列表"></a>创建资金列表</h4><p>新建views&#x2F;FundList.vue</p>
<p>添加各个按钮,事件<br>设置添加按钮,新增对话框component&#x2F;Dialog.vue组件</p>
<h4 id="编辑和添加"><a href="#编辑和添加" class="headerlink" title="编辑和添加"></a>编辑和添加</h4><p>编辑和添加功能雷同,把formData放到父级fundlist中,并用props传递<br>修改父级中dialog的属性,新增title,options,方便切换弹窗的标题和选项</p>
<p>在handleEdit中修改dialog的title,当点击编辑时title就切换成’编辑’<br>编辑时已经拿到数据了.this.formData的值也就是传入值了<br>同样,添加的也可以新增this.formData.但是添加的数据默认是空的</p>
<p>在onSubmit中判断提交的类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> url = <span class="variable language_">this</span>.<span class="property">dialog</span>.<span class="property">option</span> == <span class="string">&quot;add&quot;</span> ? <span class="string">&quot;add&quot;</span> : <span class="string">`edit/<span class="subst">$&#123;<span class="variable language_">this</span>.formData.id&#125;</span>`</span></span><br></pre></td></tr></table></figure>
<h4 id="删除按钮"><a href="#删除按钮" class="headerlink" title="删除按钮"></a>删除按钮</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$axios</span>.<span class="title function_">delete</span>(<span class="string">`/api/profiles/delete/<span class="subst">$&#123;row._id&#125;</span>`</span>)</span><br><span class="line"><span class="comment">//之后可以then调用$message弹出删除成功的提示</span></span><br></pre></td></tr></table></figure>
<h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><p>elementUI布局整行分为24列.<br>使用标准分页</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-pagination</span><br><span class="line">  @size-change=<span class="string">&quot;handleSizeChange&quot;</span></span><br><span class="line">  @current-change=<span class="string">&quot;handleCurrentChange&quot;</span></span><br><span class="line">  :current-page=<span class="string">&quot;currentPage4&quot;</span></span><br><span class="line">  :page-sizes=<span class="string">&quot;[100, 200, 300, 400]&quot;</span></span><br><span class="line">  :page-size=<span class="string">&quot;100&quot;</span></span><br><span class="line">  layout=<span class="string">&quot;total, sizes, prev, pager, next, jumper&quot;</span></span><br><span class="line">  :total=<span class="string">&quot;400&quot;</span>&gt;</span><br><span class="line">&lt;/el-pagination&gt;</span><br></pre></td></tr></table></figure>
<p>  &#x2F;&#x2F;修改绑定数据</p>
<p>  &#x2F;&#x2F;设置全部数据容器(数组)<br>  allTableData: []</p>
<p>  &#x2F;&#x2F;在获取数据时就开始设置分页数据<br>  this.setPaginations()</p>
<p>  在setPaginations中设置默认属性</p>
<h4 id="筛选和权限"><a href="#筛选和权限" class="headerlink" title="筛选和权限"></a>筛选和权限</h4><p>定义筛选组件<el-form-item label="按照时间筛选"><br>复制elementUI的时间选择器.<br>添加筛选按钮,绑定筛选事件handleSearch()<br>绑定开始时间,结束时间.在data中定义开始时间startTime,结束时间endTime</p>
<p>添加过滤容器filterTableData:{},在getProfile()时也存储一次.</p>
<h5 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h5><p>使用计算属性computed获取此时用户的身份</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">    <span class="title function_">user</span>(<span class="params"></span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">$store</span>.<span class="property">getters</span>.<span class="property">user</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>使用v-if决定是否可以使用添加,编辑,删除操作.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v-<span class="keyword">if</span>=<span class="string">&quot;user.indentity == &#x27;manager&#x27;&quot;</span></span><br><span class="line"><span class="comment">//将此判断加到添加事件之前和label=&#x27;操作&#x27;后</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/27/%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%90%8E%E5%8F%B0%E8%B5%84%E9%87%91%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E9%A1%B9%E7%9B%AE/" data-id="cl9xpujrp003qdmopcku8ffx1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/28/yuque/%E8%99%9A%E6%8B%9Fdom/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          虚拟dom
        
      </div>
    </a>
  
  
    <a href="/2019/11/27/cNode%E7%A4%BE%E5%8C%BA%E9%A1%B9%E7%9B%AE/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">cNode社区项目</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/HTML%E5%9F%BA%E7%A1%80/">HTML基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/HTTP%E5%9F%BA%E7%A1%80/">HTTP基础</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/">HTML5</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/HTML5/canvas/">canvas</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/">JS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JS/ES6/">ES6</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/JS%E5%9F%BA%E7%A1%80/">JS基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/JS%E8%BF%9B%E9%98%B6/">JS进阶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/jQuery/">jQuery</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JS/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">前端工程化</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/css/">css</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/css/css3/">css3</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/Node-js/">Node.js</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/" rel="tag">HTML</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E5%AE%89%E5%85%A8/" rel="tag">HTTP安全</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTTP%E8%BF%9B%E9%98%B6/" rel="tag">HTTP进阶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS%E6%B7%B1%E5%85%A5/" rel="tag">JS深入</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS%E8%BF%9B%E9%98%B6/" rel="tag">JS进阶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-SSR/" rel="tag">Vue-SSR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js/" rel="tag">Vue.js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js%E5%9F%BA%E7%A1%80/" rel="tag">Vue.js基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue-js%E8%BF%9B%E9%98%B6/" rel="tag">Vue.js进阶</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/" rel="tag">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css3/" rel="tag">css3</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">html5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag">后端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9F%BA%E7%A1%80/" rel="tag">基础</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" rel="tag">小程序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" rel="tag">移动端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="tag">面试题</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A1%B9%E7%9B%AE/" rel="tag">项目</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/HTML/" style="font-size: 18.57px;">HTML</a> <a href="/tags/HTTP%E5%AE%89%E5%85%A8/" style="font-size: 10px;">HTTP安全</a> <a href="/tags/HTTP%E8%BF%9B%E9%98%B6/" style="font-size: 10px;">HTTP进阶</a> <a href="/tags/JS/" style="font-size: 12.86px;">JS</a> <a href="/tags/JS%E6%B7%B1%E5%85%A5/" style="font-size: 10px;">JS深入</a> <a href="/tags/JS%E8%BF%9B%E9%98%B6/" style="font-size: 11.43px;">JS进阶</a> <a href="/tags/React/" style="font-size: 17.14px;">React</a> <a href="/tags/Vue-SSR/" style="font-size: 15.71px;">Vue-SSR</a> <a href="/tags/Vue-js/" style="font-size: 20px;">Vue.js</a> <a href="/tags/Vue-js%E5%9F%BA%E7%A1%80/" style="font-size: 11.43px;">Vue.js基础</a> <a href="/tags/Vue-js%E8%BF%9B%E9%98%B6/" style="font-size: 17.14px;">Vue.js进阶</a> <a href="/tags/android/" style="font-size: 11.43px;">android</a> <a href="/tags/css/" style="font-size: 14.29px;">css</a> <a href="/tags/css3/" style="font-size: 11.43px;">css3</a> <a href="/tags/html5/" style="font-size: 12.86px;">html5</a> <a href="/tags/javascript/" style="font-size: 15.71px;">javascript</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 11.43px;">后端</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size: 11.43px;">基础</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 11.43px;">小程序</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" style="font-size: 10px;">移动端</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 14.29px;">面试题</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 12.86px;">项目</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">十一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/11/01/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2022/10/25/yuque/%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/">自动化构建工具</a>
          </li>
        
          <li>
            <a href="/2022/10/25/yuque/%E8%84%9A%E6%89%8B%E6%9E%B6/">脚手架</a>
          </li>
        
          <li>
            <a href="/2022/10/24/yuque/React%20Query/">React Query</a>
          </li>
        
          <li>
            <a href="/2022/10/19/yuque/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/">常用组件</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Zax Tseng<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>