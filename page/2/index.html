<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="ZAX">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="ZAX">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zax Tseng">
<meta property="article:tag" content="javascript, React, Vue, HTML5">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ZAX</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ZAX</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zax Tseng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">109</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/25/%E8%84%9A%E6%89%8B%E6%9E%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/25/%E8%84%9A%E6%89%8B%E6%9E%B6/" class="post-title-link" itemprop="url">脚手架</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-25 15:56:35" itemprop="dateCreated datePublished" datetime="2022-10-25T15:56:35+08:00">2022-10-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:07" itemprop="dateModified" datetime="2022-11-11T14:47:07+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Yeoman"><a href="#Yeoman" class="headerlink" title="Yeoman"></a>Yeoman</h1><p>构建定制化的脚手架.</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add yo</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn global add generator-node</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo node</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo node:cli</span><br></pre></td></tr></table></figure>

<h2 id="小问题"><a href="#小问题" class="headerlink" title="小问题"></a>小问题</h2><p>这里执行当前项目的命令时会遇到权限问题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">link</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">chmod</span> -R 777 目录名</span><br></pre></td></tr></table></figure>

<p>这里需要目录名,要么是绝对路径,要么可以先返回到上一层,再给这个文件夹权限.</p>
<h2 id="自定义-generator"><a href="#自定义-generator" class="headerlink" title="自定义 generator"></a>自定义 generator</h2><h3 id="Yeoman-使用步骤总结"><a href="#Yeoman-使用步骤总结" class="headerlink" title="Yeoman 使用步骤总结"></a>Yeoman 使用步骤总结</h3><ul>
<li>明确需求</li>
<li>找到合适的<a target="_blank" rel="noopener" href="https://yeoman.io/generators/">Generator</a></li>
<li>全局范围安装找到 Generator</li>
<li>通过 yo 运行对应的 Generator</li>
<li>通过命令行交互填写选项</li>
<li>生成你需要的项目结构</li>
</ul>
<h3 id="创建-Generator-模块"><a href="#创建-Generator-模块" class="headerlink" title="创建 Generator 模块"></a>创建 Generator 模块</h3><p>Generator 本质上就是一个 NPM 模块<br>Generator 基本结构</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|— generator-sample</span><br><span class="line">| |— generators/ ------------- 生成器目录</span><br><span class="line">| | |— app/ ----------------- 默认生成器目录</span><br><span class="line">| |— components -------- 模板文件</span><br><span class="line">| |— index.js ---------- 默认生成器实现</span><br><span class="line">|— package.json --------------- 模块包配置文件</span><br></pre></td></tr></table></figure>

<p>如果需要提供多个 Sub Generator，可以在 app 目录添加新的生成器目录</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|— generator-sample</span><br><span class="line">| |— generators/ ------------ 生成器目录</span><br><span class="line">| | |— app/ ---------------- 默认生成器目录</span><br><span class="line">| | | |— components ------- 模板文件</span><br><span class="line">| | | |— index.js --------- 默认生成器实现</span><br><span class="line">+| |— component/ ------------- 其他生产器目录</span><br><span class="line">+| |— index.js ------------ 其他生成器实现</span><br><span class="line">|— package.json -------------- 模块包配置文件</span><br></pre></td></tr></table></figure>

<p>Yeoman Generator 模快的名称必须是<code>generator-</code>，否则 Yeoman 后续工作无法找到你的生成器模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app/index.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 此文件为 Generator 的核心入口</span></span><br><span class="line"><span class="comment">// 需要导出一个继承自 Yeoman Generator 的类</span></span><br><span class="line"><span class="comment">// Yeoman Generator 在工作时会自动调用我们在此类型中定义的一些生命周期方法</span></span><br><span class="line"><span class="comment">// 我们在这些生命周期方法中通过调用父类提供的一些工具方法实现一些功能，例如文件写入</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Generator</span> = <span class="built_in">require</span>(<span class="string">&quot;yeoman-generator&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="title function_">writing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Yeoman 自动在生成文件阶段调用此方法</span></span><br><span class="line">    <span class="comment">// 我们尝试往项目目录中写入文件</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">write</span>(<span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="string">&quot;temp.txt&quot;</span>), <span class="title class_">Math</span>.<span class="title function_">random</span>().<span class="title function_">toString</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>在生成器目录终端执行<code>yarn link</code></li>
<li>在新建项目终端执行<code>yo sample</code></li>
</ul>
<h3 id="根据模板创建文件"><a href="#根据模板创建文件" class="headerlink" title="根据模板创建文件"></a>根据模板创建文件</h3><p>在生成器目录下添加 template 目录，模板中遵循 EJS 模板语法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="title function_">writing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Yeoman 自动在生成文件阶段调用此方法</span></span><br><span class="line">    <span class="comment">// 通过模板方式写入文件到目标目录</span></span><br><span class="line">    <span class="comment">// 模板文件路径</span></span><br><span class="line">    <span class="keyword">const</span> tmpl = <span class="variable language_">this</span>.<span class="title function_">templatePath</span>(<span class="string">&quot;foo.txt&quot;</span>); <span class="comment">// 自动获取当前生成器下template目录下的文件路径</span></span><br><span class="line">    <span class="comment">// 输出目标路径</span></span><br><span class="line">    <span class="keyword">const</span> outPut = <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="string">&quot;foo.txt&quot;</span>);</span><br><span class="line">    <span class="comment">// 模板数据上下文</span></span><br><span class="line">    <span class="keyword">const</span> context = &#123; <span class="attr">title</span>: <span class="string">&quot;Hello zyh~&quot;</span>, <span class="attr">success</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">copyTpl</span>(tmpl, outPut, context);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="接收用户输入（终端命令行交互）prompting-方法"><a href="#接收用户输入（终端命令行交互）prompting-方法" class="headerlink" title="接收用户输入（终端命令行交互）prompting()方法"></a>接收用户输入（终端命令行交互）prompting()方法</h3><p>Yeoman 在询问用户环节会调用<code>prompting()</code>方法，在此方法中可以调用父类的 <code>prompt()</code> 方法发出对用户的命令行询问<br><code>prompt()</code>方法参数为一个数组，数组的每一个元素是一个问题对象(命令行交互)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Generator</span> = <span class="built_in">require</span>(<span class="string">&quot;yeoman-generator&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="title function_">prompting</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Yeoman 在询问用户环节会自动调用此方法</span></span><br><span class="line">    <span class="comment">// 在此方法中可以调用父类的 prompt() 方法发出对用户的命令行询问</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数组的每个元素都是一个问题（终端命令行交互）</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">prompt</span>([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>, <span class="comment">// input:使用用户输入的方式</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;name&quot;</span>, <span class="comment">// value是最终得到结果的键（用户输入的值的键）</span></span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;Your project name&quot;</span>, <span class="comment">// 终端界面给用户的提示（问题）</span></span><br><span class="line">        <span class="attr">default</span>: <span class="variable language_">this</span>.<span class="property">appname</span>, <span class="comment">// 默认值，如果用户不输入则使用默认值，appname 为项目生成目录名称</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ]).<span class="title function_">then</span>(<span class="function">(<span class="params">answers</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 用户交互选择的结果</span></span><br><span class="line">      <span class="comment">// answers =&gt; &#123; name: &#x27;user input value&#x27; &#125;</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">answers</span> = answers;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">writing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// Yeoman 自动在生成文件阶段调用此方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模板文件路径</span></span><br><span class="line">    <span class="keyword">const</span> tmp = <span class="variable language_">this</span>.<span class="title function_">templatePath</span>(<span class="string">&quot;bar.html&quot;</span>);</span><br><span class="line">    <span class="comment">//输出模板路径</span></span><br><span class="line">    <span class="keyword">const</span> outPut = <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="string">&quot;bar.html&quot;</span>);</span><br><span class="line">    <span class="comment">// 模板数据上下文</span></span><br><span class="line">    <span class="keyword">const</span> context = <span class="variable language_">this</span>.<span class="property">answers</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">copyTpl</span>(tmp, outPut, context);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="生成-vue-项目结构"><a href="#生成-vue-项目结构" class="headerlink" title="生成 vue 项目结构"></a>生成 vue 项目结构</h3><p>如果模板文件中有<code>&#39;&lt;%= BASE_URL %&gt;&#39;</code>需要添加一个<code>%</code>进行转义，<code>&#39;&lt;%%= BASE_URL %&gt;&#39;</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Generator</span> = <span class="built_in">require</span>(<span class="string">&quot;yeoman-generator&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">class</span> <span class="title class_">extends</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="title function_">prompting</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">prompt</span>([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;Your project name&quot;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="variable language_">this</span>.<span class="property">appname</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;list&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;tool&quot;</span>,</span><br><span class="line">        <span class="attr">choices</span>: [<span class="string">&quot;yarn&quot;</span>, <span class="string">&quot;npm&quot;</span>],</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;请选择版本管理工具&quot;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="string">&quot;yarn&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]).<span class="title function_">then</span>(<span class="function">(<span class="params">answers</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">answers</span> = answers;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">writing</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 把每一个文件都通过模板转换到目标路径</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// templates目录下的模板文件相对路径</span></span><br><span class="line">    <span class="keyword">const</span> templates = [</span><br><span class="line">      <span class="string">&quot;.browserslistrc&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.editorconfig&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.env.development&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.env.production&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.eslintrc.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;.gitignore&quot;</span>,</span><br><span class="line">      <span class="string">&quot;babel.config.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;package.json&quot;</span>,</span><br><span class="line">      <span class="string">&quot;postcss.config.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;README.md&quot;</span>,</span><br><span class="line">      <span class="string">&quot;public/favicon.ico&quot;</span>,</span><br><span class="line">      <span class="string">&quot;public/index.html&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/App.vue&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/main.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/router.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/assets/logo.png&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/components/HelloWorld.vue&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/store/actions.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/store/getters.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/store/index.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/store/mutations.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/store/state.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/utils/request.js&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/views/About.vue&quot;</span>,</span><br><span class="line">      <span class="string">&quot;src/views/Home.vue&quot;</span>,</span><br><span class="line">    ];</span><br><span class="line">    templates.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> temp = <span class="variable language_">this</span>.<span class="title function_">templatePath</span>(item);</span><br><span class="line">      <span class="keyword">const</span> outPut = <span class="variable language_">this</span>.<span class="title function_">destinationPath</span>(<span class="variable language_">this</span>.<span class="property">answers</span>.<span class="property">name</span> + <span class="string">&quot;/&quot;</span> + item);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">fs</span>.<span class="title function_">copyTpl</span>(temp, outPut, <span class="variable language_">this</span>.<span class="property">answers</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 进入项目目录，根据用户选择的管理工具安装依赖</span></span><br><span class="line">  <span class="title function_">install</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, tool &#125; = <span class="variable language_">this</span>.<span class="property">answers</span>;</span><br><span class="line">    <span class="keyword">const</span> npmDir = process.<span class="title function_">cwd</span>() + <span class="string">&quot;/&quot;</span> + name;</span><br><span class="line">    process.<span class="title function_">chdir</span>(npmDir);</span><br><span class="line">    tool === <span class="string">&quot;yarn&quot;</span> ? <span class="variable language_">this</span>.<span class="title function_">yarnInstall</span>() : <span class="variable language_">this</span>.<span class="title function_">npmInstall</span>();</span><br><span class="line">    <span class="comment">// this.installDependencies(&#123;</span></span><br><span class="line">    <span class="comment">//   bower: true,</span></span><br><span class="line">    <span class="comment">//   npm: true</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="发布-Generator"><a href="#发布-Generator" class="headerlink" title="发布 Generator"></a>发布 Generator</h3><ol>
<li>上传 GitHub</li>
<li><code>yarn publish</code>填写相关信息后，如果出现错误是因为使用淘宝镜像取代官方镜像，所以往 npm 仓库发布代码就会出现问题，淘宝镜像是只读镜像；<ul>
<li>可以修改本地的镜像配置；</li>
<li><code>yarn publish --registry=https://registry.yarnpkg.com</code>(官方的镜像)</li>
</ul>
</li>
<li>发布成功</li>
</ol>
<h1 id="Plop"><a href="#Plop" class="headerlink" title="Plop"></a>Plop</h1><p>小型脚手架工具.<br>相当于一个可定制化的自动生成代码文件的工具.<br>比如有一套文件,包括 js,css,还要复制很多几乎相同的页面文件,使用 Plop 就可以一键生成.</p>
<p>可以帮助我们自动生成文件</p>
<ul>
<li>将 plop 模快作为项目开发依赖安装<code>yarn add plop --dev</code></li>
<li>在项目根目录新建文件 plopfile.js 作为 Plop 入口文件，需要导出一个函数，此函数接收一个 plop 对象，用于创建生成器任务</li>
<li>在 plopfile.js 文件中定义脚手架任务</li>
<li>编写用于生成特定类型文件的模板</li>
<li>通过 Plop 提供的 CLI 运行脚手架任务<code>yarn plop component</code></li>
<li>如果执行 <code>yarn plop Home</code>，则直接把<code>Home</code>作为文件名创建相应的目录文件，如何输入的是<code>yarn plop component</code>，则会提示输入组件名</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">plop</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 第一个：生成器名字 第二个：生成器的配置选项</span></span><br><span class="line">  plop.<span class="title function_">setGenerator</span>(<span class="string">&quot;component&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">description</span>: <span class="string">`cretate a component`</span>,</span><br><span class="line">    <span class="attr">prompts</span>: [</span><br><span class="line">      <span class="comment">// 命令行问题</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;component name&quot;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="string">&quot;MyComponent&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&quot;path&quot;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&quot;output path&quot;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="string">&quot;src/components&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 完成命令行交互后，执行的一些动作</span></span><br><span class="line">    <span class="attr">actions</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;add&quot;</span>, <span class="comment">// 代表添加文件</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;&#123;&#123;path&#125;&#125;/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.js&quot;</span>, <span class="comment">// 输出路径；name为上面命令行交互中得到的name值</span></span><br><span class="line">        <span class="attr">templateFile</span>: <span class="string">&quot;plop-templates/component.hbs&quot;</span>, <span class="comment">// 添加的文件的模板文件</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;add&quot;</span>, <span class="comment">// 代表添加文件</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;&#123;&#123;path&#125;&#125;/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.css&quot;</span>, <span class="comment">// name为上面命令行交互中得到的name值</span></span><br><span class="line">        <span class="attr">templateFile</span>: <span class="string">&quot;plop-templates/component.css.hbs&quot;</span>, <span class="comment">// 添加的文件的模板文件</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;add&quot;</span>, <span class="comment">// 代表添加文件</span></span><br><span class="line">        <span class="attr">path</span>: <span class="string">&quot;&#123;&#123;path&#125;&#125;/&#123;&#123;name&#125;&#125;/&#123;&#123;name&#125;&#125;.test.js&quot;</span>, <span class="comment">// name为上面命令行交互中得到的name值</span></span><br><span class="line">        <span class="attr">templateFile</span>: <span class="string">&quot;plop-templates/component.test.hbs&quot;</span>, <span class="comment">// 添加的文件的模板文件</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="脚手架的工作原理"><a href="#脚手架的工作原理" class="headerlink" title="脚手架的工作原理"></a>脚手架的工作原理</h3><p>工作原理：启用脚手架后询问用户一些问题，将用户回答结果结合一些模板文件生成项目结构</p>
<ul>
<li>新建一个项目</li>
<li><code>yarn init -y</code>初始化，在 package.json 文件下添加<code>bin</code>字段，用于指定 CLI 的入口文件：如：<code>&quot;bin&quot;: &quot;cli.js&quot;</code></li>
<li>在项目新增 bin 入口文件 cli.js</li>
<li>Node CLI 应用入口文件必须要有这样的文件头：<code>#!/usr/bin/env node</code>，如果是 Linux 或者 macOS 系统下还需要修改此文件的读写权限为 755，具体就是通过 <code>chmod 755 cli.js</code> 实现修改</li>
<li>脚手架的工作过程：<ul>
<li>通过命令行交互询问用户问题</li>
<li>根据用户回答的结果生成文件</li>
</ul>
</li>
<li>node 中发起命令行交互方式使用<code>inquirer</code>库。安装 inquirer 库 <code>yarn add inquirer</code>；inquirer 库提供一个 prompt 方法用于发起命令行交互</li>
<li><code>commander</code>库，命令行工具</li>
<li><code>chalk</code>库，命令行输出美化</li>
<li><code>child_process</code>模块，nodejs 的子进程模块，可以运行命令、检查 npm、yarn<ul>
<li><code>child_process.execSync(&#39;yarnpkg --version&#39;).toString()</code></li>
<li><code>child_process.spawn(&#39;npm&#39;, [&#39;isntall&#39;, &#39;webpack&#39;, &#39;-D&#39;], &#123;shell: true&#125;)</code></li>
</ul>
</li>
<li><code>download-git-repo</code>库，下载仓库模板</li>
<li>编写用于生成特定类型文件的模板</li>
<li>命令行执行<code>yarn link</code>把模块 link 到全局</li>
<li>新建项目，在项目命令行执行<code>sample-scaffolding</code></li>
<li>另外 webpack 的<code>ProgressPlugin</code>插件，用于监听编译进度</li>
<li>webpack 启动的 devServer，可以通过 nodejs 的<code>os</code>模块获取本机 IP 地址</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sample-scaffolding</span><br><span class="line">|— templates</span><br><span class="line">|— cli.js</span><br><span class="line">|— package.json</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&quot;inquirer&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&quot;ejs&quot;</span>);</span><br><span class="line"></span><br><span class="line">inquirer</span><br><span class="line">  .<span class="title function_">prompt</span>([</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 命令行问题</span></span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;input&quot;</span>,</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;Project name?&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ])</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">anwsers</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 用户回答</span></span><br><span class="line">    <span class="comment">// console.log(anwsers)</span></span><br><span class="line">    <span class="comment">// 根据用户回答的结果生成文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模板目录</span></span><br><span class="line">    <span class="keyword">const</span> tmplDir = path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;templates&quot;</span>);</span><br><span class="line">    <span class="comment">// 目标目录</span></span><br><span class="line">    <span class="keyword">const</span> destDir = process.<span class="title function_">cwd</span>(); <span class="comment">// 输出目录（命令行在那执行，就输出到哪个目录）</span></span><br><span class="line">    <span class="comment">// 将模板下的文件全部转换到目标目录</span></span><br><span class="line">    fs.<span class="title function_">readdir</span>(tmplDir, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      files.<span class="title function_">forEach</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 通过模板引擎渲染文件</span></span><br><span class="line">        ejs.<span class="title function_">renderFile</span>(path.<span class="title function_">join</span>(tmplDir, file), anwsers, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 将结果写入目标文件路径</span></span><br><span class="line">          fs.<span class="title function_">writeFileSync</span>(path.<span class="title function_">join</span>(destDir, file), result);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/24/rolllup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/24/rolllup/" class="post-title-link" itemprop="url">rolllup</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-24 22:20:58" itemprop="dateCreated datePublished" datetime="2022-10-24T22:20:58+08:00">2022-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:07" itemprop="dateModified" datetime="2022-11-11T14:47:07+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="Rollup-概述"><a href="#Rollup-概述" class="headerlink" title="Rollup 概述"></a>Rollup 概述</h2><ul>
<li>Rollup 更小巧，仅仅是一款 ESM 打包器</li>
<li>Rollup 中并不支持类似 HMR 这种高级特性</li>
<li>提供一个充分利用 ESM 各项特性的高效打包器</li>
</ul>
<h2 id="Rollup-快速上手"><a href="#Rollup-快速上手" class="headerlink" title="Rollup 快速上手"></a>Rollup 快速上手</h2><ul>
<li>安装 <code>yarn add rollup --dev</code></li>
<li>打包 <code>yarn rollup ./src/index.js --format iife --file dist/bundle.js</code></li>
<li>入口文件 index.js，指定输出格式：–format，格式：iife（自执行函数），–file：输出到目录</li>
<li>没使用的不会打包，自动开启 Tree Shaking</li>
</ul>
<h2 id="Rollup-配置文件"><a href="#Rollup-配置文件" class="headerlink" title="Rollup 配置文件"></a>Rollup 配置文件</h2><ul>
<li>rollup 运行在 node 环境中</li>
<li>根目录新建 <code>rollup.config.mjs</code> 配置文件</li>
<li>rollup 会额外处理这个配置文件，所有可以使用 ESM,注意使用 esm 需要将后缀改为<code>.mjs</code></li>
<li>配置文件导出一个对象</li>
<li>通过 input 属性指定打包入口</li>
<li>通过 output 属性指定输出，该属性值是一个对象，通过 file 指定输出的文件名，format 属性指定输出格式</li>
<li>打包 <code>pnpm rollup --config rollup.config.mjs</code> 通过–config 告诉 rollup 使用配置文件，可以根据开发、生产指定对应的配置文件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">input</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">file</span>: <span class="string">&quot;dist/bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;iife&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Rollup-使用插件"><a href="#Rollup-使用插件" class="headerlink" title="Rollup 使用插件"></a>Rollup 使用插件</h2><ul>
<li>插件是 rollup 唯一的扩展途径</li>
<li>安装插件 <code>pnpm add @rollup/plugin-json -D</code> 一个可以在代码导入 json 文件的插件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-json&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">input</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">file</span>: <span class="string">&quot;dist/bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;iife&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">json</span>()],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="comment">// package.json 的属性会作为成员导出</span></span><br><span class="line"><span class="keyword">import</span> &#123; name, version &#125; <span class="keyword">from</span> <span class="string">&quot;../package&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name, version);</span><br></pre></td></tr></table></figure>

<h2 id="Rollup-加载-NPM-模块"><a href="#Rollup-加载-NPM-模块" class="headerlink" title="Rollup 加载 NPM 模块"></a>Rollup 加载 NPM 模块</h2><ul>
<li>安装插件 <code>pnpm add @rollup/plugin-node-resolve -D</code></li>
<li>安装 lodash 的 es 版本 <code>pnpm add lodash-es</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-json&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nodeResolve &#125; <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-node-resolve&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">input</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">file</span>: <span class="string">&quot;dist/bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;iife&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">json</span>(), <span class="title function_">nodeResolve</span>()],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash-es&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(_.<span class="title function_">camelCase</span>(<span class="string">&quot;hello world&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="Rollup-加载-CommonJS-模块"><a href="#Rollup-加载-CommonJS-模块" class="headerlink" title="Rollup 加载 CommonJS 模块"></a>Rollup 加载 CommonJS 模块</h2><ul>
<li>安装插件 <code>yarn add @rollup/plugin-commonjs --dev</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-json&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; nodeResolve &#125; <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-node-resolve&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> commonjs <span class="keyword">from</span> <span class="string">&quot;@rollup/plugin-commonjs&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">input</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">file</span>: <span class="string">&quot;dist/bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;iife&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">json</span>(), <span class="title function_">nodeResolve</span>(), <span class="title function_">commonjs</span>()],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cjs-module.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; <span class="attr">foo</span>: <span class="string">&quot;bar&quot;</span> &#125;;</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> cjs <span class="keyword">from</span> <span class="string">&quot;./cjs-module.js&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(cjs);</span><br></pre></td></tr></table></figure>

<h2 id="Rollup-代码拆分"><a href="#Rollup-代码拆分" class="headerlink" title="Rollup 代码拆分"></a>Rollup 代码拆分</h2><ul>
<li>可以 ESM 的动态导入方式（import()）实现模块的按需加载</li>
<li>rollup 内部会自动处理代码拆分</li>
<li>代码拆分的方式打包 formats 不可以使用 iife（自执行函数）</li>
<li>自执行函数会把所有模块放到同一个函数中，可以使用 AMD 或者 Commonjs 标准，浏览器使用 AMD</li>
<li>需要输出多个文件 output 中就不能使用 file 属性，而是使用 dis 属性 值是输出目录</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">input</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">dir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;amd&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="title function_">import</span>(<span class="string">&quot;./logger&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; log &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">log</span>(<span class="string">&quot;code splitting~&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Rollup-多入口打包"><a href="#Rollup-多入口打包" class="headerlink" title="Rollup 多入口打包"></a>Rollup 多入口打包</h2><ul>
<li>会把不同入口公共代码自动提取到单个文件中作为独立的 bundle</li>
<li>把配置文件的 input 属性值修改为一个数组，或者使用对象的方式</li>
<li>rollup 内部会自动拆分 format 要使用 AMD</li>
<li>AMD 文件不能直接引入，要使用特定的库去加载</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// input: [&#x27;src/index.js&#x27;, &#x27;src/album.js&#x27;]</span></span><br><span class="line">  <span class="attr">input</span>: &#123;</span><br><span class="line">    <span class="attr">foo</span>: <span class="string">&quot;src/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">bar</span>: <span class="string">&quot;src/album.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">dir</span>: <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="attr">format</span>: <span class="string">&quot;amd&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- AMD 标准格式的输出 bundle 不能直接引用 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;script src=&quot;foo.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 需要 Require.js 这样的库 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--data-main：指定require入口路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/requirejs@2.3.6/require.js&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">data-main</span>=<span class="string">&quot;foo.js&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Rollup-选用原则"><a href="#Rollup-选用原则" class="headerlink" title="Rollup 选用原则"></a>Rollup 选用原则</h2><ul>
<li>优势<ul>
<li>输出结果更加扁平</li>
<li>自动移除未引用的代码</li>
<li>打包结果依然完全可读</li>
</ul>
</li>
<li>缺点<ul>
<li>加载非 ESM 的第三方模块比较复杂</li>
<li>模块最终都被打包到一个函数中，无法实现 HMR</li>
<li>浏览器环境中，代码拆分功能依赖 AMD 库</li>
</ul>
</li>
<li>应用开发建议使用 webpack</li>
<li>库、框架开发建议使用 Rollup</li>
</ul>
<h2 id="Parcel-打包器"><a href="#Parcel-打包器" class="headerlink" title="Parcel 打包器"></a>Parcel 打包器</h2><ul>
<li>零配置的前端应用打包器</li>
<li>安装 <code>yarn add parcel-bundler --dev</code></li>
<li>官方建议使用 html 文件作为打包入口</li>
<li>打包 <code>yarn parcel src/index.html</code> parcel 会根据导入的模块查找 从而完成整个项目的打包，会自动开启一个服务</li>
<li>模块热更新</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">module</span>.<span class="property">hot</span>) &#123;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hmr&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>会自动安装模块依赖，如文件中导入 JQ，保存文件后，会自动安装模块</li>
<li>支持导入其他类型文件，而且是零配置的 <code>import &#39;./style.css</code> 保存就生效了</li>
<li>可以动态导入模块 import()</li>
<li>生成环境打包 <code>yarn parcel build src/index.html</code></li>
<li>内部使用多进程同时工作，构建速度快</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/24/webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/24/webpack/" class="post-title-link" itemprop="url">webpack</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-24 22:20:43" itemprop="dateCreated datePublished" datetime="2022-10-24T22:20:43+08:00">2022-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:07" itemprop="dateModified" datetime="2022-11-11T14:47:07+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一、模块化开发"><a href="#一、模块化开发" class="headerlink" title="一、模块化开发"></a>一、模块化开发</h1><h2 id="Commonjs-规范"><a href="#Commonjs-规范" class="headerlink" title="Commonjs 规范"></a>Commonjs 规范</h2><ul>
<li>Commonjs 是以同步模式加载模块</li>
<li>一个文件就是一个模块</li>
<li>每个模块都有单独的作用域</li>
<li>通过 module.exports 导出成员</li>
<li>通过 require 函数载入模块</li>
</ul>
<h2 id="ES-Module-特性"><a href="#ES-Module-特性" class="headerlink" title="ES Module 特性"></a>ES Module 特性</h2><p>通过给 script 添加 type &#x3D; module 的属性，就可以以 ES Module 的标准执行其中的 js 代码了</p>
<ul>
<li>自动采用严格模式，忽略‘use strict’</li>
<li>每个 ES Module 模块都是单独的私有作用域</li>
<li>ES Module 是通过 CORS 去请求外部 js 模块的，服务器要支持 CORS</li>
<li>ES Module 的 script 标签会延迟执行脚本（页面渲染完在执行脚本）</li>
</ul>
<h3 id="ES-Module-导出"><a href="#ES-Module-导出" class="headerlink" title="ES Module 导出"></a>ES Module 导出</h3><ul>
<li>导出<ul>
<li>导出成员使用 export 修饰成员声明的方式，如：<code>export var name = &#39;yan; exprot var age = 18&#39;</code></li>
<li>export 可以单独使用，如:<code>var name = &#39;yan&#39;; var age = 18; export &#123; name, age &#125;</code></li>
<li>使用 as 给导出的成员重命名，导入时就要使用重命名后的变量名，如：<code>var name = &#39;yan&#39;; exprot &#123; name as firstName &#125;</code></li>
<li>如果重命名为 default 那这个成员就会做为当前模块默认导出的成员</li>
<li>在导入这个成员就必须要给这个成员重命名，default 是一个关键词不能作为一个变量使用</li>
</ul>
</li>
<li>导入<ul>
<li>导入使用 import 导入，如：<code>import &#123; name &#125; from &#39;./module.js&#39;</code>，name 为导出的变量名</li>
<li>导入默认导出传成员可以不使用花括号，变量名可以根据需要随便取，如：<code>import name from &#39;./module.js&#39;</code></li>
<li>如果导入的变量名为 default，需要使用 as 重命名，如：<code>import &#123; default as firstName &#125; from &#39;./module.js&#39;</code></li>
</ul>
</li>
</ul>
<h3 id="ES-Modules-导入导出的注意事项"><a href="#ES-Modules-导入导出的注意事项" class="headerlink" title="ES Modules 导入导出的注意事项"></a>ES Modules 导入导出的注意事项</h3><ul>
<li><code>export &#123; name, age &#125;</code> 该写法不是对象字面量的，如果要对象字面量的写法应该是：<code>export default &#123; name, age &#125;</code>，这样花括号会被理解为对象</li>
<li><code>import &#123;&#125; from &#39;./module.js&#39;</code>，花括号不是解构</li>
<li>导出成员时，导出的是这个成员的引用，导出的变量是只读的（在导入的文件中无法改变变量的值），如，在导出成员的文件中在一秒后改变变量的值，在导入变量的文件中两秒后输出变量值，输出的结果是改变后的值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  a = <span class="number">2</span>;</span><br><span class="line">&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; a &#125; <span class="keyword">from</span> <span class="string">&quot;./module.js&quot;</span>;</span><br><span class="line"><span class="comment">// a = 22 // 报错，Assignment to constant variable</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 2</span></span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-导入用法"><a href="#ES-Modules-导入用法" class="headerlink" title="ES Modules 导入用法"></a>ES Modules 导入用法</h3><ul>
<li>import 必须使用完整的路径不能省略扩展名，即使是引入 index 也要完整的路径不能省略 index</li>
<li>import 可以使用完整的 url 加载模块 <code>import &#123; name &#125; from &#39;https://xxx.com/xxx.js&#39;</code></li>
<li>相对路径，在网页引用资源是可以省略‘.&#x2F;’的，但是 import 不可以省略，如果省略了就是以字母开头 ES Module 会以为在加载第三方模块，可以使用绝对路径和完整的 url</li>
<li>如果想要执行某个模块而不用提取模块成员，花括号为空即可，这是就只会执行这个模块，不会提出成员，如：<code>import &#123;&#125; from &#39;./module.js&#39;</code>，简写：<code>import &#39;./module.js&#39;</code></li>
<li>如果模块导出的成员特别多，而导入的都用到，可以使用星号‘_’，把这个模块的成员全部导入，在通过 as 将导入的成员全部放到一个对象中,导出的成员都会作为这个对象的属性，如：<code>import _ as mod from &#39;./module.js&#39;</code></li>
<li>动态导入模块，不可以通过判断使用<code>if (true)&#123;import &#123;name&#125; from &#39;./module.js&#39;&#125;</code>，如果需要动态导入，可以使用 import 函数<code>import(&#39;./module.js&#39;)</code>，import 函数返回的是一个 promise</li>
<li>如果模块同时导出默认成员和命名成员，在导入时可以给默认成员重命名<code>import &#123; name, default as age &#125; from &#39;./module.js&#39;</code>，也可以<code>import age(默认成员), &#123; name &#125; from &#39;./module.js&#39;</code></li>
</ul>
<h3 id="ES-Modules-导出导入成员"><a href="#ES-Modules-导出导入成员" class="headerlink" title="ES Modules 导出导入成员"></a>ES Modules 导出导入成员</h3><ul>
<li>import 可以配合 export 使用，效果就是将导入的结果直接作为当前模块的导出成员，那么在当前作用域就不能访问这些成员，如：<code>export &#123; name, age &#125; from &#39;./module&#39;</code>，利用这种特性可以把散落的模块组织在一起，如，一个 index 把零散的模块组织一起，然后再导出</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// button.js</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Button</span> = <span class="string">&quot;Button Component&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Button</span>;</span><br><span class="line"><span class="comment">// avatar.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> <span class="title class_">Avatar</span> = <span class="string">&quot;Avatar Component&quot;</span>;</span><br><span class="line"><span class="comment">// index.mjs</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="keyword">default</span> <span class="keyword">as</span> <span class="title class_">Button</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./button.js&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">Avatar</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./avatar.js&quot;</span>;</span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Button</span>, <span class="title class_">Avatar</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./index.mjs&quot;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-浏览器环境-Polyfill"><a href="#ES-Modules-浏览器环境-Polyfill" class="headerlink" title="ES Modules 浏览器环境 Polyfill"></a>ES Modules 浏览器环境 Polyfill</h3><ul>
<li>在不支持 ES Module 的浏览器中，可以使用 browser-es-module-loader 第三方库，在执行的时候解析</li>
<li>但是在支持 ES Module 的浏览器中，这样会执行两次，可以添加 script 标签的新属性 nomodule</li>
<li>nomodule:在不支持 ES Module 的浏览器工作</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nomodule</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/promise-polyfill@8.1.3/dist/polyfill.min.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nomodule</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/browser-es-module-loader@0.4.1/dist/babel-browser-build.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">  <span class="attr">nomodule</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/browser-es-module-loader@0.4.1/dist/browser-es-module-loader.js&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-in-Node-js-支持情况"><a href="#ES-Modules-in-Node-js-支持情况" class="headerlink" title="ES Modules in Node.js - 支持情况"></a>ES Modules in Node.js - 支持情况</h3><ul>
<li>在 node 中使用 ES Module 文件后缀名为‘mjs’</li>
<li>执行 <code>node --experimental-modules 文件</code>，experimental-modules：启用 ES Module 实验特性</li>
<li>可以通过 import 导入原生的模块和第三方模块<code>import fs from &#39;fs&#39;; import _ form &#39;loadsh&#39;</code></li>
<li><code>import &#123; camelCase &#125; from &#39;lodash&#39;</code>，不支持，因为第三方模块都是导出默认成员；内置模块兼容了 ES Module 的提取成员方式，所以<code>import &#123; writeFileSync &#125; from &#39;fs&#39;</code>支持</li>
</ul>
<h3 id="ES-Modules-in-Node-js-与-CommonJS-交互"><a href="#ES-Modules-in-Node-js-与-CommonJS-交互" class="headerlink" title="ES Modules in Node.js - 与 CommonJS 交互"></a>ES Modules in Node.js - 与 CommonJS 交互</h3><ul>
<li>ES Module 中可以导入 Commonjs 模块</li>
<li>Commonjs 中不能导入 ES Module 模块</li>
<li>Commonjs 始终只会导出一个默认成员</li>
<li>注意 import 不是解构导出对象</li>
</ul>
<h3 id="ES-Modules-in-Node-js-与-CommonJS-的差异"><a href="#ES-Modules-in-Node-js-与-CommonJS-的差异" class="headerlink" title="ES Modules in Node.js - 与 CommonJS 的差异"></a>ES Modules in Node.js - 与 CommonJS 的差异</h3><ul>
<li>ES Module 中没有 Commonjs 中的那些模块全局成员（require&#x2F;module&#x2F;exports&#x2F;**filename&#x2F;**dirname）</li>
<li>Commonjs 中 require&#x2F;module&#x2F;exports 在 ES Module 中使用 import 和 export 替代，**filename 和 **dirname 可以通过 import.meta.url 可以拿到当前工作文件的文件 url 地址，可以使用原生的 url 模块的 fileURLToPath()方法可以把文件 url 转换为路径</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">&quot;url&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; dirname &#125; <span class="keyword">from</span> <span class="string">&quot;path&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> __filename = <span class="title function_">fileURLToPath</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>);</span><br><span class="line"><span class="keyword">const</span> __dirname = <span class="title function_">dirname</span>(__filename);</span><br></pre></td></tr></table></figure>

<h3 id="ES-Modules-in-Node-js-新版本进一步支持"><a href="#ES-Modules-in-Node-js-新版本进一步支持" class="headerlink" title="ES Modules in Node.js - 新版本进一步支持"></a>ES Modules in Node.js - 新版本进一步支持</h3><ul>
<li>在 package.json 文件添加 type 字段值为 module，此时文件扩展名可以用 js，而不需要 mjs</li>
<li>此时想要使用 Commonjs 规范，那么文件后缀名要改为 cjs</li>
</ul>
<h3 id="ES-Modules-in-Node-js-Babel-兼容方案"><a href="#ES-Modules-in-Node-js-Babel-兼容方案" class="headerlink" title="ES Modules in Node.js - Babel 兼容方案"></a>ES Modules in Node.js - Babel 兼容方案</h3><ul>
<li>安装 babel 相关依赖 <code>yarn add @babel/node @babel/core @babel/preset-env</code> babel 工作依赖插件，preset 是一个插件集合</li>
<li>执行 <code>yarn babel-node index.js(想要转换的文件) --presets=@babel/preset-env</code></li>
<li>或者添加一个.babelrc 文件</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;presets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;@babel/preset-env&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="二、Webpack-打包"><a href="#二、Webpack-打包" class="headerlink" title="二、Webpack 打包"></a>二、Webpack 打包</h1><h2 id="模块打包工具的由来"><a href="#模块打包工具的由来" class="headerlink" title="模块打包工具的由来"></a>模块打包工具的由来</h2><ul>
<li>ES Module 存在环境兼容问题</li>
<li>模块文件过多，网络请求频繁</li>
<li>所有的前端资源都需要模块化</li>
</ul>
<h2 id="Webpack-配置文件"><a href="#Webpack-配置文件" class="headerlink" title="Webpack 配置文件"></a>Webpack 配置文件</h2><ul>
<li>webpack 默认以<code>src/index.js</code> 为入口文件</li>
<li>在项目的根目录添加<code>webpack.config.js</code>文件，可以自定义相应的配置，该文件是运行在 nodejs 环境中</li>
<li>该文件导出一个对象，通过导出对象的属性就可以完成相应的配置选项</li>
<li>entry 属性：webpack 打包入口文件的路径，如果是相对路径<code>‘./’</code>不能省略</li>
<li>output 属性：webpack 打包输出的位置，值要求是一个对象，通过对象的 filename 属性指定输出的文件名，path 属性指定输出的目录(绝对路径)</li>
</ul>
<h2 id="Webpack-工作模式"><a href="#Webpack-工作模式" class="headerlink" title="Webpack 工作模式"></a>Webpack 工作模式</h2><ul>
<li>在 webpack.config.js 文件对象中添加 mode 属性</li>
<li>mode 默认值是 production，mode 可选值有 production、development、none</li>
<li>production：自动启动优化，会把代码压缩加密</li>
<li>development：会自动优化打包速度，添加一些调式过程中的辅助</li>
<li>none：运行最原始的打包，不做额外的处理</li>
</ul>
<h2 id="Webpack-资源模块加载"><a href="#Webpack-资源模块加载" class="headerlink" title="Webpack 资源模块加载"></a>Webpack 资源模块加载</h2><ul>
<li>webpack 内容默认只会处理 javascript 文件</li>
<li>处理其他类型的文件要安装使用对角的 loader（加载器）</li>
<li>使用 loader，在 webpack.config.js 导出的对象中的 module 属性，添加一个 rules 数组</li>
<li>rules 数组就是针对加载其他资源模块的规则配置</li>
<li>每个规则对象要设置两个属性，test：正则表达式，匹配打包过程中遇到的文件；use：匹配到的文件使用的 loader，use 的值可以是单个 loader 字符串也可以是一个数组 loader，<strong>如果是一个数组，会从右往左执行</strong></li>
<li>css-loader 的作用就是将 css 文件转换为一个 js 模块；具体实现就是将 css 代码 push 到一个数组中</li>
<li>style-loader 的作用就是将 css-loader 转换后的结果通过 style 标签追加到页面上</li>
<li>loader 是 webpack 的核心特性</li>
<li>借助不同的 loader 就可以加载任何类型的资源</li>
</ul>
<h2 id="Webpack-文件资源加载器"><a href="#Webpack-文件资源加载器" class="headerlink" title="Webpack 文件资源加载器"></a>Webpack 文件资源加载器</h2><ul>
<li>安装依赖 <code>yarn add file-loader</code></li>
<li>在配置文件中添加 rules <code>&#123; test: /.png$/, use: &#39;file-loader&#39; &#125;</code></li>
<li>webpack 默认所有打包的结果放在网站根目录；为项目中的所有资源指定一个基础路径，在 output 中添加 publicPath 属性，默认值为空表示网站的根目录</li>
<li>把 publicPath 值修改为 ‘dist&#x2F;‘ 注意“&#x2F;”不能省略，打包后是一个变量名（publicPath 值）拼接资源名（资源名前面没有“&#x2F;”）所有“&#x2F;”不能省略</li>
</ul>
<h2 id="Webpack-URL-加载器"><a href="#Webpack-URL-加载器" class="headerlink" title="Webpack URL 加载器"></a>Webpack URL 加载器</h2><ul>
<li>Data URLS 格式：data(协议):[mediatype(媒体类型和编码)][;base64],</li>
<li>安装插件 <code>yarn add url-loader --dev</code></li>
<li>在配置文件中添加 rules</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">use</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.png$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;url-loader&quot;</span>,</span><br><span class="line">          <span class="attr">option</span>: &#123;</span><br><span class="line">            <span class="attr">limit</span>: <span class="number">10</span> * <span class="number">1024</span>, <span class="comment">// 对于小于10kb的png图片使用url-loader打包；而大于10kb的会使用file-loader打包</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>打包后，图片将是以 base64 的格式显示</li>
</ul>
<p>最佳实践</p>
<ul>
<li>小文件使用 Data URLs，减少请求次数</li>
<li>大文件单独提取存放，提高加载速度</li>
</ul>
<h2 id="Webpack-常用加载器分类"><a href="#Webpack-常用加载器分类" class="headerlink" title="Webpack 常用加载器分类"></a>Webpack 常用加载器分类</h2><ul>
<li>编译转换类：会把加载的资源转为 js 代码</li>
<li>文件操作类：会把加载的资源拷贝到输出的目录，导出文件访问路径</li>
<li>代码检查类：目的是统一代码风格</li>
</ul>
<h2 id="Webpack-与-ES-2015"><a href="#Webpack-与-ES-2015" class="headerlink" title="Webpack 与 ES 2015"></a>Webpack 与 ES 2015</h2><ul>
<li>安装 babel-loader @babel&#x2F;core @babel&#x2F;preset-env</li>
<li>在配置文件中 module rules 添加</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-加载资源的方式"><a href="#Webpack-加载资源的方式" class="headerlink" title="Webpack 加载资源的方式"></a>Webpack 加载资源的方式</h2><ul>
<li>遵循 ES Modules 标准的 import 声明</li>
<li>遵循 Commonjs 标准的 require 函数</li>
<li>遵循 AMD 标准的 define 函数和 require 函数</li>
<li>Loader 加载器的非 JavaScript 也会触发资源加载<ul>
<li>样式代码中的@import 指令和 url 函数</li>
<li>HTML 代码中图片标签的 src 属性</li>
</ul>
</li>
</ul>
<h2 id="Webpack-核心工作原理"><a href="#Webpack-核心工作原理" class="headerlink" title="Webpack 核心工作原理"></a>Webpack 核心工作原理</h2><ul>
<li>webpack 会根据配置找到打包入口文件，然后顺着入口文件的代码</li>
<li>根据代码中的 import 或者 require 解析推断这个文件依赖的资源模块</li>
<li>然后分别解析每个资源模块对应的依赖，形成整个项目中所有用到文件之间的依赖关系的依赖树</li>
<li>webpack 递归依赖树，找到每个节点对于的资源文件</li>
<li>根据配置文件中的 rules 属性找到模块对应的加载器，找到对于的资源放在打包结果中，实现整个项目的打包</li>
</ul>
<h2 id="Webpack-开发一个-Loader"><a href="#Webpack-开发一个-Loader" class="headerlink" title="Webpack 开发一个 Loader"></a>Webpack 开发一个 Loader</h2><ul>
<li>loader 负责资源文件从输入到输出的转换</li>
<li>对于同一个资源可以依次使用多个 loader （css-loader -&gt; style-loader）</li>
<li>loader 模块导出一个函数；该函数输入的是加载到的资源文件内容；函数体是处理内容的过程；输出的是经过处理过的资源文件内容结果，结果必须是 javascript 代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> about <span class="keyword">from</span> <span class="string">&quot;./about.md&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(about);</span><br><span class="line"></span><br><span class="line"><span class="comment">// markdown-loader.js</span></span><br><span class="line"><span class="keyword">const</span> marked = <span class="built_in">require</span>(<span class="string">&quot;marked&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">source</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// source接受输入</span></span><br><span class="line">  <span class="comment">// console.log(source);</span></span><br><span class="line">  <span class="comment">// return &#x27;hello&#x27;;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法一</span></span><br><span class="line">  <span class="keyword">const</span> html = <span class="title function_">marked</span>(source);</span><br><span class="line">  <span class="comment">// return `module.exports = $&#123;JSON.stringify(html)&#125;`</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方法二 返回 html 字符串交给下一个 loader处理 (html-loader)</span></span><br><span class="line">  <span class="keyword">return</span> html;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">join</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;dist/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/.md$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;html-loader&quot;</span>, <span class="string">&quot;./markdown-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-插件机制介绍"><a href="#Webpack-插件机制介绍" class="headerlink" title="Webpack 插件机制介绍"></a>Webpack 插件机制介绍</h2><ul>
<li>增强 webpack 自动化能力</li>
<li>loader 专注实现资源模块加载</li>
<li>plugin 解决其他自动化工作<ul>
<li>清除 dist 目录</li>
<li>拷贝静态文件至输出目录</li>
<li>压缩输出代码</li>
</ul>
</li>
</ul>
<h2 id="Webpack-自动清除输出目录插件"><a href="#Webpack-自动清除输出目录插件" class="headerlink" title="Webpack 自动清除输出目录插件"></a>Webpack 自动清除输出目录插件</h2><ul>
<li>安装插件 <code>yarn add clean-webpack-plugin --dev</code></li>
<li>配置文件中导入插件</li>
<li>在配置对象中 plugins 属性，该属性是专门配置插件的地方，属性值是一个数组</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-自动生成-HTML-插件"><a href="#Webpack-自动生成-HTML-插件" class="headerlink" title="Webpack 自动生成 HTML 插件"></a>Webpack 自动生成 HTML 插件</h2><ul>
<li>安装插件 <code>yarn add html-webpack-plugin --dev</code></li>
<li>在配置文件中导入插件</li>
<li>在配置对象中 plugins 属性，该属性是专门配置插件的地方，属性值是一个数组</li>
<li>同时输出多个页面文件，可以再通过 HtmlWebpackPlugin 创建额外的 html 文件,通过 filename 指定文件名</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 用于生成 index.html</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Webpack Plugin Sample&quot;</span>, <span class="comment">// html文件的title</span></span><br><span class="line">      <span class="attr">meta</span>: &#123;</span><br><span class="line">        <span class="attr">viewport</span>: <span class="string">&quot;width=device-width&quot;</span>, <span class="comment">// 设置meta的viewport</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>, <span class="comment">// 模版</span></span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;about.html&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.html</span></span><br><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="comment">// &lt;h1&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/h1&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Webpack-插件使用总结"><a href="#Webpack-插件使用总结" class="headerlink" title="Webpack 插件使用总结"></a>Webpack 插件使用总结</h2><ul>
<li>安装插件 <code>yarn add copy-webpack-plugin --dev</code></li>
</ul>
<h2 id="Webpack-开发一个插件"><a href="#Webpack-开发一个插件" class="headerlink" title="Webpack 开发一个插件"></a>Webpack 开发一个插件</h2><ul>
<li>相比于 loader，plugin 拥有更宽的能力范围</li>
<li>plugin 通过钩子机制实现</li>
<li>插件必须是一个函数或者是一个包含 apply 方法的对象</li>
<li>通过在生命周期的钩子中挂载函数实现扩展</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyPlugin</span> &#123;</span><br><span class="line">  <span class="comment">// 目标 删除bundle.js中的注释</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">// 会自动执行</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;my plugin 启动&quot;</span>);</span><br><span class="line">    <span class="comment">// https://webpack.js.org/api/compiler-hooks/</span></span><br><span class="line">    <span class="comment">// emit钩子：即将输出文件时执行</span></span><br><span class="line">    <span class="comment">// 参数一：插件名 参数二、挂载到钩子上的函数</span></span><br><span class="line">    compiler.<span class="property">hooks</span>.<span class="property">emit</span>.<span class="title function_">tap</span>(<span class="string">&quot;MyPlugin&quot;</span>, <span class="function">(<span class="params">compilation</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// compilation =&gt; 可以理解为此次打包的上下文</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> name <span class="keyword">in</span> compilation.<span class="property">assets</span>) &#123;</span><br><span class="line">        <span class="comment">// assets:资源文件</span></span><br><span class="line">        <span class="comment">// console.log(name); // 文件名</span></span><br><span class="line">        <span class="comment">// console.log(compilation.assets[name].source());//文件内容</span></span><br><span class="line">        <span class="keyword">if</span> (name.<span class="title function_">endsWith</span>(<span class="string">&quot;.js&quot;</span>)) &#123;</span><br><span class="line">          <span class="comment">// 判断是js文件</span></span><br><span class="line">          <span class="keyword">const</span> contents = compilation.<span class="property">assets</span>[name].<span class="title function_">source</span>(); <span class="comment">// 文件内容</span></span><br><span class="line">          <span class="keyword">const</span> withoutComments = contents.<span class="title function_">replace</span>(<span class="regexp">/\/\*\*+\*\//g</span>, <span class="string">&quot;&quot;</span>); <span class="comment">// 全局替换注释</span></span><br><span class="line">          compilation.<span class="property">assets</span>[name] = &#123;</span><br><span class="line">            <span class="comment">// 覆盖原有内容</span></span><br><span class="line">            <span class="attr">source</span>: <span class="function">() =&gt;</span> withoutComments, <span class="comment">// 返回新的内容</span></span><br><span class="line">            <span class="attr">size</span>: <span class="function">() =&gt;</span> withoutComments.<span class="property">length</span>, <span class="comment">// 返回内容的大小 webpack内部规定必须</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-Dev-Server-静态资源访问"><a href="#Webpack-Dev-Server-静态资源访问" class="headerlink" title="Webpack Dev Server 静态资源访问"></a>Webpack Dev Server 静态资源访问</h2><ul>
<li>Dev Server 默认只会 serve 打包输出文件</li>
<li>只要是 webpack 打包输出的文件都可以直接被访问</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">  <span class="comment">// 额外开发服务指定静态资源路径，可以是字符串或数组</span></span><br><span class="line">  <span class="attr">contentBase</span>: <span class="string">&quot;./public&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-Dev-Server-代理-API"><a href="#Webpack-Dev-Server-代理-API" class="headerlink" title="Webpack Dev Server 代理 API"></a>Webpack Dev Server 代理 API</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="comment">// 前缀</span></span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">// http://localhost:8080/api/users =&gt; https://api.github.com/api/users</span></span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;https://api.github.com&quot;</span>,</span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123;</span><br><span class="line">          <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="comment">// 去除 /api</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 不能使用 localhost:8080 作为请求github的主机名</span></span><br><span class="line">        <span class="attr">changeOrigin</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Source-Map-介绍"><a href="#Source-Map-介绍" class="headerlink" title="Source Map 介绍"></a>Source Map 介绍</h2><ul>
<li>调试和报错都是基于运行代码</li>
<li>source map 映射转换后代码和源代码关系，通过 source map 逆向解析</li>
<li>解决源代码与运行代码不一致所产生的调试问题</li>
</ul>
<h2 id="Webpack-配置-Source-Map"><a href="#Webpack-配置-Source-Map" class="headerlink" title="Webpack 配置 Source Map"></a>Webpack 配置 Source Map</h2><p>在配置项添加 <code>devtool: &#39;source-map&#39;</code></p>
<h2 id="Webpack-eval-模式的-Source-Map"><a href="#Webpack-eval-模式的-Source-Map" class="headerlink" title="Webpack eval 模式的 Source Map"></a>Webpack eval 模式的 Source Map</h2><ul>
<li>eval 是否使用 eval 执行模块代码，带 eval，用 eval 执行模块代码</li>
<li>cheap-source map 是否包含行信息</li>
<li>module 是否能够得到 Loader 处理之前的源代码</li>
<li>带 module 的模式下解析的出来的原代码是没有经过 loader 加工，手写的源代码</li>
<li>不带 module 是 loader 加工过后的代码</li>
<li>inline-source-map：source map 是因 dataURL 嵌入代码，其他的 source map 是以物理文件存在</li>
<li>hidden-source-map：开发工具看不到 source map 效果 在开发第三方包比较有用</li>
</ul>
<h2 id="Webpack-选择-Source-Map-模式"><a href="#Webpack-选择-Source-Map-模式" class="headerlink" title="Webpack 选择 Source Map 模式"></a>Webpack 选择 Source Map 模式</h2><ul>
<li>开发模式<ul>
<li>cheap-module-eval-source-map：代码每行不会超过 80 个字符；代码进过 loader 转换后差异较大需要 module 模式（loader 处理前的源代码）；首次打包速度慢无所谓，重写打包相对较快</li>
</ul>
</li>
<li>生成模式<ul>
<li>none 或 nosources-source-map：Source Map 会暴露源代码</li>
</ul>
</li>
</ul>
<h2 id="Webpack-HMR-体验（热更新）"><a href="#Webpack-HMR-体验（热更新）" class="headerlink" title="Webpack HMR 体验（热更新）"></a>Webpack HMR 体验（热更新）</h2><ul>
<li>应用运行过程中实时替换某个模块，应用运行状态不受影响</li>
<li>HMR 集成在 webpack-dev-server 中</li>
<li>开启 HMR<ul>
<li>css 样式（经过 loader 处理的）可以热更新但是 js 还是会刷新浏览器，webpack 中的 HMR 不可以开箱即用</li>
<li>webpack 中的 HMR 需要手动处理模块热替换逻辑</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-使用-HMR-API"><a href="#Webpack-使用-HMR-API" class="headerlink" title="Webpack 使用 HMR API"></a>Webpack 使用 HMR API</h2><h2 id="Webpack-处理-JS-模块热替换"><a href="#Webpack-处理-JS-模块热替换" class="headerlink" title="Webpack 处理 JS 模块热替换"></a>Webpack 处理 JS 模块热替换</h2><p>js 热更新：保存旧数据，代码发生变化后把数据回填</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> lastEditor = editor;</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./editor&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;editor HMR&#x27;)</span></span><br><span class="line">  <span class="comment">// console.log(createEditor)</span></span><br><span class="line">  <span class="keyword">const</span> value = lastEditor.<span class="property">innerHTML</span>;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="title function_">removeChild</span>(editor);</span><br><span class="line">  <span class="keyword">const</span> newEditor = <span class="title function_">createEditor</span>();</span><br><span class="line">  newEditor.<span class="property">innerHTML</span> = value;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(newEditor);</span><br><span class="line">  lastEditor = newEditor;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 图片热更新</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">hot</span>.<span class="title function_">accept</span>(<span class="string">&quot;./better.png&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  img.<span class="property">src</span> = background;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(background);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="HMR-注意事项"><a href="#HMR-注意事项" class="headerlink" title="HMR 注意事项"></a>HMR 注意事项</h2><ul>
<li>如果没有开启热更新，但是 js 代码做了热更新处理，先做判断 <code>if (module.hot)&#123;// 热更新逻辑&#125;</code></li>
<li>hot 会刷新浏览器，报错信息会被刷走；hotOnly 不会刷新浏览器，可以把错误信息输出</li>
<li>打包后会自动去除 js 热更新逻辑代码</li>
</ul>
<h2 id="Webpack-生产环境优化"><a href="#Webpack-生产环境优化" class="headerlink" title="Webpack 生产环境优化"></a>Webpack 生产环境优化</h2><ul>
<li>mode：none、production、development</li>
<li>为不同的工作环境创建不同的配置</li>
</ul>
<h2 id="Webpack-不同环境下的配置"><a href="#Webpack-不同环境下的配置" class="headerlink" title="Webpack 不同环境下的配置"></a>Webpack 不同环境下的配置</h2><ul>
<li>配置文件根据环境不同导出不同的配置<ul>
<li>webpack 可以导出一个函数，函数返回配置</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数一：cli传递的环境名参数；参数二：运行cli传递的所有参数</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">env, argv</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (env === <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 执行 yarn webpack --env production</span></span><br></pre></td></tr></table></figure>

<ul>
<li>一个环境对应一个配置文件<ul>
<li>webpack.common.js 存放公共配置</li>
<li>webpack.dev.js 开发配置，把公共配置和开发配置合并（使用 loadsh merge）</li>
<li>webpack.prod.js 生产环境，把公共配置和生产配置合并（使用 loadsh merge）</li>
<li>执行 yarn webpack –config webpack.dev.js</li>
<li>或者在 scripts 中添加命令 <code>&quot;build&quot;: &quot;webpack --config webpack.dev.js&quot;</code></li>
</ul>
</li>
</ul>
<h2 id="Webpack-DefinePlugin"><a href="#Webpack-DefinePlugin" class="headerlink" title="Webpack DefinePlugin"></a>Webpack DefinePlugin</h2><ul>
<li>DefinePlugin 为代码注入全局成员</li>
<li>接收的是一个对象，每一个键值都会注入到代码中</li>
<li>文件代码中直接使用键，打包后把注入的值 直接替换到代码中，definePlugin 传递的字符串应该是代码</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.<span class="title class_">DefinePlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 想要输出的是字符串要个引号，否则输出的不是字符串</span></span><br><span class="line">      <span class="comment">// 输出值可以使用JSON.stringify(&#x27;https://api.github.com&#x27;)</span></span><br><span class="line">      <span class="attr">API_BASE_URL</span>: <span class="string">&#x27;&quot;https://api.github.com&quot;&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ==</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">API_BASE_URL</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-体验-Tree-Shaking"><a href="#Webpack-体验-Tree-Shaking" class="headerlink" title="Webpack 体验 Tree Shaking"></a>Webpack 体验 Tree Shaking</h2><ul>
<li>在生成模式下自动开启，对于冗余、未引用代码不会打包</li>
<li>不是指某个配置选项，是一组功能搭配使用后的优化效果</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack 使用 Tree Shaking</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 集中配置webpack内部优化功能</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>, <span class="comment">// 只到处外部使用了的成员 （相当于标记没使用的代码）</span></span><br><span class="line">    <span class="attr">minimize</span>: <span class="literal">true</span>, <span class="comment">// 开启webpack代码压缩  会把外部没使用的代码去除</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-合并模块—concatenateModules"><a href="#Webpack-合并模块—concatenateModules" class="headerlink" title="Webpack 合并模块—concatenateModules"></a>Webpack 合并模块—concatenateModules</h2><ul>
<li>尽可能的将所有模块合并输出到一个函数中</li>
<li>提升运行效率，减少代码体积</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 集中配置webpack内部优化功能</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">concatenateModules</span>: <span class="literal">true</span>, <span class="comment">// 打包后把所有的模块放在同一个函数中；</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-Tree-Shaking-与-Babel"><a href="#Webpack-Tree-Shaking-与-Babel" class="headerlink" title="Webpack Tree Shaking 与 Babel"></a>Webpack Tree Shaking 与 Babel</h2><ul>
<li>babel 和 tree shaking 同时使用会导致 tree shaking 失效<ul>
<li>tree shaking 前提是 ES Modules，由 webpack 打包的代码必须使用 ESM</li>
<li>babel-loader 转换代码时可能会把 ES Modules 转为 CommonJS<br>新版的 babel-loader 不会导致 tree shaking 失效，</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [</span><br><span class="line">              <span class="comment">// modules：默认值是auto 根据环境判断是否开启ESM，可以设为false</span></span><br><span class="line">              [<span class="string">&quot;@babel/preset-env&quot;</span>, &#123; <span class="attr">modules</span>: <span class="string">&quot;commonjs&quot;</span> &#125;], <span class="comment">// 强制使用babel ESM，把ESM转为commonjs</span></span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-sideEffects"><a href="#Webpack-sideEffects" class="headerlink" title="Webpack sideEffects"></a>Webpack sideEffects</h2><ul>
<li>允许通过配置方式标识代码是否有副作用（模块执行时除了导出成员之外所做的事情）</li>
<li>一般用于开发 npm 包时 标记是否有副作用</li>
<li>生产模式自动开启 会检查当前代码所属的 package.json 有没有 sideEffects 标识，以此来判断这个模块是否有副作用</li>
<li>如果这个模块没有副作用，那些没有用到的模块不会被打包</li>
<li>package.json 添加 <code>sideEffects: false</code> 表示 package.json 所影响的项目当中所有的代码都没有副作用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">  <span class="attr">sideEffects</span>: <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-sideEffects-注意"><a href="#Webpack-sideEffects-注意" class="headerlink" title="Webpack sideEffects 注意"></a>Webpack sideEffects 注意</h2><ul>
<li>使用 sideEffects 前提确保代码真的没有副作用，否则 webpack 再打报时会误删有副作用的代码</li>
<li>如在 Number 原型添加方法然后载入、载入 css 也是</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// extend.js</span></span><br><span class="line"><span class="comment">// 为Number的原型添加一个扩展方法</span></span><br><span class="line"><span class="comment">// 副作用代码 在package.json声明没有副作用，在打包时会被去除</span></span><br><span class="line"><span class="title class_">Number</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">pad</span> = <span class="keyword">function</span>(<span class="params">size</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="variable language_">this</span> + <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="keyword">while</span>(result.<span class="property">length</span> &lt; size) &#123;</span><br><span class="line">    result = <span class="string">&#x27;0&#x27;</span> + result</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./extend.js&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">8.</span><span class="title function_">pad</span>(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>解决：在 package.json 关闭副作用、标识哪些文件有副作用</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line"><span class="string">&quot;sideEffects&quot;</span>: [ <span class="comment">// 标识有副作用的文件</span></span><br><span class="line">  <span class="string">&#x27;./src/extends.js&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;*.css&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-代码分割"><a href="#Webpack-代码分割" class="headerlink" title="Webpack 代码分割"></a>Webpack 代码分割</h2><ul>
<li>所有代码最终都被打包到一起，打包文件体积过大</li>
<li>分包，按需加载</li>
<li>多入口打包</li>
<li>动态导入</li>
</ul>
<h2 id="Webpack-多入口打包"><a href="#Webpack-多入口打包" class="headerlink" title="Webpack 多入口打包"></a>Webpack 多入口打包</h2><ul>
<li>多页应用程序，一个页面对应一个打包入口，公共部分单独提取</li>
<li>多个入口可以把 entry 定义为对象，一个属性就是一个入口，键就是入口名，值就是入口对应的文件路径</li>
<li>多入口，输出也要多个，可以给 filename 的值添加 <code>[name]</code>占位 <code>outpur:&#123;filename: &#39;[name].bundle.js&#39;&#125;</code> 这样 <code>[name]</code>就会被替换为入口名称</li>
<li>plugins 中的 HtmlWebpackPlugin 插件会自动输入注入所以打包结果的 html，所以此时入口文件会注入所有的打包结果</li>
<li>可以给 HtmlWebpackPlugin 插件配置注入的打包文件 <code>new HtmlWebpackPlugin(&#123;chunks:[&#39;index&#39;]&#125;), new HtmlWebpackPlugin(&#123;chunks:[&#39;album&#39;]&#125;)</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;clean-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;none&quot;</span>,</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">index</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">    <span class="attr">album</span>: <span class="string">&quot;./src/album.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name].bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Multi Entry&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;index&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&quot;Multi Entry&quot;</span>,</span><br><span class="line">      <span class="attr">template</span>: <span class="string">&quot;./src/album.html&quot;</span>,</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">&quot;album.html&quot;</span>,</span><br><span class="line">      <span class="attr">chunks</span>: [<span class="string">&quot;album&quot;</span>],</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-提取公共模块"><a href="#Webpack-提取公共模块" class="headerlink" title="Webpack 提取公共模块"></a>Webpack 提取公共模块</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="comment">// 自动提取所有公共模块到单独 bundle</span></span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-动态导入"><a href="#Webpack-动态导入" class="headerlink" title="Webpack 动态导入"></a>Webpack 动态导入</h2><ul>
<li>需要用到某个模块时，再加载这个模块</li>
<li>动态导入的模块会被自动分包</li>
<li>一般我们都是在文件头直接 import 文件的，这会造成资源浪费</li>
<li>可以使用 ES Modules 的 import()在需要导入的地方导入模块，该方法返回的是 promise 可以拿到导出的对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="title function_">import</span>(<span class="string">&quot;./posts&quot;</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">&#123; <span class="keyword">default</span>: posts &#125;</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-魔法注释"><a href="#Webpack-魔法注释" class="headerlink" title="Webpack 魔法注释"></a>Webpack 魔法注释</h2><ul>
<li>在 import()方法中添加特定的注释 <code>import(/* webpackChunkName: &#39;posts&#39; */ &#39;./posts&#39;)</code> 这样在打包后文件名就会带上这个 webpackChunkName 值</li>
<li>如果 webpackChunkName 相同，打包后会打包在一起</li>
</ul>
<h2 id="Webpack-MiniCssExtractPlugin—提取-css-到单独文件"><a href="#Webpack-MiniCssExtractPlugin—提取-css-到单独文件" class="headerlink" title="Webpack MiniCssExtractPlugin—提取 css 到单独文件"></a>Webpack MiniCssExtractPlugin—提取 css 到单独文件</h2><ul>
<li>安装插件 <code>yarn add mini-css-extract-plugin --dev</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// &#x27;style-loader&#x27;, // 将样式通过 style 标签注入</span></span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>, <span class="comment">// 通过 link 标签注入</span></span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-OptimizeCssAssetsWebpackPlugin—-压缩-css"><a href="#Webpack-OptimizeCssAssetsWebpackPlugin—-压缩-css" class="headerlink" title="Webpack OptimizeCssAssetsWebpackPlugin— 压缩 css"></a>Webpack OptimizeCssAssetsWebpackPlugin— 压缩 css</h2><ul>
<li>安装插件 <code>yarn add optimize-css-assets-webpack-plugin --dev</code></li>
<li>如果配置在 plugins 中这个插件在任何情况都会正常工作</li>
<li>配置在 minimizer 中 只有 minimizer 开启（生产环境自动开启）是才工作</li>
<li>webpack 建议压缩创建配置在 minimizer 中，以便通过 minimizer 选项统一控制</li>
<li>当 minimizer 使用一个数组，webpack 认为我们要自定义所使用的压缩器插件，webpack 内部的 js 压缩器就会被覆盖，如果不配置 js 压缩器，这是打包，js 代码不会被压缩</li>
<li>手动把 js 压缩器添加回来，安装插件 <code>yarn add terser-webpack-plugin --dev</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;optimize-css-assets-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">TerserWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">TerserWebpackPlugin</span>(),</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">OptimizeCssAssetsWebpackPlugin</span>(),</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Webpack-输出文件名-Hash"><a href="#Webpack-输出文件名-Hash" class="headerlink" title="Webpack 输出文件名 Hash"></a>Webpack 输出文件名 Hash</h2><ul>
<li>在部署时服务器开启静态文件缓存，如果缓存时间过长，程序发生更改，得不到更新</li>
<li>生产环境下，文件名使用 Hash，文件名发生变化 对客户端而言全新的文件名就是全新的请求，就不会有缓存问题</li>
<li>[hash]【占位符】：整个项目级别的，项目中有任何地方改动，这次打包的 hash 值都会发生变化</li>
<li>[chunkhash]【占位符】：chuankhash 级别，打包过程中只要是同一路的打包 chunkhash 都是相同的</li>
<li>[contenthask]【占位符】：文件级别 hash，根据文件输出内容生成 hash 值（不同的文件就有不同的 hash 值）</li>
<li>指定 hash 值长度[chunkhash:8]【占位符】</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name]-[contenthash:8].bundle.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/24/React%20Query/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/24/React%20Query/" class="post-title-link" itemprop="url">React Query</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-24 16:58:46" itemprop="dateCreated datePublished" datetime="2022-10-24T16:58:46+08:00">2022-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:07" itemprop="dateModified" datetime="2022-11-11T14:47:07+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h1><p>也就是解决了什么问题?</p>
<h2 id="常规流程"><a href="#常规流程" class="headerlink" title="常规流程"></a>常规流程</h2><p>请求数据 &#x3D;&gt;加载中 &#x3D;&gt; 后端返回 &#x3D;&gt; 如果有报错展示报错 &#x3D;&gt;刷新数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 存储 后端返回数据</span></span><br><span class="line">  <span class="keyword">const</span> [zen, setZen] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>); <span class="comment">// 存储 加载状态</span></span><br><span class="line">  <span class="keyword">const</span> [isLoading, setIsLoading] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>); <span class="comment">// 存储 是否请求成功</span></span><br><span class="line">  <span class="keyword">const</span> [isError, setIsError] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="literal">false</span>); <span class="comment">// 存储 后端返回的错误数据</span></span><br><span class="line">  <span class="keyword">const</span> [errorMessage, setErrorMessage] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">fetchData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 开始获取数据，将isLoading置为true</span></span><br><span class="line">    <span class="title function_">setIsLoading</span>(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">&quot;https://api.github.com/zen&quot;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="keyword">async</span> (response) =&gt; &#123;</span><br><span class="line">        <span class="comment">// 如果请求返回status不为200 则抛出后端错误</span></span><br><span class="line">        <span class="keyword">if</span> (response.<span class="property">status</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> &#123; message &#125; = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response.<span class="title function_">text</span>();</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">text: string</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 请求完成将isLoading置为false</span></span><br><span class="line">        <span class="title function_">setIsLoading</span>(<span class="literal">false</span>); <span class="comment">// 接口请求成功，将isError置为false</span></span><br><span class="line">        <span class="title function_">setIsError</span>(<span class="literal">false</span>); <span class="comment">// 存储后端返回的数据</span></span><br><span class="line">        <span class="title function_">setZen</span>(text);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 请求完成将isLoading置为false</span></span><br><span class="line">        <span class="title function_">setIsLoading</span>(<span class="literal">false</span>); <span class="comment">// 接口请求错误，将isError置为true</span></span><br><span class="line">        <span class="title function_">setIsError</span>(<span class="literal">true</span>); <span class="comment">// 存储后端返回的错误数据</span></span><br><span class="line">        <span class="title function_">setErrorMessage</span>(error.<span class="property">message</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化请求数据</span></span><br><span class="line">    <span class="title function_">fetchData</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Zen from Github<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>     <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        &#123;isLoading ? &quot;加载中...&quot; : isError ? errorMessage : zen&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span>   &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;!isLoading &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;fetchData&#125;</span>&gt;</span>&#123;isError ? &quot;重试&quot; : &quot;刷新&quot;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">         </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 isLoading 来存储加载状态</li>
<li>使用 isError 来存储接口是否有错误</li>
<li>使用 errorMessage 来存储后端返回的报错信息</li>
<li>使用 zen 来存储后端返回数据存储</li>
<li>重新调用 fetchData 方法来刷新数据</li>
</ul>
<h2 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchData</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">fetch</span>(<span class="string">&quot;https://api.github.com/zen&quot;</span>).<span class="title function_">then</span>(<span class="keyword">async</span> (response) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果请求返回status不为200 则抛出后端错误</span></span><br><span class="line">    <span class="keyword">if</span> (response.<span class="property">status</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; message &#125; = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">text</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> zenQuery = <span class="title function_">useQuery</span>([<span class="string">&quot;zen&quot;</span>], fetchData); <span class="comment">// ①</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Zen from Github<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>     <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">             &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;zenQuery.isLoading || zenQuery.isFetching</span></span><br><span class="line"><span class="language-xml">          ? &quot;加载中...&quot;</span></span><br><span class="line"><span class="language-xml">          : zenQuery.isError</span></span><br><span class="line"><span class="language-xml">          ? zenQuery.error?.message</span></span><br><span class="line"><span class="language-xml">          : data&#125;</span></span><br><span class="line"><span class="language-xml">             </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">p</span>&gt;</span>   &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;!zenQuery.isLoading &amp;&amp; !zenQuery.isFetching &amp;&amp; (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            zenQuery.refetch();</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">                  &#123;zenQuery.isError ? &quot;重试&quot; : &quot;刷新&quot;&#125;       </span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">         </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>为了解决这么多大量冗杂的模板代码.使用 react-query 会变得十分整洁.<br>上面各种 loading,error,数据刷新等等都交给 react-query 处理.</p>
<h1 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h1><h2 id="查询键和查询函数"><a href="#查询键和查询函数" class="headerlink" title="查询键和查询函数"></a>查询键和查询函数</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> zenQuery = <span class="title function_">useQuery</span>([<span class="string">&quot;zen&quot;</span>], fetchData);</span><br></pre></td></tr></table></figure>

<ul>
<li>其中<code>[&#39;zen&#39;]</code>就是 react-query 的查询键，react-query 通过不同的查询键来标识(映射)不同接口(或是同一接口不同参数请求)返回的数据。在 react-query@4 中，查询键必须是数组。</li>
<li>而<code>fetchData</code>就是我们请求后端接口的函数，也就是查询函数.<blockquote>
<p>PS：查询键内的元素可以是嵌套数组、对象、字符串、数字<br>例如：[‘zen’, { form: ‘confucius’ }]或[‘zen’, [‘confucius’, ‘Lao Tzu’]]</p>
</blockquote>
</li>
</ul>
<p>为了方便记忆，打个比方，你可以将查询键看做是你存储 localStorage 时的 key，而 value 则是通过查询函数查询到数据后，将各种我们需要的状态数据存储进入 value<br>使用变量作为查询键的元素时，当变量的值变化后，react-query 将会重新调用 fetchData 方法，获取新的数据，并缓存到对应变量值为 key 的缓存中。</p>
<h2 id="并行请求"><a href="#并行请求" class="headerlink" title="并行请求"></a>并行请求</h2><p>同时多个请求就写多个 useQuery,合并请求就用 Promise.all 包裹.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">getReposAndGists</span> = (<span class="params">username</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">$&#123;username&#125;</span>/repos`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">      res.<span class="title function_">json</span>()</span><br><span class="line">    ),</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">$&#123;username&#125;</span>/gists`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">      res.<span class="title function_">json</span>()</span><br><span class="line">    ),</span><br><span class="line">  ]);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">ReposAndGists</span> = (<span class="params">&#123; username &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> reposAndGistsQuery = <span class="title function_">useQuery</span>([<span class="string">&quot;reposAndGists&quot;</span>, username], <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">getReposAndGists</span>(username)</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (reposAndGistsQuery.<span class="property">isLoading</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>加载数据中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (reposAndGistsQuery.<span class="property">isError</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>数据加载错误: &#123;reposAndGistsQuery.error.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!reposAndGistsQuery.<span class="property">data</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [repos, gists] = reposAndGistsQuery.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">h2</span>&gt;</span>仓库列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>     <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">             &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;repos.map((repo) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;repo.id&#125;</span>&gt;</span>&#123;repo.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">             </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">hr</span> /&gt;</span>     <span class="tag">&lt;<span class="name">h2</span>&gt;</span>代码片段列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span>     </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">             &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">        &#123;gists.map((gist) =&gt; (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;gist.id&#125;</span>&gt;</span>&#123;gist.description || &quot;暂无描述&quot;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ))&#125;</span></span><br><span class="line"><span class="language-xml">             </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">ReposAndGists</span>;</span><br></pre></td></tr></table></figure>

<h2 id="动态生成请求"><a href="#动态生成请求" class="headerlink" title="动态生成请求"></a>动态生成请求</h2><p><code>useQueries</code>.从动态获取[‘facebook’, ‘vuejs’, ‘nestjs’, ‘mongdb’]，到重新批量获取了以下用户的仓库[‘microsoft’, ‘tesla’].</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQueries &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [users, setUsers] = <span class="title class_">React</span>.<span class="title function_">useState</span>([</span><br><span class="line">    <span class="string">&quot;facebook&quot;</span>,</span><br><span class="line">    <span class="string">&quot;vuejs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;nestjs&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mongodb&quot;</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getRepos</span> = (<span class="params">username</span>) =&gt;</span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">$&#123;username&#125;</span>/repos`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">      res.<span class="title function_">json</span>()</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> userQueries = <span class="title function_">useQueries</span>(&#123;</span><br><span class="line">    <span class="attr">queries</span>: users.<span class="title function_">map</span>(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">queryKey</span>: [<span class="string">&quot;user&quot;</span>, user],</span><br><span class="line">        <span class="attr">queryFn</span>: <span class="function">() =&gt;</span> <span class="title function_">getRepos</span>(user),</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">h1</span>&gt;</span>查看github用户的仓库<span class="tag">&lt;/<span class="name">h1</span>&gt;</span>     <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setUsers([&quot;microsoft&quot;, &quot;tesla&quot;])&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">               更改获取用户      </span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span>   &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;userQueries.map((query) =&gt;</span></span><br><span class="line"><span class="language-xml">        query.isLoading ? (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">div</span>&gt;</span>加载中....<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        ) : (</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                     &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">            &#123;query.data.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;item.full_name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ))&#125;</span></span><br><span class="line"><span class="language-xml">                     </span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        )</span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">         </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="依赖请求"><a href="#依赖请求" class="headerlink" title="依赖请求"></a>依赖请求</h2><p>请求 B 接口的某个参数依赖 A 接口请求返回的内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">IssueLabelFilter</span> = (<span class="params">&#123; owner, repo &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> labelsQuery = <span class="title function_">useQuery</span>([<span class="string">&quot;repos&quot;</span>, owner, repo, <span class="string">&quot;labels&quot;</span>], <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/repos/<span class="subst">$&#123;owner&#125;</span>/<span class="subst">$&#123;repo&#125;</span>/labels`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">      res.<span class="title function_">json</span>()</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> labels = labelsQuery.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> issuesQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">    [<span class="string">&quot;repos&quot;</span>, owner, repo, <span class="string">&quot;issues&quot;</span>],</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="title function_">fetch</span>(</span><br><span class="line">        <span class="string">`https://api.github.com/repos/<span class="subst">$&#123;owner&#125;</span>/<span class="subst">$&#123;repo&#125;</span>/issues?labels=<span class="subst">$&#123;labels[<span class="number">1</span>].name&#125;</span>`</span></span><br><span class="line">      ).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>()),</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 该配置项在value为true时，会触发接口请求。</span></span><br><span class="line"><span class="comment">       * 因此当第一个接口请求返回后，此时该配置项表达式为true</span></span><br><span class="line"><span class="comment">       * 会触发请求github中的issue列表</span></span><br><span class="line"><span class="comment">       * ①</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="attr">enabled</span>: !!labels,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;labelsQuery.isLoading ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载标签中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;labelsQuery.data.map((label) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;label.id&#125;</span>&gt;</span>&#123;label.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        Issues</span></span><br><span class="line"><span class="language-xml">        &#123;Array.isArray(issuesQuery.data) ? `($&#123;labels[1].name&#125;)` : &quot;&quot;&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;issuesQuery.isLoading ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载issues中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;issuesQuery.data.map((issue) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;issue.id&#125;</span>&gt;</span>&#123;issue.title&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">IssueLabelFilter</span> <span class="attr">owner</span>=<span class="string">&#123;</span>&quot;<span class="attr">facebook</span>&quot;&#125; <span class="attr">repo</span>=<span class="string">&#123;</span>&quot;<span class="attr">react</span>&quot;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 react-query 中，当该组件被加载时，组件内的 useQuery 就会开始请求。<br>此时明显不符合需求，需求的要求是在加载完标签列表后，获取到第二个标签，再开始请求 issues 列表。<br>因此就需要使用到 useQuery 的 enabled 参数，当参数值为 false 时，将会禁止请求接口。<br>现在回到上面的例子中，当 labelsQuery 请求还没有结果时，labels 变量值为 undefined,此时在 ① 行代码中的值为 false，当 labelsQuery 请求结束时，labels 变量值为数组，此时在 ① 行代码中的值为 true，issuesQuery 开始请求数据。完全符合需求的要求。</p>
<h2 id="改进依赖查询接口一直为-loading-的问题"><a href="#改进依赖查询接口一直为-loading-的问题" class="headerlink" title="改进依赖查询接口一直为 loading 的问题"></a>改进依赖查询接口一直为 loading 的问题</h2><p>上面的例子中，issuesQuery 在加载后，由于处于禁用状态(配置项 enabled: false)，此时 isLoading 将会一直处于 true 的状态，直到 issuesQuery 请求完成数据后变为 false。<br>这种提示会非常奇怪，明明有一段时间里 issuesQuery 没有真正的请求数据，为啥要一直显示加载标签中…的内容？<br>解决办法是：需要一个字段来区分查询函数当前并没有请求数据，处于摸鱼状态。<br>在 useQuery 中当 fetchStatus 字段在为 idle 时，表示当前查询函数不在运行，处于摸鱼状态^ ^</p>
<blockquote>
<p>fetchStatus 一共有三个状态，fetching 状态表示当前查询函数正在运行，idle 状态表示当时查询函数不在运行。paused 状态表示查询函数尝试运行，但是无法进行请求，最可能的原因是由于当前没有联网，处于离线状态</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./style.css&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">IssueLabelFilter</span> = (<span class="params">&#123; owner, repo &#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> labelsQuery = <span class="title function_">useQuery</span>([<span class="string">&quot;repos&quot;</span>, owner, repo, <span class="string">&quot;labels&quot;</span>], <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/repos/<span class="subst">$&#123;owner&#125;</span>/<span class="subst">$&#123;repo&#125;</span>/labels`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span></span><br><span class="line">      res.<span class="title function_">json</span>()</span><br><span class="line">    )</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> labels = labelsQuery.<span class="property">data</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> issuesQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">    [<span class="string">&quot;repos&quot;</span>, owner, repo, <span class="string">&quot;issues&quot;</span>],</span><br><span class="line">    <span class="function">() =&gt;</span></span><br><span class="line">      <span class="title function_">fetch</span>(</span><br><span class="line">        <span class="string">`https://api.github.com/repos/<span class="subst">$&#123;owner&#125;</span>/<span class="subst">$&#123;repo&#125;</span>/issues?labels=<span class="subst">$&#123;labels[<span class="number">1</span>].name&#125;</span>`</span></span><br><span class="line">      ).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>()),</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">enabled</span>: !!labels, <span class="comment">// 👈🏻❗️❗️❗️该配置项在value为true时，会触发接口请求。因此当第一个接口请求返回后，此时该配置项表达式为true，会触发请求github中的issue列表</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>标签<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;labelsQuery.isLoading ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载标签中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;labelsQuery.data.map((label) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;label.id&#125;</span>&gt;</span>&#123;label.name&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      // 👇🏻下面的代码判断了在查询函数处于摸鱼状态时，不显示任何内容 ②&#123;issuesQuery.isLoading &amp;&amp;</span></span><br><span class="line"><span class="language-xml">      issuesQuery.fetchStatus === &quot;idle&quot; ? null : (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            Issues</span></span><br><span class="line"><span class="language-xml">            &#123;Array.isArray(issuesQuery.data) ? `($&#123;labels[1].name&#125;)` : &quot;&quot;&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          // 当查询函数处于干活状态时，显示加载issues中 ③&#123;issuesQuery.isLoading ? (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>加载issues中...<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ) : (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              &#123;issuesQuery.data.map((issue) =&gt; (</span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;issue.id&#125;</span>&gt;</span>&#123;issue.title&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              ))&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          )&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      )&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">IssueLabelFilter</span> <span class="attr">owner</span>=<span class="string">&#123;</span>&quot;<span class="attr">facebook</span>&quot;&#125; <span class="attr">repo</span>=<span class="string">&#123;</span>&quot;<span class="attr">react</span>&quot;&#125; /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>并行请求</li>
</ul>
<p>通过在查询函数中，使用<code>Promise.all</code>来进行接口的合并请求<br>通过<code>useQueries</code>来进行动态的并行请求</p>
<ul>
<li>依赖请求</li>
</ul>
<p><code>isLoading</code>为<code>true</code>表示第一次请求未返回结果前这段时间的状态，如果对接口进行了禁用，可以通过<code>fetchStatus</code>为<code>idle</code>来获取接口禁用请求这段时间的状态。</p>
<h1 id="缓存状态"><a href="#缓存状态" class="headerlink" title="缓存状态"></a>缓存状态</h1><p>react-query 通常在挂载组件时获取数据；在获取数据后，将数据存储到缓存中，并将该数据提供给组件使用。<br>在获取数据时,有三种状态.<code>loading</code>,<code>success</code>,<code>error</code>.<br>也对应<code>useQuery</code>钩子中的<code>isLoading</code>、<code>isSuccess</code>、<code>isError</code>属性<br>当 react-query 进行后端请求查询时，会有以下三个状态：</p>
<ul>
<li><code>idle</code>：空闲，表示当前不需要从后端获取数据</li>
<li><code>fetching</code>: 获取数据，表示当前正在从后端获取数据</li>
<li><code>paused</code>：暂停，表示原本尝试从后端获取数据，但是通常由于未联网的原因导致暂停</li>
</ul>
<p><code>fetchStatus</code>将会在 idle、fetching、paused 这三个状态间经历循环</p>
<blockquote>
<p>在 react-query 中 status 为<strong>loading</strong>状态(或者<strong>isLoading</strong>为 true)指的是第一次从后端获取成功之前的状态.<br>而 fetchStatus 为<strong>fetching</strong>状态(或者<strong>isFetching</strong>为 true)指的是每次从后端获取数据的加载状态（包含第一次获取数据）。</p>
</blockquote>
<p>整个生命周期:<br>假如你使用 react-query 从 Github 的接口请求了 react 的 issue 列表，你此次的请求结果将会在 status 中标记为 success 或 error，或者从 isSuccess、isError 中判断请求成功或者失败。<br>请求后端数据成功后，在写入缓存时，此时的缓存状态是<code>fresh</code>(最新)状态，但是很快(默认过期时间是 0ms)就会变为<code>stale</code>(老旧)状态。<br>如果使用 react 的 issue 列表的每个组件都被卸载后，issue 列表数据的缓存状态将会被标记为<code>inactive</code>(不活跃)状态。此时数据将不会被删除，直到一段时间后(默认为 5 分钟)，react-query 将会从缓存中删除该条数据。<br>在变为<code>inactive</code>(不活跃)状态之前，该条数据将会在<code>fresh</code>(最新)与<code>stale</code>(老旧)之间来回切换，同时接口请求状态也会在<code>idle</code>与<code>fetching</code> 之间切换。</p>
<h1 id="fresh-最新态和-stale-老旧态"><a href="#fresh-最新态和-stale-老旧态" class="headerlink" title="fresh 最新态和 stale 老旧态"></a>fresh 最新态和 stale 老旧态</h1><p>react-query 是否会触发查询函数，并从后端接口获取数据，与缓存状态是：<code>fresh</code>(最新)状态或<code>stale</code>(老旧)状态有关。如果缓存状态是<code>stale</code>(老旧)，表示该查询将会有资格重新获取，但如果缓存状态是<code>fresh</code>(最新)的，就不会重新获取。</p>
<p>如果使用 react 的 issue 列表的每个组件都被卸载后，issue 列表数据的缓存状态将会被标记为<code>inactive</code>(不活跃)状态。此时数据将不会被删除，直到一段时间后(默认为 5 分钟)，react-query 将会从缓存中删除该条数据。<br>在变为<code>inactive</code>(不活跃)状态之前，该条数据将会在<code>fresh</code>(最新)与<code>stale</code>(老旧)之间来回切换，同时接口请求状态也会在<code>idle</code>与<code>fetching</code>之间切换。</p>
<h2 id="staleTime"><a href="#staleTime" class="headerlink" title="staleTime"></a>staleTime</h2><p>在默认情况下，后端返回的数据其缓存状态将会立即<code>(&#123;staleTime: 0&#125;)</code>从<code>fresh</code>(最新)状态变为<code>stale</code>(老旧)状态。<br>其实这样做不难理解，因为当你请求到数据后，后端的数据有可能就发生了变化，因此当拿到后端返回的数据瞬间，缓存状态就是<code>stale</code>(陈旧)的了。<br>你可以将配置中的<code>staleTime</code>，设置一个毫秒数的数字，那么缓存将会在<code>staleTime</code>毫秒后过期(从<code>fresh</code>(最新)变为<code>stale</code>(陈旧))<br>如果把<code>staleTime</code>设置为<code>Infinity</code>，表示当前查询的数据将只会获取一次，且会在整个网页的生命周期内缓存。</p>
<h2 id="触发条件"><a href="#触发条件" class="headerlink" title="触发条件"></a>触发条件</h2><p>在 react-query 中并不是缓存从 fresh(最新)转换为 stale(老旧)状态时，就会重新获取。</p>
<ol>
<li>当组件首次加载，将会触发数据的获取。如果组件被卸载后再次被加载，此时也会触发数据的重新获取。</li>
<li>当用户把浏览器重新聚焦,或者切换到当前选项卡。这个触发条件是默认开启的，如果希望关闭这个触发条件，可以把<code>refetchOnWindowFocus</code>选项设置为 false 来禁止。</li>
<li>网络重新连接。可以使用<code>refetchOnReconnect</code>来禁止。</li>
<li>定时刷新。当你在配置中设置<code>refetchInterval</code>为数字(代表 xxx 毫秒)时。无论此时数据是<code>fresh</code>(最新)还是<code>stale</code>(老旧)的缓存状态，react-query 都会在你设置的毫秒时间间隔内重新获取数据</li>
</ol>
<h1 id="清理缓存"><a href="#清理缓存" class="headerlink" title="清理缓存"></a>清理缓存</h1><p>在缓存状态处于<code>inactive</code>(不活跃)状态或者使用这个查询数据的组件卸载时，超过 5 分钟（默认情况下）后，react-query 将会自动清除该缓存。<br>如果你希望自定义这个时间，你可以使用<code>cacheTime</code>配置，下面的例子中将<code>cacheTime</code>设置为 0，实现的效果是，当查询数据在<code>inactive</code>状态时，立即从缓存中删除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">  [<span class="string">&quot;user&quot;</span>, username],</span><br><span class="line">  <span class="function">() =&gt;</span></span><br><span class="line">    <span class="title function_">fetch</span>(<span class="string">`https://api.github.com/users/<span class="subst">$&#123;username&#125;</span>`</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> res.<span class="title function_">json</span>()),</span><br><span class="line">  &#123; <span class="attr">cacheTime</span>: <span class="number">0</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h1 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h1><h2 id="错误重试"><a href="#错误重试" class="headerlink" title="错误重试"></a>错误重试</h2><p>当一个查询无法重新获取时，将会基于指数退避算法的时间间隔，尝试请求 3 次。 从 1s 的延迟起步，到 30s 的最大延迟。下面是默认重试策略的相关配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exampleQuery = <span class="title function_">useQuery</span>(<span class="string">&quot;example&quot;</span>, fetchExample, &#123;</span><br><span class="line">  <span class="attr">retry</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">retryDelay</span>: <span class="function">(<span class="params">attempt</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">min</span>(attempt &gt; <span class="number">1</span> ? <span class="number">2</span> ** attempt * <span class="number">1000</span> : <span class="number">1000</span>, <span class="number">30</span> * <span class="number">1000</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS: 如果只配置了 retry 的次数，那么 retry 的时间间隔，将会默认采用指数退避算法。</p>
</blockquote>
<h2 id="错误边界"><a href="#错误边界" class="headerlink" title="错误边界"></a>错误边界</h2><p>使用<code>react-error-boundary</code>这个包，来减少相关错误边界的配置。<br>需要在配置项中，配置<code>useErrorBoundary</code>为<code>true</code>，之后错误边界就能捕获到相关的报错</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./style.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ErrorBoundary</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-error-boundary&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchWithError</span> = <span class="keyword">async</span> (<span class="params">url, options = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(url, options);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> errorMessage = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> (response.<span class="property">status</span> !== <span class="number">200</span>) &#123;</span><br><span class="line">    errorMessage += <span class="string">`请求错误状态码为： <span class="subst">$&#123;response.status&#125;</span>. `</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> body = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">  <span class="keyword">if</span> (body.<span class="property">message</span>) &#123;</span><br><span class="line">    errorMessage += body.<span class="property">message</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(errorMessage);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (errorMessage) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(errorMessage);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> body;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Repos</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> reposQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">    [<span class="string">&quot;users&quot;</span>],</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">fetchWithError</span>(<span class="string">&quot;https://api.github.com/users/facebook/repos&quot;</span>),</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">useErrorBoundary</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">onError</span>: <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error, <span class="string">&quot;onError&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;JSON.stringify(reposQuery.data)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Gists</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> gistsQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">    [<span class="string">&quot;gists&quot;</span>],</span><br><span class="line">    <span class="function">() =&gt;</span> <span class="title function_">fetchWithError</span>(<span class="string">&quot;https://api.github.com/users/facebook/gists&quot;</span>),</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">useErrorBoundary</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">onError</span>: <span class="function">(<span class="params">error</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(error, <span class="string">&quot;onError&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;JSON.stringify(gistsQuery.data)&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">QueryError</span>(<span class="params">&#123; error &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>出现错误<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;error.message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ErrorBoundary</span> <span class="attr">FallbackComponent</span>=<span class="string">&#123;QueryError&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Repos</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Gists</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ErrorBoundary</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="错误回调"><a href="#错误回调" class="headerlink" title="错误回调"></a>错误回调</h2><p>在 react-query 中，你可以在配置中设置 onError 属性，来获取错误的回调。包含了 error 的数据。<br>你可以在回调中，调用消息弹窗来提示报错信息，如果你使用 ant-design 组件库，你可以这么写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> reposQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">  [<span class="string">&quot;users&quot;</span>],</span><br><span class="line">  <span class="function">() =&gt;</span> <span class="title function_">fetchWithError</span>(<span class="string">&quot;https://api.github.com/users/facebook/repos&quot;</span>),</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">onError</span>: <span class="function">(<span class="params">error</span>) =&gt;</span> message.<span class="title function_">error</span>(&#123; <span class="attr">content</span>: error.<span class="property">message</span> &#125;),</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h2 id="针对重新获取数据失败处理的方式"><a href="#针对重新获取数据失败处理的方式" class="headerlink" title="针对重新获取数据失败处理的方式"></a>针对重新获取数据失败处理的方式</h2><p>在第一次请求数据时，查询函数返回成功。在页面失焦后，重新聚焦，触发第二次请求时，查询函数返回失败。<br>如何处理?</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useQuery &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> mockQuery = <span class="title function_">useQuery</span>(</span><br><span class="line">    [<span class="string">&quot;mock&quot;</span>],</span><br><span class="line">    <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">await</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> <span class="built_in">setTimeout</span>(resolve, <span class="number">1000</span>));</span><br><span class="line">      <span class="keyword">if</span> (count === <span class="number">0</span>) &#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="attr">retry</span>: <span class="literal">false</span> &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         &#123;&quot; &quot;&#125;</span></span><br><span class="line"><span class="language-xml">      &#123;mockQuery.isError ? (</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;error-message&quot;</span>&gt;</span>&#123;mockQuery.error.message&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      ) : null&#125;</span></span><br><span class="line"><span class="language-xml">          &#123;mockQuery.isLoading ? &quot;首次加载中...&quot; : mockQuery.data&#125;   </span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以根据不同的情况来指定你的显示策略：</p>
<ul>
<li>当重新获取数据失败后，你可以像上面的例子一样即显示缓存数据，又显示报错</li>
<li>也可以判断 isError 字段为 true 时，只显示报错信息，隐藏缓存数据。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/19/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/19/%E5%B8%B8%E7%94%A8%E7%BB%84%E4%BB%B6/" class="post-title-link" itemprop="url">常用组件</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-19 16:23:33" itemprop="dateCreated datePublished" datetime="2022-10-19T16:23:33+08:00">2022-10-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:07" itemprop="dateModified" datetime="2022-11-11T14:47:07+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="树形选项点击主项子项默认全选"><a href="#树形选项点击主项子项默认全选" class="headerlink" title="树形选项点击主项子项默认全选"></a>树形选项点击主项子项默认全选</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">carSelectedChange</span>(<span class="params">val, row</span>) &#123;</span><br><span class="line">  <span class="comment">//先重置</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">responseData</span>.<span class="property">carInfo</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">car</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (val.<span class="title function_">find</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x.<span class="property">accCarSeq</span> == car.<span class="property">accCarSeq</span>)) &#123;</span><br><span class="line">      car.<span class="property">checked</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      car.<span class="property">checked</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (car.<span class="property">children</span>) &#123;</span><br><span class="line">      car.<span class="property">children</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (val.<span class="title function_">find</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x.<span class="property">accCarSeq</span> == p.<span class="property">accCarSeq</span>)) &#123;</span><br><span class="line">          p.<span class="property">checked</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          p.<span class="property">checked</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (row) &#123;</span><br><span class="line">    <span class="comment">//单独操作行</span></span><br><span class="line">    <span class="keyword">let</span> action = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否是新增</span></span><br><span class="line">    <span class="keyword">if</span> (val.<span class="title function_">find</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> x.<span class="property">accCarSeq</span> == row.<span class="property">accCarSeq</span>)) &#123;</span><br><span class="line">      <span class="comment">//新增</span></span><br><span class="line">      action = <span class="string">&quot;add&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//移除</span></span><br><span class="line">      action = <span class="string">&quot;remove&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> carIndex = <span class="variable language_">this</span>.<span class="property">responseData</span>.<span class="property">carInfo</span>.<span class="title function_">findIndex</span>(</span><br><span class="line">      <span class="function">(<span class="params">car</span>) =&gt;</span> car.<span class="property">accCarSeq</span> == row.<span class="property">accCarSeq</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (carIndex &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">responseData</span>.<span class="property">carInfo</span>[carIndex].<span class="property">children</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        p.<span class="property">checked</span> = action == <span class="string">&quot;add&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">carTable</span>.<span class="title function_">toggleRowSelection</span>(p, action == <span class="string">&quot;add&quot;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">responseData</span>.<span class="property">carInfo</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">car</span>) =&gt;</span> &#123;</span><br><span class="line">        car.<span class="property">children</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (p.<span class="property">accCarSeq</span> == row.<span class="property">accCarSeq</span> &amp;&amp; action == <span class="string">&quot;add&quot;</span>) &#123;</span><br><span class="line">            car.<span class="property">checked</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">carTable</span>.<span class="title function_">toggleRowSelection</span>(car, <span class="literal">true</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//全选</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">responseData</span>.<span class="property">carInfo</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">car</span>) =&gt;</span> &#123;</span><br><span class="line">      car.<span class="property">children</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        p.<span class="property">checked</span> = car.<span class="property">checked</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$refs</span>.<span class="property">carTable</span>.<span class="title function_">toggleRowSelection</span>(p, p.<span class="property">checked</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/10/12/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/10/12/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">单元测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-10-12 17:29:11" itemprop="dateCreated datePublished" datetime="2022-10-12T17:29:11+08:00">2022-10-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:08" itemprop="dateModified" datetime="2022-11-11T14:47:08+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>常用测试工具 Jest,用于测试 js 相关.<br>测试 react 使用<code>@testing-library/react</code><br>测试 react-hook 使用<code>@testing-library/react-hooks</code></p>
<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @testing-library/react-hooks msw -D</span><br></pre></td></tr></table></figure>

<p>新建<code>__tests__</code>文件夹,约定<code>__</code>为测试使用文件夹.</p>
<h2 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h2><p>在<code>__tests__/http</code>中测试<code>http</code>模块.<br>下面模块用于模拟异步请求.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; setupServer &#125; <span class="keyword">from</span> <span class="string">&quot;msw/node&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> server = <span class="title function_">setupServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// beforeAll是Jest测试库中一个方法,表示执行所有测试之前先执行</span></span><br><span class="line"><span class="title function_">beforeAll</span>(<span class="function">() =&gt;</span> server.<span class="title function_">listen</span>());</span><br><span class="line"><span class="comment">//每次测试完毕都重置mock路由</span></span><br><span class="line"><span class="title function_">afterEach</span>(<span class="function">() =&gt;</span> server.<span class="title function_">resetHandlers</span>());</span><br><span class="line"><span class="comment">//所有测试完毕后,关闭mock路由</span></span><br><span class="line"><span class="title function_">afterAll</span>(<span class="function">() =&gt;</span> server.<span class="title function_">close</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始测试,第二个参数是回调函数就是测试内容</span></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&quot;http异步发送请求&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> endpoint = <span class="string">&quot;test-endpoint&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> mockResult = &#123; <span class="attr">mockValue</span>: <span class="string">&quot;mock&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用msw模拟mock</span></span><br><span class="line">  server.<span class="title function_">use</span>(</span><br><span class="line">    <span class="comment">// rest是msw中用于restful接口的方法</span></span><br><span class="line">    rest.<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;apiUrl&#125;</span>/<span class="subst">$&#123;endpoint&#125;</span>`</span>, <span class="function">(<span class="params">req, res, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">res</span>(ctx.<span class="title function_">json</span>(mockResult));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// 使用http模块返回mock值</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="title function_">http</span>(endpoint);</span><br><span class="line">  <span class="comment">// 期望http的返回值和mock数据相等(注意不是完全相等,完全是toBe)</span></span><br><span class="line">  <span class="title function_">expect</span>(result).<span class="title function_">toEqual</span>(mockResult);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&quot;http请求时携带token&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> token = <span class="string">&quot;FAKE_TOKEN&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> endpoint = <span class="string">&quot;test-endpoint&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> mockResult = &#123; <span class="attr">mockValue</span>: <span class="string">&quot;mock&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">request</span>: <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用msw模拟mock</span></span><br><span class="line">  server.<span class="title function_">use</span>(</span><br><span class="line">    <span class="comment">// rest是msw中用于restful接口的方法</span></span><br><span class="line">    rest.<span class="title function_">get</span>(<span class="string">`<span class="subst">$&#123;apiUrl&#125;</span>/<span class="subst">$&#123;endpoint&#125;</span>`</span>, <span class="function">(<span class="params">req, res, ctx</span>) =&gt;</span> &#123;</span><br><span class="line">      request = req;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">res</span>(ctx.<span class="title function_">json</span>(mockResult));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">// 使用http模块返回mock值</span></span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">http</span>(endpoint, &#123; token &#125;);</span><br><span class="line">  <span class="comment">// 期望http的返回值和mock数据相等(注意不是完全相等,完全是toBe)</span></span><br><span class="line">  <span class="title function_">expect</span>(request.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&quot;Authorization&quot;</span>)).<span class="title function_">toBe</span>(<span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="测试-Hook"><a href="#测试-Hook" class="headerlink" title="测试 Hook"></a>测试 Hook</h2><p>新建<code>__test__/use-async</code>文件.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; act, renderHook &#125; <span class="keyword">from</span> <span class="string">&quot;@testing-library/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; useAsync &#125; <span class="keyword">from</span> <span class="string">&quot;utils/use-async&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaultState</span>: <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> useAsync&gt; = &#123;</span><br><span class="line">  <span class="attr">stat</span>: <span class="string">&quot;idle&quot;</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">isIdle</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isLoading</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">isError</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">isSuccess</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">run</span>: expect.<span class="title function_">any</span>(<span class="title class_">Function</span>),</span><br><span class="line">  <span class="attr">setData</span>: expect.<span class="title function_">any</span>(<span class="title class_">Function</span>),</span><br><span class="line">  <span class="attr">setError</span>: expect.<span class="title function_">any</span>(<span class="title class_">Function</span>),</span><br><span class="line">  <span class="attr">retry</span>: expect.<span class="title function_">any</span>(<span class="title class_">Function</span>),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">loadingState</span>: <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> useAsync&gt; = &#123;</span><br><span class="line">  ...defaultState,</span><br><span class="line">  <span class="attr">stat</span>: <span class="string">&quot;loading&quot;</span>,</span><br><span class="line">  <span class="attr">isLoading</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isIdle</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">successState</span>: <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> useAsync&gt; = &#123;</span><br><span class="line">  ...defaultState,</span><br><span class="line">  <span class="attr">stat</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">  <span class="attr">isSuccess</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">isIdle</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试脚本</span></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&quot;useAsync可以异步处理&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">resolve</span>: <span class="built_in">any</span>, reject;</span><br><span class="line">  <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve = res;</span><br><span class="line">    reject = rej;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; result &#125; = <span class="title function_">renderHook</span>(<span class="function">() =&gt;</span> <span class="title function_">useAsync</span>());</span><br><span class="line">  <span class="comment">// 期望Hook的默认返回值与test的默认值一致</span></span><br><span class="line">  <span class="title function_">expect</span>(result.<span class="property">current</span>).<span class="title function_">toEqual</span>(defaultState);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> <span class="attr">p</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;;</span><br><span class="line">  <span class="comment">// 如果操作包含改变setState,需要使用act包裹</span></span><br><span class="line">  <span class="title function_">act</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    p = result.<span class="property">current</span>.<span class="title function_">run</span>(promise);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 期望刚创建的promise中是loading状态</span></span><br><span class="line">  <span class="title function_">expect</span>(result.<span class="property">current</span>).<span class="title function_">toEqual</span>(loadingState);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 期望promise执行完毕后,返回的值是success状态的值</span></span><br><span class="line">  <span class="keyword">const</span> resolvedValue = &#123; <span class="attr">mockValue</span>: <span class="string">&quot;resolved&quot;</span> &#125;;</span><br><span class="line">  <span class="title function_">act</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// 执行resolve,之后promise就是fulfilled</span></span><br><span class="line">    <span class="title function_">resolve</span>(resolvedValue);</span><br><span class="line">    <span class="keyword">await</span> p;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">expect</span>(result.<span class="property">current</span>).<span class="title function_">toEqual</span>(&#123;</span><br><span class="line">    ...successState,</span><br><span class="line">    <span class="attr">data</span>: resolvedValue,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="测试组件"><a href="#测试组件" class="headerlink" title="测试组件"></a>测试组件</h2><p>新建<code>__tests__/mark.tsx</code>用于测试高亮组件.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; renderHook &#125; <span class="keyword">from</span> <span class="string">&quot;@testing-library/react-hooks&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; screen &#125; <span class="keyword">from</span> <span class="string">&quot;@testing-library/react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Mark</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../components/mark&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">test</span>(<span class="string">&quot;Mark组件正确高亮关键词&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">&quot;物料管理&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> keyword = <span class="string">&quot;管理&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">renderHook</span>(<span class="function">() =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">Mark</span> <span class="attr">name</span>=<span class="string">&#123;name&#125;</span> <span class="attr">keyword</span>=<span class="string">&#123;keyword&#125;</span> /&gt;</span></span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 期望keyword存在document中</span></span><br><span class="line">  <span class="title function_">expect</span>(screen.<span class="title function_">getByText</span>(keyword)).<span class="title function_">toBeInTheDocument</span>();</span><br><span class="line">  <span class="title function_">expect</span>(screen.<span class="title function_">getByText</span>(keyword)).<span class="title function_">toHaveStyle</span>(<span class="string">&quot;color: #257AFD&quot;</span>);</span><br><span class="line">  <span class="comment">// 期望其他字没有高亮颜色</span></span><br><span class="line">  <span class="title function_">expect</span>(screen.<span class="title function_">getByText</span>(<span class="string">&quot;物料&quot;</span>)).<span class="property">not</span>.<span class="title function_">toHaveStyle</span>(<span class="string">&quot;color: #257AFD&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/26/HTTP%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/26/HTTP%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">HTTP基础</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-26 21:08:25" itemprop="dateCreated datePublished" datetime="2022-09-26T21:08:25+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:08" itemprop="dateModified" datetime="2022-11-11T14:47:08+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<p>title: HTTP基础</p>
<p>date: 2019-08-21 14:53:32</p>
<p>tags: HTML</p>
<p>categories:  # 这里写的分类会自动汇集到 categories 页面上，分类可以多级</p>
<ul>
<li>HTML # 一级分类</li>
<li>HTTP基础 # 二级分类</li>
</ul>
<hr>
<h1 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h1><p>ajax 是一种技术方案，核心依赖浏览器提供的 XMLHttpRequest 对象，是这个对象使得浏览器可以发出 http 请求与接受响应。</p>
<h2 id="如何与后端交互"><a href="#如何与后端交互" class="headerlink" title="如何与后端交互"></a>如何与后端交互</h2><ol>
<li>form 表单提交.缺点会跳转，无后台反馈</li>
<li>ajax</li>
<li>websocket</li>
</ol>
<h3 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h3><ol>
<li>XMLHttpRequest 对象(该对象支持同步和异步请求)</li>
<li>fetch</li>
</ol>
<h3 id="范例"><a href="#范例" class="headerlink" title="范例"></a>范例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequst</span>()</span><br><span class="line"><span class="comment">//true默认是异步的方式,false是同步的方式</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;/xxx.com&quot;</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; xhr.<span class="property">status</span> &lt; <span class="number">300</span>) || xhr.<span class="property">status</span> === <span class="number">304</span>) &#123;</span><br><span class="line">            <span class="comment">//成功</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">responseText</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器异常&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>()</span><br></pre></td></tr></table></figure>

<h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a>Fetch</h3><p>fetch 基于 promise</p>
<p>当接受到错误状态码时,conf<code>fetch()</code>返回的 promise 不会标记为 reject</p>
<p>默认情况下,fetch 不会从服务端发送或接收任何 cookies.</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"><span class="number">2.</span> xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;/xxx&#x27;</span>)  <span class="comment">//初始化xhr</span></span><br><span class="line"><span class="number">3.</span> xhr.<span class="title function_">send</span>()  <span class="comment">//发送请求</span></span><br><span class="line"><span class="number">4.</span> xhr.<span class="property">onreadystatechange</span>  <span class="comment">//监听请求状态的变化&lt;readystatechange&gt;是一个事件</span></span><br><span class="line"><span class="number">5.</span> xhr.<span class="property">readyState</span> === <span class="number">1</span>  <span class="comment">//xhr.open()已经完成</span></span><br><span class="line"><span class="number">6.</span> xhr.<span class="property">readyState</span> === <span class="number">2</span>  <span class="comment">//xhr.send()已经完成</span></span><br><span class="line"><span class="number">7.</span> xhr.<span class="property">readyState</span> === <span class="number">3</span>  <span class="comment">//xhr.responseText正在下载</span></span><br><span class="line"><span class="number">5.</span> xhr.<span class="property">readyState</span> === <span class="number">4</span>  <span class="comment">//响应完成</span></span><br><span class="line"><span class="number">6.</span> xhr.<span class="property">status</span>  <span class="comment">//HTTP状态码</span></span><br><span class="line"><span class="number">7.</span> <span class="keyword">var</span> string = xhr.<span class="property">responseText</span>  <span class="comment">//响应的内容</span></span><br><span class="line"><span class="number">8.</span> <span class="keyword">var</span> value = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>)  <span class="comment">//把符合JSON语法的字符串转换成JS，解析响应返回的内容</span></span><br><span class="line"><span class="number">9.</span> value.<span class="property">node</span>   <span class="comment">//若value是对象，这就是对象里内容</span></span><br><span class="line"><span class="number">10.</span> value.<span class="property">node</span>.<span class="property">name</span>  <span class="comment">//对象里的name的值</span></span><br></pre></td></tr></table></figure>

<p><strong>post</strong>形式需要将数据放入到 send 中</p>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><h3 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h3><p>同协议，域名，端口</p>
<h1 id="实现跨域的方法"><a href="#实现跨域的方法" class="headerlink" title="实现跨域的方法"></a>实现跨域的方法</h1><h2 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h2><p>JSON with padding</p>
<blockquote>
<p>通过 script 标签加载数据的方式获取数据当做 js 代码来执行。jsonp 需要对应接口的后端配合才可以实现。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">addScriptTag</span>(<span class="params">src</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> script = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">  script.<span class="title function_">setAttribute</span>(<span class="string">&quot;type&quot;</span>, <span class="string">&quot;text/javascript&quot;</span>);</span><br><span class="line">  script.<span class="property">src</span> = src;</span><br><span class="line">  <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(script);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">addScriptTag</span>(<span class="string">&quot;http://example.com/ip?callback=foo&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Your public IP address is: &quot;</span> + data.<span class="property">ip</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面代码通过动态添加<code>&lt;script&gt;</code>元素，向服务器 example.com 发出请求。注意，该请求的查询字符串有一个 callback 参数，用来指定回调函数的名字，这对于 JSONP 是必需的。</p>
</blockquote>
<p>服务器收到这个请求以后，会将数据放在回调函数的参数位置返回。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">foo</span>(&#123;</span><br><span class="line">  <span class="attr">ip</span>: <span class="string">&quot;8.8.8.8&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于<code>&lt;script&gt;</code>元素请求的脚本，直接作为代码运行。这时，只要浏览器定义了 foo 函数，该函数就会立即调用。作为参数的 JSON 数据被视为 JavaScript 对象，而不是字符串，因此避免了使用<code>JSON.parse</code>的步骤。</p>
</blockquote>
<h3 id="必考面试题：JSONP-为什么不支持-POST-请求"><a href="#必考面试题：JSONP-为什么不支持-POST-请求" class="headerlink" title="必考面试题：JSONP 为什么不支持 POST 请求"></a>必考面试题：JSONP 为什么不支持 POST 请求</h3><p>答：因为 JSONP 是通过动态创建 script 的方法进行的，而 script 只能发送 get 请求不能发送 post 请求。</p>
<h3 id="jquery-的写法"><a href="#jquery-的写法" class="headerlink" title="jquery 的写法"></a>jquery 的写法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://jack.com:8002/pay&quot;</span>,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;jsonp&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span> (<span class="params">response</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(response)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="axios-写法"><a href="#axios-写法" class="headerlink" title="axios 写法"></a>axios 写法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">$http</span> = axios;</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">$http</span></span><br><span class="line">  .<span class="title function_">jsonp</span>(<span class="string">&quot;http://www.domain2.com:8080/login&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">params</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">jsonp</span>: <span class="string">&quot;handleCallback&quot;</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h2><p>跨域资源共享，是一种 ajax 跨域请求资源的方式。</p>
<p>写法就是普通的 ajax 写法.不过在浏览器请求上加点处理.而且是浏览器自动处理的.</p>
<p>当使用 XMLHttpRequest 发送请求时，浏览器发现该请求不符合同源策略，会给请求加一个请求头:<code>Origin</code>。</p>
<p>后台进行处理，如果确定接受请求，则在返回结果中加响应头：<code>Access-Control-Allow-Origin</code>。</p>
<p>浏览器判断该响应头中是否包含<code>Origin</code>的值，如果有，浏览器会处理响应，就可以拿到响应数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>(); <span class="comment">// IE8/9需用window.XDomainRequest兼容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 前端设置是否带cookie</span></span><br><span class="line">xhr.<span class="property">withCredentials</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;post&quot;</span>, <span class="string">&quot;http://www.domain2.com:8080/login&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">xhr.<span class="title function_">send</span>(<span class="string">&quot;user=admin&quot;</span>);</span><br><span class="line"></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> == <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="postMessage"><a href="#postMessage" class="headerlink" title="postMessage"></a>postMessage</h2><ol>
<li><strong>A 页面</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="variable language_">this</span>.<span class="property">receiveMessage</span>, <span class="literal">false</span>)</span><br><span class="line">    <span class="keyword">const</span> iframeImg = <span class="variable language_">this</span>.<span class="property">iframe</span>.<span class="property">contentWindow</span></span><br><span class="line">    iframeImg.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        iframeImg.<span class="title function_">postMessage</span>(<span class="string">&#x27;message&#x27;</span>, <span class="string">&#x27;http://www.blogoog.com:8088&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">receiveMessage = <span class="function">(<span class="params">event</span>) =&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> origin = event.<span class="property">origin</span> || event.<span class="property">originalEvent</span>.<span class="property">origin</span></span><br><span class="line">        <span class="keyword">const</span> thisData = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(event.<span class="property">data</span>)</span><br><span class="line">        <span class="keyword">const</span> imgUrl = <span class="title class_">Object</span>.<span class="title function_">values</span>(thisData)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123; imgUrl &#125;)</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span>&#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">closeIframe</span>();</span><br><span class="line">            message.<span class="title function_">success</span>(<span class="string">&#x27;上传成功&#x27;</span>)</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">        <span class="keyword">if</span> (origin !== <span class="string">&#x27;http://www.blogoog.com:80881) &#123;</span></span><br><span class="line"><span class="string">          window.location.hash = &#x27;</span>#/exception/<span class="number">404</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe</span><br><span class="line">  className=&#123;styles.<span class="property">iframeWrap</span>&#125;</span><br><span class="line">  src=<span class="string">&quot;http://www.blogoog.com:8088&quot;</span></span><br><span class="line">  name=<span class="string">&quot;imgIframe&quot;</span></span><br><span class="line">  frameBorder=<span class="string">&quot;0&quot;</span></span><br><span class="line">  scrolling=<span class="string">&quot;auto&quot;</span></span><br><span class="line">  ref=&#123;<span class="function">(<span class="params">dom</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">iframe</span> = dom;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  您的浏览器不支持iframe</span><br><span class="line">&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li>A 页面使用的语法</li>
</ol>
<p><strong>window.postMessage()</strong></p>
<p><code>otherWindow.postMessage(message, targetOrigin, [transfer])</code></p>
<ul>
<li>otherWindow：其他窗口的一个引用（在这里我使用了 iframe 的 contentWindow 属性）</li>
<li>message：将要发送到其他 window 的数据（可以不受限制的将数据对象安全的传送给目标窗口而无需自己序列化，原因是因为采用了结构化克隆算法）</li>
<li>targetOrigin：接收信息的 URL（在这里我当然填的 B 页面的 URL）</li>
<li>transfer：可选参数</li>
</ul>
<p><strong>window.addEventListener(‘message’, receiveMessage, false)</strong></p>
<p><code>target.addEventListener(type, listener, options)</code></p>
<ul>
<li>type：表示监听事件类型的字符串</li>
<li>listener：当所监听的事件类型触发时，会通知的一个对象或者一个函数</li>
<li>potions：可选参数（在此我用 false，表示在 listener 被调用之后不会自动移除）</li>
</ul>
<p><strong>receiveMessage &#x3D; (event) &#x3D;&gt; {}</strong></p>
<ul>
<li>event.data：从另一个 window 传递过来的对象（包含传递过来的所有信息）</li>
<li>event.origin||event.originalEvent.origin：window.postMessage()发送消息的目标 URL</li>
<li>event.source：对发送消息的窗口对象的引用</li>
</ul>
<h3 id="注意点！！！"><a href="#注意点！！！" class="headerlink" title="注意点！！！"></a>注意点！！！</h3><ul>
<li>在页面内嵌入 iframe 页面的情况下，需要等到页面内的 iframe 页面，也就是 B 页面加载完成之后，才能进行 postMessage 跨域通信</li>
<li>event.origin 中的 origin 不能保证是该窗口的当前 origin 或者未来 origin，因为 postMessage 被调用后，可能会被导航到不同的位置，所以需要做个异常情况判断处理<code>origin !== &#39;http://www.blogoog.com:8088&#39;</code></li>
</ul>
<ol start="2">
<li><strong>B 页面</strong></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">created</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">addEventListener</span>&#123;<span class="string">&quot;message&quot;</span>, <span class="variable language_">this</span>.<span class="property">receiveMessage</span>, <span class="literal">false</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="title function_">receiveMessage</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e origin === <span class="string">&#x27;http://www.blogoog.com:8080&#x27;</span> || e.<span class="property">origin</span> === <span class="string">&#x27;http://www.blogoog.com:8088&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">sendBtnShow</span> = <span class="literal">true</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">originSource</span> = e.<span class="property">origin</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">magicBuildData</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(e.<span class="property">data</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">sendMsg</span>(<span class="params"></span>) &#123;</span><br><span class="line">        top.<span class="title function_">postMessage</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data), <span class="string">&#x27;http://www.blogoog.com:8000&#x27;</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>B 页面使用到的语法</li>
</ol>
<p><code>top.postMessage(&#39;data&#39;, &#39;http://www.blogoog.com:8000&#39;)</code></p>
<p>参考上面 A 页面的语法</p>
<p>为什么用 top 而不用 window 下面再讲</p>
<p><code>window.addEventListener(&#39;message&#39;, receiveMessage, false)</code></p>
<p>参考上面 A 页面的语法</p>
<p><code>receiveMessage = (event) =&gt; &#123;&#125;</code></p>
<p>参考上面 A 页面的语法</p>
<h4 id="window-postMessage-中的-window-到底是啥？"><a href="#window-postMessage-中的-window-到底是啥？" class="headerlink" title="window.postMessage()中的 window 到底是啥？"></a>window.postMessage()中的 window 到底是啥？</h4><p>始终是你需要通信的目标窗口</p>
<ul>
<li>A 页面中：A 页面向 B 页面发送跨域信息，window 就是在 A 页面中嵌入的 iframe 指向的 B 页面的 window，即：iframe.contentWindow</li>
<li>B 页面中：B 页面想 A 页面发送跨域信息，window 就是 A 页面的 window，在这里因为 B 页面时嵌入到 A 页面中的，对于 B 页面来讲，window 就是 top 或者 parent</li>
</ul>
<h3 id="需要特别注意的坑"><a href="#需要特别注意的坑" class="headerlink" title="需要特别注意的坑"></a>需要特别注意的坑</h3><ol>
<li>一定要等 A 页面嵌入的 B 页面加载完成之后，再进行 postMessage 跨域通信</li>
<li>一定要对 origin 做判断，去掉不是来自我们目标窗口的 origin，防止来自其他 origin 的攻击</li>
<li>着重注意 window.postMessage()中 window 的用法，明确目标窗口的 window</li>
</ol>
<h1 id="websocket-协议跨域"><a href="#websocket-协议跨域" class="headerlink" title="websocket 协议跨域"></a>websocket 协议跨域</h1><p>WebSocket protocol 是 HTML5 一种新的协议。它实现了浏览器与服务器全双工通信，同时允许跨域通讯，是 server push 技术的一种很好的实现。</p>
<p>原生 WebSocket API 使用起来不太方便，我们使用 Socket.io，它很好地封装了 webSocket 接口，提供了更简单、灵活的接口，也对不支持 webSocket 的浏览器提供了向下兼容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;user input：&lt;input type=<span class="string">&quot;text&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcss.com/socket.io/2.2.0/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">var</span> socket = <span class="title function_">io</span>(<span class="string">&#x27;http://www.domain2.com:8080&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 连接成功处理</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">socket.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 监听服务端消息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    socket.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="keyword">function</span>(<span class="params">msg</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;data from server: ---&gt; &#x27;</span> + msg);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 监听服务端关闭</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    socket.<span class="title function_">on</span>(<span class="string">&#x27;disconnect&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server socket has closed.&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;input&#x27;</span>)[<span class="number">0</span>].<span class="property">onblur</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    socket.<span class="title function_">send</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>后端 node</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> socket = <span class="built_in">require</span>(<span class="string">&quot;socket.io&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 启http服务</span></span><br><span class="line"><span class="keyword">var</span> server = http.<span class="title function_">createServer</span>(<span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123;</span><br><span class="line">    <span class="string">&quot;Content-type&quot;</span>: <span class="string">&quot;text/html&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  res.<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="string">&quot;8080&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Server is running at port 8080...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听socket连接</span></span><br><span class="line">socket.<span class="title function_">listen</span>(server).<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="keyword">function</span> (<span class="params">client</span>) &#123;</span><br><span class="line">  <span class="comment">// 接收信息</span></span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span> (<span class="params">msg</span>) &#123;</span><br><span class="line">    client.<span class="title function_">send</span>(<span class="string">&quot;hello：&quot;</span> + msg);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;data from client: ---&gt; &quot;</span> + msg);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 断开处理</span></span><br><span class="line">  client.<span class="title function_">on</span>(<span class="string">&quot;disconnect&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Client socket has closed.&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h1><h2 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h2><p>HTML 内联框架元素<code>&lt;iframe&gt;</code> 表示嵌套的 browsing context。它能够将另一个 HTML 页面嵌入到当前页面中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe</span><br><span class="line">  src=<span class="string">&quot;https://mdn-samples.mozilla.org/snippets/html/iframe-simple-contents.html&quot;</span></span><br><span class="line">  title=<span class="string">&quot;iframe example 1&quot;</span></span><br><span class="line">  width=<span class="string">&quot;400&quot;</span></span><br><span class="line">  height=<span class="string">&quot;300&quot;</span></span><br><span class="line">&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Your browser does not support iframes.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&lt;/iframe&gt;</span><br></pre></td></tr></table></figure>

<h2 id="canvas"><a href="#canvas" class="headerlink" title="canvas"></a>canvas</h2><p>标签定义图形，比如图表和其他图像。该标签基于 JavaScript 的绘图 API</p>
<h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>定义多媒体资源 <code>&lt;video&gt;</code> 和<code>&lt;audio&gt;</code></p>
<h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><p>定义命令按钮，比如单选按钮、复选框或按钮</p>
<h2 id="figure"><a href="#figure" class="headerlink" title="figure"></a>figure</h2><p>规定独立的流内容（图像、图表、照片、代码等等）</p>
<h2 id="nav"><a href="#nav" class="headerlink" title="nav"></a>nav</h2><p>导航</p>
<h2 id="section"><a href="#section" class="headerlink" title="section"></a>section</h2><p>定义文档中的节（section、区段）</p>
<h1 id="HTTP-报文"><a href="#HTTP-报文" class="headerlink" title="HTTP 报文"></a>HTTP 报文</h1><p>HTTP 报文是在 HTTP 应用程序之间发送的数据块。这些数据块以一些文本形式的元信息开头，描述报文的内容及含义，后面跟着可选的数据部分</p>
<h2 id="URI-和-URL"><a href="#URI-和-URL" class="headerlink" title="URI 和 URL"></a>URI 和 URL</h2><p>URI：统一资源标识符</p>
<p>URL：统一资源定位符</p>
<h2 id="报文组成"><a href="#报文组成" class="headerlink" title="报文组成"></a>报文组成</h2><ol>
<li>对报文进行描述的起始行 —— start line</li>
<li>包含属性的首部块 —— header</li>
<li>可选的包含数据的主体部分 —— body</li>
</ol>
<h2 id="报文语法"><a href="#报文语法" class="headerlink" title="报文语法"></a>报文语法</h2><ol>
<li>请求报文：</li>
</ol>
<p>向 web 服务器请求一个动作</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;method&gt;&lt;request-<span class="variable constant_">URL</span>&gt;&lt;version&gt;</span><br><span class="line">&lt;headers&gt;</span><br><span class="line"></span><br><span class="line">&lt;entity-body&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>响应报文</li>
</ol>
<p>把请求结果返回给客户端</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;version&gt;&lt;status&gt;&lt;reason-phrase&gt;</span><br><span class="line">&lt;headers&gt;</span><br><span class="line"></span><br><span class="line">&lt;entity-body&gt;</span><br></pre></td></tr></table></figure>

<h2 id="状态码"><a href="#状态码" class="headerlink" title="状态码"></a>状态码</h2><p>服务器和浏览器之间的约定</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类:"></a>分类:</h3><p>100-199 用于指定客户端应相应的某些动作。</p>
<p>200-299 用于表示请求成功。</p>
<p>300-399 用于已经移动的文件并且常被包含在定位头信息中指定新的地址信息。</p>
<p>400-499 用于指出客户端的错误。</p>
<p>500-599 用于支持服务器错误。</p>
<table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">状态信息</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">100</td>
<td align="left">Continue</td>
<td align="left">初始请求已接受,继续发送</td>
</tr>
<tr>
<td align="left">101</td>
<td align="left">switching Protocols</td>
<td align="left">服务器遵从客户请求转换到另一种协议</td>
</tr>
<tr>
<td align="left"><strong>200</strong></td>
<td align="left"><strong>OK</strong></td>
<td align="left"><strong>请求成功</strong></td>
</tr>
<tr>
<td align="left">201</td>
<td align="left">Created</td>
<td align="left">服务器已经创建了文档,Location 头给出了他的 URL</td>
</tr>
<tr>
<td align="left">202</td>
<td align="left">Accepted</td>
<td align="left">已接受请求,但处理尚未完成</td>
</tr>
<tr>
<td align="left">203</td>
<td align="left">Non-Authoritative Information</td>
<td align="left">文档已正常返回但一些应答头可能不正确,因为使用的是文档的拷贝</td>
</tr>
<tr>
<td align="left"><strong>204</strong></td>
<td align="left"><strong>No Content</strong></td>
<td align="left"><strong>服务器接到请求已经处理完毕,但浏览器页面不会刷新</strong></td>
</tr>
<tr>
<td align="left">205</td>
<td align="left">Reset Content</td>
<td align="left">没有新内容,但浏览器应该重置它所显示的内容,用来强制浏览器清除表单输入内容.</td>
</tr>
<tr>
<td align="left">206</td>
<td align="left">Partial Content</td>
<td align="left">客户发送了一个带有 Range 头的 GET 请求,服务器完成了它</td>
</tr>
<tr>
<td align="left">300</td>
<td align="left">Multiple Choices</td>
<td align="left">客户请求的文档可以在多个位置找到,这些位置已经在返回的文档中列出.如果服务器要提出优先选择,则应该在 Location 应答头指明</td>
</tr>
<tr>
<td align="left"><strong>301</strong></td>
<td align="left"><strong>Moved Permanently</strong></td>
<td align="left"><strong>永久重定向,请求的网页已经永久移动到新位置</strong></td>
</tr>
<tr>
<td align="left"><strong>302</strong></td>
<td align="left"><strong>Found</strong></td>
<td align="left"><strong>临时重定向,POST 方法的重定向在未询问用户的情况下就会变成 GET</strong></td>
</tr>
<tr>
<td align="left"><strong>303</strong></td>
<td align="left"><strong>See Other</strong></td>
<td align="left"><strong>类似 301&#x2F;302,不同之处在于,原来的请求是 POST,现在是 GET</strong></td>
</tr>
<tr>
<td align="left"><strong>304</strong></td>
<td align="left"><strong>Not Modified</strong></td>
<td align="left"><strong>自从上次请求后,网页未被修改过</strong></td>
</tr>
<tr>
<td align="left">305</td>
<td align="left">Use Proxy</td>
<td align="left">使用代理服务器</td>
</tr>
<tr>
<td align="left"><strong>307</strong></td>
<td align="left"><strong>Temporary Redirect</strong></td>
<td align="left"><strong>临时重定向，不同之处,把 POST 转为 GET</strong></td>
</tr>
<tr>
<td align="left"><strong>400</strong></td>
<td align="left"><strong>Bad Request</strong></td>
<td align="left"><strong>请求出现语法错误</strong></td>
</tr>
<tr>
<td align="left"><strong>401</strong></td>
<td align="left"><strong>Unauthorized</strong></td>
<td align="left"><strong>用户未授权,需要用户验证</strong></td>
</tr>
<tr>
<td align="left"><strong>403</strong></td>
<td align="left"><strong>Forbidden</strong></td>
<td align="left"><strong>服务器已经理解请求,但是拒绝执行</strong></td>
</tr>
<tr>
<td align="left"><strong>404</strong></td>
<td align="left"><strong>Not Found</strong></td>
<td align="left"><strong>服务器找不到请求的网页</strong></td>
</tr>
<tr>
<td align="left">405</td>
<td align="left">Method Not Allowed</td>
<td align="left">请求方法（GET、POST、HEAD、DELETE、PUT、TRACE 等）对指定的资源不适用。</td>
</tr>
<tr>
<td align="left">406</td>
<td align="left">Not Acceptable</td>
<td align="left">指定的资源已经找到，但它的 MIME 类型和客户在 Accpet 头中所指定的不兼容</td>
</tr>
<tr>
<td align="left">407</td>
<td align="left">Proxy Authentication Required</td>
<td align="left">类似于 401，表示客户必须先经过代理服务器的授权</td>
</tr>
<tr>
<td align="left">408</td>
<td align="left">Request Timeout</td>
<td align="left">请求超时</td>
</tr>
<tr>
<td align="left"><strong>500</strong></td>
<td align="left"><strong>Internal Server Error</strong></td>
<td align="left"><strong>服务器遇到错误,无法完成请求</strong></td>
</tr>
<tr>
<td align="left"><strong>503</strong></td>
<td align="left"><strong>Service Unavailable</strong></td>
<td align="left"><strong>由于临时的服务器维护或过载,暂时无法处理请求</strong></td>
</tr>
<tr>
<td align="left">504</td>
<td align="left">Gateway Timeout</td>
<td align="left">由作为代理或网关的服务器使用，表示不能及时地从远程服务器获得应答</td>
</tr>
<tr>
<td align="left">505</td>
<td align="left">HTTP Version Not Supported</td>
<td align="left">服务器不支持请求中所指明的 HTTP 版本。</td>
</tr>
</tbody></table>
<h2 id="HTTP-请求方法"><a href="#HTTP-请求方法" class="headerlink" title="HTTP 请求方法"></a>HTTP 请求方法</h2><ol>
<li><strong>GET</strong></li>
</ol>
<p>请求服务器发送某个资源</p>
<ol start="2">
<li><strong>HEAD</strong></li>
</ol>
<p>与 GET 方法类似,但是在服务器的响应中没有资源的内容,只有资源的一些基本信息,主要用于</p>
<ul>
<li>在不获取资源的情况下获取信息(类型,大小等)</li>
<li>通过状态码看资源是否存在</li>
<li>通过查看首部,测试资源是否被修改</li>
</ul>
<ol start="3">
<li><strong>PUT</strong></li>
</ol>
<p>和 GET 从服务器获取资源相反,PUT 用于向服务器写入资源.PUT 的语义就是让服务器用请求的主体部分创建一个请求 URL 命名的文档.如果存在就替换</p>
<ol start="4">
<li><strong>POST</strong></li>
</ol>
<p>POST 用于向服务器发送数据,通常用来支持 HTML 的表单(input,select,textarea),表单中的数据会被发送到服务器</p>
<ol start="5">
<li><strong>TRACE</strong></li>
</ol>
<p>客户端发送一个请求,这个请求可能会穿过防火墙,代理,网关,和一些其他应用程序,每个中间节点都可以修改 HTTP 请求,TRACE 方法允许客户端在最终请求发往服务器的时候,看看他变成了什么样子</p>
<p>TRACE 请求会在目的服务器端发送一个”闭环”诊断,行程最后一站服务器会弹回一条 TRACE 响应,并在响应主题中携带他收到的原始请求报文</p>
<ol start="5">
<li><strong>DELETE</strong></li>
</ol>
<p>用于要求服务器删除请求的 URL,和 PUT 一样,服务器可能不支持</p>
<ol start="6">
<li><strong>OPTIONS</strong></li>
</ol>
<p>用于请求服务器告知其支持的各种功能</p>
<h1 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h1><p>缓存是一种保存资源副本并在下次请求时直接使用该副本的技术.</p>
<p>HTTP 缓存有多种规则，根据是否需要重新向服务器发起请求来分类，分为两大类(<strong>强制缓存，协商缓存</strong>)</p>
<p>http 缓存机制主要在 http 响应头中设定，响应头中相关字段为<strong>Expires、Cache-Control、Last-Modified、Etag</strong>。</p>
<h3 id="cache-control"><a href="#cache-control" class="headerlink" title="cache-control"></a>cache-control</h3><p>cache-control 通常用于优化网页性能,适当使用可减少重复读取相同内容</p>
<p>可以在服务端 setHeader 设置 cache-control</p>
<p>可以设置让该字段存于缓存中,浏览器下次访问时不发起请求,直接从缓存中读取该资源</p>
<h3 id="ETag"><a href="#ETag" class="headerlink" title="ETag"></a>ETag</h3><p>ETag 通常用于优化网页性能,适当使用可减少重复读取相同内容</p>
<p>可通过服务端 setHeader 设置 etag 为相应的字段的 md5 值</p>
<p>浏览器访问时,request.headers 会带有 if-none-match 属性(为上述 MD5),若不等于则说明服务器上的</p>
<p>该资源与本地存储的该资源不相同,需要重新从服务器加载;若相等则说明两者资源相同,则直接从本地</p>
<p>缓存获取.后端应设置 statusCode&#x3D;304.与 cache-control 不同的是:etag 始终都要发请求和收响应,而</p>
<p>cache-control 不发请求.</p>
<h1 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h1><p>存储信息到浏览器，可以用 js 设置，也可以在服务器端通过 set-cookie 让浏览器种下 cookie，存在于响应头里。</p>
<p>每次请求都会带上 cookie，最大容量 4k</p>
<p>用途：记录用户名</p>
<p>设置 cookie 时的参数：</p>
<ol>
<li><code>path</code>: cookie 影响到的路径，匹配该路径才发送 cookie</li>
<li><code>expires</code>和<code>maxAge</code>:告诉浏览器 cookie 多久过期</li>
</ol>
<p>不设置就会产生 session cookie，当关闭浏览器，cookie 就被清除 3. <code>secure</code>: 为 true 时，在 http 无效，在 https 生效 4. <code>httpOnly</code>: 浏览器不允许通过 js 修改 cookie</p>
<h1 id="session"><a href="#session" class="headerlink" title="session"></a>session</h1><p>用来保存状态。当用户输入用户名密码提交给服务器后，服务器验证通过后创建 session 用于记录用户信息，session 可保存在服务器，也可以保存在数据库</p>
<ol>
<li>创建 session 后，会把关联的 session_id 通过是 set-cookie 添加到响应头</li>
<li>浏览器加载页面发现有 set-cookie 字段，就把这个 cookie 种到指定域名下</li>
<li>下次刷新页面，发送的请求带上 cookie，服务器接受后根据 session_id 来识别用户</li>
</ol>
<blockquote>
<p>cookie 和 session 的区别:</p>
</blockquote>
<p>cookie 是存储在浏览器中的一小段数据,session 是让服务器识别某个用户的机制 session.在实现过程中需要使用 cookie.二者不是同一维度的东西.</p>
<h1 id="localStorage"><a href="#localStorage" class="headerlink" title="localStorage"></a>localStorage</h1><ol>
<li>本地存储，永不过期，除非手动 js 删除。5M 大小。</li>
<li>不参与网络传输</li>
<li>一般用于性能优化</li>
</ol>
<h2 id="localStorage-的存储-获取-删除"><a href="#localStorage-的存储-获取-删除" class="headerlink" title="localStorage 的存储,获取,删除"></a>localStorage 的存储,获取,删除</h2><p>只支持字符串存储.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存储</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&quot;myCat&quot;</span>, <span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取</span></span><br><span class="line"><span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除</span></span><br><span class="line">localstorage.<span class="title function_">removeItem</span>(<span class="string">&quot;myCat&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//移除所有</span></span><br><span class="line">localstorage.<span class="title function_">clear</span>();</span><br></pre></td></tr></table></figure>

<h1 id="sessionstorage"><a href="#sessionstorage" class="headerlink" title="sessionstorage"></a>sessionstorage</h1><p>与 localstorage 类似,属于本地存储与上面的 session 无关.但是关闭浏览器失效.</p>
<h2 id="浏览器缓存机制通俗语言版-自我理解"><a href="#浏览器缓存机制通俗语言版-自我理解" class="headerlink" title="浏览器缓存机制通俗语言版(自我理解)"></a>浏览器缓存机制通俗语言版(自我理解)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: max-age=300；</span><br><span class="line">ETag:W/&quot;e-cbxLFQW5zapn79tQwb/g6Q&quot;</span><br></pre></td></tr></table></figure>

<p>浏览器第一次请求 a.jpg 这张图片,服务器发回一张图片,并且附送一个<code>ETag</code>(相当于一个用于验证的文件).浏览器把这张图片和 ETag 缓存到本地.如果在 300 秒内,浏览器又请求这张图片,那么直接从缓存中读取这张图.如果超过 300 秒,浏览器发现已经过了时间了,就重新向服务器发请求,并且附带之前给的 ETag.服务器拿着当前文件计算后的<code>ETag</code>和浏览器发回的<code>ETag</code>比较,如果一样,说明图片没换,发回一个响应头(不包含图片,304,表示文件没修改,还能用).如果不一样,就把新的文件和新的<code>ETag</code>发回去.</p>
<p>另外还有<code>Last-Modified/If-Modified-Since</code>.和<code>ETag</code>功能类似.因为服务器可能不止一个,文件存储在不同的服务器,那就给请求文件上附带上<code>Last-Modified</code>声明,请求时带上<code>If-Modified-Since</code>,表明服务器上一次修改这个文件的时间,拿来和服务器上记录的最后修改时间对比.如果修改时间比较新,说明被动过,发回一个新文件.如果时间比较旧,说明不用换,发回 304,使用缓存即可.</p>
<h2 id="严谨说法"><a href="#严谨说法" class="headerlink" title="严谨说法"></a>严谨说法</h2><p>浏览器缓存控制分为<strong>强缓存</strong>和<strong>协商缓存</strong>，<strong>协商缓存</strong>必须配合<strong>强缓存</strong>使用。</p>
<p>首先浏览器第一次跟服务器请求一个资源，服务器在返回这个资源和 response header 的同时，会根据开发者要求或者浏览器默认，在 response 的 header 加上相关字段的 http response header。</p>
<p>一、当浏览器对某个资源的请求命中了<strong>强缓存</strong>时，利用[Expires]或者[Cache-Control]这两个 http response header 实现</p>
<p>。</p>
<ol>
<li><p>[Expires]：描述的是一个绝对时间，根据的是客户端时间。用 GMT 格式的字符串表示，如：Expires:Thu, 31 Dec 2037 23:55:55 GMT 下次浏览器再次请求同一资源时。先从客户端缓存中寻找，找到这个资源后，拿出它的[Expires]跟当前的请求时间比较。如果请求时间在[Expires]指定的失效时间之前，就能命中缓存，这样就不用再次到服务器上去缓存一遍，节省了资源。但是正因为是绝对时间，如果客户端时间被随意更改下，这个机制就失效了。所以我们需要[Cache-Control]。</p>
</li>
<li><p>[Cache-Control]：描述的是一个相对时间，在进行缓存命中时，都是利用浏览器时间判断。</p>
</li>
</ol>
<p>这两个 header 可以只启用一个，也可以同时启用，当 response header 中，[Expires]和[Cache-Control]同时存在时，[Cache-Control]优先级高于[Expires]。</p>
<p>二、当浏览器对某个资源的请求没有命中<strong>强缓存</strong>，就会发一个请求到服务器，验证<strong>协商缓存</strong>是否命中。</p>
<p>如果命中，则还是从客户端缓存中加载。<strong>协商缓存</strong>利用的是[Last-Modified，If-Modified-Since]和[ETag、If-None-Match]这两对 Header 来管理的。</p>
<ol>
<li><p>[Last-Modified]：原理和上面的[expires]相同，区别是它是根据服务器时间返回的 header 来判断缓存是否存在。但是有时候也会服务器上资源其实有变化，但是最后修改时间却没有变化的情况（这种问题也不容易被定位），这时候我们需要[ETag、If-None-Match]。</p>
</li>
<li><p>[ETag、If-None-Match]：原理与上相同，区别是浏览器跟服务器请求一个资源，服务器在返回这个资源的同时，在 respone 的 header 加上 ETag 的 header，这个 header 是服务器根据当前请求的资源生成的一个唯一标识，这个唯一标识是一个字符串，只要资源有变化这个串就不同。</p>
</li>
<li><p>[ETag、If-None-Match]这么厉害我们为什么还需要[Last-Modified、If-Modified-Since]呢？有一个例子就是分布式系统尽量关闭掉 ETag(每台机器生成的 ETag 都会不一样）</p>
</li>
</ol>
<p>[Last-Modified，If-Modified-Since]和[ETag、If-None-Match]一般都是同时启用。</p>
<h1 id="HTTPS-原理"><a href="#HTTPS-原理" class="headerlink" title="HTTPS 原理"></a>HTTPS 原理</h1><p>HTTP+SSL&#x2F;TLS， 即 HTTP 下加入 SSL 层，HTTPS 的安全基础是 SSL，因此加密的详细内容就需要 SSL，用于安全的 HTTP 数据传输。</p>
<h2 id="加密算法："><a href="#加密算法：" class="headerlink" title="加密算法："></a>加密算法：</h2><ol>
<li>对称加密</li>
</ol>
<p>有流式、分组两种，加密和解密都是使用的同一个密钥。 2. 非对称加密</p>
<p>加密使用的密钥和解密使用的密钥是不相同的，分别称为：公钥、私钥，公钥和算法都是公开的，私钥是保密的。非对称加密算法性能较低，但是安全性超强，由于其加密特性，非对称加密算法能加密的数据长度也是有限的 3. 哈希算法</p>
<p>将任意长度的信息转换为较短的固定长度的值，通常其长度要比信息小得多，且算法不可逆。 4. 数字签名</p>
<p>签名就是在信息的后面再加上一段内容（信息经过 hash 后的值），可以证明信息没有被修改过。hash 值一般都会加密后（也就是签名）再和信息一起发送，以保证这个 hash 值不被修改。</p>
<h1 id="简单通信流程"><a href="#简单通信流程" class="headerlink" title="简单通信流程"></a>简单通信流程</h1><p>概括来说，整个简化的加密通信的流程就是：</p>
<ol>
<li>小明访问网站，网站将自己的证书给到小明（其实是给到浏览器，小明不会有感知）</li>
<li>浏览器从证书中拿到网站的公钥 A</li>
<li>浏览器生成一个只有自己知道的对称密钥 B，用公钥 A 加密，并传给网站（其实是有协商的过程，这里为了便于理解先简化）</li>
<li>网站通过私钥解密，拿到对称密钥 B</li>
<li>浏览器、网站 之后的数据通信，都用密钥 B 进行加密</li>
</ol>
<h1 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h1><h2 id="证书可能存在的问题"><a href="#证书可能存在的问题" class="headerlink" title="证书可能存在的问题"></a>证书可能存在的问题</h2><p>证书是伪造的：压根不是 CA 颁发的</p>
<p>证书被篡改过：比如将 XX 网站的公钥给替换了</p>
<p>解决方法: <strong>数字签名和摘要</strong></p>
<p>“摘要”就是对传输的内容，通过 hash 算法计算出一段固定长度的串。然后，在通过 CA 的私钥对这段摘要进行加密，加密后得到的结果就是“数字签名.这段数字签名只有 CA 的公钥才能够解密。</p>
<h1 id="一个页面从输入-URL-到页面加载显示完成，这个过程中都发生了什么？（流程说的越详细越好）"><a href="#一个页面从输入-URL-到页面加载显示完成，这个过程中都发生了什么？（流程说的越详细越好）" class="headerlink" title="一个页面从输入 URL 到页面加载显示完成，这个过程中都发生了什么？（流程说的越详细越好）"></a>一个页面从输入 URL 到页面加载显示完成，这个过程中都发生了什么？（流程说的越详细越好）</h1><h2 id="详细版："><a href="#详细版：" class="headerlink" title="详细版："></a>详细版：</h2><p>1、浏览器会开启一个线程来处理这个请求，对 URL 分析判断如果是 http 协议就按照 Web 方式来处理;</p>
<p>2、调用浏览器内核中的对应方法，比如 WebView 中的 loadUrl 方法;</p>
<p>3、通过 DNS 解析获取网址的 IP 地址，设置 UA 等信息发出第二个 GET 请求;</p>
<p>4、进行 HTTP 协议会话，客户端发送报头(请求报头);</p>
<p>5、进入到 web 服务器上的 Web Server，如 Apache、Tomcat、Node.JS 等服务器;</p>
<p>6、进入部署好的后端应用，如 PHP、Java、JavaScript、Python 等，找到对应的请求处理;</p>
<p>7、处理结束回馈报头，此处如果浏览器访问过，缓存上有对应资源，会与服务器最后修改时间对比，一致则返回 304;</p>
<p>8、浏览器开始下载 html 文档(响应报头，状态码 200)，同时使用缓存;</p>
<p>9、文档树建立，根据标记请求所需指定 MIME 类型的文件（比如 css、js）,同时设置了 cookie;</p>
<p>10、页面开始渲染 DOM，JS 根据 DOM API 操作 DOM,执行事件绑定等，页面显示完成。</p>
<h2 id="简洁版："><a href="#简洁版：" class="headerlink" title="简洁版："></a>简洁版：</h2><p>浏览器根据请求的 URL 交给 DNS 域名解析，找到真实 IP，向服务器发起请求；</p>
<p>服务器交给后台处理完成后返回数据，浏览器接收文件（HTML、JS、CSS、图象等）；</p>
<p>浏览器对加载到的资源（HTML、JS、CSS 等）进行语法解析，建立相应的内部数据结构（如 HTML 的 DOM）；</p>
<p>载入解析到的资源文件，渲染页面，完成。</p>
<h1 id="WebSocket-协议"><a href="#WebSocket-协议" class="headerlink" title="WebSocket 协议"></a>WebSocket 协议</h1><h2 id="1-为什么需要-WebSocket"><a href="#1-为什么需要-WebSocket" class="headerlink" title="1.为什么需要 WebSocket"></a>1.为什么需要 WebSocket</h2><p>HTTP 协议只能由客户端发起,WebSocket 可以实现双向对话,服务端和客户端都可以发送信息.</p>
<h2 id="2-WebSocket-特点"><a href="#2-WebSocket-特点" class="headerlink" title="2.WebSocket 特点"></a>2.WebSocket 特点</h2><ol>
<li>建立在 TCP 协议之上,服务端实现容易.</li>
<li>与 HTTP 协议有着良好的兼容性,并且握手阶段采用 HTTP 协议,因此握手阶段不容易屏蔽,可通过 HTTP 代理服务器.</li>
<li>数据格式轻量,性能开销小,通信高效.</li>
<li>可以发送文本和二进制数据.</li>
<li>没有同源限制.</li>
<li>协议标识符是 ws(加密是 wss),服务器网址是 URL.</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ws</span>:<span class="comment">//example.com:80/some/path</span></span><br></pre></td></tr></table></figure>

<h3 id="客户端示例"><a href="#客户端示例" class="headerlink" title="客户端示例"></a>客户端示例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;wss://echo.websocket.org&quot;</span>);</span><br><span class="line"></span><br><span class="line">ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Connection open ...&quot;</span>);</span><br><span class="line">  ws.<span class="title function_">send</span>(<span class="string">&quot;Hello WebSockets!&quot;</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Received Message: &quot;</span> + evt.<span class="property">data</span>);</span><br><span class="line">  ws.<span class="title function_">close</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.<span class="property">onclose</span> = <span class="keyword">function</span> (<span class="params">evt</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Connection closed.&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="WebSocket-客户端-API"><a href="#WebSocket-客户端-API" class="headerlink" title="WebSocket 客户端 API"></a>WebSocket 客户端 API</h2><h3 id="WebSocket-构造函数"><a href="#WebSocket-构造函数" class="headerlink" title="WebSocket 构造函数"></a>WebSocket 构造函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&quot;ws://localhost:8080&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>执行上面语句之后，客户端就会与服务器进行连接。</p>
<h3 id="WebSocket-readyState"><a href="#WebSocket-readyState" class="headerlink" title="WebSocket.readyState"></a>WebSocket.readyState</h3><p>readyState 属性返回实例对象的当前状态,共用四种.</p>
<ul>
<li>CONNECTING: 值为 0,表示正在连接.</li>
<li>OPEN: 值为 1,表示连接成功,可以通信.</li>
<li>CLOSEING: 值为 2,表示正在关闭.</li>
<li>CLOSED: 值为 3,表示连接已经关闭,或者打开失败.</li>
</ul>
<p>示例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (ws.<span class="property">readyState</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="title class_">WebSocket</span>.<span class="property">CONNECTING</span>:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="title class_">WebSocket</span>.<span class="property">CLOSING</span>:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="title class_">WebSocket</span>.<span class="property">CLOSED</span>:</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="attr">default</span>:</span><br><span class="line">    <span class="comment">// this never happens</span></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="WebSocket-onopen"><a href="#WebSocket-onopen" class="headerlink" title="WebSocket.onopen"></a>WebSocket.onopen</h3><p>实例对象的<code>onopen</code>属性,用于指定连接成功后的回调函数.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ws.<span class="property">onopen</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  ws.<span class="title function_">send</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果指定多个函数,可以使用<code>addEventListener</code>方法.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ws.<span class="title function_">addEventListener</span>(<span class="string">&quot;open&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  ws.<span class="title function_">send</span>(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="WebSocket-onclose"><a href="#WebSocket-onclose" class="headerlink" title="WebSocket.onclose"></a>WebSocket.onclose</h3><p>实例对象的<code>onclose</code>属性，用于指定连接关闭后的回调函数。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/26/React-Hooks/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/26/React-Hooks/" class="post-title-link" itemprop="url">React-Hooks</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-26 21:08:20" itemprop="dateCreated datePublished" datetime="2022-09-26T21:08:20+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:08" itemprop="dateModified" datetime="2022-11-11T14:47:08+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<h2 id="title-React-Hooksdate-2020-06-27-09-13-34"><a href="#title-React-Hooksdate-2020-06-27-09-13-34" class="headerlink" title="title: React-Hooksdate: 2020-06-27 09:13:34"></a>title: React-Hooksdate: 2020-06-27 09:13:34</h2><p>tags: React</p>
<h3 id="class-组件类的缺点"><a href="#class-组件类的缺点" class="headerlink" title="class 组件类的缺点"></a>class 组件类的缺点</h3><ul>
<li>大型业务很难拆分或重构,也很难测试</li>
<li>业务逻辑分散在组件的各个方法中,导致重复逻辑或关联逻辑.</li>
<li>组件类引入了复杂的编程模式,比如<code>render props</code>和高阶组件.</li>
</ul>
<h2 id="React-Hook-的设计目的"><a href="#React-Hook-的设计目的" class="headerlink" title="React Hook 的设计目的"></a>React Hook 的设计目的</h2><p>加强版函数组件,完全不使用类,就能写出一个全功能组件.</p>
<blockquote>
<p>含义为,组件尽量写成纯函数,如果需要外部功能或副作用,就用钩子函数把外部代码”钩”进来.</p>
</blockquote>
<p>React 规定,钩子一律使用<code>use</code>前缀命名,便于识别.</p>
<p>常用钩子: <code>useState()</code>,<code>useContext()</code>,<code>useReducer()</code>,<code>useEffect()</code></p>
<h2 id="useState-状态钩子"><a href="#useState-状态钩子" class="headerlink" title="useState()状态钩子"></a><code>useState()</code>状态钩子</h2><p>用于为函数组件引入状态(state),纯函数不能有状态,所以将状态放入钩子里.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">Button</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> [buttonText, setButtonText] = <span class="title function_">useState</span>(<span class="string">&quot;Click!&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">handleCilck</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">setButtonText</span>(<span class="string">&quot;thank&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleClick&#125;</span>&gt;</span>&#123;buttonText&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用户点击后,文字自发生了变化,文字取决于用户是否点击,这就是状态.</p>
<blockquote>
<p>Button 组件是一个函数,内部使用<code>useState()</code>引入状态.</p>
</blockquote>
<p><code>useState()</code>函数接收状态的初始值,作为参数,例子中的初始值为按钮的文字,该函数返回一个数组,数组的第一个成员是一个变量(<code>buttonText</code>).</p>
<p>指向状态的当前值.第二个成员是一个函数,用来更新状态.约定是<code>set</code>前缀加上变量名(<code>setButtonText</code>).</p>
<h2 id="useContext-共享状态钩子"><a href="#useContext-共享状态钩子" class="headerlink" title="useContext()共享状态钩子"></a><code>useContext()</code>共享状态钩子</h2><p>如果需要在组件之间共享状态,可以使用<code>useContext()</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">AppContext</span> = <span class="title class_">React</span>.<span class="title function_">createContext</span>(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">&lt;<span class="title class_">AppContext</span>.<span class="property">Provider</span> value=&#123;&#123; <span class="attr">username</span>: <span class="string">&quot;super&quot;</span>&#125;&#125;&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Navbar</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Message</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">AppContext</span>.<span class="property">Provider</span>&gt;</span><br></pre></td></tr></table></figure>

<p>其中,<code>AppContext.Provider</code>提供一个<code>Context</code>对象,这个对象可以被子组件共享.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Navbar.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Navbar</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username &#125; = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>Awesome<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;username&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>其中,<code>useContext()</code>钩子函数用来引入 Context 对象,从中获取<code>username</code>属性.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Message.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">Message</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username &#125; = <span class="title function_">useContext</span>(<span class="title class_">AppContext</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;messages&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>message for &#123;username&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">&quot;message&quot;</span>&gt;</span>useContext<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="useReducer-action-钩子"><a href="#useReducer-action-钩子" class="headerlink" title="useReducer(): action 钩子"></a><code>useReducer()</code>: action 钩子</h2><p>React 本身不提供状态管理功能,通常使用外部库,如 Redux.</p>
<p>Redux 的核心概念,组件发出 action 与状态管理器通信.状态管理器收到 action 后,使用 Reducer 函数算出新的状态,</p>
<p>Reducer 函数的形式是<code>(state, action)=&gt;newState</code>.</p>
<p><code>useReducers()</code>用来引入 Reducer 功能.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [state, dispatch] = <span class="title function_">useReducer</span>(reducer, initialState);</span><br></pre></td></tr></table></figure>

<p>上面是<code>useReducer()</code>的基本用法,它接收 Reducer 函数和状态的初始值作为参数,返回一个数组.数组的第一个成员是状态的当前值,</p>
<p>第二个是发送 action 的<code>dispatch</code>函数.</p>
<p>由于 Hooks 可以提供共享状态和 Reducer 函数,所以这些方面可以取代 redux.但是无提供<code>中间件</code>和时间旅行.</p>
<h2 id="useEffect-副作用钩子"><a href="#useEffect-副作用钩子" class="headerlink" title="useEffect(): 副作用钩子"></a><code>useEffect()</code>: 副作用钩子</h2><p><code>useEffect()</code>用来引入具有副作用的操作,如向服务器发送请求数据.</p>
<p>之前放在<code>componentDidMount</code>之中的代码可以放在<code>useEffect()</code>中.</p>
<p>解决了没有生命周期的问题.</p>
<p>用法如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//async action</span></span><br><span class="line">&#125;, [dependencies]);</span><br></pre></td></tr></table></figure>

<p><code>useEffect()</code>接收两个参数,第一个参数是一个函数,异步操作的代码放在里面.</p>
<p>第二个参数是一个数组,用于给<code>Effect</code>的依赖项,只要这个数组发生变化,<code>useEffect()</code>就会执行.</p>
<p>第二个参数可以省略,这样每次渲染,就会执行<code>useEffect()</code>.</p>
<p>第二个参数如果是一个空数组<code>[]</code>,就只会在加载时执行一次,数据更新时不执行.</p>
<h2 id="自定义-Hooks"><a href="#自定义-Hooks" class="headerlink" title="自定义 Hooks"></a>自定义 Hooks</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/26/React%E8%B7%AF%E7%94%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/26/React%E8%B7%AF%E7%94%B1/" class="post-title-link" itemprop="url">React路由</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-26 21:08:15" itemprop="dateCreated datePublished" datetime="2022-09-26T21:08:15+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:08" itemprop="dateModified" datetime="2022-11-11T14:47:08+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<h2 id="title-React-路由-date-2020-05-10-13-59-49"><a href="#title-React-路由-date-2020-05-10-13-59-49" class="headerlink" title="title: React 路由 date: 2020-05-10 13:59:49"></a>title: React 路由 date: 2020-05-10 13:59:49</h2><p>tags: React</p>
<h2 id="安装-react-router-dom"><a href="#安装-react-router-dom" class="headerlink" title="安装 react-router-dom"></a>安装 react-router-dom</h2><p>可以使用<code>&lt;Link&gt;,&lt;NavLink&gt;</code>标签</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom --save</span><br></pre></td></tr></table></figure>

<h2 id="创建路由模式"><a href="#创建路由模式" class="headerlink" title="创建路由模式"></a>创建路由模式</h2><ol>
<li>hash 模式</li>
<li>history 模式</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hash模式</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Link</span>, <span class="title class_">Route</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">//history模式</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span>, <span class="title class_">Route</span>, <span class="title class_">HashRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>as</code>类似于起别名,方便简化名称.</p>
<h2 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a>创建路由</h2><blockquote>
<p>需要通过使<code>Route</code>进行对组件的声明配置,才能被<code>Link</code>找到.</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// histoty</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Link</span>, <span class="title class_">Route</span>, <span class="title class_">Switch</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="comment">// hash</span></span><br><span class="line"><span class="comment">// import &#123; Link, Route, HashRouter as Router &#125; from &#x27;react-router-dom&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page1</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是Page1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page2</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是Page2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Page3</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是Page3<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;page1&quot;</span>&gt;</span>Page1<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;page2&quot;</span>&gt;</span>Page2<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;page3&quot;</span>&gt;</span>Page3<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/page1&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page1&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/page2&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page2&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/page3&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page3&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h2 id="函数式-带组件"><a href="#函数式-带组件" class="headerlink" title="函数式(带组件)"></a>函数式(带组件)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//router.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BrowserRouter</span> <span class="keyword">as</span> <span class="title class_">Router</span>, <span class="title class_">Route</span>, <span class="title class_">Switch</span>, <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Login</span> <span class="keyword">from</span> <span class="string">&quot;./pages/login&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Home</span> <span class="keyword">from</span> <span class="string">&quot;./pages/home&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">App</span> <span class="keyword">from</span> <span class="string">&quot;./pages/app&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数式</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">ARouter</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/home&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Link</span> &#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span>去首页<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>去登陆<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//有状态组件点击跳转</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  handleJump = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">histroy</span>.<span class="title function_">push</span>(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/login&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/home&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleJump&#125;</span>&gt;</span>点击去登陆<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<p>如果用<code>Switch</code>，浏览器输入<code>/home</code>也只会加载 App 页，因为<code>/home</code>先匹配了<code>/</code></p>
<p>加上 <code>exact</code> 可以精准匹配</p>
<p>如果导入的是<code>HashRouter</code>，会自动加上<code>#</code> 如 <code>http://localhost:3000/login#/</code></p>
<h2 id="手动跳转"><a href="#手动跳转" class="headerlink" title="手动跳转"></a>手动跳转</h2><p>当你使用 History 路由的时候，某些时候需要主动的跳转道某个路由，</p>
<p>这时又不能去触发节点行为，所以这个时候就可以通过 API 的方式，进行跳转.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 跳转页面</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">push</span>(参数和to的内容相似);</span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">push</span>(<span class="string">&quot;page1&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重定向页面</span></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">history</span>.<span class="title function_">replace</span>(<span class="string">&quot;page2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>当然还有 hash 的 go 方法。</p>
<h2 id="动态路由"><a href="#动态路由" class="headerlink" title="动态路由"></a>动态路由</h2><h2 id="路由传值"><a href="#路由传值" class="headerlink" title="路由传值"></a>路由传值</h2><p>路由传参(传值)一般使用<code>params</code>和<code>query</code>.</p>
<p>通过给<code>to</code>传递一个对象的方式进行数据传递.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">&quot;App&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">to</span>=<span class="string">&#123;&#123;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">pathname:</span> &quot;/<span class="attr">page1</span>/<span class="attr">10</span>&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">search:</span> &quot;?<span class="attr">roles</span>=<span class="string">[10,</span> <span class="attr">20</span>]&quot;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">state:</span> &#123; <span class="attr">name:</span> &quot;<span class="attr">Tom</span>&quot; &#125;,</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &#125;&#125;</span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        &gt;</span></span></span><br><span class="line"><span class="language-xml">          Page1</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;page2&quot;</span>&gt;</span>Page2<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;page3&quot;</span>&gt;</span>Page3<span class="tag">&lt;/<span class="name">Link</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/page1/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page1&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/page2&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page2&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">exact</span> <span class="attr">path</span>=<span class="string">&quot;/page3&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Page3&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>可以看到，向<code>page1</code>的路由上添加了一个<code>:id</code>表示需要传递<code>param</code>的<code>id</code>的值，</p>
<p>同时声明了<code>search</code>的文本和<code>state</code>对象多种方式传递了参数。以便根据不同的场景使用。</p>
<h2 id="路由-Hooks"><a href="#路由-Hooks" class="headerlink" title="路由 Hooks"></a>路由 Hooks</h2><h3 id="useParams-获取参数-内部封装"><a href="#useParams-获取参数-内部封装" class="headerlink" title="useParams: 获取参数(内部封装)"></a>useParams: 获取参数(内部封装)</h3><p>如果在有状态组件(也就是 class 声明的类中)获取参数,需要通过<code>this.props.match.parmas.id</code>.</p>
<p>而在函数式组件(无状态组件)中获取,需要通过<code>useParams()</code></p>
<h3 id="useHistory-通过-JS-Api-操作路由跳转"><a href="#useHistory-通过-JS-Api-操作路由跳转" class="headerlink" title="useHistory: 通过 JS Api 操作路由跳转"></a>useHistory: 通过 JS Api 操作路由跳转</h3><p>函数式组件没有作用域,this 为 undefined.所以需要使用 useHistory 进行跳转.</p>
<p>如果在有状态组件中,需要<code>this.props.history.push(&#39;/&#39;)</code>进行跳转.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Detail</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> params = <span class="title function_">useParams</span>();</span><br><span class="line">  <span class="keyword">const</span> history = <span class="title function_">useHistory</span>();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>当前的参数值为: &#123;params.goodId&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">          history.push(&quot;/&quot;);</span></span><br><span class="line"><span class="language-xml">        &#125;&#125;</span></span><br><span class="line"><span class="language-xml">      &gt;</span></span><br><span class="line"><span class="language-xml">        跳转</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/26/React%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/26/React%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">React入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-26 21:08:10" itemprop="dateCreated datePublished" datetime="2022-09-26T21:08:10+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-11-11 14:47:08" itemprop="dateModified" datetime="2022-11-11T14:47:08+08:00">2022-11-11</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<h2 id="title-React-入门-date-2020-05-05-09-48-17"><a href="#title-React-入门-date-2020-05-05-09-48-17" class="headerlink" title="title: React 入门 date: 2020-05-05 09:48:17"></a>title: React 入门 date: 2020-05-05 09:48:17</h2><p>tags: React</p>
<p>React 是一个 MVC 框架.</p>
<h1 id="React-特点"><a href="#React-特点" class="headerlink" title="React 特点"></a>React 特点</h1><ol>
<li>声明式写法</li>
<li>组件化</li>
<li>可开发多种任务</li>
</ol>
<h1 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h1><h2 id="官方脚手架-creat-react-app"><a href="#官方脚手架-creat-react-app" class="headerlink" title="官方脚手架 creat-react-app"></a>官方脚手架 creat-react-app</h2><p>需求: node &gt; 6.0</p>
<p>安装命令<code>npm install create-react-app</code></p>
<p>创建命令<code>create-reate-app my-project</code></p>
<p>运行命令<code>npm start</code></p>
<h1 id="文件入口"><a href="#文件入口" class="headerlink" title="文件入口"></a>文件入口</h1><p><code>/src/App.js</code></p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p>ReactDOM.render()</p>
<p>React.CreateElement()</p>
<p>React.Component</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//括号内分别为标签名,属性,默认值</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="title class_">React</span>.<span class="title class_">CreatElement</span>(</span><br><span class="line">  <span class="string">&quot;h1&quot;</span>,</span><br><span class="line">  &#123; <span class="attr">className</span>: <span class="string">&quot;red&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;Tom&quot;</span> &#125;,</span><br><span class="line">  <span class="string">&quot;hello world&quot;</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">//括号内为所要渲染元素,挂载位置</span></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(hello, <span class="variable language_">document</span>.<span class="title function_">getELementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>特点:</p>
<p>当插入很多数据,ReactDOM.render 会通过虚拟 DOM 方式生成一个 diff,只插入一次.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用大括号形式将js函数编入HTML</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> ele = (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">&quot;red&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Tom&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    hello,&#123;name&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(ele, <span class="variable language_">document</span>.<span class="title function_">getELementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="书写格式"><a href="#书写格式" class="headerlink" title="书写格式"></a>书写格式</h2><p>src 下新建一个组件 Demo.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/Demo.js</span></span><br><span class="line"><span class="comment">//引入react</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="comment">//新建类class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">    <span class="comment">//render方法渲染</span></span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;h1&gt; <span class="title class_">Hello</span> <span class="title class_">React</span> &lt;h1&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Demo</span></span><br></pre></td></tr></table></figure>

<h3 id="组件挂载"><a href="#组件挂载" class="headerlink" title="组件挂载"></a>组件挂载</h3><p>将组件挂载到 ReactDOM 节点上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">ReactDOM</span> <span class="keyword">from</span> <span class="string">&quot;react-dom&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Demo</span> <span class="keyword">from</span> <span class="string">&quot;./Demo&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDom</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Demo</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>));</span><br></pre></td></tr></table></figure>

<h1 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h1><p>javascript 语法扩展.</p>
<p>在花括号{}中可以添加任意 js 的表达式(expressions).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Demo.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Demo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> todoList = [<span class="string">&quot;Learn React&quot;</span>, <span class="string">&quot;Learn Redux&quot;</span>];</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello React<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          &#123;todoList.map((item) =&gt; (</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          ))&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">Demo</span>;</span><br></pre></td></tr></table></figure>

<h2 id="JSX-实质"><a href="#JSX-实质" class="headerlink" title="JSX 实质"></a>JSX 实质</h2><p>JSX 是语法糖–<code>React.createElement()</code></p>
<p>JSX 返回 ReactElement 对象</p>
<h1 id="实操总结"><a href="#实操总结" class="headerlink" title="实操总结"></a>实操总结</h1><p>&#x2F;&#x2F;jsx 中函数必须用{}括起来,不要有空格,否则失效</p>
<p>&#x2F;&#x2F;jsx 中调用类中的函数要加 this</p>
<p>&#x2F;&#x2F;在 jsx 之前要把要用的参数提前解构出来</p>
<p>&#x2F;&#x2F;函数中调用也要解构</p>
<h1 id="组件通信-属性传值-Props-x2F-State-x2F-Forms"><a href="#组件通信-属性传值-Props-x2F-State-x2F-Forms" class="headerlink" title="组件通信(属性传值)Props&#x2F;State&#x2F;Forms"></a>组件通信(属性传值)Props&#x2F;State&#x2F;Forms</h1><h2 id="组件和-Props-属性"><a href="#组件和-Props-属性" class="headerlink" title="组件和 Props(属性)"></a>组件和 Props(属性)</h2><ul>
<li>组件像函数一样,接受特定的输入(props),产生特定的输出(React Elements)</li>
<li>V &#x3D; f(props)</li>
<li>props 像纯函数一样,只读,不可变化</li>
</ul>
<p><code>props.children</code>可以拿到 div 下的首尾标签的子元素</p>
<p>示例:</p>
<h2 id="class-形式带状态组件"><a href="#class-形式带状态组件" class="headerlink" title="class 形式带状态组件"></a>class 形式带状态组件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NameCard</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="comment">//使用render()进行渲染</span></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, number, isHuman, tags &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>电话: &#123;number&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;isHuman ? &quot;人类&quot; : &quot;外星人&quot;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            &#123;tags.map((tag, index) =&gt; (</span></span><br><span class="line"><span class="language-xml">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;tag&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            ))&#125;</span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">NameCard</span>;</span><br></pre></td></tr></table></figure>

<h3 id="函数式组件-无状态组件"><a href="#函数式组件-无状态组件" class="headerlink" title="函数式组件(无状态组件)"></a>函数式组件(无状态组件)</h3><p>无状态,没有生命周期</p>
<h4 id="示例一"><a href="#示例一" class="headerlink" title="示例一"></a>示例一</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Hello</span>(<span class="params">props</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello,&#123;props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄: &#123;props.age&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Hello</span> <span class="attr">name</span>=<span class="string">&quot;Tom&quot;</span> <span class="attr">age</span>=<span class="string">&quot;12&quot;</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="示例二"><a href="#示例二" class="headerlink" title="示例二"></a>示例二</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">NameCard</span> = (<span class="params">props</span>) =&gt; &#123;</span><br><span class="line">        <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;name, number, isHuman, tags &#125; = <span class="variable language_">this</span>.<span class="property">props</span></span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;name&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>电话: &#123;number&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123; isHuman ? &#x27;人类&#x27; : &#x27;外星人&#x27; &#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        &#123; tags.map((tag,index) =&gt; (</span></span><br><span class="line"><span class="language-xml">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;tag&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                        ))&#125;</span></span><br><span class="line"><span class="language-xml">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="State-状态"><a href="#State-状态" class="headerlink" title="State(状态)"></a>State(状态)</h2><ul>
<li>组件内部的数据可以动态改变</li>
<li><code>this.setState()</code>是更新 state 的唯一途径</li>
</ul>
<h3 id="示例-LikesButton"><a href="#示例-LikesButton" class="headerlink" title="示例:LikesButton"></a>示例:LikesButton</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//cpmponents/LikesButton.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LikesButton</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">likes</span>: <span class="number">0</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//如果未使用箭头函数说明this,需绑定this</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">increaseLikes</span> = <span class="variable language_">this</span>.<span class="property">increaseLikes</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">type</span>=<span class="string">&quot;button&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          // <span class="attr">函数要使用驼峰式</span>,<span class="attr">最好使用箭头函数</span>,<span class="attr">否则this指向不明</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">            this.increaseLikes();</span></span><br><span class="line"><span class="language-xml">          &#125;&#125;</span></span><br><span class="line"><span class="language-xml">        &gt;</span></span><br><span class="line"><span class="language-xml">          点赞 &#123;this.state.likes&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">LikesButton</span>;</span><br></pre></td></tr></table></figure>

<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><ul>
<li>组件挂载</li>
<li>组件更新</li>
<li>组件卸载</li>
<li>错误处理</li>
</ul>
<p><img src="https://s1.ax1x.com/2020/06/28/NgZCwD.png#alt="></p>
<h3 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h3><p>当组件实例被创建并插入 DOM 中,生命周期调用顺序为</p>
<ul>
<li><code>constructor()</code></li>
</ul>
<p>构造函数初始化,最先被执行,初始化<code>state</code>等</p>
<ul>
<li><code>static getDerivedStateFromProps()</code></li>
</ul>
<p>这是一个静态方法，需要在前面增加 static 的属性</p>
<ul>
<li><code>render()</code></li>
</ul>
<p>渲染函数，返回渲染的内容，当页面产生更新也会触发该方法。</p>
<p><code>render()</code>方法是<code>class</code>组件中唯一必须实现的方法。</p>
<ul>
<li><code>componentDidMount</code></li>
</ul>
<p>组件挂载之后，这个时候组件已经挂载完毕了</p>
<h3 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h3><p>当组件的<code>props</code>或<code>state</code>发生变化时会触发更新。组件更新的生命周期调用顺序如下：</p>
<ul>
<li><code>static getDrivedStateFromProps()</code></li>
</ul>
<p>组件即将被更新，这里参数分别对应前后被修改的内容，通过返回一个布尔值告知是否需要更新视图。</p>
<ul>
<li><code>shouldComponentUpdate()</code></li>
</ul>
<p>如果<code>shouldComponentUpdate()</code>返回<code>false</code>，则不会调用<code>render()</code>。</p>
<ul>
<li><code>render()</code></li>
</ul>
<p>当视图更新，那么 Render 也会重新更新</p>
<ul>
<li><code>getSnapshotBeforeUpdate</code></li>
</ul>
<p><code>getSnapshotBeforeUpdate</code>在<code>render</code>之后<code>componentDidUpdate</code>之前输出，类似于中间件用来做一些捕获操作。</p>
<ul>
<li><code>componentDidUpdate</code></li>
</ul>
<p><code>componentDidUpdate(prevProps, prevState, snapshot)</code>,三个参数 prevProps，prevState，snapshot，表示之前的 props，之前的 state，和 snapshot。snapshot 是 getSnapshotBeforeUpdate 返回的值.</p>
<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><p>当组件从 DOM 中移除时会调用如下方法：</p>
<p><code>componentWillUnmount</code></p>
<p>组件卸载，我们可以清除一些定时器,取消网络请求。</p>
<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>当渲染过程，生命周期，或子组件的构造函数中抛出错误时，会调用如下方法：</p>
<ul>
<li><code>static getDrivedStateFromError()</code></li>
<li><code>componentDidCatch()</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span> (props) &#123;</span><br><span class="line">  <span class="variable language_">super</span>(props)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">state</span> = &#123;&#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;1.constructor构造函数&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidMount () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;componentDidMount&#x27;</span>)</span><br><span class="line">  <span class="title class_">Store</span>.<span class="title function_">subscribe</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromProps (nextProps, prevState) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getDerivedStateFromProps&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(nextProps, prevState)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getSnapshotBeforeUpdate (prevProps, prevState) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(prevProps, prevState)</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&#x27;top: 200&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentDidUpdate (prevProps, prevState, snapshot) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(prevProps, prevState, snapshot)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">componentWillUnmount () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;componentWillUnmount&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">changeText () &#123;</span><br><span class="line">  <span class="title class_">Store</span>.<span class="title function_">dispatch</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;changeName&#x27;</span>,</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;我是ClassDemo中修改的名字： wangly&#x27;</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render () &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;3.render函数&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123; Store.getState().redux_name &#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123; this.state.redux_name &#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">this.changeText.bind</span>(<span class="attr">this</span>) &#125;&gt;</span>更改文本<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="示例-电子钟表"><a href="#示例-电子钟表" class="headerlink" title="示例: 电子钟表"></a>示例: 电子钟表</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//components/DigitalClock.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DigitalClock</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">//初始化props</span></span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">//初始化状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="comment">//初始值</span></span><br><span class="line">      <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//加载前可以发起ajax请求,拉取接口数据</span></span><br><span class="line">  <span class="title function_">componentWillMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;组件加载前&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//挂载后使用定时器更新时间</span></span><br><span class="line">  <span class="title function_">componentDidMount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timer</span> = setIntervalo(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">        <span class="attr">date</span>: <span class="keyword">new</span> <span class="title class_">Date</span>(),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//结束时,卸载</span></span><br><span class="line">  <span class="title function_">componentWillUnmount</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//组件是否应该更新</span></span><br><span class="line">  <span class="title function_">shouldCompnentUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//为true时执行数据更新</span></span><br><span class="line">  <span class="title function_">componentWillUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据将要更新&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">componentDidUpdate</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;数据已经更新&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;this.state.date.toLocalTimeString()&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">DigitalClock</span>;</span><br></pre></td></tr></table></figure>

<h2 id="事件处理中-this-的绑定"><a href="#事件处理中-this-的绑定" class="headerlink" title="事件处理中 this 的绑定"></a>事件处理中 this 的绑定</h2><ol>
<li>箭头函数</li>
<li>class 中 bind 绑定</li>
<li>事件中使用箭头函数</li>
<li>事件中使用 bind 绑定</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Hello</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="comment">//初始化props</span></span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="comment">//初始化状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Tom&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">12</span>,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//或者在class内部通过bind绑定this</span></span><br><span class="line">    <span class="comment">//this.updateUser = this.updateUser.bind(this)</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//数据更新</span></span><br><span class="line">  updateUser = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//使用箭头函数将this指向当前实例</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;Jack&quot;</span>,</span><br><span class="line">      <span class="attr">age</span>: <span class="number">13</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//外部就可以拿到this</span></span><br><span class="line">  <span class="comment">//就可以使用普通函数定义</span></span><br><span class="line">  <span class="comment">/*updateUser()&#123;</span></span><br><span class="line"><span class="comment">        this.setState(&#123;</span></span><br><span class="line"><span class="comment">            name: &#x27;Jack&#x27;,</span></span><br><span class="line"><span class="comment">            age: 12</span></span><br><span class="line"><span class="comment">        &#125;)</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//渲染</span></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello,&#123;this.state.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>年龄: &#123;this.state.age&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.updateUser&#125;</span>&gt;</span>更新数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        //或者在此处改为</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.updateUser()&#125;&gt;更新数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.updateUser.bind(this)&#125;</span>&gt;</span>更新数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Hello</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="条件判断"><a href="#条件判断" class="headerlink" title="条件判断"></a>条件判断</h2><p>通常使用三元运算符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;isLogin ? <span class="tag">&lt;<span class="name">Login</span> /&gt;</span> : <span class="tag">&lt;<span class="name">Logout</span> /&gt;</span>&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="组件通信-组件传值"><a href="#组件通信-组件传值" class="headerlink" title="组件通信(组件传值)"></a>组件通信(组件传值)</h2><h3 id="子组件获取父组件的值-Props"><a href="#子组件获取父组件的值-Props" class="headerlink" title="子组件获取父组件的值 Props"></a>子组件获取父组件的值 Props</h3><p>通过 Props 可以快捷的拿到父组件的值.</p>
<ol>
<li>在子组件上添加属性名和数据</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;classDemo name=<span class="string">&quot;Tom&quot;</span>&gt;&lt;/classDemo&gt;&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在 class 中使用 Props</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">    <span class="variable language_">super</span>(props)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">        <span class="attr">defaultText</span>: <span class="string">&quot;默认文字&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过<code>this.props.父组件绑定的属性名</code></li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;<span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">name</span>&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="子组件传递父组件"><a href="#子组件传递父组件" class="headerlink" title="子组件传递父组件"></a>子组件传递父组件</h3><p>通过 props 传递一个函数,当子组件需要改变父组件的值时,通过<code>this.props.[自定义函数]</code>执行回调.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">App</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">childText</span>: <span class="string">&quot;123&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onPropChange = <span class="function">(<span class="params">val</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">childText</span>: val,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;this.state.childText&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ClassDemo</span> <span class="attr">onChange</span>=<span class="string">&#123;this.onPropChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">ClassDemo</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ClassDemo</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">props</span>)&#123;</span><br><span class="line">        <span class="variable language_">super</span>(props)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">            <span class="attr">defaultText</span>: <span class="string">&#x27;默认文字&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    changeText = <span class="function">()=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">props</span>.<span class="title function_">onChange</span>(<span class="string">&#x27;321&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;</span> <span class="attr">this.changeText</span> &#125;&gt;</span>修改文本<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="列表渲染-循环"><a href="#列表渲染-循环" class="headerlink" title="列表渲染(循环)"></a>列表渲染(循环)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">List</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">list</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">list</span>;</span><br><span class="line">    <span class="keyword">const</span> listItem = [];</span><br><span class="line">    <span class="comment">//使用map方法遍历</span></span><br><span class="line">    <span class="comment">//将初始值加上li标签填入新的list中</span></span><br><span class="line">    arr.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      listItem.<span class="title function_">push</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//使用return渲染出新的listItem</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItem&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">List</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<h2 id="Forms-表单应用"><a href="#Forms-表单应用" class="headerlink" title="Forms 表单应用"></a>Forms 表单应用</h2><p>数据发生变化后需要使用 this.setSate 进行更改数据,否则不会生效</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Forms</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">list</span>: [],</span><br><span class="line">      <span class="attr">val</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  handleChange = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 错误写法 val = event.target.value</span></span><br><span class="line">    <span class="comment">//数据发生变化后需要使用this.setSate进行更改数据</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">val</span>: event.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  handleAdd = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//从state中获取val和list</span></span><br><span class="line">    <span class="keyword">const</span> &#123; val, list &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="comment">//将输入的新值添加到list中</span></span><br><span class="line">    list.<span class="title function_">push</span>(val);</span><br><span class="line">    <span class="comment">//重新赋值state</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      list,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> arr = <span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">list</span>;</span><br><span class="line">    <span class="keyword">const</span> listItem = [];</span><br><span class="line">    arr.<span class="title function_">map</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      listItem.<span class="title function_">push</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;this.state.val&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;this.handleChange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleAdd&#125;</span>&gt;</span>点击添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span>&#123;listItem&#125;<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">ReactDOM</span>.<span class="title function_">render</span>(<span class="language-xml"><span class="tag">&lt;<span class="name">Form</span> /&gt;</span></span>, <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;app&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="受控组件和非受控组件"><a href="#受控组件和非受控组件" class="headerlink" title="受控组件和非受控组件"></a>受控组件和非受控组件</h3><p>受控组件: React 控制输入的表单元素</p>
<p>实例: 留言框</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CommentBox.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommentBox</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = &#123;</span><br><span class="line">      <span class="attr">value</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//如果不使用bind绑定,可以在函数声明时使用箭头函数方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleChange</span> = <span class="variable language_">this</span>.<span class="property">handleChange</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleSubmit</span> = <span class="variable language_">this</span>.<span class="property">handleSubmit</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">handleChange</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setState</span>(&#123;</span><br><span class="line">      <span class="attr">value</span>: event.<span class="property">target</span>.<span class="property">value</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">handleSubmit</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">state</span>.<span class="property">value</span>);</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;this.handleSubmit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>留言内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">onChange</span>=<span class="string">&#123;this.handlechange&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">value</span>=<span class="string">&#123;this.state.value&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>留言<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CommonBox</span>;</span><br></pre></td></tr></table></figure>

<p>非受控组件写法</p>
<p>将真实数据保存在 DOM 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CommentBox.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CommentBox</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">props</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(props);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">handleSubmit</span> = <span class="variable language_">this</span>.<span class="property">handleSubmit</span>.<span class="title function_">bind</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">handleSubmit</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="variable language_">this</span>.<span class="property">textInput</span>.<span class="property">value</span>);</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">onSubmit</span>=<span class="string">&#123;this.handleSubmit&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">label</span>&gt;</span>留言内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">input</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">type</span>=<span class="string">&quot;text&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">ref</span>=<span class="string">&#123;(textInput)</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-xml">              this.textInput = textInput;</span></span><br><span class="line"><span class="language-xml">            &#125;&#125;</span></span><br><span class="line"><span class="language-xml">          /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>留言<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">CommonBox</span>;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zax Tseng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
