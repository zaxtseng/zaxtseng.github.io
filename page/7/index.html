<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.13.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="ZAX">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="ZAX">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zax Tseng">
<meta property="article:tag" content="javascript, React, Vue, HTML5">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ZAX</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ZAX</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Zax Tseng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">114</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/26/jQuery/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/26/jQuery/" class="post-title-link" itemprop="url">jQuery</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-26 21:04:01" itemprop="dateCreated datePublished" datetime="2022-09-26T21:04:01+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <hr>
<p>title: jQuery</p>
<p>date: 2019-08-22 13:14:59</p>
<p>tags: javascript</p>
<p>categories:  # 这里写的分类会自动汇集到 categories 页面上，分类可以多级</p>
<ul>
<li>JS # 一级分类</li>
<li>jQuery # 二级分类</li>
</ul>
<hr>
<h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><table>
<thead>
<tr>
<th align="left">jQuery 基本选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘*‘)</td>
<td align="left">匹配所有元素</td>
</tr>
<tr>
<td align="left">$(‘#id’)</td>
<td align="left">id 选择器</td>
</tr>
<tr>
<td align="left">$(‘.class’)</td>
<td align="left">类选择器</td>
</tr>
<tr>
<td align="left">$(‘element’)</td>
<td align="left">标签选择器</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">组合选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E,F’)</td>
<td align="left">多元素选择器，同时匹配 E 和 F</td>
</tr>
<tr>
<td align="left">$(‘E F’)</td>
<td align="left">后代选择器,用空格分隔,匹配 E 元素所有后代</td>
</tr>
<tr>
<td align="left">$(‘E&gt;F’)</td>
<td align="left">子元素选择器,匹配 E 元素所有直接子元素</td>
</tr>
<tr>
<td align="left">$(‘E+F’)</td>
<td align="left">直接相邻元素,匹配 E 元素之后的相邻的同级元素 F</td>
</tr>
<tr>
<td align="left">$(‘E~F’)</td>
<td align="left">普通相邻元素(弟弟选择器),匹配 E 元素之后的同级元素 F(无论是否直接相邻)</td>
</tr>
<tr>
<td align="left">$(‘class1.class2’)</td>
<td align="left">匹配类名中既含有 class1 又含有 class2 的元素</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">基本过滤选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E:first’)</td>
<td align="left">所有 E 中的第一个</td>
</tr>
<tr>
<td align="left">$(‘E:last’)</td>
<td align="left">所有 E 中的最后一个</td>
</tr>
<tr>
<td align="left">$(‘E:not(selector)’)</td>
<td align="left">按照 selector 过滤 E</td>
</tr>
<tr>
<td align="left">$(‘E:even’)</td>
<td align="left">所有 E 中 index 是偶数</td>
</tr>
<tr>
<td align="left">$(‘E:odd’)</td>
<td align="left">所有 E 中 index 是奇数</td>
</tr>
<tr>
<td align="left">$(‘E:eq(n)’)</td>
<td align="left">所有 E 中 index 为 n 的元素</td>
</tr>
<tr>
<td align="left">$(‘E:gt(n)’)</td>
<td align="left">所有 E 中 index 大于 n 的元素</td>
</tr>
<tr>
<td align="left">$(‘E:lt(n)’)</td>
<td align="left">所有 E 中 index 小于 n 的元素</td>
</tr>
<tr>
<td align="left">$(‘header’)</td>
<td align="left">选择 h1~h6 元素</td>
</tr>
<tr>
<td align="left">$(‘div:animated’)</td>
<td align="left">选择正在执行动画效果的元素</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">内容过滤器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E:contains(value)’)</td>
<td align="left">内容包含 value 的元素</td>
</tr>
<tr>
<td align="left">$(‘E:empty’)</td>
<td align="left">内容为空的元素</td>
</tr>
<tr>
<td align="left">$(‘E:has(F)’)</td>
<td align="left">子元素中有 F 的元素,$(‘div:has(a)’):包含 a 标签的 div</td>
</tr>
<tr>
<td align="left">$(‘E:parent’)</td>
<td align="left">父元素是 E 的元素</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">可视化选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E:hidden’)</td>
<td align="left">所有被隐藏的 E</td>
</tr>
<tr>
<td align="left">$(‘E:visible’)</td>
<td align="left">所有可见的 E</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">属性过滤选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E[attr]’)</td>
<td align="left">含有属性 attr 的 E</td>
</tr>
<tr>
<td align="left">$(‘E[attr&#x3D;value]’)</td>
<td align="left">属性 attr&#x3D;value 的 E</td>
</tr>
<tr>
<td align="left">$(‘E[attr !&#x3D;value]’)</td>
<td align="left">属性 attr！&#x3D;value 的 E</td>
</tr>
<tr>
<td align="left">$(‘E[attr ^&#x3D;value]’)</td>
<td align="left">属性 attr 以 value 开头的 E</td>
</tr>
<tr>
<td align="left">$(‘E[attr $&#x3D;value]’)</td>
<td align="left">属性 attr 以 value 结尾的 E</td>
</tr>
<tr>
<td align="left">$(‘E[attr *&#x3D;value]’)</td>
<td align="left">属性 attr 包含 value 的 E</td>
</tr>
<tr>
<td align="left">$(‘E[attr][attr*value]’)</td>
<td align="left">可以连用</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">子元素过滤器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E:nth-child(n)’)</td>
<td align="left">E 的第 n 个子节点</td>
</tr>
<tr>
<td align="left">$(‘E:nth-child(3n+1)’)</td>
<td align="left">E 的第 3n+1 个子节点</td>
</tr>
<tr>
<td align="left">$(‘E:nth-child(even)’)</td>
<td align="left">E 的 index 为偶数的子节点</td>
</tr>
<tr>
<td align="left">$(‘E:nth-child(odd)’)</td>
<td align="left">E 的 index 为奇数的子节点</td>
</tr>
<tr>
<td align="left">$(‘E:first-child’)</td>
<td align="left">所有 E 的第一个子节点</td>
</tr>
<tr>
<td align="left">$(‘E:last-child’)</td>
<td align="left">所有 E 的最后一个子节点</td>
</tr>
<tr>
<td align="left">$(‘E:only-child’)</td>
<td align="left">只有唯一子节点的 E 的子节点</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">表单元素选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$(‘E:type’)</td>
<td align="left">特定类型的 input</td>
</tr>
<tr>
<td align="left">$(‘:checked’)</td>
<td align="left">被选中的 checkbox 或者 radio</td>
</tr>
<tr>
<td align="left">$(‘option:selected’)</td>
<td align="left">被选中的 option</td>
</tr>
</tbody></table>
<h3 id="其他查找相关元素的方法"><a href="#其他查找相关元素的方法" class="headerlink" title="其他查找相关元素的方法"></a>其他查找相关元素的方法</h3><h4 id="eq-index-get-index"><a href="#eq-index-get-index" class="headerlink" title=".eq(index), .get([index])"></a>.eq(index), .get([index])</h4><p><code>$(&#39;div&#39;).eq(3) //获取所有div中第4个jQuery对象</code></p>
<p><code>$(&#39;div&#39;)[2] 或者 $(&#39;div&#39;).get(2) //获取第三个的DOM对象</code></p>
<p><code>get()</code>不写参数把所有对象转为 DOM 对象返回</p>
<h4 id="兄弟元素获取"><a href="#兄弟元素获取" class="headerlink" title="兄弟元素获取"></a>兄弟元素获取</h4><table>
<thead>
<tr>
<th align="left">选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.next([selector])</td>
<td align="left">没有写 selcetor,返回所有后面的兄弟元素.写了就返回满足条件的</td>
</tr>
<tr>
<td align="left">.prev([selector])</td>
<td align="left">和上面相反,获取前面的兄弟元素</td>
</tr>
<tr>
<td align="left">.nextAll([selector])</td>
<td align="left">获取所有后面的兄弟元素</td>
</tr>
<tr>
<td align="left">.prevAll([selector])</td>
<td align="left">获取所有前面的兄弟元素</td>
</tr>
<tr>
<td align="left">.siblings([selector])</td>
<td align="left">获取所有前后邻居的元素</td>
</tr>
</tbody></table>
<h4 id="父子元素获取"><a href="#父子元素获取" class="headerlink" title="父子元素获取"></a>父子元素获取</h4><table>
<thead>
<tr>
<th align="left">选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.parent([selector])</td>
<td align="left">获取父元素,可选筛选器</td>
</tr>
<tr>
<td align="left">.parents([selector])</td>
<td align="left">获取祖先元素,可选筛选器</td>
</tr>
<tr>
<td align="left">.children([selector])</td>
<td align="left">获取子元素,可选筛选器</td>
</tr>
<tr>
<td align="left">.find([selector])</td>
<td align="left">查找符合选择器的后代</td>
</tr>
</tbody></table>
<h4 id="筛选当前结果集"><a href="#筛选当前结果集" class="headerlink" title="筛选当前结果集"></a>筛选当前结果集</h4><table>
<thead>
<tr>
<th align="left">选择器</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.first()</td>
<td align="left">获取当前结果集第一个对象</td>
</tr>
<tr>
<td align="left">.last()</td>
<td align="left">获取当前结果集最后一个对象</td>
</tr>
<tr>
<td align="left">.filter(slector), .filter(function(index))</td>
<td align="left">筛选当前结果集符合条件的对象</td>
</tr>
<tr>
<td align="left">.not(selector), .not(function(index))</td>
<td align="left">从当前结果集中移除指定元素</td>
</tr>
<tr>
<td align="left">.is(selector), is(function(index)), is(dom&#x2F;jqObj)</td>
<td align="left">判断结果集中的元素，是否为一个选择器，DOM 元素，或者 jQuery 对象，如果这些元素至少一个匹配给定的参数，那么返回 true</td>
</tr>
<tr>
<td align="left">.has(seletor), has(dom)</td>
<td align="left">筛选匹配结果集中符合条件的后代元素</td>
</tr>
</tbody></table>
<h2 id="jQueryDOM-操作"><a href="#jQueryDOM-操作" class="headerlink" title="jQueryDOM 操作"></a>jQueryDOM 操作</h2><h3 id="创建元素"><a href="#创建元素" class="headerlink" title="创建元素"></a>创建元素</h3><p>将 DOM 传入$方法即可返回一个 jQuery 对象</p>
<p><code>var obj = $(&#39;&lt;div class=&quot;test&quot;&gt;&lt;p&gt;&lt;span&gt;Done&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&#39;)</code></p>
<h3 id="添加元素"><a href="#添加元素" class="headerlink" title="添加元素"></a>添加元素</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">解释</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.append(content[,content]) &#x2F; .append(function(index,html))</td>
<td align="left">可以添加多个内容,DOM 对象,字符串,jQuery 对象</td>
<td align="left"><img src="https://g.yuque.com/gr/latex?(%27p%27).append(#card=math&code=%28%27p%27%29.append%28)newdiv">; <img src="https://g.yuque.com/gr/latex?(%27p%27).append(#card=math&code=%28%27p%27%29.append%28)('strong')">; $(‘p’).append(document.createTextNode(‘hello’))</td>
</tr>
<tr>
<td align="left">.appendTo(target)</td>
<td align="left">把对象插入到目标 target 尾部,可以是 selector,DOM 对象,字符串,元素集合,jQuery 对象(最后一个孩子)</td>
<td align="left"><img src="https://g.yuque.com/gr/latex?(%27h2%27).appendTo(#card=math&code=%28%27h2%27%29.appendTo%28)('.container')">; $(‘<p>Test</p>‘).appendTo(‘.inner’)</td>
</tr>
<tr>
<td align="left">.prepend(content[,content]) &#x2F; .prepend(function(index, html))</td>
<td align="left">向头部追加内容,内容添加到最前面(第一个孩子)</td>
<td align="left">$(‘.inner’).prepend(‘<p>Test</p>‘)</td>
</tr>
<tr>
<td align="left">.prependTo(Target)</td>
<td align="left">把对象插入到目标头部</td>
<td align="left">$(‘<p>Test</p>‘).prependTo(‘.inner’)</td>
</tr>
<tr>
<td align="left">.before([content][,content]) &#x2F; .before(function)</td>
<td align="left">在对象前面(不是头部,而是外面,和对象并列同级)插入内容(放到前面做邻居)</td>
<td align="left">$(‘.inner’).before(‘<p>Test</p>‘); <img src="https://g.yuque.com/gr/latex?(%27.container%27).before(#card=math&code=%28%27.container%27%29.before%28)('h2')">; $( “p” ).before( document.createTextNode( “Hello” ) )</td>
</tr>
<tr>
<td align="left">.insertBefore(target)</td>
<td align="left">把对象插入到 target 之前(不是头部,是同级)(做邻居)</td>
<td align="left"><img src="https://g.yuque.com/gr/latex?(%27h2%27).insertBefore(#card=math&code=%28%27h2%27%29.insertBefore%28)('.container)"></td>
</tr>
<tr>
<td align="left">.after([content][,content]) &#x2F; .after(function（index）)</td>
<td align="left">和 before 相反，在对象后面(不是尾部，而是外面，和对象并列同级)插入内容，参数和 append 类似</td>
<td align="left">$( “.inner” ).after( “<p>Test</p>“ ); $( “p” ).after( document.createTextNode( “Hello” ) );</td>
</tr>
<tr>
<td align="left">.insertAfter(target)</td>
<td align="left">和 insertBefore 相反，把对象插入到 target 之后（同样不是尾部，是同级）</td>
<td align="left">$( “<p>Test</p>“ ).insertAfter( “.inner” ); $( “p” ).insertAfter( “#foo” );</td>
</tr>
</tbody></table>
<h3 id="删除元素"><a href="#删除元素" class="headerlink" title="删除元素"></a>删除元素</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">解释</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.remove([selector])</td>
<td align="left">删除被选元素及其子元素</td>
<td align="left">$(‘.div’).remove()</td>
</tr>
<tr>
<td align="left">.empty()</td>
<td align="left">清空被选元素内所有子元素</td>
<td align="left">$(‘body’).empty()</td>
</tr>
<tr>
<td align="left">.detach()</td>
<td align="left">.detach() 方法和.remove()一样, 除了 .detach()保存所有 jQuery 数据和被移走的元素相关联。当需要移走一个元素，不久又将该元素插入 DOM 时，这种方法很有用。</td>
<td align="left">$(‘.div’).detach()</td>
</tr>
</tbody></table>
<h3 id="包裹元素"><a href="#包裹元素" class="headerlink" title="包裹元素"></a>包裹元素</h3><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">解释</th>
<th align="left">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">.wrap(wrapElement) &#x2F; .wrap(function(index))</td>
<td align="left">为每个对象包裹一层 HTML 结构，可以是 selector, element, HTML string, jQuery object</td>
<td align="left">$( “.inner” ).wrap( “<div class='new'></div>“ )</td>
</tr>
<tr>
<td align="left">.wrapAll(wrappingElement)</td>
<td align="left">把所有匹配对象包裹在同一个 html 结构里</td>
<td align="left">$(‘.inner’).wrapAll(‘<div class="new"></div>)</td>
</tr>
<tr>
<td align="left">.wrapInner(wrapingElement)</td>
<td align="left">为每个匹配的对象包裹一层 HTML 结构</td>
<td align="left">$(‘.inner’).wrapInner(‘<div class="new"></div>)</td>
</tr>
<tr>
<td align="left">.unwrap</td>
<td align="left">把 DOM 元素外的壳去掉</td>
<td align="left">$(‘p’).unwrap()</td>
</tr>
</tbody></table>
<h3 id="html-string"><a href="#html-string" class="headerlink" title="html([string])"></a>html([string])</h3><p><code>$(&#39;div&#39;).html()</code></p>
<p><code>$(&#39;div&#39;).html(&#39;123&#39;)</code></p>
<p>这是一个读写两用的方法,用于获取修改元素的 innerHTML</p>
<ol>
<li>没有传递参数的时候,返回元素的 innerHTML</li>
<li>当传递一个 string 参数时,修改元素的 innerHTML 为参数值</li>
</ol>
<h3 id="text"><a href="#text" class="headerlink" title="text()"></a>text()</h3><p>和 html 方法类似，操作的是 DOM 的 innerText 值</p>
<h2 id="jQuery-属性操作"><a href="#jQuery-属性操作" class="headerlink" title="jQuery 属性操作"></a>jQuery 属性操作</h2><h3 id="属性相关"><a href="#属性相关" class="headerlink" title="属性相关"></a>属性相关</h3><h4 id="val-value"><a href="#val-value" class="headerlink" title=".val([value])"></a>.val([value])</h4><p>这是一个读写双用的方法,用来处理 input 的 value 值,当方法没有参数时返回 input 的 value 值.</p>
<p>当传递一个参数时,方法修改 input 的 value 值为参数值.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.input&quot;</span>).<span class="title function_">val</span>();</span><br><span class="line">$(<span class="string">&quot;.input&quot;</span>).<span class="title function_">val</span>(<span class="string">&quot;newValue&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="attr"><a href="#attr" class="headerlink" title=".attr()"></a>.attr()</h4><h5 id="attr-attributeName"><a href="#attr-attributeName" class="headerlink" title=".attr(attributeName)"></a>.attr(attributeName)</h5><p>获取元素特定属性的值</p>
<p><code>var title = $(&#39;em&#39;).attr(&#39;title&#39;)</code></p>
<h5 id="attr-attributeName-value-x2F-attr-attributesJson-x2F-attr-attributeName-funtion-index-attr"><a href="#attr-attributeName-value-x2F-attr-attributesJson-x2F-attr-attributeName-funtion-index-attr" class="headerlink" title=".attr(attributeName,value)&#x2F;.attr(attributesJson)&#x2F;.attr(attributeName,funtion(index,attr))"></a>.attr(attributeName,value)&#x2F;.attr(attributesJson)&#x2F;.attr(attributeName,funtion(index,attr))</h5><p>为元素属性赋值</p>
<p><code>$( &quot;#greatphoto&quot; ).attr( &quot;alt&quot;, &quot;Beijing&quot; )</code></p>
<h5 id="removeAttr"><a href="#removeAttr" class="headerlink" title=".removeAttr()"></a>.removeAttr()</h5><p>为匹配的元素集合中的每个元素移除一个属性</p>
<p><code>$(&#39;div&#39;).removeAttr(&#39;id&#39;)</code></p>
<h5 id="prop-x2F-removeProp"><a href="#prop-x2F-removeProp" class="headerlink" title=".prop()&#x2F;.removeProp()"></a>.prop()&#x2F;.removeProp()</h5><p>这两个方法是用来操作元素的 property 的</p>
<h3 id="CSS-相关"><a href="#CSS-相关" class="headerlink" title="CSS 相关"></a>CSS 相关</h3><h4 id="css"><a href="#css" class="headerlink" title=".css()"></a>.css()</h4><h5 id="css-propertyName-x2F-css-propertyNames"><a href="#css-propertyName-x2F-css-propertyNames" class="headerlink" title=".css(propertyName) &#x2F; .css(propertyNames)"></a>.css(propertyName) &#x2F; .css(propertyNames)</h5><p>获取元素 style 特定 property 的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> color = $(<span class="variable language_">this</span>).<span class="title function_">css</span>(<span class="string">&quot;background-color&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> styleProps = $(<span class="variable language_">this</span>).<span class="title function_">css</span>([<span class="string">&quot;width&quot;</span>, <span class="string">&quot;height&quot;</span>, <span class="string">&quot;color&quot;</span>, <span class="string">&quot;background-color&quot;</span>]);</span><br></pre></td></tr></table></figure>

<h5 id="css-propertyName-value-x2F-css-propertyName-function-index-value-x2F-css-propertiesJson"><a href="#css-propertyName-value-x2F-css-propertyName-function-index-value-x2F-css-propertiesJson" class="headerlink" title=".css(propertyName,value)&#x2F;.css(propertyName,function(index,value))&#x2F; .css(propertiesJson)"></a>.css(propertyName,value)&#x2F;.css(propertyName,function(index,value))&#x2F; .css(propertiesJson)</h5><p>设置元素 style 特定 property 的值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;div.example&quot;</span>).<span class="title function_">css</span>(<span class="string">&quot;width&quot;</span>, <span class="keyword">function</span> (<span class="params">index</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> index * <span class="number">50</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">this</span>).<span class="title function_">css</span>(<span class="string">&quot;width&quot;</span>, <span class="string">&quot;+=200&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">this</span>).<span class="title function_">css</span>(<span class="string">&quot;background-color&quot;</span>, <span class="string">&quot;yellow&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="variable language_">this</span>).<span class="title function_">css</span>(&#123;</span><br><span class="line">  <span class="string">&quot;background-color&quot;</span>: <span class="string">&quot;yellow&quot;</span>,</span><br><span class="line">  <span class="string">&quot;font-weight&quot;</span>: <span class="string">&quot;bolder&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="addClass-className-x2F-addClass-function-index-currentClass"><a href="#addClass-className-x2F-addClass-function-index-currentClass" class="headerlink" title=".addClass(className) &#x2F; .addClass(function(index,currentClass))"></a>.addClass(className) &#x2F; .addClass(function(index,currentClass))</h5><p>为元素添加 class，不是覆盖原 class，是追加，也不会检查重复</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;myClass yourClass&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;ul li&quot;</span>).<span class="title function_">addClass</span>(<span class="keyword">function</span> (<span class="params">index</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;item-&quot;</span> + index;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="removeClass-className-x2F-removeClass-function-index-class"><a href="#removeClass-className-x2F-removeClass-function-index-class" class="headerlink" title=".removeClass([className])&#x2F;.removeClass(function(index,class))"></a>.removeClass([className])&#x2F;.removeClass(function(index,class))</h5><p>移除元素单个&#x2F;多个&#x2F;所有 class</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;myClass yourClass&quot;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;li:last&quot;</span>).<span class="title function_">removeClass</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> $(<span class="variable language_">this</span>).<span class="title function_">prev</span>().<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="hasClass-className"><a href="#hasClass-className" class="headerlink" title=".hasClass(className)"></a>.hasClass(className)</h5><p>检查元素是否包含某个 class，返回 true&#x2F;false</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#mydiv&quot;</span>).<span class="title function_">hasClass</span>(<span class="string">&quot;foo&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="toggleClass-className"><a href="#toggleClass-className" class="headerlink" title=".toggleClass(className)"></a>.toggleClass(className)</h5><p>toggle 是切换的意思，方法用于切换，switch 是个 bool 类型值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;tumble&quot;</span>&gt;<span class="title class_">Some</span> text.&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第一次执行</span></span><br><span class="line">$( <span class="string">&quot;div.tumble&quot;</span> ).<span class="title function_">toggleClass</span>( <span class="string">&quot;bounce&quot;</span> )</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;tumble bounce&quot;</span>&gt;<span class="title class_">Some</span> text.&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二次执行</span></span><br><span class="line">$( <span class="string">&quot;div.tumble&quot;</span> ).<span class="title function_">toggleClass</span>( <span class="string">&quot;bounce&quot;</span> )</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;tumble&quot;</span>&gt;<span class="title class_">Some</span> text.&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="jQuery-常用方法"><a href="#jQuery-常用方法" class="headerlink" title="jQuery 常用方法"></a>jQuery 常用方法</h2><h4 id="each-fnction-index-Element"><a href="#each-fnction-index-Element" class="headerlink" title=".each(fnction(index, Element))"></a>.each(fnction(index, Element))</h4><p>遍历一个 jQuery 对象,为每个匹配元素执行一个函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;li&quot;</span>).<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">index</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(index + <span class="string">&quot;:&quot;</span> + $(<span class="variable language_">this</span>).<span class="title function_">text</span>());</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//回调函数返回的是DOM对象,所以this需要加$变成jQuery对象才能使用.text()方法</span></span><br><span class="line"><span class="comment">//否则使用this.innerText方法</span></span><br></pre></td></tr></table></figure>

<h4 id="jQuery-each-collection-callback-indexInArray-valueOfElement"><a href="#jQuery-each-collection-callback-indexInArray-valueOfElement" class="headerlink" title="jQuery.each(collection, callback(indexInArray, valueOfElement))"></a>jQuery.each(collection, callback(indexInArray, valueOfElement))</h4><p>一个通用迭代函数,可以迭代对象和数组.数组和类数组对象通过长度属性来迭代数字索引,从 0 到 length-1.</p>
<p>其他对象通过其属性名进行迭代.</p>
<p>上面 jQuery 可以用<img src="https://g.yuque.com/gr/latex?%E6%9B%BF%E4%BB%A3,%E5%8D%B3%60#card=math&code=%E6%9B%BF%E4%BB%A3%2C%E5%8D%B3%60">.each()&#96;.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    <span class="string">&quot;fla&quot;</span> : <span class="string">&quot;infla&quot;</span>,</span><br><span class="line">    <span class="string">&quot;duh&quot;</span> : <span class="string">&quot; no duh&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">$.<span class="title function_">each</span>(obj, <span class="keyword">function</span>(<span class="params">key, value</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(key + <span class="string">&quot;:&quot;</span> + value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="map-callback-index-domElement"><a href="#map-callback-index-domElement" class="headerlink" title=".map(callback(index, domElement))"></a>.map(callback(index, domElement))</h4><p>通过一个函数匹配当前集合中的每个元素,返回一个包含新的 jQuery 对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.div&quot;</span>).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params">i, ele</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="jQuery-extend-deep-target-ovject1-objectn"><a href="#jQuery-extend-deep-target-ovject1-objectn" class="headerlink" title="jQuery.extend([deep,]target[,ovject1][,objectn])"></a>jQuery.extend([deep,]target[,ovject1][,objectn])</h4><ol>
<li>当提供两个或多个对象给$.extend(),对象的所有属性都添加到目标对象(target 参数).</li>
<li>如果只有一个参数提供给$.extend(),这意味着目标参数被省略,在这种情况下,jQuery 对象本身默认为目标对象.</li>
</ol>
<p>这样我们可以在 jQuery 的命名空间下添加新功能.</p>
<p><code>var obj = $.extend(&#123;&#125;, object1, object2)</code></p>
<p><code>object1,object2</code>会被添加到{}中</p>
<p>如果第一个对象的属性本身是一个数组或对象,那它将完全用第二个对象相同的 key 重写一个属性.</p>
<p>这些值不会被合并.如果 true 作为第一个参数,那么会在对象上进行递归的合并.</p>
<h4 id="clone-withDataAndEvents"><a href="#clone-withDataAndEvents" class="headerlink" title=".clone([withDataAndEvents])"></a>.clone([withDataAndEvents])</h4><p>.clone()方法深度复制所有匹配的元素集合,包括所有匹配元素,匹配元素的下级,文字节点.</p>
<p><code>$(&#39;.hello&#39;).clone().appendTo(&#39;.Goodbye&#39;)</code></p>
<h4 id="index-x2F-index-selector-x2F-index-element"><a href="#index-x2F-index-selector-x2F-index-element" class="headerlink" title=".index()&#x2F;.index(selector)&#x2F;.index(element)"></a>.index()&#x2F;.index(selector)&#x2F;.index(element)</h4><p>从给定集合中查找特定元素 index</p>
<ol>
<li>没参数返回第一个元素 index</li>
<li>如果参数是 DOM 对象或 jQuery 对象,则返回参数在集合中的 index</li>
<li>如果参数是选择器,返回第一个匹配元素的 index,没有找到返回-1</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> listItem = $(<span class="string">&quot;.bar&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Index:&quot;</span> + $(<span class="string">&quot;li&quot;</span>).<span class="title function_">index</span>(listItem));</span><br></pre></td></tr></table></figure>

<h4 id="ready-handler"><a href="#ready-handler" class="headerlink" title=".ready(handler)"></a>.ready(handler)</h4><p>当 DOM 加载完毕,执行.</p>
<p>下面两种等价</p>
<ul>
<li><code>$(document).ready(handler)</code></li>
<li><code>$(handler)</code></li>
</ul>
<h2 id="jQuery-事件"><a href="#jQuery-事件" class="headerlink" title="jQuery 事件"></a>jQuery 事件</h2><h4 id="on-events-selector-data-handler-eventObject"><a href="#on-events-selector-data-handler-eventObject" class="headerlink" title=".on(events[,selector][,data],handler(eventObject))"></a>.on(events[,selector][,data],handler(eventObject))</h4><ol>
<li>events: 一个或多个空格分隔的事件类型和可选空间</li>
<li>selector: 一个选择器字符串,用于过滤被选中的元素中能触发事件的后代元素.</li>
</ol>
<p>如果选择器是 null 或者忽略,那么被选中的元素总能触发事件 3. data: 当一个事件被触发,要传递给事件处理函数的 event.data 4. handler(eventObject): 事件被触发时,执行的函数.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;box&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>2<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>3<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>4<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;ipt&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="string">&#x27;.box li&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> str = $(<span class="variable language_">this</span>).<span class="title function_">text</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  $(<span class="string">&#x27;#wrap&#x27;</span>).<span class="title function_">text</span>(str)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//等同于</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="string">&#x27;.box&gt;ul&gt;li&#x27;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> str = $(<span class="variable language_">this</span>).<span class="title function_">text</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  $(<span class="string">&#x27;#wrap&#x27;</span>).<span class="title function_">text</span>(str)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//下面新增的元素是没有绑定事件的</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="string">&#x27;btn&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> value = $(<span class="string">&#x27;#ipt&#x27;</span>).<span class="title function_">val</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  $(<span class="string">&#x27;.box&gt;li&#x27;</span>).<span class="title function_">append</span>(<span class="string">&#x27;&lt;li&gt;&#x27;</span> + value + <span class="string">&#x27;&lt;/li&gt;&#x27;</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//可以用事件代理</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">$(<span class="string">&#x27;.box ul&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>,<span class="string">&#x27;li&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">var</span> str = $(<span class="variable language_">this</span>).<span class="title function_">text</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  $(<span class="string">&#x27;#wrap&#x27;</span>).<span class="title function_">text</span>(<span class="title class_">Str</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">//上面代码换成原生js代码</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;.box ul&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params">e</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span>(e.<span class="property">target</span>.<span class="property">tagName</span>.<span class="title function_">toLowerCase</span>() === <span class="string">&#x27;li&#x27;</span>)&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//do something</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="one-events-selector-data-handler-eventObject"><a href="#one-events-selector-data-handler-eventObject" class="headerlink" title=".one(events[,selector][,data],handler(eventObject))"></a>.one(events[,selector][,data],handler(eventObject))</h4><p>同 on，绑定事件，但只执行一次</p>
<h4 id="off-events-selector-handler"><a href="#off-events-selector-handler" class="headerlink" title=".off(events[,selector][,handler])"></a>.off(events[,selector][,handler])</h4><p>移除一个事件处理函数</p>
<p><code>$(&#39;.box li&#39;).off(&#39;click&#39;)</code></p>
<h4 id="trigger-eventType-extraParameters"><a href="#trigger-eventType-extraParameters" class="headerlink" title=".trigger(eventType[,extraParameters])"></a>.trigger(eventType[,extraParameters])</h4><p>根据绑定到匹配元素的给定的事件类型执行所有的处理程序和行为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#foo&quot;</span>).<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>($(<span class="variable language_">this</span>).<span class="title function_">text</span>());</span><br><span class="line">&#125;);</span><br><span class="line">$(<span class="string">&quot;#foo&quot;</span>).<span class="title function_">trigger</span>(<span class="string">&quot;click&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h4><p>blur([[data],fn])</p>
<p>change([[data],fn])</p>
<p>click([[data],fn])</p>
<p>dblclick([[data],fn])</p>
<p>error([[data],fn])</p>
<p>focus([[data],fn])</p>
<p>focusin([data],fn)</p>
<p>focusout([data],fn)</p>
<p>keydown([[data],fn])</p>
<p>keypress([[data],fn])</p>
<p>keyup([[data],fn])</p>
<p>mousedown([[data],fn])</p>
<p>mouseenter([[data],fn])</p>
<p>mouseleave([[data],fn])</p>
<p>mousemove([[data],fn])</p>
<p>mouseout([[data],fn])</p>
<p>mouseover([[data],fn])</p>
<p>mouseup([[data],fn])</p>
<p>resize([[data],fn])</p>
<p>scroll([[data],fn])</p>
<p>select([[data],fn])</p>
<p>submit([[data],fn])</p>
<h4 id="事件对象"><a href="#事件对象" class="headerlink" title="事件对象"></a>事件对象</h4><p>eve.currentTarget</p>
<p>eve.data</p>
<p>eve.delegateTarget</p>
<p>eve.isDefaultPrevented()</p>
<p>eve.isImmediatePropag…()</p>
<p>eve.isPropagationStopped()</p>
<p>eve.namespace</p>
<p>eve.pageX</p>
<p>eve.pageY</p>
<p>eve.preventDefault()</p>
<p>eve.relatedTarget</p>
<p>eve.result</p>
<p>eve.stopImmediatePro…()</p>
<p>eve.stopPropagation()</p>
<p>eve.target</p>
<p>eve.timeStamp</p>
<p>eve.type</p>
<p>eve.which</p>
<h2 id="jQuery-动画"><a href="#jQuery-动画" class="headerlink" title="jQuery 动画"></a>jQuery 动画</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><h4 id="hide-duration-easting-fn"><a href="#hide-duration-easting-fn" class="headerlink" title=".hide([duration][,easting][,fn])"></a>.hide([duration][,easting][,fn])</h4><ul>
<li>duration: 三种预定速度之一的字符串(“slow”,”normal”, or “fast”)或表示动画时长的毫秒数值(如：1000)</li>
<li>easing: 用来指定切换效果，默认是”swing”，可用参数”linear”</li>
<li>fn: 在动画完成时执行的函数，每个元素执行一次。</li>
</ul>
<p>用于隐藏元素,没有参数等同于直接设置 display 属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.target&quot;</span>).<span class="title function_">hide</span>();</span><br><span class="line"><span class="comment">//等同于$(&#x27;.target&#x27;).css(&#x27;display&#x27;,&#x27;none&#x27;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#book&quot;</span>).<span class="title function_">hide</span>(<span class="number">300</span>, <span class="string">&quot;linear&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Animation complete.&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="show-duration-easing-fn"><a href="#show-duration-easing-fn" class="headerlink" title=".show([duration][,easing][,fn])"></a>.show([duration][,easing][,fn])</h4><p>显示元素,用法类似 hide</p>
<h4 id="toggle-duration-easing-fn"><a href="#toggle-duration-easing-fn" class="headerlink" title=".toggle([duration][,easing][,fn])"></a>.toggle([duration][,easing][,fn])</h4><p>事件处理套件也有一个名为.toggle()方法。哪一个被调用取决于传递的参数的设置</p>
<p>用来切换元素的隐藏、显示，类似于 toggleClass，用法和 show、hide 类似</p>
<h3 id="渐变"><a href="#渐变" class="headerlink" title="渐变"></a>渐变</h3><h4 id="fadeIn-duration-easing-complete"><a href="#fadeIn-duration-easing-complete" class="headerlink" title=".fadeIn( [duration ] [, easing ] [, complete ] )"></a>.fadeIn( [duration ] [, easing ] [, complete ] )</h4><p>渐入效果</p>
<h4 id="fadeOut-duration-easing-complete"><a href="#fadeOut-duration-easing-complete" class="headerlink" title=".fadeOut( [duration ] [, easing ] [, complete ] )"></a>.fadeOut( [duration ] [, easing ] [, complete ] )</h4><p>渐出效果</p>
<h4 id="fadeTo-duration-opacity-easing-complete"><a href="#fadeTo-duration-opacity-easing-complete" class="headerlink" title=".fadeTo( duration, opacity [, easing ] [, complete ] )"></a>.fadeTo( duration, opacity [, easing ] [, complete ] )</h4><p>调整匹配元素的透明度，方法通过匹配元素的不透明度做动画效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;#book&quot;</span>).<span class="title function_">fadeTo</span>(<span class="string">&quot;slow&quot;</span>, <span class="number">0.5</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// Animation complete.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="fadeToggle-speed-easing-fn"><a href="#fadeToggle-speed-easing-fn" class="headerlink" title="fadeToggle([speed,[easing],[fn]])"></a>fadeToggle([speed,[easing],[fn]])</h4><p>通过不透明度的变化来开关所有匹配元素的淡入和淡出效果，并在动画完成后可选地触发一个回调函数。</p>
<p>这个动画只调整元素的不透明度，也就是说所有匹配的元素的高度和宽度不会发生变化。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;p&quot;</span>).<span class="title function_">fadeToggle</span>(<span class="string">&quot;fast&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;Animation Done.&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//用200毫秒快速将段落淡入，之后弹出一个对话框</span></span><br></pre></td></tr></table></figure>

<h4 id="slideDown-speed-easing-fn"><a href="#slideDown-speed-easing-fn" class="headerlink" title="slideDown([speed],[easing],[fn])"></a>slideDown([speed],[easing],[fn])</h4><p>下拉动画.这个动画效果只调整元素的高度，可以使匹配的元素以“滑动”的方式显示出来。</p>
<h4 id="slideUp-speed-easing-fn"><a href="#slideUp-speed-easing-fn" class="headerlink" title="slideUp([speed,[easing],[fn]])"></a>slideUp([speed,[easing],[fn]])</h4><p>上浮动画,向上隐藏,在隐藏完成后可选地触发一个回调函数。</p>
<h4 id="slideToggle-speed-easing-fn"><a href="#slideToggle-speed-easing-fn" class="headerlink" title="slideToggle([speed],[easing],[fn])"></a>slideToggle([speed],[easing],[fn])</h4><p>上下切换</p>
<h3 id="动画队列"><a href="#动画队列" class="headerlink" title="动画队列"></a>动画队列</h3><p>因为动画是异步,所以将动画执行函数放入回调函数中,等动画执行完毕再执行其他的.</p>
<p>但是这样写会形成回调地狱.又因为存在动画队列,可以按代码二方法执行会有同样效果.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$box.<span class="title function_">hide</span>(<span class="number">1000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  $box.<span class="title function_">show</span>(<span class="number">1000</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    $box.<span class="title function_">fadeOut</span>(<span class="string">&quot;slow&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      $box.<span class="title function_">fadeIn</span>(<span class="string">&quot;slow&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        $box.<span class="title function_">slideUp</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">          $box.<span class="title function_">slideDown</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;动画执行完毕&quot;</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//等价于</span></span><br><span class="line">$box</span><br><span class="line">  .<span class="title function_">hide</span>(<span class="number">1000</span>)</span><br><span class="line">  .<span class="title function_">show</span>(<span class="number">1000</span>)</span><br><span class="line">  .<span class="title function_">fadeOut</span>()</span><br><span class="line">  .<span class="title function_">fadeIn</span>()</span><br><span class="line">  .<span class="title function_">slideUp</span>()</span><br><span class="line">  .<span class="title function_">slideDown</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;真的完毕了&quot;</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="自定义动画"><a href="#自定义动画" class="headerlink" title="自定义动画"></a>自定义动画</h3><p><code>animate(params,[speed],[easing],[fn])</code></p>
<p>这个函数的关键在于指定动画形式及结果样式属性对象。</p>
<p>这个对象中每个属性都表示一个可以变化的样式属性（如“height”、“top”或“opacity”）。</p>
<p>注意：所有指定的属性必须用驼峰形式，比如用 marginLeft 代替 margin-left.</p>
<ul>
<li>params:一组包含作为动画属性和终值的样式属性和及其值的集合</li>
<li>speed:三种预定速度之一的字符串(“slow”,”normal”, or “fast”)或表示动画时长的毫秒数值(如：1000)</li>
<li>easing:要使用的擦除效果的名称(需要插件支持).默认 jQuery 提供”linear” 和 “swing”.</li>
<li>fn:在动画完成时执行的函数，每个元素执行一次。</li>
</ul>
<h4 id="finish"><a href="#finish" class="headerlink" title=".finish"></a>.finish</h4><p>停止当前动画，并清除动画队列中所有未完成的动画,最终展示动画队列最后一帧的最终状态</p>
<h4 id="stop-clearQueue-jumpToEnd"><a href="#stop-clearQueue-jumpToEnd" class="headerlink" title=".stop( [clearQueue] [,jumpToEnd])"></a>.stop( [clearQueue] [,jumpToEnd])</h4><p>停止当前正在运行的动画</p>
<h1 id="AJAX"><a href="#AJAX" class="headerlink" title="AJAX"></a>AJAX</h1><h3 id="jQuery-ajax-url-settings"><a href="#jQuery-ajax-url-settings" class="headerlink" title="jQuery.ajax(url,[settings])"></a>jQuery.ajax(url,[settings])</h3><p>jQuery 底层 AJAX 实现.<code>$.ajax()</code>返回其创建的 XMLHttpRequest 对象。</p>
<p>大多数情况下你无需直接操作该函数，除非你需要操作不常用的选项，以获得更多的灵活性。</p>
<p>最简单的情况下，<code>$.ajax()</code>可以不带任何参数直接使用。</p>
<p>注意，所有的选项都可以通过<code>$.ajaxSetup()</code>函数来全局设置。</p>
<p><strong>回调函数</strong></p>
<p>如果要处理<code>$.ajax()</code>得到的数据，则需要使用回调函数。beforeSend、error、dataFilter、success、complete。</p>
<ul>
<li>beforeSend 在发送请求之前调用，并且传入一个 XMLHttpRequest 作为参数。</li>
<li>error 在请求出错时调用。传入 XMLHttpRequest 对象，描述错误类型的字符串以及一个异常对象（如果有的话）</li>
<li>dataFilter 在请求成功之后调用。传入返回的数据以及”<code>dataType</code>“参数的值。</li>
</ul>
<p>并且必须返回新的数据（可能是处理过的）传递给 success 回调函数。</p>
<ul>
<li>success 当请求之后调用。传入返回后的数据，以及包含成功代码的字符串。</li>
<li>complete 当请求完成之后调用这个函数，无论成功或失败。传入 XMLHttpRequest 对象，以及一个包含成功或错误代码的字符串。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&#x27;test.com&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">  <span class="attr">datatype</span>: json,</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;tom&#x27;</span>,</span><br><span class="line">    <span class="attr">age</span>: <span class="string">&#x27;12&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &lt;!-- <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">result</span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">  &#125; --&gt;</span><br><span class="line">&#125;).<span class="title function_">done</span>(<span class="keyword">function</span>(<span class="params">result</span>)&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result)</span><br><span class="line">&#125;).<span class="title function_">fail</span>(<span class="keyword">function</span>(<span class="params">jqXHR, textStatus</span>)&#123;</span><br><span class="line">  consloe.<span class="title function_">log</span>(textStatus)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>url: 一个用来包含发送请求的 URL 字符串。</p>
<p>settings: AJAX 请求设置。所有选项都是可选的。</p>
<h5 id="seting-中的设置"><a href="#seting-中的设置" class="headerlink" title="seting 中的设置"></a>seting 中的设置</h5><ol>
<li><code>async</code>：默认设置下，所有请求均为异步请求（也就是说这是默认设置为 true ）。</li>
</ol>
<p>如果需要发送同步请求，请将此选项设置为 false 2. <code>beforeSend</code>：请求发送前的回调函数，用来修改请求发送前 jqXHR 对象，此功能用来设置自定义 HTTP 头信息</p>
<p>该 jqXHR 和设置对象作为参数传递 3. <code>cache</code>：如果设置为 false ，浏览器将不缓存此页面。</p>
<p>注意: 设置 cache 为 false 将在 HEAD 和 GET 请求中正常工作。</p>
<p>它的工作原理是在 GET 请求参数中附加”_&#x3D;{timestamp}” 4. <code>context</code>：这个对象用于设置 Ajax 相关回调函数的上下文。</p>
<p>默认情况下，这个上下文是一个 ajax 请求使用的参数设置对象 5. <code>data</code>：发送到服务器的数据。将自动转换为请求字符串格式。</p>
<p>GET 请求中将附加在 URL 后面，POST 请求作为表单数据 6. <code>headers</code>：一个额外的{键:值}对映射到请求一起发送。此设置会在 beforeSend 函数调用之前被设置;</p>
<p>因此，请求头中的设置值，会被 beforeSend 函数内的设置覆盖 7. <code>type</code>: 请求方式 (“POST” 或 “GET”)，默认为 “GET”。</p>
<p>注意:其它 HTTP 请求方法，如 PUT 和 DELETE 也可以使用，但仅部分浏览器支持。</p>
<h3 id="jQuery-get-settings-x2F-jQuery-post-settings"><a href="#jQuery-get-settings-x2F-jQuery-post-settings" class="headerlink" title="jQuery.get( [settings] ) &#x2F; jQuery.post( [settings ] )"></a>jQuery.get( [settings] ) &#x2F; jQuery.post( [settings ] )</h3><p>这两个方法专门用来处理 get 和 post 请求</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">get</span>(<span class="string">&quot;test.html&quot;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  $(<span class="string">&quot;.result&quot;</span>).<span class="title function_">html</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="jQuery-getJSON-url-data-success-data-textstatus-jqxhr"><a href="#jQuery-getJSON-url-data-success-data-textstatus-jqxhr" class="headerlink" title="jQuery.getJSON(url[,data][,success(data,textstatus,jqxhr)])"></a>jQuery.getJSON(url[,data][,success(data,textstatus,jqxhr)])</h3><p>使用一个 HTTP GET 请求从服务器加载 JSON 编码的数据</p>
<p>范例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$.<span class="title function_">getJSON</span>(<span class="string">&quot;ajax/test.json&quot;</span>, <span class="keyword">function</span> (<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> items = [];</span><br><span class="line"></span><br><span class="line">  $.<span class="title function_">each</span>(data, <span class="keyword">function</span> (<span class="params">key, val</span>) &#123;</span><br><span class="line">    items.<span class="title function_">push</span>(<span class="string">&#x27;&lt;li id=&quot;&#x27;</span> + key + <span class="string">&#x27;&quot;&gt;&#x27;</span> + val + <span class="string">&quot;&lt;/li&gt;&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  $(<span class="string">&quot;&lt;ul/&gt;&quot;</span>, &#123;</span><br><span class="line">    <span class="attr">class</span>: <span class="string">&quot;my-new-list&quot;</span>,</span><br><span class="line">    <span class="attr">html</span>: items.<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>),</span><br><span class="line">  &#125;).<span class="title function_">appendTo</span>(<span class="string">&quot;body&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="load-url-data-complete-responsetext-textstatus-xmlhttprequest"><a href="#load-url-data-complete-responsetext-textstatus-xmlhttprequest" class="headerlink" title=".load(url[,data][,complete(responsetext,textstatus,xmlhttprequest)])"></a>.load(url[,data][,complete(responsetext,textstatus,xmlhttprequest)])</h3><p>从服务器载入数据并且将返回的 HTML 代码并插入至匹配的元素中</p>
<p><code>$(&#39;#result&#39;).load(&#39;ajax/test.html&#39;)</code></p>
<h3 id="serialize-x2F-serializeArray"><a href="#serialize-x2F-serializeArray" class="headerlink" title=".serialize() &#x2F; serializeArray()"></a><code>.serialize()</code> &#x2F; <code>serializeArray()</code></h3><p>将用作提交的表单元素的值编译成字符串，方法没有参数，使用标准的 URL-encoded 符号上建立一个文本字符串.</p>
<p>它可以对一个代表一组表单元素的 jQuery 对象进行操作，比如<code>&lt;input&gt;, &lt;textarea&gt;, 和 &lt;select&gt;</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id=<span class="string">&quot;holder&quot;</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;a&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;b&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> <span class="attr">id</span>=<span class="string">&quot;b&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;c&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> <span class="attr">id</span>=<span class="string">&quot;c&quot;</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;f&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;f&quot;</span> <span class="attr">value</span>=<span class="string">&quot;9&quot;</span> <span class="attr">checked</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/form&gt;;</span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#holder&quot;</span>).<span class="title function_">serialize</span>(); <span class="comment">//a=1&amp;b=2&amp;c=3&amp;f=8&amp;f=9</span></span><br><span class="line"></span><br><span class="line">$(<span class="string">&quot;#holder&quot;</span>).<span class="title function_">serializeArray</span>();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">      &#123;name: &#x27;a&#x27;, value: &#x27;1&#x27;&#125;,</span></span><br><span class="line"><span class="comment">      &#123;name: &#x27;b&#x27;, value: &#x27;2&#x27;&#125;,</span></span><br><span class="line"><span class="comment">      &#123;name: &#x27;c&#x27;, value: &#x27;3&#x27;&#125;,</span></span><br><span class="line"><span class="comment">      &#123;name: &#x27;f&#x27;, value: &#x27;8&#x27;&#125;,</span></span><br><span class="line"><span class="comment">      &#123;name: &#x27;f&#x27;, value: &#x27;9&#x27;&#125;</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>serialize 和 serializeArray 都是针对 JQuery 对象(选中的 form 元素)进行操作，只是返回值格式不同而已。</p>
</blockquote>
<p>这里特别要注意：这 2 个 API 只能操作 form，如果将 holder 改成 div，会发现不起作用</p>
<h2 id="jsonp"><a href="#jsonp" class="headerlink" title="jsonp"></a>jsonp</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getBooks</span>(<span class="params"></span>) &#123;</span><br><span class="line">  $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;get&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&quot;http://test.com/bookservice.php&quot;</span>,</span><br><span class="line">    <span class="attr">dataType</span>: <span class="string">&quot;jsonp&quot;</span>,</span><br><span class="line">    <span class="attr">jsonp</span>: <span class="string">&quot;callback&quot;</span>,</span><br><span class="line">    <span class="attr">jsonpCallback</span>: <span class="string">&quot;displayBooks&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当然使用 jsonp 会在一定程度上造成安全性问题，如果请求的站点不是信任站点，那么可能会在返回的方法调用中包含一些恶意代码。</p>
</blockquote>
<p>所以尽量向信任的站点发送请求。另外 xss 也经常会利用 jsonp 向站点注入恶意代码。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/26/HTTP%E8%A1%A5%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/26/HTTP%E8%A1%A5%E6%A1%A3/" class="post-title-link" itemprop="url">HTTP补档</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-26 11:03:49" itemprop="dateCreated datePublished" datetime="2022-09-26T11:03:49+08:00">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="cookie-session-token"><a href="#cookie-session-token" class="headerlink" title="cookie,session.token"></a>cookie,session.token</h1><p>服务器验证是前提。cookie 保存在客户端，服务器不加密不保存；session 保存在客户端，服务器要加密并保存；token 保存在客户端，服务器要加密不保存。</p>
<h1 id="强制缓存-协商缓存"><a href="#强制缓存-协商缓存" class="headerlink" title="强制缓存,协商缓存"></a>强制缓存,协商缓存</h1><p>HTTP 缓存都是从第二次请求开始的：<br>第一次请求资源时，服务器返回资源，并在 response header 中回传资源的缓存策略；<br>第二次请求时，浏览器判断这些请求参数，击中强缓存就直接 200，否则就把请求参数加到 request header 头中传给服务器，看是否击中协商缓存，击中则返回 304，否则服务器会返回新的资源。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/473454/1665390838645-21dd5a7c-9d7b-46be-8f11-5295c562a9cf.png#clientId=u28f1947f-f233-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=214&id=u3198c11f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=214&originWidth=1096&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=126739&status=done&style=none&taskId=ue0545c29-898f-42d5-84b6-38939a39296&title=&width=1096" alt="image.png"></p>
<h2 id="强制缓存"><a href="#强制缓存" class="headerlink" title="强制缓存"></a>强制缓存</h2><p>在缓存未失效时,直接使用浏览器缓存数据,不再请求服务端.生效时,状态码是 200.<br>cache-control 优先级 &gt; expires 优先级。</p>
<h2 id="协商缓存"><a href="#协商缓存" class="headerlink" title="协商缓存"></a>协商缓存</h2><p>第一次请求服务器,或者<code>cache-control</code>和<code>Expire</code>过期,第二次请求就会与服务器协商,与服务端对比资源是否修改更新.没有修改,则返回 304 状态码,继续使用缓存数据.如果更新,则返回 200 状态码,并将缓存信息一并返回.</p>
<h1 id="跨域"><a href="#跨域" class="headerlink" title="跨域"></a>跨域</h1><p>原因: 浏览器的同源策略(为了安全),即同端口,域名,协议.</p>
<blockquote>
<p>跨域并不是请求发不出去，请求能发出去，服务端能收到请求并正常返回结果，只是结果被浏览器拦截了。</p>
</blockquote>
<h2 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h2><p>限制的内容有:</p>
<ul>
<li>cookie, localstorage 等存储内容</li>
<li>DOM 节点</li>
<li>ajax 请求后浏览器返回的结果</li>
</ul>
<p>允许的内容:</p>
<ul>
<li><code>&lt;img src=&quot;xxx&quot;&gt;</code></li>
<li><code>&lt;link href=&quot;xxx&quot;&gt;</code></li>
<li><code>&lt;script src=&quot;xxx&quot;&gt;</code></li>
</ul>
<h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>解决方案有 jsonp、cors、postMessage、websocket、Node 中间件代理(两次跨域)、nginx 反向代理、window.name + iframe、location.hash + iframe、document.domain + iframe<br>日常工作中，用得比较多的跨域方案是 cors 和 nginx 反向代理</p>
<h2 id="cors"><a href="#cors" class="headerlink" title="cors"></a>cors</h2><p>服务端设置<code>Access-Control-Allow-Origin</code>,可以设置哪些域名可以访问资源.</p>
<h2 id="nginx-反向代理"><a href="#nginx-反向代理" class="headerlink" title="nginx 反向代理"></a>nginx 反向代理</h2><p>搭建一个中转 nginx 服务器，用于转发请求.<br>理解: 设置一个中转用的代理服务器,所有接口都访问这个服务器,在这个服务器内设置对应的目标服务器.选择目标服务器获取数据,发送给客户端.<br>实现思路：通过 nginx 配置一个代理服务器（域名与 domain1 相同，端口不同）做跳板机，反向代理访问 domain2 接口，并且可以顺便修改 cookie 中 domain 信息，方便当前域 cookie 写入，实现跨域登录。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>   <span class="number">80</span>; <span class="comment"># 监听的端口</span></span><br><span class="line">    <span class="attribute">server_name</span>   localhost; <span class="comment"># 用户访问 localhost，反向代理到 http://webcanteen.com</span></span><br><span class="line">    <span class="section">location</span> / &#123;</span><br><span class="line">        <span class="attribute">proxy_pass</span> http://webcanteen.com <span class="comment"># 即需要代理访问的地址</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># 也可以写其他的比如/api</span></span><br><span class="line">    location /api &#123;</span><br><span class="line">      <span class="attribute">proxy_pass</span> http://api.web.com <span class="comment"># 这就可以将请求/api的接口代理到这个地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="保持前后端实时通信的方法"><a href="#保持前后端实时通信的方法" class="headerlink" title="保持前后端实时通信的方法"></a>保持前后端实时通信的方法</h1><ol>
<li>websocket</li>
<li>event-source</li>
<li>ajax 轮询</li>
<li>永久帧</li>
</ol>
<h2 id="websocket"><a href="#websocket" class="headerlink" title="websocket"></a>websocket</h2><p>优点: 它是在单个 tcp 连接上进行的全双工通讯协议,客户端和服务器只进行一次握手就可以进行持续双向的数据传输.节约资源和带宽.<br>缺点: 1.兼容性.2.不支持断线重连,需要手写心跳连接的逻辑.3.通信机制复杂</p>
<h2 id="event-source"><a href="#event-source" class="headerlink" title="event-source"></a>event-source</h2><p>优点：（1）只需一次请求，便可以 stream 的方式多次传送数据，节约资源和带宽 （2）相对 WebSocket 来说简单易用 （3）内置断线重连功能(retry)<br>缺点： （1）是单向的，只支持服务端-&gt;客户端的数据传送，客户端到服务端的通信仍然依靠 AJAX，没有”一家人整整齐齐“的感觉（2）兼容性令人担忧，IE 浏览器完全不支持</p>
<h2 id="AJAX-轮询"><a href="#AJAX-轮询" class="headerlink" title="AJAX 轮询"></a>AJAX 轮询</h2><p>优点：兼容性良好，对标低版本 IE<br>缺点：请求中有大半是无用的请求，浪费资源</p>
<h1 id="HTTP1-和-HTTP2-的区别"><a href="#HTTP1-和-HTTP2-的区别" class="headerlink" title="HTTP1 和 HTTP2 的区别"></a>HTTP1 和 HTTP2 的区别</h1><ol>
<li>http1 是明文传送,http2 是二进制传送</li>
<li>http2 支持多路复用</li>
<li>http2 支持头部压缩</li>
<li>http2 支持服务器推送</li>
</ol>
<h1 id="HTTP-和-HTTPS-的区别"><a href="#HTTP-和-HTTPS-的区别" class="headerlink" title="HTTP 和 HTTPS 的区别"></a>HTTP 和 HTTPS 的区别</h1><ol>
<li>http 是超文本传输协议,信息是明文传输,https 是具有安全性的 TLS 加密传输协议</li>
<li>https 需要 ca 申请证书</li>
<li>http 端口使用 80,https 使用 443</li>
</ol>
<h1 id="加密方式"><a href="#加密方式" class="headerlink" title="加密方式"></a>加密方式</h1><p>受 TLS 协议保护的通信过程：先对传输的数据进行了加密（使用对称加密算法）。并且对称加密的密钥是为每一个连接唯一生成的（基于 TLS 握手阶段协商的加密算法和共享密钥），然后发送的每条消息都会通过消息验证码（Message authentication code, MAC），来进行消息完整性检查，最后还可以使用公钥对通信双方进行身份验证</p>
<h2 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/22/JS%E6%89%8B%E5%86%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/22/JS%E6%89%8B%E5%86%99/" class="post-title-link" itemprop="url">JS手写</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-22 16:57:00" itemprop="dateCreated datePublished" datetime="2022-09-22T16:57:00+08:00">2022-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="手写数组转树"><a href="#手写数组转树" class="headerlink" title="手写数组转树"></a>手写数组转树</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 例如将 input 转成output的形式</span></span><br><span class="line"><span class="keyword">let</span> input = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">val</span>: <span class="string">&quot;学校&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">val</span>: <span class="string">&quot;班级1&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">val</span>: <span class="string">&quot;班级2&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="attr">val</span>: <span class="string">&quot;学生1&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="attr">val</span>: <span class="string">&quot;学生2&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">2</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="attr">val</span>: <span class="string">&quot;学生3&quot;</span>,</span><br><span class="line">    <span class="attr">parentId</span>: <span class="number">3</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> output = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">val</span>: <span class="string">&quot;学校&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="attr">val</span>: <span class="string">&quot;班级1&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">4</span>,</span><br><span class="line">          <span class="attr">val</span>: <span class="string">&quot;学生1&quot;</span>,</span><br><span class="line">          <span class="attr">children</span>: [],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">5</span>,</span><br><span class="line">          <span class="attr">val</span>: <span class="string">&quot;学生2&quot;</span>,</span><br><span class="line">          <span class="attr">children</span>: [],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">val</span>: <span class="string">&quot;班级2&quot;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">id</span>: <span class="number">6</span>,</span><br><span class="line">          <span class="attr">val</span>: <span class="string">&quot;学生3&quot;</span>,</span><br><span class="line">          <span class="attr">children</span>: [],</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码实现</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">arrayToTree</span>(<span class="params">array</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> root = array[<span class="number">0</span>];</span><br><span class="line">  array.<span class="title function_">shift</span>();</span><br><span class="line">  <span class="keyword">let</span> tree = &#123;</span><br><span class="line">    <span class="attr">id</span>: root.<span class="property">id</span>,</span><br><span class="line">    <span class="attr">val</span>: root.<span class="property">val</span>,</span><br><span class="line">    <span class="attr">children</span>: array.<span class="property">length</span> &gt; <span class="number">0</span> ? <span class="title function_">toTree</span>(root.<span class="property">id</span>, array) : [],</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> tree;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toTree</span>(<span class="params">parenId, array</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> children = [];</span><br><span class="line">  <span class="keyword">let</span> len = array.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> node = array[i];</span><br><span class="line">    <span class="keyword">if</span> (node.<span class="property">parentId</span> === parenId) &#123;</span><br><span class="line">      children.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: node.<span class="property">id</span>,</span><br><span class="line">        <span class="attr">val</span>: node.<span class="property">val</span>,</span><br><span class="line">        <span class="attr">children</span>: <span class="title function_">toTree</span>(node.<span class="property">id</span>, array),</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> children;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">arrayToTree</span>(input));</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/20/React%E9%AB%98%E9%98%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/20/React%E9%AB%98%E9%98%B6/" class="post-title-link" itemprop="url">React高阶</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-20 17:27:10" itemprop="dateCreated datePublished" datetime="2022-09-20T17:27:10+08:00">2022-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="错误边界"><a href="#错误边界" class="headerlink" title="错误边界"></a>错误边界</h1><p>捕获错误显示备用 UI,而不是整个组件崩溃.<br>无法捕获:</p>
<ol>
<li>事件处理</li>
<li>异步代码 （例如 setTimeout 或 requestAnimationFrame 回调函数）</li>
<li>服务端渲染</li>
<li>错误边界自身抛出来的错误 （而不是其子组件）</li>
</ol>
<h1 id="虚拟-DOM"><a href="#虚拟-DOM" class="headerlink" title="虚拟 DOM"></a>虚拟 DOM</h1><p>Virtual DOM,即虚拟 DOM 节点.使用 JS 的 Object 对象模拟 DOM 中的节点.通过特定的 render 方法将其渲染成真实 DOM.比操作真实 DOM 减小性能开销.</p>
<p>通过对比前后虚拟 dom,得出变化的部分,只修改有变化的 dom,节省性能.</p>
<h2 id="Diff-算法"><a href="#Diff-算法" class="headerlink" title="Diff 算法"></a>Diff 算法</h2><p>传统的 Diff 算法也是一直都有的,diff 算法，会对比新老虚拟 DOM，记录下他们之间的变化，然后将变化的部分更新到视图上。其实之前的 diff 算法，是通过循环递归每个节点，然后进行对比，复杂程度为 O(n^3)，n 是树中节点的总数，这样性能是非常差的。<br>dom-diff 的原理？<br>dom-diff 算法会比较前后虚拟 DOM，从而得到 patches(补丁)，然后与老 Virtual DOM 进行对比，将其应用在需要更新的地方，将 O(n^3) 复杂度的问题转换成 O(n^1&#x3D;n) 复杂度的问题，得到新的 Virtual DOM。降低时间复杂度的方法：</p>
<ol>
<li>两个不同类型的元素会产生不同的树</li>
<li>对于同一层级的一组子节点，它们可以通过唯一 key 进行区分</li>
</ol>
<h1 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a>Fiber</h1><h2 id="为什么需要-Fiber"><a href="#为什么需要-Fiber" class="headerlink" title="为什么需要 Fiber"></a>为什么需要 Fiber</h2><p>在 React 15 版本中采用的是 Virtual DOM 对比方案，通过对比 Virtual DOM 找出差异部分，从而只将差异部分更新到页面中，避免更新整体 DOM 以提高性能。<br>在 Virtual DOM 比对的过程中 React 使用了递归，递归调用的过程不能被终止，如果 Virtual DOM 的层级比较深，递归比对的过程就会长期占用主线程，而 JavaScript 又是单线程，不能同时执行多个任务，其他任务只能等待执行，而且 JavaScript 的执行和 UI 的渲染又是互斥的，此时用户要么看到的就是空白界面，要么就是有界面但是不能响应用户操作，处于卡顿状态，用户体验差。<br>核心就是<strong>递归比对的过程长期占用主线程产生了性能问题。</strong></p>
<h2 id="Fiber-如何解决这种问题"><a href="#Fiber-如何解决这种问题" class="headerlink" title="Fiber 如何解决这种问题"></a>Fiber 如何解决这种问题</h2><p>在 Fiber 架构中 React 放弃了递归调用，采用循环来模拟递归，因为循环可以随时被中断。<br>React 利用浏览器空闲时间执行比对任务， 解决了 React 执行比对任务长期占用主线程的问题。<br>React 在执行完一个任务单元后，查看是否有其他的高优先级任务，如果有，放弃占用主线程，先执行优先级高的任务.</p>
<h2 id="什么是-Fiber"><a href="#什么是-Fiber" class="headerlink" title="什么是 Fiber"></a>什么是 Fiber</h2><ol>
<li>Fiber 是一个执行单元</li>
</ol>
<p>React16 之前,将 VirtualDOM 树整体看成一个任务,进行递归处理,任务整体庞大,执行耗时且不能中断.<br>React16 开始,将整个任务分成一个个小的任务进行处理,<strong>每个小的任务就是 Fiber 节点的构建</strong>.<br>任务是在浏览器的空余时间执行,每个单元执行后,都会检查是否还有空余时间,如果有,就继续执行,没有就交还主线程的控制权.</p>
<ol start="2">
<li>Fiber 是一种数据结构</li>
</ol>
<p>Fiber 其实是一个 js 对象,对象中有 children 属性表示节点的子节点,有 sibling 属性表示节点的下一个兄弟节点,有 return 属性表示节点的父节点.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">type <span class="title class_">Fiber</span> = &#123;</span><br><span class="line">  <span class="comment">// 组件类型 div、span、组件构造函数</span></span><br><span class="line">  <span class="attr">type</span>: any,</span><br><span class="line">  <span class="comment">// DOM 对象</span></span><br><span class="line">  <span class="attr">stateNode</span>: any,</span><br><span class="line">  <span class="comment">// 指向自己的父级 Fiber 对象</span></span><br><span class="line">  <span class="attr">return</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 指向自己的第一个子级 Fiber 对象</span></span><br><span class="line">  <span class="attr">child</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// 指向自己的下一个兄弟 iber 对象</span></span><br><span class="line">  <span class="attr">sibling</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Fiber-的工作方式"><a href="#Fiber-的工作方式" class="headerlink" title="Fiber 的工作方式"></a>Fiber 的工作方式</h2><p>render 阶段: 构建 Fiber 对象,构建链表,在链表中标记要执行的 DOM 操作,可中断.<br>commit 阶段: 根据构建好的链表进行 DOM 操作,不可中断.</p>
<blockquote>
<p>先从上向下走，构建节点对应的 Fiber 对象，然后再从下向上走，构建 Fiber 对象及链表</p>
</blockquote>
<h2 id="Fiber-实现所利用的-api"><a href="#Fiber-实现所利用的-api" class="headerlink" title="Fiber 实现所利用的 api"></a>Fiber 实现所利用的 api</h2><p>利用了 window 的一个 API: <code>requestIdleCallback</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">requestIdleCallback</span>(<span class="keyword">function</span> (<span class="params">deadline</span>) &#123;</span><br><span class="line">  <span class="comment">//deadline.timeRemaining() 获取浏览器的空余时间</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="实现-Fiber"><a href="#实现-Fiber" class="headerlink" title="实现 Fiber"></a>实现 Fiber</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jsx = (</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;a1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;b1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;c1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;c2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;b2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> container = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;root&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. 为每一个节点构建 Fiber 对象</span></span><br><span class="line"><span class="comment"> * 2. 构建 Fiber 链表</span></span><br><span class="line"><span class="comment"> * 3. 提交 Fiber 链接</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建根元素 Fiber 对象</span></span><br><span class="line"><span class="keyword">const</span> workInProgressRoot = &#123;</span><br><span class="line">  <span class="attr">stateNode</span>: container,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">children</span>: [jsx],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextUnitOfWork = workInProgressRoot;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">workLoop</span>(<span class="params">deadline</span>) &#123;</span><br><span class="line">  <span class="comment">// 如果下一个要构建的执行单元存在并且浏览器有空余时间</span></span><br><span class="line">  <span class="keyword">while</span> (nextUnitOfWork &amp;&amp; deadline.<span class="title function_">timeRemaining</span>() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// 构建执行单元并返回新的执行单元</span></span><br><span class="line">    nextUnitOfWork = <span class="title function_">performUnitOfWork</span>(nextUnitOfWork);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 如果所有的执行单元都已经构建完成</span></span><br><span class="line">  <span class="keyword">if</span> (!nextUnitOfWork) &#123;</span><br><span class="line">    <span class="comment">// 进入到第二个阶段 执行 DOM 操作</span></span><br><span class="line">    <span class="title function_">commitRoot</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Fiber 工作的第一个阶段</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">performUnitOfWork</span>(<span class="params">workInProgress</span>) &#123;</span><br><span class="line">  <span class="comment">// 构建阶段向下走的过程</span></span><br><span class="line">  <span class="comment">// 1. 创建当前 Fiber 节点的 DOM 对象并存储在 stateNode 属性中</span></span><br><span class="line">  <span class="comment">// 2. 构建子级 Fiber 对象</span></span><br><span class="line">  <span class="title function_">beginWork</span>(workInProgress);</span><br><span class="line">  <span class="comment">// 如果子级存在</span></span><br><span class="line">  <span class="keyword">if</span> (workInProgress.<span class="property">child</span>) &#123;</span><br><span class="line">    <span class="comment">// 返回子级 构建子级的子级</span></span><br><span class="line">    <span class="keyword">return</span> workInProgress.<span class="property">child</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 开始构建阶段向上走的过程</span></span><br><span class="line">  <span class="comment">// 如果父级存在</span></span><br><span class="line">  <span class="keyword">while</span> (workInProgress) &#123;</span><br><span class="line">    <span class="comment">// 构建 Fiber 链表</span></span><br><span class="line">    <span class="title function_">completeUnitOfWork</span>(workInProgress);</span><br><span class="line">    <span class="comment">// 如果同级存在</span></span><br><span class="line">    <span class="keyword">if</span> (workInProgress.<span class="property">sibling</span>) &#123;</span><br><span class="line">      <span class="comment">// 返回同级 构建同级的子级</span></span><br><span class="line">      <span class="keyword">return</span> workInProgress.<span class="property">sibling</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 同级不存在 退回父级 看父级是否有同级</span></span><br><span class="line">    workInProgress = workInProgress.<span class="property">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">beginWork</span>(<span class="params">workInProgress</span>) &#123;</span><br><span class="line">  <span class="comment">// 如果 Fiber 对象没有存储其对应的 DOM 对象</span></span><br><span class="line">  <span class="keyword">if</span> (!workInProgress.<span class="property">stateNode</span>) &#123;</span><br><span class="line">    <span class="comment">// 创建 DOM 对象并存储在 Fiber 对象中</span></span><br><span class="line">    workInProgress.<span class="property">stateNode</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(workInProgress.<span class="property">type</span>);</span><br><span class="line">    <span class="comment">// 为 DOM 对象添加属性</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> attr <span class="keyword">in</span> workInProgress.<span class="property">props</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (attr !== <span class="string">&quot;children&quot;</span>) &#123;</span><br><span class="line">        workInProgress.<span class="property">stateNode</span>[attr] = workInProgress.<span class="property">props</span>[attr];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 创建子级 Fiber 对象</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(workInProgress.<span class="property">props</span>.<span class="property">children</span>)) &#123;</span><br><span class="line">    <span class="comment">// 记录上一次创建的子级 Fiber 对象</span></span><br><span class="line">    <span class="keyword">let</span> previousFiber = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// 遍历子级</span></span><br><span class="line">    workInProgress.<span class="property">props</span>.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">child, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 创建子级 Fiber 对象</span></span><br><span class="line">      <span class="keyword">let</span> childFiber = &#123;</span><br><span class="line">        <span class="attr">type</span>: child.<span class="property">type</span>,</span><br><span class="line">        <span class="attr">props</span>: child.<span class="property">props</span>,</span><br><span class="line">        <span class="attr">return</span>: workInProgress,</span><br><span class="line">        <span class="attr">effectTag</span>: <span class="string">&quot;PLACEMENT&quot;</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 第一个子级挂载到父级的 child 属性中</span></span><br><span class="line">      <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">        workInProgress.<span class="property">child</span> = childFiber;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 其他子级挂载到自己的上一个兄弟的 sibling 属性中</span></span><br><span class="line">        previousFiber.<span class="property">sibling</span> = childFiber;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 更新上一个子级</span></span><br><span class="line">      previousFiber = childFiber;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">completeUnitOfWork</span>(<span class="params">workInProgress</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> returnFiber = workInProgress.<span class="property">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (returnFiber) &#123;</span><br><span class="line">    <span class="comment">// 链头上移</span></span><br><span class="line">    <span class="keyword">if</span> (!returnFiber.<span class="property">firstEffect</span>) &#123;</span><br><span class="line">      returnFiber.<span class="property">firstEffect</span> = workInProgress.<span class="property">firstEffect</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// lastEffect 上移</span></span><br><span class="line">    <span class="keyword">if</span> (!returnFiber.<span class="property">lastEffect</span>) &#123;</span><br><span class="line">      returnFiber.<span class="property">lastEffect</span> = workInProgress.<span class="property">lastEffect</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 构建链表</span></span><br><span class="line">    <span class="keyword">if</span> (workInProgress.<span class="property">effectTag</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (returnFiber.<span class="property">lastEffect</span>) &#123;</span><br><span class="line">        returnFiber.<span class="property">lastEffect</span>.<span class="property">nextEffect</span> = workInProgress;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        returnFiber.<span class="property">firstEffect</span> = workInProgress;</span><br><span class="line">      &#125;</span><br><span class="line">      returnFiber.<span class="property">lastEffect</span> = workInProgress;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Fiber 工作的第二阶段</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">commitRoot</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 获取链表中第一个要执行的 DOM 操作</span></span><br><span class="line">  <span class="keyword">let</span> currentFiber = workInProgressRoot.<span class="property">firstEffect</span>;</span><br><span class="line">  <span class="comment">// 判断要执行 DOM 操作的 Fiber 对象是否存在</span></span><br><span class="line">  <span class="keyword">while</span> (currentFiber) &#123;</span><br><span class="line">    <span class="comment">// 执行 DOM 操作</span></span><br><span class="line">    currentFiber.<span class="property">return</span>.<span class="property">stateNode</span>.<span class="title function_">appendChild</span>(currentFiber.<span class="property">stateNode</span>);</span><br><span class="line">    <span class="comment">// 从链表中取出下一个要执行 DOM 操作的 Fiber 对象</span></span><br><span class="line">    currentFiber = currentFiber.<span class="property">nextEffect</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在浏览器空闲的时候开始构建</span></span><br><span class="line"><span class="title function_">requestIdleCallback</span>(workLoop);</span><br></pre></td></tr></table></figure>

<h2 id="构建-Fiber-链表"><a href="#构建-Fiber-链表" class="headerlink" title="构建 Fiber 链表"></a>构建 Fiber 链表</h2><ol>
<li>链表的构建顺序</li>
</ol>
<p>链表的顺序是由 DOM 操作的顺序决定的，c1 是第一个要执行 DOM 操作的所以它是链的开始，A1 是最后一个被添加到 Root 中的元素，所以它是链的最后。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/473454/1665628426277-2fd08850-6a30-4f2f-a51b-2edf2ccc0438.png#averageHue=%23fafafa&clientId=ucd2db471-e0ef-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=432&id=u368dabbd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=432&originWidth=424&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=28089&status=done&style=none&taskId=ube3adbea-32ee-47c1-8d98-0522fc58eca&title=&width=424" alt="image.png"></p>
<ol start="2">
<li>如何向链的尾部添加新元素？</li>
</ol>
<p>在链表结构中通过 nextEffect 存储链中的下一项。<br>在构建链表的过程中，需要通过一个变量存储链表中的最新项，每次添加新项时都使用这个变量，每次操作完成后都需要更新它。这个变量在源码中叫做 lastEffect。<br>lastEffect 是存储在当前 Fiber 对象的父级上的，当父级发生变化时，为避免链接顺序发生错乱，lastEffect 要先上移然后再追加 nextEffect</p>
<ol start="3">
<li>将链表保存在什么位置？</li>
</ol>
<p>链表需要被保存在 Root 中，因为在进入到第二阶段时，也就是 commitRoot 方法中，是将 Root 提交到第二阶段的。<br>在源码中，Root Fiber 下有一个叫 firstEffect 的属性，用于存储链表。<br>在构建链表的遍历过程中，C1 开始，Root 是结尾，如何才能将 C1 存储到 Root 中呢？<br>其实是链头的不断上移做到的。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/473454/1665628479417-a56bd511-feff-47cf-8b2f-caa3f3ebeedd.png#averageHue=%23fbfbfb&clientId=ucd2db471-e0ef-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=467&id=u732bb189&margin=%5Bobject%20Object%5D&name=image.png&originHeight=467&originWidth=586&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=32753&status=done&style=none&taskId=uc4500bf3-9b14-40d0-af6b-a3f44970565&title=&width=586" alt="image.png"></p>
<h1 id="React-性能优化"><a href="#React-性能优化" class="headerlink" title="React 性能优化"></a>React 性能优化</h1><h2 id="React-memo-useMemo-useCallback"><a href="#React-memo-useMemo-useCallback" class="headerlink" title="React.memo useMemo useCallback"></a>React.memo useMemo useCallback</h2><ul>
<li>React.memo 是包裹整个组件,浅层对比 props 的变化,决定是否渲染组件,</li>
<li>useMemo 是更加细粒度的进行性能优化.</li>
<li>useMemo 是返回一个 memoized 值,只有当依赖项变化才会触发重新渲染.</li>
<li>useMemo 和 useCallback 用法差不多，都是在第一次渲染的时候执行，然后在依赖项改变时再次执行，不同点在于，useMemo 返回缓存的变量，useCallback 返回缓存的函数</li>
</ul>
<h2 id="lazy-和-Suspense"><a href="#lazy-和-Suspense" class="headerlink" title="lazy 和 Suspense"></a>lazy 和 Suspense</h2><p>异步加载组件</p>
<h2 id="不可变数据-immer"><a href="#不可变数据-immer" class="headerlink" title="不可变数据 immer"></a>不可变数据 immer</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/15/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E9%9B%86%E5%90%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/15/%E9%A1%B9%E7%9B%AE%E9%97%AE%E9%A2%98%E9%9B%86%E5%90%88/" class="post-title-link" itemprop="url">项目问题集合</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-15 16:48:51" itemprop="dateCreated datePublished" datetime="2022-09-15T16:48:51+08:00">2022-09-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Jira"><a href="#Jira" class="headerlink" title="Jira"></a>Jira</h1><h2 id="参数解构"><a href="#参数解构" class="headerlink" title="参数解构"></a>参数解构</h2><p>用于简化浅拷贝操作</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">setParam</span>(...param, e.<span class="property">target</span>.<span class="property">value</span>)&#125;</span><br></pre></td></tr></table></figure>

<h2 id="fetch-方法使用"><a href="#fetch-方法使用" class="headerlink" title="fetch 方法使用"></a>fetch 方法使用</h2><p>fetch 方法返回的是异步的可以使用 async&#x2F;await</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&quot;&quot;</span>).<span class="title function_">then</span>(<span class="keyword">async</span> (res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">    <span class="title function_">setList</span>(<span class="keyword">await</span> res.<span class="title function_">json</span>());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="避免修改原值"><a href="#避免修改原值" class="headerlink" title="避免修改原值"></a>避免修改原值</h2><p>对于修改某个值,可以先将该值拷贝,再修改拷贝值,将修改后的拷贝值抛出,避免修改原值.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">removeIndex</span>: <span class="function">(<span class="params">index</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> copy = [...value];</span><br><span class="line">  copy.<span class="title function_">splice</span>(index, <span class="number">1</span>);</span><br><span class="line">  <span class="title function_">setValue</span>(copy);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="自定义-Hook"><a href="#自定义-Hook" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h1><p>注意点:</p>
<ol>
<li>hooks 要放在最外层,层级要求最高.</li>
<li>不要在循环,条件,嵌套中使用 Hook,确保它在最顶层.</li>
</ol>
<p>只在 React 函数中调用 Hook,不要在 js 函数中调用.</p>
<h2 id="挂载时-Hook"><a href="#挂载时-Hook" class="headerlink" title="挂载时 Hook"></a>挂载时 Hook</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useMount</span> = (<span class="params">callback</span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">callback</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="防抖-Hook"><a href="#防抖-Hook" class="headerlink" title="防抖 Hook"></a>防抖 Hook</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数一,需要防抖的值,可以是任意类型</span></span><br><span class="line"><span class="keyword">const</span> useDebounce = &lt;V&gt;(<span class="attr">value</span>: V, delay?: <span class="built_in">number</span>): <span class="function"><span class="params">any</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [debounceValue, setDebounceValue] = <span class="title function_">useState</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//挂载时设置定时器</span></span><br><span class="line">    <span class="keyword">const</span> timeout = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">setDebounceValue</span>(value), (delay = <span class="number">1000</span>));</span><br><span class="line">    <span class="comment">//卸载时,清除定时器</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> <span class="title function_">cleatTimeout</span>(timeout);</span><br><span class="line">    <span class="comment">//设置的依赖用于变化后重新执行</span></span><br><span class="line">  &#125;, [value, delay]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Hooks-中的闭包陷阱"><a href="#Hooks-中的闭包陷阱" class="headerlink" title="Hooks 中的闭包陷阱"></a>Hooks 中的闭包陷阱</h1><p>以设置网站标题为例</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">useDocument</span> = (<span class="params">title:<span class="built_in">string</span>, keepOnUnmount?:<span class="built_in">boolean</span>=<span class="literal">true</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 拿到文档当前的title</span></span><br><span class="line">  <span class="keyword">const</span> oldTitle = <span class="title class_">React</span>.<span class="title function_">useRef</span>(<span class="variable language_">document</span>.<span class="property">title</span>).<span class="title function_">current</span>()</span><br><span class="line">  <span class="comment">// 挂载时,将传入title赋值</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">title</span> = title</span><br><span class="line">  &#125;,[])</span><br><span class="line">  <span class="comment">// 卸载时,判断是否有保持传入title的参数</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//这里闭包里保存的oldTitle没有变化</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(!keepOnUnmount) &#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">title</span> = oldTitle</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,[keepOnUnmount,oldTitle])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="闭包陷阱"><a href="#闭包陷阱" class="headerlink" title="闭包陷阱"></a>闭包陷阱</h2><p>“闭包陷阱” 最大的问题就是在函数数内无法获取的最新的 state 的值.<br>函数式组件每次 render 都会生产一个新的 log 函数，这个新的 log 函数会产生一个在当前这个阶段 value 值的闭包。<br>log 方法内的 value 和点击触发时的 value 相同,value 的后续变化对 log 内的 value 不造成影响.<br>如何解决:</p>
<ol>
<li>使用 useRef</li>
</ol>
<p>原理: useRef 每次 render 时都会返回同一个引用类型的对象.设置值和读取值都在这个对象上处理.</p>
<ol start="2">
<li>useState 更新值时传入回调函数</li>
</ol>
<p><code>**setValue**(value =&gt; value + 1)</code></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">FunctionComponent</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = <span class="title function_">useState</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">log</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">alert</span>(value);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>FunctionComponent<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>value: &#123;value&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> setValue(value + 1)&#125;&gt;add<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;log&#125;</span>&gt;</span>alert<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="副作用"><a href="#副作用" class="headerlink" title="副作用"></a>副作用</h1><p>副作用(Side Effect)是指函数或者表达式的行为依赖于外部世界。</p>
<h1 id="useMemo-和-useCallback"><a href="#useMemo-和-useCallback" class="headerlink" title="useMemo 和 useCallback"></a>useMemo 和 useCallback</h1><p>而 useCallback 就是一个特殊版本的 useMemo，专门来处理函数的<br>案例:</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;./styles.css&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = <span class="title class_">React</span>.<span class="title function_">useState</span>(<span class="number">0</span>); <span class="comment">// 加了这一行</span></span><br><span class="line">  <span class="keyword">const</span> value = &#123; <span class="attr">name</span>: <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="title class_">React</span>.<span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">setCount</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()); <span class="comment">// 加了这一行</span></span><br><span class="line">    (<span class="string">&quot;render&quot;</span>);</span><br><span class="line">  &#125;, [value]);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello CodeSandbox<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Edit to see some magic happen!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里循环的原因是：组件渲染 → useEffect 执行 → setCount 触发循环 → 组件渲染 → useEffect 执行 → setCount 触发循环…<br>注意是组件渲染之后,刷新的是 value,和上一个不是同一个 value.那就需要给它套上 useMemo.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title class_">React</span>.<span class="title function_">useMemo</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; <span class="attr">name</span>: <span class="number">1</span> &#125;;</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<p>useMemo 的意思就是：不要每次渲染都重新定义，而是我让你重新定义的时候再重新定义(第二个参数，依赖列表)。大家看到这里的依赖列表是空的，是因为 useMemo 里的回调函数确实没用到啥变量，如果有变量的话大家的 IDE 就会提醒加上依赖了。<br>这就是使用 useMemo 的原理，useMemo 适用于所有类型的值，加入这个值恰好是函数，那么用 useCallback 也可以。也就是说，useCallback 是一种特殊的 useMemo。<br>使用场景:</p>
<ol>
<li>它不是状态，也就是说，不是用 useState 定义的(redux 中的状态实际上也是用 useState 定义的)</li>
<li>它不是基本类型</li>
<li>它会被放在 useEffect 的依赖列表里 || 自定义 hook 的返回值</li>
</ol>
<p>自定义 hook 的返回值也成立是因为，你不知道自定义 hook 的返回值将会被用在哪里，它可能会被用在依赖也可能不会，所以干脆都加上；而像上面那个在组件中定义的 value，你就可以见机行事了</p>
<h1 id="自定义-Hook-1"><a href="#自定义-Hook-1" class="headerlink" title="自定义 Hook"></a>自定义 Hook</h1><p>自定义 Hook 是目前最好的重用 React 逻辑的方法，它和普通的函数很像很像，自定义 Hook 的特殊之处在于，它是有状态的，它返回的也是状态。所以在什么时候我们应该用到自定义 Hook？那就是，我们想要抽象出处理状态的逻辑的时候</p>
<h1 id="状态管理"><a href="#状态管理" class="headerlink" title="状态管理"></a>状态管理</h1><p>大概可以分为三种场景<br>简单场景:使用状态提升,组合组件<br>使用缓存管理:react-query<br>使用客户端状态管理:redux, context, url</p>
<h2 id="关于全局使用的状态操作"><a href="#关于全局使用的状态操作" class="headerlink" title="关于全局使用的状态操作"></a>关于全局使用的状态操作</h2><p>方法一: 可以使用 redux 设置一个 state,设置对应的 reducer,<br>一个同步设置状态,一个异步 thunk.<br>方法二: 使用缓存,react-query.</p>
<h2 id="useContext"><a href="#useContext" class="headerlink" title="useContext"></a>useContext</h2><p>给整个 app 设置登录注册用户信息相关的 context.将 app 包裹,就可以随时验证登录状态.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建Context</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">IContext</span> &#123;</span><br><span class="line">  <span class="attr">user</span>: <span class="title class_">User</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">login</span>: <span class="function">(<span class="params">form:AuthForm</span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">register</span>: <span class="function">(<span class="params">form:AuthForm</span>) =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">  <span class="attr">logout</span>: <span class="function">() =&gt;</span> <span class="title class_">Promise</span>&lt;<span class="built_in">void</span>&gt;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">AuthForm</span> &#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">password</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AuthContext</span> = createContext&lt;<span class="title class_">IContext</span>| <span class="literal">undefined</span>&gt;(<span class="literal">undefined</span>);</span><br><span class="line"><span class="comment">// 2.设置Context的名字</span></span><br><span class="line"><span class="title class_">AuthContext</span>.<span class="property">displayName</span> = <span class="string">&#x27;AuthContext&#x27;</span></span><br><span class="line"><span class="comment">// 3. 设置provider包裹整个app组件</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">AuthProvider</span> = (<span class="params">&#123;children&#125;:&#123;children: ReactNode&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 各种在登录或者要验证用户信息的方法</span></span><br><span class="line">  <span class="comment">// 设置报错反馈</span></span><br><span class="line">  <span class="keyword">return</span> (<span class="language-xml"><span class="tag">&lt;<span class="name">AuthContext.Provider</span> <span class="attr">children</span>=<span class="string">&#123;children&#125;</span> <span class="attr">value</span>=<span class="string">&#123;/*各种方法的变量*/&#125;</span> /&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 4. 使用自定义Hook设置调用方法</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useAuth</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> context = <span class="title function_">useContext</span>(<span class="title class_">AuthContext</span>)</span><br><span class="line">  <span class="keyword">if</span>(!context)&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;useAuth必须在AuthProvider中使用&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> context</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 5. 将AuthProvider和父级的Provider合并</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title class_">AppProvider</span> = (&#123; children &#125;: &#123; <span class="attr">children</span>: <span class="title class_">ReactNode</span> &#125;)) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">QueryClientProvider</span> <span class="attr">client</span>=<span class="string">&#123;new</span> <span class="attr">QueryClient</span>()&#125;&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">AuthProvider</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">AuthProvider</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">QueryClientProvider</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 6. 在index.ts文件将整个app组件包裹</span></span><br><span class="line">&lt;<span class="title class_">AppProviders</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">DevTools</span> /&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span></span></span><br><span class="line">&lt;/<span class="title class_">AppProviders</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h2><h2 id="react-query"><a href="#react-query" class="headerlink" title="react-query"></a>react-query</h2><p>这是一个适用于 React Hooks 的请求库，这个库将帮助你获取、同步、更新和缓存你的远程数据， 提供两个简单的 hooks，就能完成增删改查等操作，React-Query 使用声明式管理服务端状态，可以使用零配置开箱即用地处理缓存，后台更新和陈旧数据。</p>
<p>React-Query 封装了完整的请求中间状态（<code>isLoading</code>、<code>isError</code>…）。<br>不仅如此，React-Query 还为我们做了如下工作：<br>多个组件请求同一个 query 时只发出一个请求<br>缓存数据失效&#x2F;更新策略（判断缓存合适失效，失效后自动请求数据）<br>对失效数据垃圾清理<br>数据的 CRUD 由 2 个 hook 处理：<br><code>useQuery</code>处理数据的查<br><code>useMutation</code>处理数据的增&#x2F;删&#x2F;改</p>
<h1 id="乐观更新"><a href="#乐观更新" class="headerlink" title="乐观更新"></a>乐观更新</h1><p>更新操作后,在数据返回前可以先乐观的更新数据,但是有的情况下会有失败的可能.这时候再选择回滚更新.<br><code>useMutation</code> 的 <code>onMutate</code> 回调允许返回一个特定值，该值稍后将作为最后一个参数传递给 <code>onError</code> 和 <code>onSettled</code> 处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_">useMutation</span>(updateTodo, &#123;</span><br><span class="line">  <span class="comment">// 当 mutate 调用时</span></span><br><span class="line">  <span class="attr">onMutate</span>: <span class="keyword">async</span> (newTodo) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 撤销相关的查询（这样它们就不会覆盖我们的乐观更新）</span></span><br><span class="line">    <span class="keyword">await</span> queryClient.<span class="title function_">cancelQueries</span>([<span class="string">&quot;todos&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存前一次状态的快照</span></span><br><span class="line">    <span class="keyword">const</span> previousTodos = queryClient.<span class="title function_">getQueryData</span>([<span class="string">&quot;todos&quot;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行&quot;乐观&quot;更新</span></span><br><span class="line">    queryClient.<span class="title function_">setQueryData</span>([<span class="string">&quot;todos&quot;</span>], <span class="function">(<span class="params">old</span>) =&gt;</span> [...old, newTodo]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回具有快照值的上下文对象</span></span><br><span class="line">    <span class="keyword">return</span> &#123; previousTodos &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 如果修改失败，则使用 onMutate 返回的上下文进行回滚</span></span><br><span class="line">  <span class="attr">onError</span>: <span class="function">(<span class="params">err, newTodo, context</span>) =&gt;</span> &#123;</span><br><span class="line">    queryClient.<span class="title function_">setQueryData</span>([<span class="string">&quot;todos&quot;</span>], context.<span class="property">previousTodos</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 总是在错误或成功之后重新获取：</span></span><br><span class="line">  <span class="attr">onSettled</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    queryClient.<span class="title function_">invalidateQueries</span>(<span class="string">&quot;todos&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>项目案例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">QueryKey</span>, useQueryClient &#125; <span class="keyword">from</span> <span class="string">&quot;react-query&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Task</span> &#125; <span class="keyword">from</span> <span class="string">&quot;types/task&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reorder &#125; <span class="keyword">from</span> <span class="string">&quot;./reorder&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">useConfig</span> = (<span class="params"></span></span><br><span class="line"><span class="params">  queryKey: QueryKey,</span></span><br><span class="line"><span class="params">  callback: (target: any, old?: any[]) =&gt; any[]</span></span><br><span class="line"><span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> queryClient = <span class="title function_">useQueryClient</span>();</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">// 第二个参数即在成功获取数据后刷新数据</span></span><br><span class="line">    <span class="attr">onSuccess</span>: <span class="function">() =&gt;</span> queryClient.<span class="title function_">invalidateQueries</span>(queryKey),</span><br><span class="line">    <span class="comment">// 配置乐观更新</span></span><br><span class="line">    <span class="attr">onMutate</span>: <span class="keyword">async</span> (<span class="attr">target</span>: any) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> previousItems = queryClient.<span class="title function_">getQueryData</span>(queryKey);</span><br><span class="line">      queryClient.<span class="title function_">setQueryData</span>(queryKey, <span class="function">(<span class="params">old?: any[]</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">callback</span>(target, old);</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        previousItems,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 如果出错就将原数据回滚</span></span><br><span class="line">    <span class="attr">onError</span>: <span class="function">(<span class="params">error: any, newItem: any, context: any</span>) =&gt;</span> &#123;</span><br><span class="line">      queryClient.<span class="title function_">setQueryData</span>(queryKey, context.<span class="property">previousItems</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="fetch-与-axios-区别"><a href="#fetch-与-axios-区别" class="headerlink" title="fetch 与 axios 区别"></a>fetch 与 axios 区别</h1><p>使用 fetch 封装,注意和 axios 的区别,无法捕获非网络异常导致的 error.必须手动 Promise.reject()抛出.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> data = <span class="keyword">await</span> res.<span class="title function_">json</span>();</span><br><span class="line"><span class="keyword">if</span> (res.<span class="property">ok</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> data;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="无感登录"><a href="#无感登录" class="headerlink" title="无感登录"></a>无感登录</h1><p>在挂载时,设置方法.获取 token,更新 user 信息.没有 token 后端返回 401 就跳转到登录页.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">bootstrapUser</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> user = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">const</span> token = auth.<span class="title function_">getToken</span>();</span><br><span class="line">  <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">http</span>(<span class="string">&quot;me&quot;</span>, &#123; token &#125;);</span><br><span class="line">    user = data.<span class="property">user</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> user;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="乐观更新-1"><a href="#乐观更新-1" class="headerlink" title="乐观更新"></a>乐观更新</h1><h1 id="自定义-Hook-异步操作"><a href="#自定义-Hook-异步操作" class="headerlink" title="自定义 Hook 异步操作"></a>自定义 Hook 异步操作</h1><p>自带 loading,错误处理</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">State</span>&lt;D&gt; &#123;</span><br><span class="line">  <span class="attr">error</span>: <span class="title class_">Error</span> | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">data</span>: D | <span class="literal">null</span>;</span><br><span class="line">  <span class="attr">stat</span>: <span class="string">&quot;idle&quot;</span> | <span class="string">&quot;loading&quot;</span> | <span class="string">&quot;error&quot;</span> | <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">defaultInitialState</span>: <span class="title class_">State</span> = &#123;</span><br><span class="line">  <span class="attr">stat</span>: <span class="string">&quot;idle&quot;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> useAsync = &lt;D&gt;<span class="function">(<span class="params">initialState?: State&lt;D&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [state, setState] = useState&lt;<span class="title class_">State</span>&lt;D&gt;&gt;(&#123;</span><br><span class="line">    ...defaultInitialState,</span><br><span class="line">    initialState,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置data说明状态成功</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setData</span> = (<span class="params">data: D</span>) =&gt;</span><br><span class="line">    <span class="title function_">setState</span>(&#123;</span><br><span class="line">      data,</span><br><span class="line">      <span class="attr">error</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">stat</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">//设置data说明状态失败</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">setError</span> = (<span class="params">error: <span class="built_in">Error</span></span>) =&gt;</span><br><span class="line">    <span class="title function_">setState</span>(&#123;</span><br><span class="line">      error,</span><br><span class="line">      <span class="attr">data</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">stat</span>: <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="comment">// 接收异步</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">run</span> = (<span class="params">promise: <span class="built_in">Promise</span>&lt;D&gt;</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 如果不是promise类型报错</span></span><br><span class="line">    <span class="keyword">if</span> (!promise || !promise.<span class="property">then</span>) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;请传入Promise类型数据&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果是,刚开始是loading状态</span></span><br><span class="line">    <span class="title function_">setState</span>(&#123; ...state, <span class="attr">stat</span>: <span class="string">&quot;loading&quot;</span> &#125;);</span><br><span class="line">    <span class="comment">// 最后返回promise</span></span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setData</span>(data);</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">setError</span>(error);</span><br><span class="line">        <span class="comment">// 注意catch会捕获error,不主动抛出就不能继续往下传递</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 将所有信息暴露</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">isIdle</span>: state.<span class="property">stat</span> === <span class="string">&quot;idle&quot;</span>,</span><br><span class="line">    <span class="attr">isLoading</span>: state.<span class="property">stat</span> === <span class="string">&quot;loading&quot;</span>,</span><br><span class="line">    <span class="attr">isError</span>: state.<span class="property">stat</span> === <span class="string">&quot;error&quot;</span>,</span><br><span class="line">    <span class="attr">isSuccess</span>: state.<span class="property">stat</span> === <span class="string">&quot;success&quot;</span>,</span><br><span class="line">    run,</span><br><span class="line">    setData,</span><br><span class="line">    setError,</span><br><span class="line">    ...state,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="错误边界"><a href="#错误边界" class="headerlink" title="错误边界"></a>错误边界</h1><p>捕获错误显示备用 UI,而不是整个组件崩溃.<br>无法捕获:</p>
<ol>
<li>事件处理</li>
<li>异步代码 （例如 setTimeout 或 requestAnimationFrame 回调函数）</li>
<li>服务端渲染</li>
<li>错误边界自身抛出来的错误 （而不是其子组件）</li>
</ol>
<p>如果一个类组件定义了生命周期方法中的任何一个（或两个）<code>static getDerivedStateFromError()</code> 或 <code>componentDidCatch()</code>，那么它就成了一个错误边界。<br>使用<code>static getDerivedStateFromError()</code>在抛出错误后渲染回退 UI。 使用 <code>componentDidCatch()</code> 来记录错误信息。</p>
<h2 id="实现方法"><a href="#实现方法" class="headerlink" title="实现方法"></a>实现方法</h2><p>需要使用类组件声明</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span> <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">FallBackRender</span> = <span class="function">(<span class="params">props: &#123; error: <span class="built_in">Error</span> | <span class="literal">null</span> &#125;</span>) =&gt;</span> <span class="title class_">React</span>.<span class="property">ReactElement</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> <span class="title class_">ErrorBoundary</span> <span class="keyword">extends</span> <span class="title class_ inherited__">React.Component</span>&lt;</span><br><span class="line">  <span class="title class_">React</span>.<span class="property">PropsWithChildren</span>&lt;&#123; <span class="attr">fallbackRender</span>: <span class="title class_">FallBackRender</span> &#125;&gt;,</span><br><span class="line">  &#123; <span class="attr">error</span>: <span class="title class_">Error</span> | <span class="literal">null</span> &#125;</span><br><span class="line">&gt; &#123;</span><br><span class="line">  state = &#123; <span class="attr">error</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  <span class="comment">// 当子组件抛出异常，这里会接收到并且调用</span></span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">getDerivedStateFromError</span>(<span class="params">error: <span class="built_in">Error</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; error &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; error &#125; = <span class="variable language_">this</span>.<span class="property">state</span>;</span><br><span class="line">    <span class="keyword">const</span> &#123; fallbackRender, children &#125; = <span class="variable language_">this</span>.<span class="property">props</span>;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">fallbackRender</span>(&#123; error &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> children;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后包裹整个组件树</p>
<h1 id="类型守卫"><a href="#类型守卫" class="headerlink" title="类型守卫"></a>类型守卫</h1><p>类型守卫(当符合条件时,value 就是 Error 类型)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isError = (<span class="attr">value</span>: <span class="built_in">any</span>): value is <span class="title class_">Error</span> =&gt; value?.<span class="property">message</span>;</span><br></pre></td></tr></table></figure>

<h1 id="React-Router"><a href="#React-Router" class="headerlink" title="React Router"></a>React Router</h1><p>在要使用的页面构建 Router 的 Context.</p>
<h2 id="路由参数-Hook"><a href="#路由参数-Hook" class="headerlink" title="路由参数 Hook"></a>路由参数 Hook</h2><p>由此设置依据 url 返回参数进行数据传递.<br>作用:返回页面 URL 中指定键的参数值.</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> useUrlQueryParam = &lt;K <span class="keyword">extends</span> <span class="built_in">string</span>&gt;<span class="function">(<span class="params">keys: K[]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [searchParams, setSearchParams] = <span class="title function_">useSearchParams</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    <span class="comment">//使用useMemo优化这个方法</span></span><br><span class="line">    <span class="title function_">useMemo</span>(<span class="function">() =&gt;</span></span><br><span class="line">      keys.<span class="title function_">reduce</span>(<span class="function">(<span class="params">prev, key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...prev, [key]:searchParams.<span class="title function_">get</span>(<span class="string">&#x27;key&#x27;</span>) || <span class="string">&#x27;&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,&#123;&#125; <span class="keyword">as</span> &#123;[key <span class="keyword">in</span> K]: <span class="built_in">string</span>&#125;)</span><br><span class="line">    ,[keys,searchParams]),</span><br><span class="line">    <span class="comment">// 返回setSearchParams,约束入参</span></span><br><span class="line">    <span class="function">(<span class="params">params: Partial&lt;[key <span class="keyword">in</span> K]: <span class="built_in">unknown</span>&gt;</span>) =&gt;</span><span class="title function_">setSearchParams</span>(params)</span><br><span class="line">  ] <span class="keyword">as</span> <span class="keyword">const</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Shop-项目"><a href="#Shop-项目" class="headerlink" title="Shop 项目"></a>Shop 项目</h1><p>使用 reduxjs&#x2F;toolkit 中的 redux.<br>reducer 采用切片的方法.</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// store/index.ts</span></span><br><span class="line"><span class="comment">// 设置根reducer对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> rootReducer = &#123;</span><br><span class="line">  <span class="attr">auth</span>: authSlice.<span class="property">reducer</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> store = <span class="title function_">configureStore</span>(&#123;</span><br><span class="line">  <span class="attr">reducer</span>: rootReducer,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// auth.slice.ts</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> authSlice = <span class="title function_">createSlice</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;auth&#x27;</span>,</span><br><span class="line">  initialState,</span><br><span class="line">  <span class="attr">reducers</span>: &#123;</span><br><span class="line">    <span class="title function_">setUser</span>(<span class="params">state,action</span>) &#123;</span><br><span class="line">      state.<span class="property">user</span> = action.<span class="property">payload</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123;setUser&#125; = authSlice.<span class="property">actions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">selectUser</span> = (<span class="params">state:RootState</span>) =&gt; state.<span class="property">auth</span>.<span class="property">user</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">login</span> = (<span class="params">form:AuthForm</span>) =&gt; <span class="function">(<span class="params">dispatch:AppDispatch</span>) =&gt;</span>auth.<span class="title function_">login</span>(form).<span class="title function_">then</span>(<span class="function"><span class="params">user</span> =&gt;</span> <span class="title function_">dispatch</span>(<span class="title function_">setUser</span>(user))</span><br></pre></td></tr></table></figure>

<p>记得使用 Provider 将 Context 包裹</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/09/14/%E5%BE%AE%E5%89%8D%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/09/14/%E5%BE%AE%E5%89%8D%E7%AB%AF/" class="post-title-link" itemprop="url">微前端</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-09-14 16:33:54" itemprop="dateCreated datePublished" datetime="2022-09-14T16:33:54+08:00">2022-09-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h1><ol>
<li>拆分巨型应用,使得应用更好维护</li>
<li>兼容历史应用,实现增量开发</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/22/React%20CSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/08/22/React%20CSS/" class="post-title-link" itemprop="url">React CSS</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-22 10:55:31" itemprop="dateCreated datePublished" datetime="2022-08-22T10:55:31+08:00">2022-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="emotion"><a href="#emotion" class="headerlink" title="emotion"></a>emotion</h1><p>可以模块化 css</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add @emotion/styled @emotion/react</span><br></pre></td></tr></table></figure>

<p>写法,注意首字母大写</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Container</span> = styled.<span class="property">div</span><span class="string">`</span></span><br><span class="line"><span class="string">  display: flex;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意styled后只能跟原生元素,如果要修改antd,加括号</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ShadowCard</span> = <span class="title function_">styled</span>(<span class="title class_">Card</span>)<span class="string">`</span></span><br><span class="line"><span class="string">  width: 40rem;</span></span><br><span class="line"><span class="string">`</span>;</span><br></pre></td></tr></table></figure>

<h1 id="antd"><a href="#antd" class="headerlink" title="antd"></a>antd</h1><p>老版本 antd 和新版本 react-script 有冲突会报 less 警告.可以将引入 antd.css 改为 antd.min.css 即可解决.</p>
<h1 id="Grid-布局和-flex-布局"><a href="#Grid-布局和-flex-布局" class="headerlink" title="Grid 布局和 flex 布局"></a>Grid 布局和 flex 布局</h1><p>区别:</p>
<ol>
<li>一维布局: flex;二维布局: grid;</li>
<li>从内容出发用 flex,布局出发用 grid.</li>
</ol>
<p>内容出发:先有一组数据,数量不固定,希望均匀分布在容器中,由内容自己的大小占据空间.<br>布局出发: 先规划网格,再把元素往里面填充.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/08/React%20Router%20v6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/07/08/React%20Router%20v6/" class="post-title-link" itemprop="url">React Router v6</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-08 14:39:54" itemprop="dateCreated datePublished" datetime="2022-07-08T14:39:54+08:00">2022-07-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>v6 版本相对比前面有较大修改</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router-dom</span><br></pre></td></tr></table></figure>

<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><h1 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h1><h2 id="Navigate"><a href="#Navigate" class="headerlink" title="Navigate"></a>Navigate</h2><p>替换之前的 Redirect.</p>
<blockquote>
<p>axios 内部只是不能调用 hook，因为 hooks 的定义就是只能在函数组件顶层或其他 hook 内部调用。<br>解决办法：先在 axios 方法外调用 useNavigate 钩子得到 nav 方法，然后在 axios 回调里用 nav 方法进行路由跳转</p>
</blockquote>
<blockquote>
<p>Navigate 组件应该是放在业务组件里。比如路径&#x2F;a 要跳转到路径&#x2F;b，则是放在路径&#x2F;a 对应的 A 组件里，不是放在 routes 里面</p>
</blockquote>
<h1 id="不使用"><a href="#不使用" class="headerlink" title="不使用"></a>不使用</h1><h2 id="exact"><a href="#exact" class="headerlink" title="exact"></a>exact</h2><p>取消了,所有路由默认都是严格匹配,如果想模糊匹配,可以在路由后加<code>*</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/06/28/Git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/06/28/Git/" class="post-title-link" itemprop="url">Git</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-06-28 16:32:14" itemprop="dateCreated datePublished" datetime="2022-06-28T16:32:14+08:00">2022-06-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="新建分支并推送"><a href="#新建分支并推送" class="headerlink" title="新建分支并推送"></a>新建分支并推送</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 创建并切换</span><br><span class="line">git checkout -b newBranch</span><br><span class="line">// 推送到远程同名</span><br><span class="line">git push origin newBranch:newBranch</span><br></pre></td></tr></table></figure>

<h1 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 推送空分支到远程就删除了</span><br><span class="line">git push origin :newBranch</span><br><span class="line"></span><br><span class="line">//delete删除</span><br><span class="line">git push origin --delete newBranch</span><br></pre></td></tr></table></figure>

<h1 id="删除本地分支"><a href="#删除本地分支" class="headerlink" title="删除本地分支"></a>删除本地分支</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 只有推送后才会删除</span><br><span class="line">git branch -d master</span><br><span class="line">// 强制删除</span><br><span class="line">git branch -d master</span><br></pre></td></tr></table></figure>

<h1 id="查看所有分支"><a href="#查看所有分支" class="headerlink" title="查看所有分支"></a>查看所有分支</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -a</span><br></pre></td></tr></table></figure>

<h1 id="新建本地项目推送远程仓库"><a href="#新建本地项目推送远程仓库" class="headerlink" title="新建本地项目推送远程仓库"></a>新建本地项目推送远程仓库</h1><h2 id="git-初始化"><a href="#git-初始化" class="headerlink" title="git 初始化"></a>git 初始化</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>

<h2 id="git-暂存提交"><a href="#git-暂存提交" class="headerlink" title="git 暂存提交"></a>git 暂存提交</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br><span class="line">git commit -m &#x27;first&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="关联远程仓库"><a href="#关联远程仓库" class="headerlink" title="关联远程仓库"></a>关联远程仓库</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add git@github.com:xxx/xxx.git</span><br></pre></td></tr></table></figure>

<h2 id="修改主分支名称"><a href="#修改主分支名称" class="headerlink" title="修改主分支名称"></a>修改主分支名称</h2><p>只有 github 是主分支 main,其他都是 master.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//强制修改当前分支为main</span><br><span class="line">git branch -M main</span><br></pre></td></tr></table></figure>

<h2 id="推送到远程并设置对应关系"><a href="#推送到远程并设置对应关系" class="headerlink" title="推送到远程并设置对应关系"></a>推送到远程并设置对应关系</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin main</span><br><span class="line"></span><br><span class="line">// 强制执行(注意会覆盖之前的)</span><br><span class="line"> git push -u origin master -f</span><br></pre></td></tr></table></figure>

<h2 id="如果之前创建了-Readme"><a href="#如果之前创建了-Readme" class="headerlink" title="如果之前创建了 Readme"></a>如果之前创建了 Readme</h2><p>大概率会推送失败,需要先拉取远程的 readme.md</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git pull origin main</span><br><span class="line">// 如果拉取报错</span><br><span class="line">git pull origin main --allow-unrelated-histories</span><br></pre></td></tr></table></figure>

<p>再执行上面的推送远程</p>
<h1 id="撤销合并"><a href="#撤销合并" class="headerlink" title="撤销合并"></a>撤销合并</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge --abort //回滚到合并之前</span><br></pre></td></tr></table></figure>

<h1 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h1><p>适用场景： 如果想恢复到之前某个提交的版本，且那个版本之后提交的版本我们都不要了，就可以用这种方法。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 版本名</span><br><span class="line">// hash名通过git log查找</span><br></pre></td></tr></table></figure>

<p>使用“git push -f”强制提交更改：<br>此时如果用“git push”会报错，因为我们本地库 HEAD 指向的版本比远程库的要旧.</p>
<blockquote>
<p>此方法就可以用于被其他人覆盖代码导致代码消失.</p>
</blockquote>
<h1 id="版本删除"><a href="#版本删除" class="headerlink" title="版本删除"></a>版本删除</h1><p>原理： git revert 是用于“反做”某一个版本，以达到撤销该版本的修改的目的。比如，我们 commit 了三个版本（版本一、版本二、 版本三），突然发现版本二不行（如：有 bug），想要撤销版本二，但又不想影响撤销版本三的提交，就可以用 git revert 命令来反做版本二，生成新的版本四，这个版本四里会保留版本三的东西，但撤销了版本二的东西</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert -n 版本名</span><br></pre></td></tr></table></figure>

<h1 id="commitlint"><a href="#commitlint" class="headerlink" title="commitlint"></a>commitlint</h1><p>提交时的分类<br>必填项，用于说明本次提交做出哪种类型的修改，必须是以下任意一值：</p>
<ul>
<li><strong>feat</strong>: A new feature（新功能）</li>
<li><strong>fix</strong>: A bug fix（bug 的修复）</li>
<li><strong>docs</strong>: Documentation only changes（修改项目中的文档）</li>
<li><strong>style</strong>: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)（不影响代码逻辑下的样式修改，通常是风格修改，例如空格、格式、分号方面的修改等）</li>
<li><strong>refactor</strong>: A code change that neither fixes a bug nor adds a feature（重构，不包括修复 bug 和添加新功能）</li>
<li><strong>perf</strong>: A code change that improves performance（性能优化）</li>
<li><strong>test</strong>: Adding missing or correcting existing tests（添加或者修改测试代码）</li>
<li><strong>chore</strong>: Changes to the build process or auxiliary tools and libraries such as documentation generation（对构建过程或辅助工具和库(如文档生成)的更改）</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/02/14/React%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Zax Tseng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ZAX">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ZAX">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/14/React%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">React工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-02-14 17:12:51" itemprop="dateCreated datePublished" datetime="2022-02-14T17:12:51+08:00">2022-02-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-12-08 17:09:28" itemprop="dateModified" datetime="2022-12-08T17:09:28+08:00">2022-12-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="不可变数据"><a href="#不可变数据" class="headerlink" title="不可变数据"></a>不可变数据</h2><p>既然是不可变数据，为何还能变更。这里说的不可变是指不能改变数据本身，如果需要改变数据，是先创建一个该数据的副本，然后在这个副本上进行修改操作，这样就在没有改变原始数据的基础上做了数据变更。此技术称之为写时复制。</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [todos, setTodos] = <span class="title function_">useState</span>([</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;learn immer&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">todo</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> newTodos = [...todos, todo]; <span class="comment">// 这里不是直接修改todos，而是创建了一个newTodos。</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">setTodos</span>(newTodos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用-immer"><a href="#使用-immer" class="headerlink" title="使用 immer"></a>使用 immer</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add immer</span><br></pre></td></tr></table></figure>

<h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//常规</span></span><br><span class="line"><span class="keyword">const</span> state = &#123; <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> newState = &#123; ...state, <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>, <span class="attr">age</span>: <span class="number">25</span> &#125;;</span><br><span class="line"><span class="comment">//immer</span></span><br><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123; <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newState = <span class="title function_">produce</span>(state, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">name</span> = <span class="string">&quot;李四&quot;</span>;</span><br><span class="line">  draft.<span class="property">age</span> = <span class="number">25</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="更多层级"><a href="#更多层级" class="headerlink" title="更多层级"></a>更多层级</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//常规</span></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newState = &#123;</span><br><span class="line">  ...state,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    ...state.<span class="property">address</span>,</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;上海&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//immer</span></span><br><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">address</span>: &#123;</span><br><span class="line">    <span class="attr">city</span>: <span class="string">&quot;北京&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newState = <span class="title function_">produce</span>(state, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="property">address</span>.<span class="property">city</span> = <span class="string">&quot;上海&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(state);</span><br><span class="line"><span class="comment">/*输出：</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  id: &#x27;1&#x27;,</span></span><br><span class="line"><span class="comment">  name: &#x27;张三&#x27;,</span></span><br><span class="line"><span class="comment">  address: &#123;</span></span><br><span class="line"><span class="comment">    city: &#x27;北京&#x27;,</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newState);</span><br><span class="line"><span class="comment">/*输出：</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  id: &#x27;1&#x27;,</span></span><br><span class="line"><span class="comment">  name: &#x27;张三&#x27;,</span></span><br><span class="line"><span class="comment">  address: &#123;</span></span><br><span class="line"><span class="comment">    city: &#x27;上海&#x27;,</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="更新数组"><a href="#更新数组" class="headerlink" title="更新数组"></a>更新数组</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newNums = [...nums, <span class="number">6</span>]; <span class="comment">// 在数组的末尾添加6</span></span><br><span class="line"><span class="keyword">const</span> newNums2 = [...nums.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>), ...nums.<span class="title function_">slice</span>(<span class="number">2</span>)]; <span class="comment">//删除数字2</span></span><br><span class="line"><span class="keyword">const</span> newNums3 = [...nums.<span class="title function_">slice</span>(<span class="number">0</span>, <span class="number">1</span>), <span class="number">7</span>, ...nums.<span class="title function_">slice</span>(<span class="number">2</span>)]; <span class="comment">// 将数字2替换为7</span></span><br></pre></td></tr></table></figure>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newNums = <span class="title function_">produce</span>(nums, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="title function_">push</span>(<span class="number">6</span>);</span><br><span class="line">&#125;); <span class="comment">// 在数组的末尾添加6</span></span><br><span class="line"><span class="keyword">const</span> newNums2 = <span class="title function_">produce</span>(nums, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="title function_">splice</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">&#125;); <span class="comment">//删除数字2</span></span><br><span class="line"><span class="keyword">const</span> newNums3 = <span class="title function_">produce</span>(nums, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">  draft.<span class="title function_">splice</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">7</span>);</span><br><span class="line">&#125;); <span class="comment">// 将数字2替换为7</span></span><br></pre></td></tr></table></figure>

<h3 id="对象数组操作"><a href="#对象数组操作" class="headerlink" title="对象数组操作"></a>对象数组操作</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todos = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;learn react&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;learn redux&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;learn immer&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">todo</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> [...todos, todo];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toggleTodo</span>(<span class="params">index</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> todos.<span class="title function_">map</span>(<span class="function">(<span class="params">todo, idx</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (idx === index) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; ...todo, <span class="attr">completed</span>: !todo.<span class="property">completed</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> todo;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> todos = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;learn react&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;learn redux&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">text</span>: <span class="string">&quot;learn immer&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">addTodo</span>(<span class="params">todo</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">produce</span>(todos, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">    draft.<span class="title function_">push</span>(todo);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">toggleTodo</span>(<span class="params">index</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">produce</span>(todos, <span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">    draft[index].<span class="property">completed</span> = !draft[index].<span class="property">completed</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在底层，immer 使用了 ES6 Proxy 对现有的状态（即 JavaScript 对象）做了代理，形成了 draft 对象。对 draft 对象的任何同步赋值操作都会被代理捕捉到，等变更操作完成后，immer 会根据捕捉到的变更操作，来生成新的 JavaScript 对象。</p>
<h3 id="与-React-的状态更新结合使用"><a href="#与-React-的状态更新结合使用" class="headerlink" title="与 React 的状态更新结合使用"></a>与 React 的状态更新结合使用</h3><p>使用 immer 可以简化深层的状态更新操作。如下所示：</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useState &#125; <span class="keyword">from</span> <span class="string">&quot;React&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [user, setUser] = <span class="title function_">useState</span>(&#123;</span><br><span class="line">  <span class="attr">userName</span>: <span class="string">&quot;张三&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">16</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 常规方式</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBirthDayClick</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setUser</span>(<span class="function">(<span class="params">prevUser</span>) =&gt;</span> (&#123;</span><br><span class="line">    ...prevUser,</span><br><span class="line">    <span class="attr">age</span>: prevUser.<span class="property">age</span> + <span class="number">1</span>,</span><br><span class="line">  &#125;));</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// immer方式</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleBirthDayClick2</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="title function_">setUser</span>(</span><br><span class="line">    <span class="title function_">produce</span>(<span class="function">(<span class="params">draft</span>) =&gt;</span> &#123;</span><br><span class="line">      draft.<span class="property">age</span> += <span class="number">1</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当然，如果真的遇到很深层次的 React 组件状态，就需要看看是否真的有必要设计出这么深层次的数据结构。</p>
<p>immer 更常见的是与 useReducer 结合使用：</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useReducer &#125; <span class="keyword">from</span> <span class="string">&quot;React&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> produce <span class="keyword">from</span> <span class="string">&quot;immer&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> todoReducers = <span class="title function_">produce</span>(<span class="function">(<span class="params">draft, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.<span class="property">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;ADD_TODO&quot;</span>:</span><br><span class="line">      draft.<span class="title function_">push</span>(action.<span class="property">payload</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;TOGGLE_TODO&quot;</span>:</span><br><span class="line">      draft[action.<span class="property">payload</span>].<span class="property">completed</span> = !draft[action.<span class="property">payload</span>].<span class="property">completed</span>;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [todos, dispatch] = <span class="title function_">useReducer</span>(todoReducers, []);</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zax Tseng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
